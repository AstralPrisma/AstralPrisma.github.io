<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>HECTF 2024 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="刚出新手村后正经打的第一场个人赛，单就re方向来说感觉难度还行？上传这篇wp到github时又看了看这些题目，发觉当时认为很困难的题目现在貌似都能迎刃而解了，成长和进步总是在不知不觉中就发生了… Reverse方向：babyre：反编译观察主函数： 12345678910111213141516171819202122232425262728293031__int64 __fastcall mai">
<meta property="og:type" content="article">
<meta property="og:title" content="HECTF 2024 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2024/12/09/hectf_24/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="刚出新手村后正经打的第一场个人赛，单就re方向来说感觉难度还行？上传这篇wp到github时又看了看这些题目，发觉当时认为很困难的题目现在貌似都能迎刃而解了，成长和进步总是在不知不觉中就发生了… Reverse方向：babyre：反编译观察主函数： 12345678910111213141516171819202122232425262728293031__int64 __fastcall mai">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-12-08T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-20T18:58:49.878Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Ideas/">
                Ideas
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">26</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-hectf_24" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        HECTF 2024 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2024-12-08T16:00:00.000Z" itemprop="datePublished">2024-12-09</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            6.7k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>刚出新手村后正经打的第一场个人赛，单就re方向来说感觉难度还行？</em><br><br><small><em>上传这篇wp到github时又看了看这些题目，发觉当时认为很困难的题目现在貌似都能迎刃而解了，成长和进步总是在不知不觉中就发生了…</em></small></p>
<h1 id="Reverse方向："><a href="#Reverse方向：" class="headerlink" title="Reverse方向："></a>Reverse方向：</h1><h2 id="babyre："><a href="#babyre：" class="headerlink" title="babyre："></a>babyre：</h2><p>反编译观察主函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-A0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">32</span>]; <span class="comment">// [rsp+20h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">32</span>]; <span class="comment">// [rsp+40h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">40</span>]; <span class="comment">// [rsp+60h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+88h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v10 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string(v6, a2, a3);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string(v7, a2, v3);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string(v8, a2, v4);</span><br><span class="line">  <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, &amp;unk_21AD); <span class="comment">//输出“enter a string：”</span></span><br><span class="line">  <span class="built_in">std</span>::operator&gt;&gt;&lt;<span class="type">char</span>&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, v6); <span class="comment">//输入</span></span><br><span class="line">  sub_147E();</span><br><span class="line">  sub_1558();</span><br><span class="line">  sub_13A9(v8, v6);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::operator=(v7, v6);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string(v9, v6);</span><br><span class="line">  sub_1920(v9, v7);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v9);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string(v9, v7);</span><br><span class="line">  sub_17A7(v9);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v9);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v8);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v7);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v6);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看其中的<strong>sub_147E</strong>和<strong>sub_1558</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_147E</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">99</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (((_BYTE)j * (_BYTE)i + (_BYTE)i - (_BYTE)j) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">        v0 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Odd  result: &quot;</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v0 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Even result: &quot;</span>);</span><br><span class="line">      v1 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(v0, (<span class="type">unsigned</span> <span class="type">int</span>)(j * i + i - j));</span><br><span class="line">      <span class="built_in">std</span>::ostream::operator&lt;&lt;(v1, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">__int64 <span class="title function_">sub_1558</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">double</span>)rand() / <span class="number">2147483647.0</span> &gt;= <span class="number">0.5</span> )</span><br><span class="line">    v0 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Random value is greater than or equal to 0.5&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v0 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Random value is less than 0.5&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">std</span>::ostream::operator&lt;&lt;(v0, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这两个函数仅仅展示了判断奇偶性和随机生成布尔值的算法，再看<strong>sub_13A9</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_13A9</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// bl</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+18h] [rbp-38h] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+20h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v9; <span class="comment">// [rsp+38h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v6 = <span class="built_in">std</span>::<span class="built_in">string</span>::length(a2);</span><br><span class="line">  v5 = <span class="built_in">std</span>::<span class="built_in">string</span>::length(a1);</span><br><span class="line">  v8 = *(_QWORD *)sub_1DC2(&amp;v5, &amp;v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; v8; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(_BYTE *)<span class="built_in">std</span>::<span class="built_in">string</span>::operator[](a1, i);</span><br><span class="line">    v3 = *(_BYTE *)<span class="built_in">std</span>::<span class="built_in">string</span>::operator[](a2, i) ^ v2;</span><br><span class="line">    *(_BYTE *)<span class="built_in">std</span>::<span class="built_in">string</span>::operator[](a1, i) = v3;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v9 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是一个简单的异或，但实际运行却由于未知原因会产生段错误，查看v8的来源函数<strong>sub_1DC2</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">sub_1DC2</span><span class="params">(_QWORD *a1, _QWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( *a2 &gt;= *a1 )</span><br><span class="line">    <span class="keyword">return</span> a1;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>只是比较了两个数组的长度大小，取两个之中更短的那个长度，查看main后续的<strong>sub_1920</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_1920</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v2; <span class="comment">// rdx</span></span><br><span class="line">  _BYTE *v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+10h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+14h] [rbp-9Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-98h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+1Ch] [rbp-94h]</span></span><br><span class="line">  _WORD *v9; <span class="comment">// [rsp+20h] [rbp-90h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// [rsp+28h] [rbp-88h]</span></span><br><span class="line">  <span class="type">char</span> v11[<span class="number">44</span>]; <span class="comment">// [rsp+30h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+5Ch] [rbp-54h]</span></span><br><span class="line">  __int64 v13[<span class="number">6</span>]; <span class="comment">// [rsp+60h] [rbp-50h] BYREF</span></span><br><span class="line">  __int16 v14; <span class="comment">// [rsp+90h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v15; <span class="comment">// [rsp+98h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v15 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v13, <span class="number">0</span>, <span class="keyword">sizeof</span>(v13));</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">63</span>; ++i )</span><br><span class="line">    *((_BYTE *)v13 + i) = dword_2040[i];</span><br><span class="line">  v10 = <span class="built_in">std</span>::<span class="built_in">string</span>::size(a1);</span><br><span class="line">  v9 = (_WORD *)<span class="built_in">std</span>::<span class="built_in">string</span>::data(a1);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::basic_string(v11, a2, v2);</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; (<span class="type">int</span>)(v10 / <span class="number">3</span>); ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)((<span class="type">char</span> *)&amp;v12 + <span class="number">1</span>) = *v9;</span><br><span class="line">    v3 = v9 + <span class="number">1</span>;</span><br><span class="line">    v9 = (_WORD *)((<span class="type">char</span> *)v9 + <span class="number">3</span>);</span><br><span class="line">    HIBYTE(v12) = *v3;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (BYTE1(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (((<span class="type">unsigned</span> __int8)(<span class="number">16</span> * BYTE1(v12)) | (BYTE2(v12) &gt;&gt; <span class="number">4</span>)) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (((<span class="type">unsigned</span> __int8)(<span class="number">4</span> * BYTE2(v12)) | (HIBYTE(v12) &gt;&gt; <span class="number">6</span>)) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (HIBYTE(v12) &amp; <span class="number">0x3F</span>)));</span><br><span class="line">    v6 += <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v6 == <span class="number">76</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, <span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v8 = v10 % <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v8 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    BYTE1(v12) = *(_BYTE *)v9;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (BYTE1(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">16</span> * BYTE1(v12)) &amp; <span class="number">0x30</span>)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, <span class="string">&quot;==&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v8 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_WORD *)((<span class="type">char</span> *)&amp;v12 + <span class="number">1</span>) = *v9;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + (BYTE1(v12) &gt;&gt; <span class="number">2</span>)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(</span><br><span class="line">      v11,</span><br><span class="line">      (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">16</span> * BYTE1(v12)) &amp; <span class="number">0x30</span> | (<span class="type">unsigned</span> <span class="type">int</span>)(BYTE2(v12) &gt;&gt; <span class="number">4</span>))));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, (<span class="type">unsigned</span> <span class="type">int</span>)*((<span class="type">char</span> *)v13 + ((<span class="number">4</span> * BYTE2(v12)) &amp; <span class="number">0x3C</span>)));</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span>::operator+=(v11, <span class="string">&quot;=&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::operator=(a2, v11);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">string</span>::~<span class="built_in">string</span>(v11);</span><br><span class="line">  <span class="keyword">return</span> v15 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是base64加密，查看有没有换表，查看<strong>dword_2040</strong>发现是<font color=red><strong>yzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789+&#x2F;abcdefghijklmnopqrstuvwx</strong></font>，说明换表了，接着往后查看<strong>sub_17A7</strong>：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_17A7</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [rsp+10h] [rbp-1B0h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-1ACh]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+18h] [rbp-1A8h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-1A4h]</span></span><br><span class="line">  <span class="type">int</span> v6[<span class="number">102</span>]; <span class="comment">// [rsp+20h] [rbp-1A0h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+1B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v5 = <span class="built_in">std</span>::<span class="built_in">string</span>::length(a1);</span><br><span class="line">  <span class="built_in">memset</span>(v6, <span class="number">0</span>, <span class="number">0x190u</span>LL);</span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">    v6[i] = *(<span class="type">char</span> *)<span class="built_in">std</span>::<span class="built_in">string</span>::operator[](a1, i) ^ (i / <span class="number">3</span>);					<span class="comment">//将字符与索引号整除以三进行异或</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v5; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6[j] != dword_4020[j] )									<span class="comment">//比较</span></span><br><span class="line">    &#123;</span><br><span class="line">      v2 = <span class="number">1</span>;</span><br><span class="line">      <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Wrong Value&quot;</span>);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !v2 )</span><br><span class="line">    <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Currunt Value&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v7 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是比较结果，查看<strong>dword_4020</strong>：<font color=lime><strong>[0x51, 0x43, 0x54, 0x43, 0x55, 0x42, 0x5A, 0x76, 0x4F, 0x46, 0x48, 0x73, 0x5C, 0x46, 0x7D, 0x6B, 0x4E, 0x50, 0x55, 0x68, 0x51, 0x55, 0x7D, 0x3E, 0x45, 0x5D, 0x43, 0x67, 0x45, 0x3E, 0x3B, 0x3D, 0x47, 0x49, 0x53, 0x20, 0x54, 0x59, 0x43, 0x60, 0x40, 0x5F, 0x49, 0x7E, 0x45, 0x38, 0x75, 0x38, 0x47, 0x7C, 0x25, 0x29, 0x5A, 0x7D, 0x59, 0x63, 0x5F, 0x46, 0x57, 0x38, 0x5F, 0x42, 0x79, 0x28]</strong></font>，至此已经分析完毕，输入的字符串先与一个key进行异或（疑似会报错），接着经过了换表的base64，再之后又异或了索引号整除以3的值，最后与加密的flag进行比较，先把最后的异或索引号逆向：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0x51</span>, <span class="number">0x43</span>, <span class="number">0x54</span>, <span class="number">0x43</span>, <span class="number">0x55</span>, <span class="number">0x42</span>, <span class="number">0x5A</span>, <span class="number">0x76</span>, <span class="number">0x4F</span>, <span class="number">0x46</span>, <span class="number">0x48</span>, <span class="number">0x73</span>, <span class="number">0x5C</span>, <span class="number">0x46</span>, <span class="number">0x7D</span>, <span class="number">0x6B</span>, <span class="number">0x4E</span>, <span class="number">0x50</span>, <span class="number">0x55</span>, <span class="number">0x68</span>, <span class="number">0x51</span>, <span class="number">0x55</span>, <span class="number">0x7D</span>, <span class="number">0x3E</span>, <span class="number">0x45</span>, <span class="number">0x5D</span>, <span class="number">0x43</span>, <span class="number">0x67</span>, <span class="number">0x45</span>, <span class="number">0x3E</span>, <span class="number">0x3B</span>, <span class="number">0x3D</span>, <span class="number">0x47</span>, <span class="number">0x49</span>, <span class="number">0x53</span>, <span class="number">0x20</span>, <span class="number">0x54</span>, <span class="number">0x59</span>, <span class="number">0x43</span>, <span class="number">0x60</span>, <span class="number">0x40</span>, <span class="number">0x5F</span>, <span class="number">0x49</span>, <span class="number">0x7E</span>, <span class="number">0x45</span>, <span class="number">0x38</span>, <span class="number">0x75</span>, <span class="number">0x38</span>, <span class="number">0x47</span>, <span class="number">0x7C</span>, <span class="number">0x25</span>, <span class="number">0x29</span>, <span class="number">0x5A</span>, <span class="number">0x7D</span>, <span class="number">0x59</span>, <span class="number">0x63</span>, <span class="number">0x5F</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x38</span>, <span class="number">0x5F</span>, <span class="number">0x42</span>, <span class="number">0x79</span>, <span class="number">0x28</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">    enc[i] ^= i//<span class="number">3</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%#x&#x27;</span> % enc[i],end=<span class="string">&quot; &quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出<font color=red><strong>0x51 0x43 0x54 0x42 0x54 0x43 0x58 0x74 0x4d 0x45 0x4b 0x70 0x58 0x42 0x79 0x6e 0x4b 0x55 0x53 0x6e 0x57 0x52 0x7a 0x39 0x4d 0x55 0x4b 0x6e 0x4c 0x37 0x31 0x37 0x4d 0x42 0x58 0x2b 0x58 0x55 0x4f 0x6d 0x4d 0x52 0x47 0x70 0x4b 0x37 0x7a 0x37 0x57 0x6c 0x35 0x38 0x4b 0x6c 0x4b 0x71 0x4d 0x55 0x44 0x2b 0x4b 0x56 0x6d 0x3d</strong></font>，转换得到换表后的base64：<font color=lime><strong>QCTBTCXtMEKpXBynKUSnWRz9MUKnL717MBX+XUOmMRGpK7z7Wl58KlKqMUD+KVm&#x3D;</strong></font>，带入cyberchef解密直接得到flag了：<font color=deepskyblue><strong>HECTF{8c7d051e5a0e9c567c86fed492720cc8d3389af1}</strong></font>.</p>
<h2 id="littleasm："><a href="#littleasm：" class="headerlink" title="littleasm："></a>littleasm：</h2><p>观察汇编代码：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">   .section</span>   .data</span><br><span class="line"><span class="symbol">flag:</span> .space <span class="number">28</span></span><br><span class="line"><span class="symbol">key:</span>  .ascii <span class="string">&quot;rev&quot;</span> <span class="comment">;密钥</span></span><br><span class="line"><span class="symbol">data:</span> .byte <span class="number">0x6a</span>,<span class="number">0x28</span>,<span class="number">0x3d</span>,<span class="number">0x4e</span>,<span class="number">0x2b</span>,<span class="number">0x5</span>,<span class="number">0x63</span>,<span class="number">0x1e</span>,<span class="number">0xd</span>,<span class="number">0x73</span>,<span class="number">0x10</span>,<span class="number">0x1c</span>,<span class="number">0x73</span>,<span class="number">0x24</span>,<span class="number">0x21</span>,<span class="number">0x73</span>,<span class="number">0x5e</span>,<span class="number">0x21</span>,<span class="number">0x31</span>,<span class="number">0x5d</span>,<span class="number">0x21</span>,<span class="number">0x3f</span>,<span class="number">0xc</span>,<span class="number">0xd</span>,<span class="number">0x6d</span>,<span class="number">0x4c</span>,<span class="number">0x3</span> <span class="comment">;明显是加密的flag</span></span><br><span class="line"><span class="symbol">msg_wrong:</span>  .ascii <span class="string">&quot;WRONG!!!\n&quot;</span></span><br><span class="line"><span class="symbol">msg_right:</span>  .ascii <span class="string">&quot;Right!!\n&quot;</span></span><br><span class="line"><span class="meta">   .section</span>   .text</span><br><span class="line"><span class="meta">   .globl</span>  main</span><br><span class="line"><span class="symbol">main:</span></span><br><span class="line">    pushl   %ebp</span><br><span class="line">    movl    %esp, %ebp</span><br><span class="line">    subl    <span class="number">$28</span>, %esp</span><br><span class="line"></span><br><span class="line">    leal    flag, %eax</span><br><span class="line">    pushl   %eax</span><br><span class="line">    <span class="keyword">call</span>    scanf <span class="comment">;输入flag</span></span><br><span class="line">    addl    <span class="number">$4</span>, %esp</span><br><span class="line"></span><br><span class="line">    movl    <span class="number">$0</span>, %ecx</span><br><span class="line"><span class="symbol">encrypt_loop:</span> <span class="comment">;加密循环</span></span><br><span class="line">    cmpl    <span class="number">$27</span>, %ecx <span class="comment">;比较输入长度</span></span><br><span class="line">    <span class="keyword">jge</span>     check_loop</span><br><span class="line"></span><br><span class="line">    movl    %ecx, %edx</span><br><span class="line">    addl    <span class="number">$2</span>, %edx</span><br><span class="line">    movl    <span class="number">$3</span>, %eax</span><br><span class="line">    divl    %eax</span><br><span class="line">    <span class="keyword">movzx</span>   %dl, %edx <span class="comment">;三个字符一组，每组第一个</span></span><br><span class="line">    <span class="keyword">movzx</span>   data(,%ecx,<span class="number">1</span>), %eax</span><br><span class="line">    <span class="keyword">movzx</span>   flag(,%ecx,<span class="number">1</span>), %ebx</span><br><span class="line">    <span class="keyword">movzx</span>   key(,%edx,<span class="number">1</span>), %esi</span><br><span class="line">    xorl    %ebx, %esi <span class="comment">;与key异或</span></span><br><span class="line">    addl    <span class="number">$0</span>x2C, %esi <span class="comment">;加上0x2C</span></span><br><span class="line">    movb    %sil, data(,%ecx,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    movl    %ecx, %edx <span class="comment">;第二个</span></span><br><span class="line">    addl    <span class="number">$1</span>, %edx</span><br><span class="line">    movl    <span class="number">$3</span>, %eax</span><br><span class="line">    divl    %eax</span><br><span class="line">    <span class="keyword">movzx</span>   %dl, %edx</span><br><span class="line">    <span class="keyword">movzx</span>   data(,%ecx + <span class="number">1</span>,<span class="number">1</span>), %eax</span><br><span class="line">    <span class="keyword">movzx</span>   flag(,%ecx + <span class="number">1</span>,<span class="number">1</span>), %ebx</span><br><span class="line">    <span class="keyword">movzx</span>   key(,%edx,<span class="number">1</span>), %esi</span><br><span class="line">    xorl    %ebx, %esi <span class="comment">;与key异或</span></span><br><span class="line">    addl    <span class="number">$0</span>x8, %esi <span class="comment">;加上0x8</span></span><br><span class="line">    movb    %sil, data(,%ecx + <span class="number">1</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    movl    %ecx, %edx <span class="comment">;第三个</span></span><br><span class="line">    movl    <span class="number">$3</span>, %eax</span><br><span class="line">    divl    %eax</span><br><span class="line">    <span class="keyword">movzx</span>   %dl, %edx</span><br><span class="line">    <span class="keyword">movzx</span>   data(,%ecx + <span class="number">2</span>,<span class="number">1</span>), %eax</span><br><span class="line">    <span class="keyword">movzx</span>   flag(,%ecx + <span class="number">2</span>,<span class="number">1</span>), %ebx</span><br><span class="line">    <span class="keyword">movzx</span>   key(,%edx,<span class="number">1</span>), %esi</span><br><span class="line">    xorl    %ebx, %esi <span class="comment">;与key异或</span></span><br><span class="line">    xorl    <span class="number">$0</span>xC, %esi <span class="comment">;异或0xC</span></span><br><span class="line">    movb    %sil, data(,%ecx + <span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    addl    <span class="number">$3</span>, %ecx</span><br><span class="line">    <span class="keyword">jmp</span>     encrypt_loop</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">check_loop:</span></span><br><span class="line">    movl    <span class="number">$0</span>, %ecx</span><br><span class="line">    movl    <span class="number">$0</span>, %edx</span><br><span class="line"><span class="symbol">compare_loop:</span></span><br><span class="line">    cmpl    <span class="number">$27</span>, %ecx</span><br><span class="line">    <span class="keyword">jge</span>     check_result</span><br><span class="line"></span><br><span class="line">    <span class="keyword">movzx</span>   flag(,%ecx,<span class="number">1</span>), %eax</span><br><span class="line">    <span class="keyword">movzx</span>   data(,%ecx,<span class="number">1</span>), %ebx</span><br><span class="line">    cmpb    %al, %bl</span><br><span class="line">    <span class="keyword">jne</span>     set_wrong</span><br><span class="line"></span><br><span class="line">    addl    <span class="number">$1</span>, %ecx</span><br><span class="line">    <span class="keyword">jmp</span>     compare_loop</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">set_wrong:</span></span><br><span class="line">    movl    <span class="number">$1</span>, %edx</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">check_result:</span></span><br><span class="line">    cmpl    <span class="number">$0</span>, %edx</span><br><span class="line">    <span class="keyword">jne</span>     print_wrong</span><br><span class="line"></span><br><span class="line">    leal    msg_right, %eax</span><br><span class="line">    pushl   %eax</span><br><span class="line">    <span class="keyword">call</span>    printf</span><br><span class="line">    addl    <span class="number">$4</span>, %esp</span><br><span class="line"></span><br><span class="line">    <span class="keyword">jmp</span>     end_main</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">print_wrong:</span></span><br><span class="line">    leal    msg_wrong, %eax</span><br><span class="line">    pushl   %eax</span><br><span class="line">    <span class="keyword">call</span>    printf</span><br><span class="line">    addl    <span class="number">$4</span>, %esp</span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">end_main:</span></span><br><span class="line">    movl    %ebp, %esp</span><br><span class="line">    popl    %ebp</span><br><span class="line"><span class="keyword">ret</span></span><br></pre></td></tr></table></figure>
<p>编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enc_flag = [<span class="number">0x6a</span>, <span class="number">0x28</span>, <span class="number">0x3d</span>, <span class="number">0x4e</span>, <span class="number">0x2b</span>, <span class="number">0x05</span>, <span class="number">0x63</span>, <span class="number">0x1e</span>, <span class="number">0x0d</span>, <span class="number">0x73</span>, <span class="number">0x10</span>, <span class="number">0x1c</span>, <span class="number">0x73</span>, <span class="number">0x24</span>, <span class="number">0x21</span>, <span class="number">0x73</span>, <span class="number">0x5e</span>, <span class="number">0x21</span>, <span class="number">0x31</span>, <span class="number">0x5d</span>, <span class="number">0x21</span>, <span class="number">0x3f</span>, <span class="number">0x0c</span>, <span class="number">0x0d</span>, <span class="number">0x6d</span>, <span class="number">0x4c</span>, <span class="number">0x03</span>]</span><br><span class="line">key = <span class="string">&quot;rev&quot;</span></span><br><span class="line">flag = <span class="built_in">bytearray</span>(<span class="number">28</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">27</span>, <span class="number">3</span>):</span><br><span class="line">    flag[i] = (enc_flag[i] - <span class="number">0x2C</span>) ^ <span class="built_in">ord</span>(key[(i + <span class="number">2</span>) % <span class="built_in">len</span>(key)]) &amp; <span class="number">0xFF</span></span><br><span class="line">    flag[i + <span class="number">1</span>] = (enc_flag[i + <span class="number">1</span>] - <span class="number">0x8</span>) ^ <span class="built_in">ord</span>(key[(i + <span class="number">1</span>) % <span class="built_in">len</span>(key)]) &amp; <span class="number">0xFF</span></span><br><span class="line">    flag[i + <span class="number">2</span>] = ((enc_flag[i + <span class="number">2</span>] ^ <span class="number">0xC</span>) ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) &amp; <span class="number">0xFF</span></span><br><span class="line"><span class="built_in">print</span>(flag.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>
<p>运行得到flag：<font color=deepskyblue><strong>HECTF{Ass1mb1y_13_s0_eas7!}</strong></font>.</p>
<h2 id="PE-py-："><a href="#PE-py-：" class="headerlink" title="PE?py?："></a>PE?py?：</h2><p>查看压缩包发现需要密码，pyre联系名称是python逆向，用pyinstxtractor提取后再用pycdc反编译pyre.pyc，得到：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;PE?py?\n&#x27;</span>)</span><br><span class="line">data = <span class="string">&#x27;the_key_is_:&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;Have_a_cup_of_tea_together&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Can you uncover the secrets of this file?&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>则压缩包密码就是<font color=lime><strong>“Have_a_cup_of_tea_together”</strong></font>，解压缩得到<code>main1.exe</code>，发现就是正常的程序，直接用ida反编译，查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i_0; <span class="comment">// [rsp+44h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> flag; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  _main();</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, cipher); <span class="comment">//输入</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">11</span>; i += <span class="number">2</span> ) <span class="comment">//加密6次，一次带入8个字符，共48字符</span></span><br><span class="line">    encrypt(<span class="number">0x20u</span>, (<span class="type">uint32_t</span> *)&amp;cipher[<span class="number">4</span> * i], (<span class="type">const</span> <span class="type">uint32_t</span> *)keys); <span class="comment">//加密</span></span><br><span class="line">  flag = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i_0 = <span class="number">0</span>; i_0 &lt;= <span class="number">49</span>; ++i_0 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( cipher[i_0] != data[i_0] ) <span class="comment">//比较</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;error T_T&quot;</span>);</span><br><span class="line">      flag = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !flag )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Right!!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现结构很清晰，再查看加密函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">encrypt</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> num_rounds, <span class="type">uint32_t</span> *v, <span class="type">const</span> <span class="type">uint32_t</span> *key)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint32_t</span> sum; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">uint32_t</span> v1; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">uint32_t</span> v0; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v0 = *v;</span><br><span class="line">  v1 = v[<span class="number">1</span>];</span><br><span class="line">  sum = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; num_rounds; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v0 += (((v1 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v1)) + v1) ^ (key[sum &amp; <span class="number">3</span>] + sum);</span><br><span class="line">    sum += <span class="number">0x9E3779B9</span>;</span><br><span class="line">    v1 += (((v0 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v0)) + v0) ^ (key[(sum &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + sum);</span><br><span class="line">  &#125;</span><br><span class="line">  *v = v0;</span><br><span class="line">  v[<span class="number">1</span>] = v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是XTEA，查看数组得到key为<font color=lime><strong>[0x48, 0x45, 0x43, 0x54, 0x46, 0x32, 0x30, 0x32, 0x34, 0x77, 0x61, 0x69, 0x74, 0x79, 0x6F, 0x75]</strong></font>（<font color=lime><strong>HECTF2024waityou</strong></font>），转换为32位整数得到<font color=LimeGreen><strong>[0x54434548, 0x32303246, 0x69617734, 0x756F7974]</strong></font>，而加密的flag则是<font color=red><strong>[0x94, 0x61, 0x59, 0xDF, 0xD6, 0x74, 0xFE, 0x2C, 0x4D, 0xAE, 0x55, 0x13, 0x87, 0x7A, 0x71, 0xB6, 0x7B, 0xB5, 0x7B, 0xF2, 0xC5, 0x36, 0xD4, 0x08, 0xAF, 0xE1, 0xC8, 0xC5, 0x8F, 0xBD, 0x85, 0x0A, 0x32, 0x00, 0xA7, 0x19, 0xF4, 0xFE, 0x0C, 0x40, 0xFC, 0xE1, 0x02, 0xAF, 0xB4, 0xCF, 0xED, 0xCD]</strong></font>（48长度，带入XTEA加密，4个字符一组是<font color=red><strong>[0xDF596194, 0x2CFE74D6, 0x1355AE4D, 0xB6717A87, 0xF27BB57B, 0x08D436C5, 0xC5C8E1AF, 0x0A85BD8F, 0x19A70032, 0x400CFEF4, 0xAF02E1FC, 0xCDEDCFB4]</strong></font>），基本信息已经获得完全，还原加密函数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">m1 = <span class="number">0x34333231</span>  <span class="comment"># 小端序前四字节</span></span><br><span class="line">m2 = <span class="number">0x38373635</span>  <span class="comment"># 小端序后四字节</span></span><br><span class="line"><span class="comment"># XTEA</span></span><br><span class="line">key = [<span class="number">0x54434548</span>, <span class="number">0x32303246</span>, <span class="number">0x69617734</span>, <span class="number">0x756F7974</span>]  <span class="comment"># 密钥</span></span><br><span class="line">ttl = <span class="number">0</span>  <span class="comment"># sum</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    m1 = (m1 + ((((m2 &gt;&gt; <span class="number">5</span>) ^ (m2 &lt;&lt; <span class="number">4</span>)) + m2) ^ (key[ttl &amp; <span class="number">3</span>] + ttl))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    ttl = (ttl + <span class="number">0x9E3779B9</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    m2 = (m2 + ((((m1 &gt;&gt; <span class="number">5</span>) ^ (m1 &lt;&lt; <span class="number">4</span>)) + m1) ^ (key[(ttl &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + ttl))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%#x&#x27;</span> % m1, <span class="string">&#x27;%#x&#x27;</span> % m2)</span><br></pre></td></tr></table></figure>
<p>带入检验发现输出结果相同，编写逆向解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 密文</span></span><br><span class="line">enc = [<span class="number">0xDF596194</span>, <span class="number">0x2CFE74D6</span>, <span class="number">0x1355AE4D</span>, <span class="number">0xB6717A87</span>, <span class="number">0xF27BB57B</span>, <span class="number">0x08D436C5</span>,</span><br><span class="line">       <span class="number">0xC5C8E1AF</span>, <span class="number">0x0A85BD8F</span>, <span class="number">0x19A70032</span>, <span class="number">0x400CFEF4</span>, <span class="number">0xAF02E1FC</span>, <span class="number">0xCDEDCFB4</span>]</span><br><span class="line">c1 = [<span class="number">0xDF596194</span>, <span class="number">0x1355AE4D</span>, <span class="number">0xF27BB57B</span>, <span class="number">0xC5C8E1AF</span>, <span class="number">0x19A70032</span>, <span class="number">0xAF02E1FC</span>]</span><br><span class="line">c2 = [<span class="number">0x2CFE74D6</span>, <span class="number">0xB6717A87</span>, <span class="number">0x08D436C5</span>, <span class="number">0x0A85BD8F</span>, <span class="number">0x400CFEF4</span>, <span class="number">0xCDEDCFB4</span>]</span><br><span class="line">key = [<span class="number">0x54434548</span>, <span class="number">0x32303246</span>, <span class="number">0x69617734</span>, <span class="number">0x756F7974</span>]  <span class="comment"># 密钥</span></span><br><span class="line"><span class="comment"># TEA解密</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c1)):</span><br><span class="line">    ttl = (<span class="number">32</span> * <span class="number">0x9E3779B9</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        c2[i] = (c2[i] - ((((c1[i] &gt;&gt; <span class="number">5</span>) ^ (c1[i] &lt;&lt; <span class="number">4</span>)) + c1[i]) ^ (key[(ttl &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + ttl))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        ttl = (ttl - <span class="number">0x9E3779B9</span>) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        c1[i] = (c1[i] - ((((c2[i] &gt;&gt; <span class="number">5</span>) ^ (c2[i] &lt;&lt; <span class="number">4</span>)) + c2[i]) ^ (key[ttl &amp; <span class="number">3</span>] + ttl))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;%#x&#x27;</span> % c1[i], <span class="string">&#x27;%#x&#x27;</span> % c2[i])</span><br></pre></td></tr></table></figure>
<p>输出：<font color=red><strong>0x54434548 0x38357b46 0x31306564 0x612d6366 0x2d623666 0x36666338 0x6338652d 0x62642d61 0x34363935 0x62306563 0x7d6531 0x0</strong></font>，十六进制转字符串得<code>TCEH 85&#123;F 10ed a-cf -b6f 6fc8 c8e- bd-a 4695 b0ec &#125;e1</code>，转换端序得到flag：<font color=deepskyblue><strong>HECTF{58de01fc-af6b-8cf6-e8ca-db5964ce0b1e}</strong></font>.</p>
<h2 id="ezAndroid："><a href="#ezAndroid：" class="headerlink" title="ezAndroid："></a>ezAndroid：</h2><p>题目提示说该APK不能正常运行，那么只能静态分析了，查看<code>MainActivity</code>，发现了引用的本地库<code>ezandroid</code>，还发现了key字符串为<font color=red><strong>“HECTF”</strong></font>，接下来给出了一个RC4解密函数，然后用RC4和key解密了一个名为<code>enc.png</code>的文件，尝试写入<code>/sdcard</code>的<code>right.txt</code>，此外还发现了一个<code>CheckActivity</code>，点击按钮时执行下面的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">    CheckActivity.<span class="built_in">this</span>.d0func();</span><br><span class="line">    <span class="keyword">if</span> (CheckActivity.<span class="built_in">this</span>.stringFromJNI(CheckActivity.<span class="built_in">this</span>.input.getText().toString().trim()) == <span class="number">1</span>) &#123;</span><br><span class="line">        Toast.makeText(CheckActivity.<span class="built_in">this</span>, <span class="string">&quot;you get it&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Toast.makeText(CheckActivity.<span class="built_in">this</span>, <span class="string">&quot;try again&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么关键的加密应该都在so层，而此外<code>CheckActivity</code>还给出了一个<code>func</code>函数，会将16长度的数组与<font color=red><strong>“hectf2024”</strong></font>循环异或，但貌似没找到引用，至此线索分成两个方向，一个是enc.png，另一个是so文件，提取资源文件，发现enc.png有7.3M，先将enc.png试图进行RC4解密，得到了right.txt，发现其实是png文件，查看得到flag格式是HECTF{填入数据的MD5}，接下来查看so文件，找到两个函数并反编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">Java_com_hectf2024_ezandroid_CheckActivity_d0func</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// r9d</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r9d</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+20h] [rbp-F0h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+28h] [rbp-E8h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+30h] [rbp-E0h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+38h] [rbp-D8h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+40h] [rbp-D0h]</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [rsp+48h] [rbp-C8h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+50h] [rbp-C0h]</span></span><br><span class="line">  __int64 v15; <span class="comment">// [rsp+58h] [rbp-B8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+64h] [rbp-ACh]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+64h] [rbp-ACh]</span></span><br><span class="line">  <span class="type">pthread_t</span> newthread; <span class="comment">// [rsp+78h] [rbp-98h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v19[<span class="number">16</span>]; <span class="comment">// [rsp+80h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v20[<span class="number">18</span>]; <span class="comment">// [rsp+C0h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v21; <span class="comment">// [rsp+108h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v21 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  pthread_create(&amp;newthread, <span class="number">0LL</span>, start_routine, <span class="number">0LL</span>);</span><br><span class="line">  pthread_join(newthread, <span class="number">0LL</span>);</span><br><span class="line">  v15 = sub_2F60(a1, <span class="string">&quot;com/hectf2024/ezandroid/CheckActivity&quot;</span>);</span><br><span class="line">  v14 = sub_2F90(a1, v15, (__int64)<span class="string">&quot;&lt;init&gt;&quot;</span>, (__int64)<span class="string">&quot;()V&quot;</span>);</span><br><span class="line">  v13 = sub_2FF0(a1, v15, v14, v1, v2, v3);</span><br><span class="line">  v12 = sub_2F90(a1, v15, (__int64)<span class="string">&quot;func&quot;</span>, (__int64)<span class="string">&quot;([I)Ljava/lang/String;&quot;</span>); <span class="comment">//刚刚的循环异或</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    v20[i] = dword_5000[i]; <span class="comment">//[0x58, 0x12, 0x1A, 0x0C, 0x1B, 0x5E, 0x58, 0x40, 0x46, 0x06, 0x0A, 0x26, 0x44, 0x0C, 0x56, 0x48]</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">16</span>; ++j )</span><br><span class="line">    v19[j] = dword_5040[j]; <span class="comment">//[0x15, 0x10, 0x48, 0x06, 0x19, 0x42, 0x6D, 0x18, 0x12, 0x0F, 0x27, 0x2F, 0x33, 0x1B, 0x50, 0x41]</span></span><br><span class="line">  v11 = sub_31A0(a1, <span class="number">16LL</span>);</span><br><span class="line">  sub_31D0(a1, v11, <span class="number">0</span>, <span class="number">0x10u</span>, (__int64)v20);</span><br><span class="line">  v10 = sub_3230(a1, v13, v12, v11, 	v4, <span class="number">0</span>);</span><br><span class="line">  v9 = sub_31A0(a1, <span class="number">16LL</span>);</span><br><span class="line">  sub_31D0(a1, v9, <span class="number">0</span>, <span class="number">0x10u</span>, (__int64)v19);</span><br><span class="line">  v8 = sub_3230(a1, v13, v12, v9, v5, v6);</span><br><span class="line">  qword_51C0 = sub_2BF0(a1, v10, <span class="number">0LL</span>);</span><br><span class="line">  qword_51C8 = sub_2BF0(a1, v8, <span class="number">0LL</span>);</span><br><span class="line">  sub_33E0(a1, v11);</span><br><span class="line">  sub_33E0(a1, v9);</span><br><span class="line">  sub_33E0(a1, v15);</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>貌似是把这两个数组带入了func函数进行了加密，异或后的结果为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Xor5000 = [<span class="number">0x30</span>, <span class="number">0x77</span>, <span class="number">0x79</span>, <span class="number">0x78</span>, <span class="number">0x7d</span>, <span class="number">0x6c</span>, <span class="number">0x68</span>, <span class="number">0x72</span>, <span class="number">0x72</span>, <span class="number">0x6e</span>, <span class="number">0x6f</span>, <span class="number">0x45</span>, <span class="number">0x30</span>, <span class="number">0x6a</span>, <span class="number">0x64</span>, <span class="number">0x78</span>]</span><br><span class="line">Xor5040 = [<span class="number">0x7d</span>, <span class="number">0x75</span>, <span class="number">0x2b</span>, <span class="number">0x72</span>, <span class="number">0x7f</span>, <span class="number">0x70</span>, <span class="number">0x5d</span>, <span class="number">0x2a</span>, <span class="number">0x26</span>, <span class="number">0x67</span>, <span class="number">0x42</span>, <span class="number">0x4c</span>, <span class="number">0x47</span>, <span class="number">0x7d</span>, <span class="number">0x62</span>, <span class="number">0x71</span>]</span><br></pre></td></tr></table></figure>
<p>但并不清楚哪个是flag，再看另一个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">Java_com_hectf2024_ezandroid_CheckActivity_stringFromJNI</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// [rsp+28h] [rbp-38h]</span></span><br><span class="line">  <span class="type">pthread_t</span> newthread[<span class="number">2</span>]; <span class="comment">// [rsp+50h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  newthread[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  pthread_create(newthread, <span class="number">0LL</span>, start_routine, <span class="number">0LL</span>);</span><br><span class="line">  pthread_join(newthread[<span class="number">0</span>], <span class="number">0LL</span>);</span><br><span class="line">  v4 = (<span class="type">char</span> *)sub_2BF0(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  sub_2090();</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> <span class="type">int</span>)sub_1028(v4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中<strong>sub_1028</strong>查看后内部是一个标准的TEA加密，只会返回1且带入的两个数全部相同：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1028</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">pthread_t</span> newthread[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  newthread[<span class="number">1</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  sub_1140(qword_51C8, qword_51C8);</span><br><span class="line">  pthread_create(newthread, <span class="number">0LL</span>, start_routine, <span class="number">0LL</span>);</span><br><span class="line">  pthread_join(newthread[<span class="number">0</span>], <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1140</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> *a1, _DWORD *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+18h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+1Ch] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v6; <span class="comment">// [rsp+20h] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  v6 = *a1;</span><br><span class="line">  v5 = a1[<span class="number">1</span>];</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">0x20</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 += <span class="number">0x9E3779B9</span>;</span><br><span class="line">    v6 += (a2[<span class="number">1</span>] + (v5 &gt;&gt; <span class="number">5</span>)) ^ (v4 + v5) ^ (*a2 + <span class="number">16</span> * v5);</span><br><span class="line">    v5 += (a2[<span class="number">3</span>] + (v6 &gt;&gt; <span class="number">5</span>)) ^ (v4 + v6) ^ (a2[<span class="number">2</span>] + <span class="number">16</span> * v6);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v6;</span><br><span class="line">  result = v5;</span><br><span class="line">  a1[<span class="number">1</span>] = v5;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>但没找到这些加密与上述两个数组之间的关系，再仔细观察，发现sub_2090有明显的ollvm混淆，用d810去混淆后，发现会检测sub_1028并将其替换为sub_1E20，也就是之前的sub_1028实际上是假的，真正的加密逻辑是<strong>sub_1E20</strong>，观察sub_1E20发现还是很混乱，再次去除ollvm混淆得到：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1E20</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+14h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+18h] [rbp-38h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">pthread_t</span> newthread; <span class="comment">// [rsp+28h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">24</span>]; <span class="comment">// [rsp+30h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  pthread_create(&amp;newthread, <span class="number">0LL</span>, start_routine, <span class="number">0LL</span>);</span><br><span class="line">  pthread_join(newthread, <span class="number">0LL</span>);</span><br><span class="line">  sub_1220();</span><br><span class="line">  v4 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    v6[i] = *(_BYTE *)(a1 + i);</span><br><span class="line">  sub_1C90(v6, qword_51C0, qword_51C8);	<span class="comment">//加密，51C0是异或后的5000（X5000）,51C8是异或后的5040（X5040）</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">16</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( dword_5080[j] != (<span class="type">unsigned</span> __int8)v6[j] )<span class="comment">//真正的比较：[0xC6, 0x9B, 0x16, 0x0F, 0x67, 0x03, 0x68, 0xB9, 0x3F, 0xD7, 0xE9, 0x16, 0x0E, 0x97, 0x63, 0xBB]</span></span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察sub_1220：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_1220</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+0h] [rbp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    byte_51D0[i] = byte_50C0[i];</span><br><span class="line">    byte_52D0[i] = byte_51D0[i] ^ <span class="number">0x18</span>;</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是把256项数组byte_50C0异或0x18后存入byte_52D0，猜测可能是s盒之类的东西，提取出来数据为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">byte_50C0 = [<span class="number">0x7B</span>, <span class="number">0x64</span>, <span class="number">0x6F</span>, <span class="number">0x63</span>, <span class="number">0x0E</span>, <span class="number">0x73</span>, <span class="number">0x77</span>, <span class="number">0xDD</span>, <span class="number">0x28</span>, <span class="number">0x19</span>, <span class="number">0x7F</span>, <span class="number">0x33</span>, <span class="number">0xE6</span>, <span class="number">0xCF</span>, <span class="number">0xB3</span>, <span class="number">0x6E</span>,</span><br><span class="line">             <span class="number">0xD2</span>, <span class="number">0x9A</span>, <span class="number">0xD1</span>, <span class="number">0x65</span>, <span class="number">0xE2</span>, <span class="number">0x41</span>, <span class="number">0x5F</span>, <span class="number">0xE8</span>, <span class="number">0xB5</span>, <span class="number">0xCC</span>, <span class="number">0xBA</span>, <span class="number">0xB7</span>, <span class="number">0x84</span>, <span class="number">0xBC</span>, <span class="number">0x6A</span>, <span class="number">0xD8</span>,</span><br><span class="line">             <span class="number">0xAF</span>, <span class="number">0xE5</span>, <span class="number">0x8B</span>, <span class="number">0x3E</span>, <span class="number">0x2E</span>, <span class="number">0x27</span>, <span class="number">0xEF</span>, <span class="number">0xD4</span>, <span class="number">0x2C</span>, <span class="number">0xBD</span>, <span class="number">0xFD</span>, <span class="number">0xE9</span>, <span class="number">0x69</span>, <span class="number">0xC0</span>, <span class="number">0x29</span>, <span class="number">0x0D</span>,</span><br><span class="line">             <span class="number">0x1C</span>, <span class="number">0xDF</span>, <span class="number">0x3B</span>, <span class="number">0xDB</span>, <span class="number">0x00</span>, <span class="number">0x8E</span>, <span class="number">0x1D</span>, <span class="number">0x82</span>, <span class="number">0x1F</span>, <span class="number">0x0A</span>, <span class="number">0x98</span>, <span class="number">0xFA</span>, <span class="number">0xF3</span>, <span class="number">0x3F</span>, <span class="number">0xAA</span>, <span class="number">0x6D</span>,</span><br><span class="line">             <span class="number">0x11</span>, <span class="number">0x9B</span>, <span class="number">0x34</span>, <span class="number">0x02</span>, <span class="number">0x03</span>, <span class="number">0x76</span>, <span class="number">0x42</span>, <span class="number">0xB8</span>, <span class="number">0x4A</span>, <span class="number">0x23</span>, <span class="number">0xCE</span>, <span class="number">0xAB</span>, <span class="number">0x31</span>, <span class="number">0xFB</span>, <span class="number">0x37</span>, <span class="number">0x9C</span>,</span><br><span class="line">             <span class="number">0x4B</span>, <span class="number">0xC9</span>, <span class="number">0x18</span>, <span class="number">0xF5</span>, <span class="number">0x38</span>, <span class="number">0xE4</span>, <span class="number">0xA9</span>, <span class="number">0x43</span>, <span class="number">0x72</span>, <span class="number">0xD3</span>, <span class="number">0xA6</span>, <span class="number">0x21</span>, <span class="number">0x52</span>, <span class="number">0x54</span>, <span class="number">0x40</span>, <span class="number">0xD7</span>,</span><br><span class="line">             <span class="number">0xC8</span>, <span class="number">0xF7</span>, <span class="number">0xB2</span>, <span class="number">0xE3</span>, <span class="number">0x5B</span>, <span class="number">0x55</span>, <span class="number">0x2B</span>, <span class="number">0x9D</span>, <span class="number">0x5D</span>, <span class="number">0xE1</span>, <span class="number">0x1A</span>, <span class="number">0x67</span>, <span class="number">0x48</span>, <span class="number">0x24</span>, <span class="number">0x87</span>, <span class="number">0xB0</span>,</span><br><span class="line">             <span class="number">0x49</span>, <span class="number">0xBB</span>, <span class="number">0x58</span>, <span class="number">0x97</span>, <span class="number">0x8A</span>, <span class="number">0x85</span>, <span class="number">0x20</span>, <span class="number">0xED</span>, <span class="number">0xA4</span>, <span class="number">0xAE</span>, <span class="number">0xC2</span>, <span class="number">0x39</span>, <span class="number">0x08</span>, <span class="number">0xE7</span>, <span class="number">0xEB</span>, <span class="number">0xCA</span>,</span><br><span class="line">             <span class="number">0xD5</span>, <span class="number">0x14</span>, <span class="number">0x0B</span>, <span class="number">0xF4</span>, <span class="number">0x47</span>, <span class="number">0x8F</span>, <span class="number">0x5C</span>, <span class="number">0x0F</span>, <span class="number">0xDC</span>, <span class="number">0xBF</span>, <span class="number">0x66</span>, <span class="number">0x25</span>, <span class="number">0x7C</span>, <span class="number">0x45</span>, <span class="number">0x01</span>, <span class="number">0x6B</span>,</span><br><span class="line">             <span class="number">0x78</span>, <span class="number">0x99</span>, <span class="number">0x57</span>, <span class="number">0xC4</span>, <span class="number">0x3A</span>, <span class="number">0x32</span>, <span class="number">0x88</span>, <span class="number">0x90</span>, <span class="number">0x5E</span>, <span class="number">0xF6</span>, <span class="number">0xA0</span>, <span class="number">0x0C</span>, <span class="number">0xC6</span>, <span class="number">0x46</span>, <span class="number">0x13</span>, <span class="number">0xC3</span>,</span><br><span class="line">             <span class="number">0xF8</span>, <span class="number">0x2A</span>, <span class="number">0x22</span>, <span class="number">0x12</span>, <span class="number">0x51</span>, <span class="number">0x1E</span>, <span class="number">0x3C</span>, <span class="number">0x44</span>, <span class="number">0xDA</span>, <span class="number">0xCB</span>, <span class="number">0xB4</span>, <span class="number">0x7A</span>, <span class="number">0x89</span>, <span class="number">0x8D</span>, <span class="number">0xFC</span>, <span class="number">0x61</span>,</span><br><span class="line">             <span class="number">0xFF</span>, <span class="number">0xD0</span>, <span class="number">0x2F</span>, <span class="number">0x75</span>, <span class="number">0x95</span>, <span class="number">0xCD</span>, <span class="number">0x56</span>, <span class="number">0xB1</span>, <span class="number">0x74</span>, <span class="number">0x4E</span>, <span class="number">0xEC</span>, <span class="number">0xF2</span>, <span class="number">0x7D</span>, <span class="number">0x62</span>, <span class="number">0xB6</span>, <span class="number">0x10</span>,</span><br><span class="line">             <span class="number">0xA2</span>, <span class="number">0x60</span>, <span class="number">0x3D</span>, <span class="number">0x36</span>, <span class="number">0x04</span>, <span class="number">0xBE</span>, <span class="number">0xAC</span>, <span class="number">0xDE</span>, <span class="number">0xF0</span>, <span class="number">0xC5</span>, <span class="number">0x6C</span>, <span class="number">0x07</span>, <span class="number">0x53</span>, <span class="number">0xA5</span>, <span class="number">0x93</span>, <span class="number">0x92</span>,</span><br><span class="line">             <span class="number">0x68</span>, <span class="number">0x26</span>, <span class="number">0xAD</span>, <span class="number">0x7E</span>, <span class="number">0x50</span>, <span class="number">0x1B</span>, <span class="number">0xEE</span>, <span class="number">0x16</span>, <span class="number">0x79</span>, <span class="number">0x2D</span>, <span class="number">0x4F</span>, <span class="number">0xA1</span>, <span class="number">0x9E</span>, <span class="number">0xD9</span>, <span class="number">0x05</span>, <span class="number">0x86</span>,</span><br><span class="line">             <span class="number">0xF9</span>, <span class="number">0xE0</span>, <span class="number">0x80</span>, <span class="number">0x09</span>, <span class="number">0x71</span>, <span class="number">0xC1</span>, <span class="number">0x96</span>, <span class="number">0x8C</span>, <span class="number">0x83</span>, <span class="number">0x06</span>, <span class="number">0x9F</span>, <span class="number">0xF1</span>, <span class="number">0xD6</span>, <span class="number">0x4D</span>, <span class="number">0x30</span>, <span class="number">0xC7</span>,</span><br><span class="line">             <span class="number">0x94</span>, <span class="number">0xB9</span>, <span class="number">0x91</span>, <span class="number">0x15</span>, <span class="number">0xA7</span>, <span class="number">0xFE</span>, <span class="number">0x5A</span>, <span class="number">0x70</span>, <span class="number">0x59</span>, <span class="number">0x81</span>, <span class="number">0x35</span>, <span class="number">0x17</span>, <span class="number">0xA8</span>, <span class="number">0x4C</span>, <span class="number">0xA3</span>, <span class="number">0x0E</span>]</span><br></pre></td></tr></table></figure>
<p>则byte52d0为：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">byte_52d0 = [<span class="number">0x63</span>, <span class="number">0x7c</span>, <span class="number">0x77</span>, <span class="number">0x7b</span>, <span class="number">0x16</span>, <span class="number">0x6b</span>, <span class="number">0x6f</span>, <span class="number">0xc5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2b</span>, <span class="number">0xfe</span>, <span class="number">0xd7</span>, <span class="number">0xab</span>, <span class="number">0x76</span>,</span><br><span class="line">             <span class="number">0xca</span>, <span class="number">0x82</span>, <span class="number">0xc9</span>, <span class="number">0x7d</span>, <span class="number">0xfa</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xf0</span>, <span class="number">0xad</span>, <span class="number">0xd4</span>, <span class="number">0xa2</span>, <span class="number">0xaf</span>, <span class="number">0x9c</span>, <span class="number">0xa4</span>, <span class="number">0x72</span>, <span class="number">0xc0</span>,</span><br><span class="line">             <span class="number">0xb7</span>, <span class="number">0xfd</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3f</span>, <span class="number">0xf7</span>, <span class="number">0xcc</span>, <span class="number">0x34</span>, <span class="number">0xa5</span>, <span class="number">0xe5</span>, <span class="number">0xf1</span>, <span class="number">0x71</span>, <span class="number">0xd8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">             <span class="number">0x04</span>, <span class="number">0xc7</span>, <span class="number">0x23</span>, <span class="number">0xc3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9a</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xe2</span>, <span class="number">0xeb</span>, <span class="number">0x27</span>, <span class="number">0xb2</span>, <span class="number">0x75</span>,</span><br><span class="line">             <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2c</span>, <span class="number">0x1a</span>, <span class="number">0x1b</span>, <span class="number">0x6e</span>, <span class="number">0x5a</span>, <span class="number">0xa0</span>, <span class="number">0x52</span>, <span class="number">0x3b</span>, <span class="number">0xd6</span>, <span class="number">0xb3</span>, <span class="number">0x29</span>, <span class="number">0xe3</span>, <span class="number">0x2f</span>, <span class="number">0x84</span>, </span><br><span class="line">             <span class="number">0x53</span>, <span class="number">0xd1</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x20</span>, <span class="number">0xfc</span>, <span class="number">0xb1</span>, <span class="number">0x5b</span>, <span class="number">0x6a</span>, <span class="number">0xcb</span>, <span class="number">0xbe</span>, <span class="number">0x39</span>, <span class="number">0x4a</span>, <span class="number">0x4c</span>, <span class="number">0x58</span>, <span class="number">0xcf</span>, </span><br><span class="line">             <span class="number">0xd0</span>, <span class="number">0xef</span>, <span class="number">0xaa</span>, <span class="number">0xfb</span>, <span class="number">0x43</span>, <span class="number">0x4d</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xf9</span>, <span class="number">0x02</span>, <span class="number">0x7f</span>, <span class="number">0x50</span>, <span class="number">0x3c</span>, <span class="number">0x9f</span>, <span class="number">0xa8</span>, </span><br><span class="line">             <span class="number">0x51</span>, <span class="number">0xa3</span>, <span class="number">0x40</span>, <span class="number">0x8f</span>, <span class="number">0x92</span>, <span class="number">0x9d</span>, <span class="number">0x38</span>, <span class="number">0xf5</span>, <span class="number">0xbc</span>, <span class="number">0xb6</span>, <span class="number">0xda</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xff</span>, <span class="number">0xf3</span>, <span class="number">0xd2</span>,</span><br><span class="line">             <span class="number">0xcd</span>, <span class="number">0x0c</span>, <span class="number">0x13</span>, <span class="number">0xec</span>, <span class="number">0x5f</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xc4</span>, <span class="number">0xa7</span>, <span class="number">0x7e</span>, <span class="number">0x3d</span>, <span class="number">0x64</span>, <span class="number">0x5d</span>, <span class="number">0x19</span>, <span class="number">0x73</span>, </span><br><span class="line">             <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4f</span>, <span class="number">0xdc</span>, <span class="number">0x22</span>, <span class="number">0x2a</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xee</span>, <span class="number">0xb8</span>, <span class="number">0x14</span>, <span class="number">0xde</span>, <span class="number">0x5e</span>, <span class="number">0x0b</span>, <span class="number">0xdb</span>,</span><br><span class="line">             <span class="number">0xe0</span>, <span class="number">0x32</span>, <span class="number">0x3a</span>, <span class="number">0x0a</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5c</span>, <span class="number">0xc2</span>, <span class="number">0xd3</span>, <span class="number">0xac</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xe4</span>, <span class="number">0x79</span>,</span><br><span class="line">             <span class="number">0xe7</span>, <span class="number">0xc8</span>, <span class="number">0x37</span>, <span class="number">0x6d</span>, <span class="number">0x8d</span>, <span class="number">0xd5</span>, <span class="number">0x4e</span>, <span class="number">0xa9</span>, <span class="number">0x6c</span>, <span class="number">0x56</span>, <span class="number">0xf4</span>, <span class="number">0xea</span>, <span class="number">0x65</span>, <span class="number">0x7a</span>, <span class="number">0xae</span>, <span class="number">0x08</span>, </span><br><span class="line">             <span class="number">0xba</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2e</span>, <span class="number">0x1c</span>, <span class="number">0xa6</span>, <span class="number">0xb4</span>, <span class="number">0xc6</span>, <span class="number">0xe8</span>, <span class="number">0xdd</span>, <span class="number">0x74</span>, <span class="number">0x1f</span>, <span class="number">0x4b</span>, <span class="number">0xbd</span>, <span class="number">0x8b</span>, <span class="number">0x8a</span>, </span><br><span class="line">             <span class="number">0x70</span>, <span class="number">0x3e</span>, <span class="number">0xb5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xf6</span>, <span class="number">0x0e</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xb9</span>, <span class="number">0x86</span>, <span class="number">0xc1</span>, <span class="number">0x1d</span>, <span class="number">0x9e</span>, </span><br><span class="line">             <span class="number">0xe1</span>, <span class="number">0xf8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xd9</span>, <span class="number">0x8e</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x1e</span>, <span class="number">0x87</span>, <span class="number">0xe9</span>, <span class="number">0xce</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xdf</span>,</span><br><span class="line">             <span class="number">0x8c</span>, <span class="number">0xa1</span>, <span class="number">0x89</span>, <span class="number">0x0d</span>, <span class="number">0xbf</span>, <span class="number">0xe6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2d</span>, <span class="number">0x0f</span>, <span class="number">0xb0</span>, <span class="number">0x54</span>, <span class="number">0xbb</span>, <span class="number">0x16</span>]</span><br></pre></td></tr></table></figure>
<p>发现是AES的S盒，再观察sub_1C90：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_1C90</span><span class="params">(_BYTE *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+14h] [rbp-6Ch]</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">24</span>]; <span class="comment">// [rsp+60h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    v5[i] = *(_BYTE *)(a3 + i) ^ a1[i]; <span class="comment">//v5为X5040异或v6</span></span><br><span class="line">  sub_1A30(v5, a2); <span class="comment">//带入了v5的值和X5000的值</span></span><br><span class="line">  <span class="built_in">memcpy</span>(a1, v5, <span class="number">0x10u</span>LL); <span class="comment">//v6为处理后的结果</span></span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>再看sub_1A30主要逻辑：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">__memcpy_chk(v6, a1, <span class="number">16LL</span>, <span class="number">16LL</span>);</span><br><span class="line">sub_1860(a2, v4);					<span class="comment">//密钥扩展</span></span><br><span class="line">sub_1810(v6, v4);					<span class="comment">//异或</span></span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt; <span class="number">10</span>; ++i )					<span class="comment">//循环9次</span></span><br><span class="line">&#123;</span><br><span class="line">  sub_1280(v6);						<span class="comment">//赋值</span></span><br><span class="line">  sub_12D0(v6);						<span class="comment">//换位</span></span><br><span class="line">  sub_13A0(v6);						<span class="comment">//加密</span></span><br><span class="line">  sub_1810(v6, &amp;v4[<span class="number">16</span> * i]);				<span class="comment">//异或</span></span><br><span class="line">&#125;</span><br><span class="line">sub_1280(v6);						<span class="comment">//赋值</span></span><br><span class="line">sub_12D0(v6);						<span class="comment">//换位</span></span><br><span class="line">sub_1810(v6, &amp;v5);					<span class="comment">//异或</span></span><br><span class="line"><span class="built_in">memcpy</span>(a1, v6, <span class="number">0x10u</span>LL);</span><br></pre></td></tr></table></figure>
<p>发现就是AES_CBC加密，则总的加密逻辑是（sub_1A30转换成的python代码附在下面）：<br><br>Dword5000—func—XOR hectf2024→X5000（key）<br><br>Dword5040—func—XOR hectf2024→X5040（iv）<br><br>Byte50D0—sub1220—51D0—XOR 0x18→52D0（S盒）<br><br>AES_CBC（input，X5000，X5040）→dword_5080（密文）</p>
<p>先从要比较的dword_5080提取得到<font color=lime><strong>[0xC6, 0x9B, 0x16, 0x0F, 0x67, 0x03, 0x68, 0xB9, 0x3F, 0xD7, 0xE9, 0x16, 0x0E, 0x97, 0x63, 0xBB]</strong></font>，用X5000和X5040AES_CBC解得明文十六进制为<font color=LimeGreen><strong>d8ac2d59f876b54a554242e4e6d32078</strong></font>，计算32位小写md5带入检验发现不对，再仔细检测so文件发现还有三个函数，其中一个对dword_5000每个数的值加上了1，另一个对dword_5040每个数的值先加上了2又异或了0x18，再次代入，得到xor5000和xor5040的真正值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Xor5000：0x31 0x76 0x78 0x79 0x7a 0x6d 0x69 0x73 0x73 0x6f 0x6e 0x44 0x31 0x6b 0x65 0x79（1vxyzmissonD1key）</span><br><span class="line">Xor5040：0x67 0x6f 0x31 0x64 0x65 0x6e 0x47 0x30 0x38 0x61 0x54 0x4a 0x59 0x63 0x78 0x6b（go1denG08aTJYcxk）</span><br></pre></td></tr></table></figure>
<p>AES_CBC解密得到明文<font color=lime><strong>“adHIHFBDCJsoiak”</strong></font>，计算md5得到<font color=deepskyblue><strong>cfa76d5f2d5aecdb53e79f644cb90fc2</strong></font>即为flag.</p>
<h2 id="easyree："><a href="#easyree：" class="headerlink" title="easyree："></a>easyree：</h2><p>拖入exeinfope发现是upx，但被篡改了，010editor打开发现UPX头（UPX012、UPX!）被替换成了CTF，修改后用UPX脱壳成功，查看main函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> data[<span class="number">27</span>]; <span class="comment">// [rsp+20h] [rbp-A0h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+8Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">char</span> str[<span class="number">30</span>]; <span class="comment">// [rsp+90h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">int</span> flag; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+BCh] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  _main();</span><br><span class="line">  data[<span class="number">0</span>] = <span class="number">35</span>;										<span class="comment">//加密的flag</span></span><br><span class="line">  data[<span class="number">1</span>] = <span class="number">33</span>;</span><br><span class="line">  data[<span class="number">2</span>] = <span class="number">32</span>;</span><br><span class="line">  data[<span class="number">3</span>] = <span class="number">40</span>;</span><br><span class="line">  data[<span class="number">4</span>] = <span class="number">37</span>;</span><br><span class="line">  data[<span class="number">5</span>] = <span class="number">126</span>;</span><br><span class="line">  data[<span class="number">6</span>] = <span class="number">40</span>;</span><br><span class="line">  data[<span class="number">7</span>] = <span class="number">70</span>;</span><br><span class="line">  data[<span class="number">8</span>] = <span class="number">82</span>;</span><br><span class="line">  data[<span class="number">9</span>] = <span class="number">4</span>;</span><br><span class="line">  data[<span class="number">10</span>] = <span class="number">75</span>;</span><br><span class="line">  data[<span class="number">11</span>] = <span class="number">82</span>;</span><br><span class="line">  data[<span class="number">12</span>] = <span class="number">76</span>;</span><br><span class="line">  data[<span class="number">13</span>] = <span class="number">3</span>;</span><br><span class="line">  data[<span class="number">14</span>] = <span class="number">82</span>;</span><br><span class="line">  data[<span class="number">15</span>] = <span class="number">4</span>;</span><br><span class="line">  data[<span class="number">16</span>] = <span class="number">72</span>;</span><br><span class="line">  data[<span class="number">17</span>] = <span class="number">79</span>;</span><br><span class="line">  data[<span class="number">18</span>] = <span class="number">123</span>;</span><br><span class="line">  data[<span class="number">19</span>] = <span class="number">79</span>;</span><br><span class="line">  data[<span class="number">20</span>] = <span class="number">125</span>;</span><br><span class="line">  data[<span class="number">21</span>] = <span class="number">66</span>;</span><br><span class="line">  data[<span class="number">22</span>] = <span class="number">68</span>;</span><br><span class="line">  data[<span class="number">23</span>] = <span class="number">4</span>;</span><br><span class="line">  data[<span class="number">24</span>] = <span class="number">79</span>;</span><br><span class="line">  data[<span class="number">25</span>] = <span class="number">73</span>;</span><br><span class="line">  data[<span class="number">26</span>] = <span class="number">112</span>;</span><br><span class="line">  flag = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">std</span>::operator&gt;&gt;&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(refptr__ZSt3cin, str);		<span class="comment">//输入str</span></span><br><span class="line">  encrypt(str, <span class="number">8</span>);										<span class="comment">//加密函数</span></span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(str) != <span class="number">27</span> )									<span class="comment">//长度为27</span></span><br><span class="line">  &#123;</span><br><span class="line">flag = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">printf</span>(“Your length is wrong <span class="number">0.0</span>”);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Guess how many xor’s there are&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::istream::operator&gt;&gt;(refptr__ZSt3cin);						<span class="comment">//输入k</span></span><br><span class="line">  <span class="keyword">for</span> ( I = <span class="number">0</span>; I &lt;= <span class="number">26</span>; ++I )</span><br><span class="line">  &#123;</span><br><span class="line">    If ( str[i] – <span class="number">21</span> != (data[i] ^ k) )							<span class="comment">//加密+比较</span></span><br><span class="line">    &#123;</span><br><span class="line">      flag = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( flag == <span class="number">1</span> )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;YOU ARE WRONG!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Genius!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现data是被加密的flag的中间态，提取得到<font color=lime><strong>[0x23, 0x21, 0x20, 0x28, 0x25, 0x7E, 0x28, 0x46, 0x52, 0x04, 0x4B, 0x52, 0x4C, 0x03, 0x52, 0x04, 0x48, 0x4F, 0x7B, 0x4F, 0x7D, 0x42, 0x44, 0x04, 0x4F, 0x49, 0x70]</strong></font>，观察加密函数encrypt：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">encrypt</span><span class="params">(<span class="type">char</span> *a, <span class="type">int</span> tot)</span>			<span class="comment">//起始tot = 8</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-54h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(a); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a[i] &lt;= <span class="number">64</span> || a[i] &gt; <span class="number">90</span> )				<span class="comment">//不是大写英语字母</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a[i] &gt; <span class="number">96</span> &amp;&amp; a[i] &lt;= <span class="number">122</span> )			<span class="comment">//是小写英语字母</span></span><br><span class="line">        a[i] = (a[i] - <span class="number">97</span> + tot++) % <span class="number">26</span> + <span class="number">97</span>;		<span class="comment">//字母索引+tot+位</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>							<span class="comment">//大写英语字母</span></span><br><span class="line">    &#123;</span><br><span class="line">      a[i] = (a[i] - <span class="number">65</span> + tot++) % <span class="number">26</span> + <span class="number">65</span>;		<span class="comment">//字母索引+tot+位</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现是一个简单的变位凯撒密码，在下方还有一个小的加密，将每项的ascii减去21再与data每项与k异或得到的值进行比较， 由于flag格式是HECTF{，第六个字符不参与变位凯撒加密，所以k其实可以计算出来，有<code>123（&#123;）-21 = 102（0x66） = 126（0x7E）^k</code>，解得k&#x3D;0x18（24），同理带入最后一个字符125（}）-21 &#x3D; 104(0x68) &#x3D; 112(0x70)^0x18，验证通过，则data^k &#x3D; encflag-21 &#x3D; <font color=lime><strong>[0x3b, 0x39, 0x38, 0x30, 0x3d, 0x66, 0x30, 0x5e, 0x4a, 0x1c, 0x53, 0x4a, 0x54, 0x1b, 0x4a, 0x1c, 0x50, 0x57, 0x63, 0x57, 0x65, 0x5a, 0x5c, 0x1c, 0x57, 0x51, 0x68]</strong></font>，得到encflag &#x3D; <font color=LimeGreen><strong>[0x50, 0x4e, 0x4d, 0x45, 0x52, 0x7b, 0x45, 0x73, 0x5f, 0x31, 0x68, 0x5f, 0x69, 0x30, 0x5f, 0x31, 0x65, 0x6c, 0x78, 0x6c, 0x7a, 0x6f, 0x71, 0x31, 0x6c, 0x66, 0x7d]</strong></font>，转换得<font color=orange><strong>PNMER{Es_1h_i0_1elxlzoq1lf}</strong></font>，代换回凯撒加密之前得到<font color=deepskyblue><strong>HECTF{Re_1s_s0_1nterest1ng}</strong></font>.</p>
<p>附解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">s, tot=<span class="number">8</span></span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;a&#x27;</span> &lt;= char &lt;= <span class="string">&#x27;z&#x27;</span>:  <span class="comment"># 小写英语字母</span></span><br><span class="line">            offset = <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">            encrypted_char = <span class="built_in">chr</span>((<span class="built_in">ord</span>(char) - offset - tot) % <span class="number">26</span> + offset)</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&#x27;A&#x27;</span> &lt;= char &lt;= <span class="string">&#x27;Z&#x27;</span>:  <span class="comment"># 大写英语字母</span></span><br><span class="line">            offset = <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">            encrypted_char = <span class="built_in">chr</span>((<span class="built_in">ord</span>(char) - offset - tot) % <span class="number">26</span> + offset)</span><br><span class="line">            tot += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:  <span class="comment"># 不是英文字母</span></span><br><span class="line">            encrypted_char = char</span><br><span class="line">        result.append(encrypted_char)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(result)</span><br><span class="line"></span><br><span class="line">original_text = <span class="string">&quot;PNMER&#123;Es_1h_i0_1elxlzoq1lf&#125;&quot;</span></span><br><span class="line">encrypted_text = encrypt(original_text)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Encrypted:&quot;</span>, encrypted_text)</span><br></pre></td></tr></table></figure>

<h2 id="Pwn方向："><a href="#Pwn方向：" class="headerlink" title="Pwn方向："></a>Pwn方向：</h2><h3 id="sign-in："><a href="#sign-in：" class="headerlink" title="sign in："></a>sign in：</h3><p>观察程序主函数，要先输入用户名和密码，用户名不能超过8个字符，密码要与m（“HECTF2024!”）相等，之后就可以进入backd00r函数并拿到shell，但在拿到之前程序关闭了输出（close(1)），因此拿到shell之后将flag内容重定向到标准错误（输入cat &#x2F;flag &gt;&amp;2），得到flag：<font color=deepskyblue><strong>HECTF{01a86b7bc0e0e58d25ea10edccedfc2762f8e3fd}</strong></font>.</p>
<h1 id="Crypto方向："><a href="#Crypto方向：" class="headerlink" title="Crypto方向："></a>Crypto方向：</h1><h2 id="迷茫的艾米莉："><a href="#迷茫的艾米莉：" class="headerlink" title="迷茫的艾米莉："></a>迷茫的艾米莉：</h2><p>题目提示了<code>维尼吉亚密码</code>和<code>栅栏密码</code>，由于维尼吉亚密码不会改变大括号的位置，所以先用栅栏密码，将原密码<font color=red><strong>Y2w9Iobe_v_Ufbm0ajI05bfzvTP1b_c}{lr</strong></font>带入cyberchef选择Rail Fence，栏数选6得到初步解密结果<font color=lime><strong>YIUIT{P0fo2bb51lbbmew_0f_rczav9_jv}</strong></font>，再用维尼吉亚密码解密，带入key&#x3D;responsibility得到flag：<font color=deepskyblue><strong>HECTF{C0ng2at51ations_0n_comin9_in}</strong></font>.</p>
<h2 id="seven-more："><a href="#seven-more：" class="headerlink" title="seven more："></a>seven more：</h2><p>发现e与p-1，q-1均不互质，无法求得模逆元d，又观察发现p-1是e的整数倍，q-1与e共因数1009，考虑使用AMM算法得到原信息，建立脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AMM</span>(<span class="params">c, r, p</span>):</span><br><span class="line">    s = p - <span class="number">1</span></span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> s % r == <span class="number">0</span>:</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        s //= r</span><br><span class="line"></span><br><span class="line">    non_residue = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        non_residue = <span class="built_in">int</span>(randint(<span class="number">1</span>, p - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">pow</span>(non_residue, (p - <span class="number">1</span>) // r, p) != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    e = <span class="built_in">pow</span>(non_residue, s * (r ** (t - <span class="number">1</span>)), p)</span><br><span class="line">    root = <span class="built_in">pow</span>(<span class="built_in">int</span>(c), gmpy2.isqrt(<span class="built_in">pow</span>(r, t - <span class="number">1</span>, <span class="built_in">int</span>(s * (r ** (t - <span class="number">1</span>))))), <span class="built_in">int</span>(p))  </span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(t - <span class="number">1</span>):</span><br><span class="line">        k = <span class="number">0</span></span><br><span class="line">        tmp = c</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, r):</span><br><span class="line">            tmp_next = (tmp * non_residue ** (s * (r ** (t - <span class="number">2</span>)) * i)) % p</span><br><span class="line">            <span class="keyword">if</span> tmp_next == root:</span><br><span class="line">                k = r - i</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        root = (root * <span class="built_in">pow</span>(non_residue, s * k * (r ** (t - <span class="number">2</span>)), p)) % p</span><br><span class="line"></span><br><span class="line">    d = GCD(r, s)</span><br><span class="line">    alpha = inverse(r // d, s // d)</span><br><span class="line">    final_root = <span class="built_in">pow</span>(root, alpha, p)</span><br><span class="line">    <span class="keyword">return</span> final_root, d, s, t, non_residue, r</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ALL_Solution</span>(<span class="params">root, r, p, s, t, non_residue</span>):</span><br><span class="line">    K = <span class="built_in">set</span>()</span><br><span class="line">    e = <span class="built_in">pow</span>(non_residue, <span class="built_in">int</span>(s * (r ** (t - <span class="number">1</span>))), p)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">        K.add(<span class="built_in">pow</span>(e, i, p))</span><br><span class="line">    K = <span class="built_in">list</span>(K)</span><br><span class="line">    solutions = []</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> K:</span><br><span class="line">        solution = (root * <span class="built_in">pow</span>(k, -<span class="number">1</span>, p)) % p  </span><br><span class="line">        solutions.append(solution)</span><br><span class="line">    <span class="keyword">return</span> solutions</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知参数</span></span><br><span class="line">e = <span class="number">1009</span> * <span class="number">7</span></span><br><span class="line">n = <span class="number">211174039496861685759253930135194075344490160159278597570478160714793843648384778026214533259531963057737358092962077790023796805017455012885781079402008604439036453706912819711606916173828620000813663524065796636039272173716362247511054616756763830945978879273812551204996912252317081836281439680223663883250992957309172746671265758427396929152878633033380299036765665530677963287445843653357154379447802151146728382517702550201</span></span><br><span class="line">c = <span class="number">191928992610587693825282781627928404831411364407297375816921425636703444790996279718679090695773598752804431891678976685083991392082287393228730341768083530729456781668626228660243400914135691435374881498580469432290771039798758412160073826112909167507868640830965603769520664582121780979767127925146139051005022993085473836213944491149411881673257628267851773377966008999511673741955131386600993547529438576918914852633139878066</span></span><br><span class="line">p = <span class="number">31160882390461311665815471693453819123352546432384109928704874241292707178454748381602275005604671000436222741183159072136366212086549437801626015758789167455043851748560416003501637268653712148286072544482747238223</span></span><br><span class="line">q = <span class="number">6776895366785389188349778634427547683984792095011326393872759455291221057085426285502176493658280343252730331506803173791893339840460125807960788857396637337440004750209164671124188980183308151635629356496128717687</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求解p和q上的c的e次方根</span></span><br><span class="line">pr = AMM(c % p, e, p)</span><br><span class="line">qr = AMM(<span class="built_in">pow</span>(c,inverse(<span class="number">7</span>,q-<span class="number">1</span>),q) , e//<span class="number">7</span>, q)</span><br><span class="line"></span><br><span class="line">pl = ALL_Solution(pr[<span class="number">0</span>], e, p, pr[<span class="number">2</span>], pr[<span class="number">3</span>], pr[<span class="number">4</span>])</span><br><span class="line">ql = ALL_Solution(qr[<span class="number">0</span>], e, q, qr[<span class="number">2</span>], qr[<span class="number">3</span>], qr[<span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 中国剩余定理合并解</span></span><br><span class="line">p_inv = inverse(p, q)</span><br><span class="line">q_inv = inverse(q, p)</span><br><span class="line">found = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> pl:</span><br><span class="line">    <span class="keyword">if</span> found :</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> ql:</span><br><span class="line">        m = (i*q*q_inv + j*p*p_inv)%n       <span class="comment">#CRT</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;HECTF&#x27;</span> <span class="keyword">in</span> long_to_bytes(m):</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">            found = <span class="number">1</span></span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>运行得到结果：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;HECTF&#123;go0d_jOb_At_AmM&#125;D~u3&lt;1\xdd\x9f\x81b:,\xbe\xf2\x1c\xf1\xd5\xeeN\xb7w\xce\xae?\xf3~\x99\xbd\xce\xf1\xf1\x10&quot;\xc6:\x85\x08\xf0\xef4h\x8c%d\x9f\xf1\xaf\xfdS\xd1\xcc\x99\x1c\xc3\xe5\x06Z\xdags\xb5R&gt;\xc9\xd4\xb7\x99\xde\x9f\xb0\xccP\xf2\xba\x82A\xfd\xbb\xda\x0e\xf9\xa5\xaa\xfcm\x92\xba\xa8\xff\xf8*\x8a\x95p\xb6\xbe\xc5\xbf\xbe\xe8c&#x27;</span></span><br></pre></td></tr></table></figure>
<p>前面的即为flag：<font color=deepskyblue><strong>HECTF{go0d_jOb_At_AmM}</strong></font>.</p>
<h2 id="翻一翻："><a href="#翻一翻：" class="headerlink" title="翻一翻："></a>翻一翻：</h2><p>发现是对称质数emirp，找到2015年ASIS总决赛的RSASR的wp脚本作为模板，更改脚本，爆破pq：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">404647938065363927581436797059920217726808592032894907516792959730610309231807721432452916075249512425255272010683662156287639951458857927130814934886426437345595825614662468173297926187946521587383884561536234303887166938763945988155320294755695229129209227291017751192918550531251138235455644646249817136993</span></span><br><span class="line">root_n_len = <span class="built_in">len</span>(<span class="built_in">str</span>(n)) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">t</span>(<span class="params">a, b, k</span>):</span><br><span class="line">    <span class="keyword">if</span> k == root_n_len:</span><br><span class="line">        <span class="keyword">if</span> a*b == n:</span><br><span class="line">            <span class="built_in">print</span>(a, b)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            a1 = a + i*(<span class="number">10</span>**k) + j*(<span class="number">10</span>**(root_n_len-k))</span><br><span class="line">            b1 = b + j*(<span class="number">10</span>**k) + i*(<span class="number">10</span>**(root_n_len-k))</span><br><span class="line">            <span class="keyword">if</span> a1*b1 &gt; n:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> (a1+(<span class="number">10</span>**(root_n_len-k)))*(b1+(<span class="number">10</span>**(root_n_len-k))) &lt; n:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> ((a1*b1)%(<span class="number">10</span>**(k+<span class="number">1</span>))) != (n%(<span class="number">10</span>**(k+<span class="number">1</span>))):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            t(a1, b1, k+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t(i*(<span class="number">10</span>**root_n_len), i*(<span class="number">10</span>**root_n_len), <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>得到：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p=<span class="number">39316409865082827891559777929907275271727781922450971403181273772573121561800306699150395758615464222134092274991810028405823897933152302724628919678029201</span></span><br><span class="line">q=<span class="number">10292087691982642720325133979832850482001819947229043122246451685759305199660300816512137527737218130417905422918772717257270992977795519872828056890461393</span></span><br></pre></td></tr></table></figure>
<p>解得明文<font color=lime><strong>SEVDVEZ7SV9yZWExbHlfbDB2ZV9jMnlwdG8hfQ&#x3D;&#x3D;</strong></font>，base64解密得到<font color=deepskyblue><strong>HECTF{I_rea1ly_l0ve_c2ypto!}</strong></font>.</p>
<h1 id="Misc方向："><a href="#Misc方向：" class="headerlink" title="Misc方向："></a>Misc方向：</h1><h2 id="funny："><a href="#funny：" class="headerlink" title="funny："></a>funny：</h2><p>打开第一张图片看到广告为JK FUN，高德地图查询只有一个结果，在北京市西城区，查看得到所在广场为“西外文化休闲广场”，再查看周围的水系，找到“京城水系慈禧水道”，查看图片发现就是这个地方，填入flag：<font color=deepskyblue><strong>HECTF{北京市-西城区-西外文化休闲广场-京城水系慈禧水道}</strong></font>发现正确.</p>
<h2 id="简单的压缩包："><a href="#简单的压缩包：" class="headerlink" title="简单的压缩包："></a>简单的压缩包：</h2><p>查看Re.txt发现给出了压缩包密码的正则表达式：<code>^([a-z])&#123;2&#125;\d([^a-z])\D$</code>，说明密码长度为5，且前两个字符为小写字母，第三个字符为数字，第四个字符不是小写字母，第五个字符不是数字，按要求生成字典文件：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">lowercase_letters = string.ascii_lowercase</span><br><span class="line">digits = string.digits</span><br><span class="line">non_lowercase_letters = string.ascii_uppercase + string.digits + string.punctuation </span><br><span class="line">non_digits = string.ascii_letters + string.punctuation </span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;dic.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    <span class="keyword">for</span> combo <span class="keyword">in</span> itertools.product(lowercase_letters, repeat=<span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> digit <span class="keyword">in</span> digits:</span><br><span class="line">            <span class="keyword">for</span> non_lower <span class="keyword">in</span> non_lowercase_letters:</span><br><span class="line">                <span class="keyword">for</span> non_digit <span class="keyword">in</span> non_digits:</span><br><span class="line">                    password = <span class="string">&#x27;&#x27;</span>.join(combo) + digit + non_lower + non_digit</span><br><span class="line">                    <span class="keyword">if</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;^([a-z])&#123;2&#125;\d([^a-z])\D$&#x27;</span>, password):</span><br><span class="line">                        file.write(password + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;complete&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>生成后用Archpr爆破，得到密码：<font color=red><strong>np76_</strong></font>，解开压缩包，提取出来图片，猜测有copy&#x2F;B隐写，直接改后缀为rar，发现果然有，里面有一个zip.zip和一个getzip.py，查看发现zip以<font color=lime><strong>key &#x3D; b”abcdefghijklmnop”</strong></font>和<font color=LimeGreen><strong>iv  &#x3D; b”qwertyuiopasdfgh”</strong></font>进行了加密，AES_CBC解密后打开被解密的zip，发现一个文件夹，里面就是flag.txt，得到flag：<font color=deepskyblue><strong>HECTF{c292af1-2b2ee35-6398bd4934f7626afc}</strong></font>.</p>
<p>附：python解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">key, iv, encrypted_data_hex</span>):</span><br><span class="line">    encrypted_data = binascii.a2b_hex(encrypted_data_hex)</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    pt = cipher.decrypt(encrypted_data)</span><br><span class="line">    unpadded_pt = unpad(pt, AES.block_size)</span><br><span class="line"><span class="keyword">return</span> unpadded_pt</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;abcdefghijklmnop&quot;</span></span><br><span class="line">iv = <span class="string">b&quot;qwertyuiopasdfgh&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;zip.zip&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    encrypted_content_hex = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(encrypted_content_hex, <span class="built_in">bytes</span>):</span><br><span class="line">    encrypted_content_hex = encrypted_content_hex.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">decrypted_content = decrypt(key, iv, encrypted_content_hex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;dezip.zip&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(decrypted_content)</span><br></pre></td></tr></table></figure>
<h2 id="Rem-YOU："><a href="#Rem-YOU：" class="headerlink" title="Rem_YOU："></a>Rem_YOU：</h2><p>下载发现是png，但是010发现是jpg+压缩包，改后缀名为rar，打开发现有一个文件夹，里面是9个二维码的切片，ps合并扫描得到<font color=lime><strong>JBCUGVCGPN2VMM3YPBRTOUZYNF4UETSUPB2GM6DWKBZE6N2SIZCTGZ2MOBZG6OLBGNAVOMSLKB6Q&#x3D;&#x3D;&#x3D;&#x3D;</strong></font>，是flag的base32，解密得到<font color=deepskyblue><strong>HECTF{uV3xxc7S8iyBNTxtfxvPrO7RFE3gLpro9a3AW2KP}</strong></font>.</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/02/09/vn_25/"
      title="VNCTF 2025 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        VNCTF 2025 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2024/11/25/qwqsn_24/"
      title="强网杯青少年专项选拔赛 2024 WriteUp (Reverse 方向)"
     >

    <p class="title-text">
      
        强网杯青少年专项选拔赛 2024 WriteUp (Reverse 方向)
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
