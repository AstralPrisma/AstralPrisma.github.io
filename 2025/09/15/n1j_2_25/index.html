<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>N1CTF Junior 2025 2/2 出题记录 | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="第一次在大比赛出题，本来出了4个逆向，最后只上了两个，也是Re所有题目里面最难的两个（mmm和loda） Multiple Magic Matrices出题记录第一部分的约束矩阵：灵感来源于朋友发我的一张 5*5 逻辑bingo图，有点像小学那种推断谁说的对谁说的错的脑筋急转弯题，当时发现转为布尔矩阵后用z3进行约束能出结果，遂扩展到 8*8，又加入了一些条件，本意也是想让用AI直接提取约束条件，">
<meta property="og:type" content="article">
<meta property="og:title" content="N1CTF Junior 2025 2&#x2F;2 出题记录">
<meta property="og:url" content="https://astralprisma.github.io/2025/09/15/n1j_2_25/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="第一次在大比赛出题，本来出了4个逆向，最后只上了两个，也是Re所有题目里面最难的两个（mmm和loda） Multiple Magic Matrices出题记录第一部分的约束矩阵：灵感来源于朋友发我的一张 5*5 逻辑bingo图，有点像小学那种推断谁说的对谁说的错的脑筋急转弯题，当时发现转为布尔矩阵后用z3进行约束能出结果，遂扩展到 8*8，又加入了一些条件，本意也是想让用AI直接提取约束条件，">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-09-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-11-09T20:18:22.306Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Ideas/">
                Ideas
                <div class="category-count">2</div>
            </a>
        
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">35</div>
            </a>
        
            <a class="category-link" href="/categories/%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">
                出题记录
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/got/" rel="tag">.got</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ARM/" rel="tag">ARM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AutoRe/" rel="tag">AutoRe</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Brainfuck/" rel="tag">Brainfuck</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CUDA/" rel="tag">CUDA</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Cheat-Engine/" rel="tag">Cheat Engine</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DOS/" rel="tag">DOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Driver/" rel="tag">Driver</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Frida-Hook/" rel="tag">Frida Hook</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Harmony-OS/" rel="tag">Harmony OS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/IPC/" rel="tag">IPC</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Indirect-Jump/" rel="tag">Indirect Jump</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Kotlin/" rel="tag">Kotlin</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Lua/" rel="tag">Lua</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Obfuscate/" rel="tag">Obfuscate</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pascal/" rel="tag">Pascal</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Powershell/" rel="tag">Powershell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pyarmor/" rel="tag">Pyarmor</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/QEMU/" rel="tag">QEMU</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/R2R/" rel="tag">R2R</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Remote/" rel="tag">Remote</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Subprocess/" rel="tag">Subprocess</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Traffic/" rel="tag">Traffic</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Unicorn/" rel="tag">Unicorn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/VM/" rel="tag">VM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/WASM/" rel="tag">WASM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Wechat-Mini-Program/" rel="tag">Wechat Mini Program</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Windows-DLL/" rel="tag">Windows DLL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Yara/" rel="tag">Yara</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/il2cpp/" rel="tag">il2cpp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pickle/" rel="tag">pickle</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/x96/" rel="tag">x96</a></li></ul>
    </div>
  </div>


    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-n1j_2_25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        N1CTF Junior 2025 2/2 出题记录
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-09-14T16:00:00.000Z" itemprop="datePublished">2025-09-15</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">出题记录</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            9.3k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p>第一次在大比赛出题，本来出了4个逆向，最后只上了两个，也是Re所有题目里面最难的两个（mmm和loda）</p>
<h1 id="Multiple-Magic-Matrices"><a href="#Multiple-Magic-Matrices" class="headerlink" title="Multiple Magic Matrices"></a>Multiple Magic Matrices</h1><h2 id="出题记录"><a href="#出题记录" class="headerlink" title="出题记录"></a>出题记录</h2><p>第一部分的约束矩阵：灵感来源于朋友发我的一张 5*5 逻辑bingo图，有点像小学那种推断谁说的对谁说的错的脑筋急转弯题，当时发现转为布尔矩阵后用z3进行约束能出结果，遂扩展到 8*8，又加入了一些条件，本意也是想让用AI直接提取约束条件，然后写z3脚本跑出来约束</p>
<p>第二部分的加密算法：来源于不久之前想自己设计的基于洛书幻方的分组加密算法，随便搓的，同构还算简单，没有什么拐弯抹角的加密方式</p>
<p>第三部分的数织：灵感同样来自朋友，随便搓了个字符画当图案用 <del>（后面还为能让加密结果尽量贴近这个图案找了半天的最佳iv值）</del></p>
<h2 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h2><p>main函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+48h] [rbp-78h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+4Ch] [rbp-74h] BYREF</span></span><br><span class="line">  _BYTE v6[<span class="number">79</span>]; <span class="comment">// [rsp+50h] [rbp-70h] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">9</span>]; <span class="comment">// [rsp+9Fh] [rbp-21h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *Block; <span class="comment">// [rsp+A8h] [rbp-18h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+B0h] [rbp-10h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+B8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">sub_140004C50</span>(argc, argv, envp);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input your key: &quot;</span>);</span><br><span class="line">  <span class="built_in">sub_140002CC3</span>((__int64)v7);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Your target: \n&quot;</span>);</span><br><span class="line">  <span class="built_in">sub_1400034C9</span>(</span><br><span class="line">    <span class="number">13</span>,</span><br><span class="line">    <span class="number">13</span>,</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)&amp;unk_140007000,</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)&amp;unk_140007220,</span><br><span class="line">    (__int64)&amp;unk_140007260,</span><br><span class="line">    (__int64)&amp;unk_140007480);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;\nYour input?: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">  v10 = <span class="built_in">sub_140002F00</span>(v6, &amp;v5);</span><br><span class="line">  <span class="keyword">if</span> ( !v10 || v5 &lt;= <span class="number">143</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">sub_140003070</span>(v10, (<span class="type">unsigned</span> <span class="type">int</span>)v5, v7);</span><br><span class="line">  v9 = v4 - <span class="number">1LL</span>;</span><br><span class="line">  Block = (<span class="type">void</span> *)<span class="built_in">sub_14000334F</span>(v10, (<span class="type">unsigned</span> <span class="type">int</span>)v5, &amp;v4);</span><br><span class="line">  <span class="keyword">if</span> ( !Block )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">sub_1400036CC</span>(</span><br><span class="line">    v4,</span><br><span class="line">    v4,</span><br><span class="line">    (_DWORD)Block,</span><br><span class="line">    (<span class="type">unsigned</span> <span class="type">int</span>)&amp;unk_140007000,</span><br><span class="line">    (__int64)&amp;unk_140007220,</span><br><span class="line">    (__int64)&amp;unk_140007260,</span><br><span class="line">    (__int64)&amp;unk_140007480);</span><br><span class="line">  <span class="built_in">free</span>(Block);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先查看对于key的校验：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140002CC3</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD v2[<span class="number">8</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+60h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// [rsp+68h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+70h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+74h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+78h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+7Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">scanf</span>(<span class="string">&quot;%llu&quot;</span>) != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Invalid input.&quot;</span>);</span><br><span class="line">    <span class="built_in">sub_140005840</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">memset</span>(v2, <span class="number">0</span>, <span class="built_in">sizeof</span>(v2));</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">sub_140001AAA</span>(v4, (__int64)v2);</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j )</span><br><span class="line">      matrix[<span class="number">8</span> * i + j] = *((_BYTE *)v2 + v8++) == <span class="number">49</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">sub_140001BDB</span>() != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong key!&quot;</span>);</span><br><span class="line">    <span class="built_in">sub_140005840</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Right key!&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">7</span>; k &gt;= <span class="number">0</span>; --k )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(a1 + k) = v4;</span><br><span class="line">    v4 &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">8</span>) = <span class="number">-17</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span> *__fastcall <span class="title">sub_140001AAA</span><span class="params">(<span class="type">unsigned</span> __int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">63</span>;</span><br><span class="line">  result = (<span class="type">char</span> *)(a2 + <span class="number">64</span>);</span><br><span class="line">  *(_BYTE *)(a2 + <span class="number">64</span>) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v5 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (a1 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      v3 = <span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v3 = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">    v4 = v5--;</span><br><span class="line">    result = (<span class="type">char</span> *)(a2 + v4);</span><br><span class="line">    *result = v3;</span><br><span class="line">    a1 &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输入的是一个uint64，在sub_140001AAA转为bit，然后填充入matrix中，查看matrix的校验函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BOOL8 <span class="title">sub_140001BDB</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">7</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * i + j] )</span><br><span class="line">      &#123;</span><br><span class="line">        ++*((_DWORD *)&amp;v8 + i);</span><br><span class="line">        ++*((_DWORD *)&amp;v4 + j);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">12</span>] != <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">32</span>] != (<span class="type">int</span>)v6 &lt;= <span class="number">5</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v68 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">7</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    v66 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">7</span>; ++m )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * k + m] != <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v66 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v66 )</span><br><span class="line">    &#123;</span><br><span class="line">      v68 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">12</span>] != v68 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">52</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">2</span>] != <span class="built_in">SHIDWORD</span>(v4) &lt; (<span class="type">int</span>)v5 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v64 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt;= <span class="number">7</span>; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    v62 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt;= <span class="number">7</span>; ++ii )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * ii + n] != <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v62 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v62 )</span><br><span class="line">    &#123;</span><br><span class="line">      v64 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">4</span>] != v64 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">23</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">25</span>] != <span class="built_in">SHIDWORD</span>(v9) &lt; <span class="built_in">SHIDWORD</span>(v4) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v60 = <span class="number">0</span>;</span><br><span class="line">  v59 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt;= <span class="number">7</span>; ++jj )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( matrix[<span class="number">9</span> * jj] != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v59 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v59 )</span><br><span class="line">    v60 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">33</span>] != <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v57 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( kk = <span class="number">0</span>; kk &lt;= <span class="number">7</span>; ++kk )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( matrix[<span class="number">8</span> * kk + <span class="number">7</span> - kk] != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v57 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v57 )</span><br><span class="line">    v60 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">20</span>] != v60 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">63</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v55 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">0</span>] )</span><br><span class="line">    ++v55;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">7</span>] )</span><br><span class="line">    ++v55;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">56</span>] )</span><br><span class="line">    ++v55;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">63</span>] )</span><br><span class="line">    ++v55;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">43</span>] != <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (v55 == <span class="number">1</span>) != matrix[<span class="number">45</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="built_in">sub_140001B0C</span>(<span class="number">1</span>, <span class="number">0</span>, v3, v2);</span><br><span class="line">  v54 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( mm = <span class="number">0</span>; mm &lt; v12; ++mm )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( matrix[<span class="number">8</span> * v3[mm] + v2[mm]] )</span><br><span class="line">      ++v54;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">8</span>] != (v54 % <span class="number">2</span> == <span class="number">1</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">21</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="built_in">sub_140001B0C</span>(<span class="number">5</span>, <span class="number">6</span>, v3, v2);</span><br><span class="line">  v52 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( nn = <span class="number">0</span>; nn &lt; v12; ++nn )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( matrix[<span class="number">8</span> * v3[nn] + v2[nn]] )</span><br><span class="line">      ++v52;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">46</span>] != !(v52 &amp; <span class="number">1</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">25</span>] != <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">34</span>] != (<span class="type">int</span>)v4 &gt; <span class="number">5</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v50 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i1 = <span class="number">0</span>; i1 &lt;= <span class="number">7</span>; ++i1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i2 = <span class="number">0</span>; i2 &lt;= <span class="number">7</span>; ++i2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v47 = <span class="number">1</span>;</span><br><span class="line">      v12 = <span class="built_in">sub_140001B0C</span>((<span class="type">unsigned</span> <span class="type">int</span>)i1, (<span class="type">unsigned</span> <span class="type">int</span>)i2, v3, v2);</span><br><span class="line">      <span class="keyword">for</span> ( i3 = <span class="number">0</span>; i3 &lt; v12; ++i3 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( matrix[<span class="number">8</span> * v3[i3] + v2[i3]] )</span><br><span class="line">        &#123;</span><br><span class="line">          v47 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v47 &amp;&amp; v12 &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v50 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v50 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)matrix[<span class="number">10</span>] != ((<span class="type">unsigned</span> __int8)v50 ^ <span class="number">1</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">16</span>] != matrix[<span class="number">18</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v45 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i4 = <span class="number">0</span>; i4 &lt;= <span class="number">2</span>; ++i4 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i5 = <span class="number">0</span>; i5 &lt;= <span class="number">2</span>; ++i5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * i4 + i5] )</span><br><span class="line">        ++v45;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v45 &gt; <span class="number">4</span> != matrix[<span class="number">17</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">48</span>] != <span class="built_in">SHIDWORD</span>(v7) &lt;= <span class="number">3</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v42 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i6 = <span class="number">0</span>; i6 &lt;= <span class="number">3</span>; ++i6 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i7 = <span class="number">0</span>; i7 &lt;= <span class="number">1</span>; ++i7 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * i6 + i7] )</span><br><span class="line">        v42 += <span class="number">4</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v42 += <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v42 &lt;= <span class="number">3</span> != matrix[<span class="number">22</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v42 &gt; <span class="number">7</span> != matrix[<span class="number">14</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (v55 == <span class="number">3</span>) != matrix[<span class="number">11</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v39 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i8 = <span class="number">0</span>; i8 &lt;= <span class="number">4</span>; ++i8 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i9 = <span class="number">0</span>; i9 &lt;= <span class="number">2</span>; ++i9 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * i8 + i9] )</span><br><span class="line">        v39 += <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v39 += <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v39 &lt;= <span class="number">2</span> != matrix[<span class="number">30</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">40</span>] != <span class="built_in">SHIDWORD</span>(v10) &lt;= <span class="number">1</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v36 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i10 = <span class="number">0</span>; i10 &lt;= <span class="number">6</span>; ++i10 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i11 = <span class="number">0</span>; i11 &lt;= <span class="number">7</span>; ++i11 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * i10 + i11] &amp;&amp; matrix[<span class="number">8</span> * i10 + <span class="number">8</span> + i11] )</span><br><span class="line">      &#123;</span><br><span class="line">        v36 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v36 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)matrix[<span class="number">18</span>] != ((<span class="type">unsigned</span> __int8)v36 ^ <span class="number">1</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">43</span>] != (<span class="type">int</span>)v8 &lt; <span class="built_in">SHIDWORD</span>(v5) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (v55 == <span class="number">4</span>) != matrix[<span class="number">57</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v33 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i12 = <span class="number">1</span>; i12 &lt;= <span class="number">6</span>; ++i12 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i13 = <span class="number">1</span>; i13 &lt;= <span class="number">6</span>; ++i13 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * i12 - <span class="number">8</span> + i13]</span><br><span class="line">        &amp;&amp; matrix[<span class="number">8</span> * i12 + <span class="number">8</span> + i13]</span><br><span class="line">        &amp;&amp; matrix[<span class="number">8</span> * i12 - <span class="number">1</span> + i13]</span><br><span class="line">        &amp;&amp; matrix[<span class="number">8</span> * i12 + <span class="number">1</span> + i13]</span><br><span class="line">        &amp;&amp; matrix[<span class="number">8</span> * i12 + i13] != <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v33 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v33 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)matrix[<span class="number">19</span>] != ((<span class="type">unsigned</span> __int8)v33 ^ <span class="number">1</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">47</span>] != v50 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v30 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i14 = <span class="number">0</span>; i14 &lt;= <span class="number">7</span>; ++i14 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i15 = <span class="number">0</span>; i15 &lt;= <span class="number">7</span>; ++i15 )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = <span class="built_in">sub_140001B0C</span>((<span class="type">unsigned</span> <span class="type">int</span>)i14, (<span class="type">unsigned</span> <span class="type">int</span>)i15, v3, v2);</span><br><span class="line">      v27 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> ( i16 = <span class="number">0</span>; i16 &lt; v12; ++i16 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( matrix[<span class="number">8</span> * v3[i16] + v2[i16]] )</span><br><span class="line">          ++v27;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( v27 &gt; <span class="number">6</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v30 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v30 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">24</span>] != v30 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">51</span>] != matrix[<span class="number">61</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v25 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i17 = <span class="number">0</span>; i17 &lt;= <span class="number">6</span>; ++i17 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i18 = <span class="number">0</span>; i18 &lt;= <span class="number">6</span>; ++i18 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( matrix[<span class="number">8</span> * i17 + i18] &amp;&amp; matrix[<span class="number">8</span> * i17 + <span class="number">8</span> + i18] &amp;&amp; matrix[<span class="number">8</span> * i17 + <span class="number">1</span> + i18] &amp;&amp; matrix[<span class="number">8</span> * i17 + <span class="number">9</span> + i18] )</span><br><span class="line">      &#123;</span><br><span class="line">        v25 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v25 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">26</span>] != v25 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (v55 == <span class="number">2</span>) != matrix[<span class="number">46</span>] )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v22 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="built_in">sub_140001B0C</span>(<span class="number">3</span>, <span class="number">3</span>, v3, v2);</span><br><span class="line">  <span class="keyword">for</span> ( i19 = <span class="number">0</span>; i19 &lt; v12; ++i19 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( matrix[<span class="number">8</span> * v3[i19] + v2[i19]] )</span><br><span class="line">      ++v22;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">27</span>] != !(v22 &amp; <span class="number">1</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v20 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="built_in">sub_140001B0C</span>(<span class="number">6</span>, <span class="number">4</span>, v3, v2);</span><br><span class="line">  <span class="keyword">for</span> ( i20 = <span class="number">0</span>; i20 &lt; v12; ++i20 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( matrix[<span class="number">8</span> * v3[i20] + v2[i20]] )</span><br><span class="line">      ++v20;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">22</span>] != (v20 % <span class="number">2</span> == <span class="number">1</span>) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">54</span>] != <span class="built_in">SHIDWORD</span>(v9) &gt; <span class="built_in">SHIDWORD</span>(v7) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v18 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i21 = <span class="number">0</span>; i21 &lt;= <span class="number">7</span>; ++i21 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)v7 &gt; *((_DWORD *)&amp;v4 + i21) )</span><br><span class="line">    &#123;</span><br><span class="line">      v18 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">35</span>] != v18 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">39</span>] != <span class="built_in">SHIDWORD</span>(v10) &gt; <span class="built_in">SHIDWORD</span>(v4) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v16 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i22 = <span class="number">0</span>; i22 &lt;= <span class="number">7</span>; ++i22 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !*((_DWORD *)&amp;v8 + i22) )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">42</span>] != (<span class="type">int</span>)v8 &lt; <span class="built_in">SHIDWORD</span>(v4) )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( matrix[<span class="number">7</span>] != (<span class="type">int</span>)v8 &gt; <span class="number">4</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i23 = <span class="number">0</span>; i23 &lt;= <span class="number">7</span>; ++i23 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !*((_DWORD *)&amp;v4 + i23) )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v1 = v16 || v14;</span><br><span class="line">  <span class="keyword">return</span> matrix[<span class="number">36</span>] == v1 &amp;&amp; matrix[<span class="number">58</span>] == (<span class="type">int</span>)v8 &gt; (<span class="type">int</span>)v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其中有很多对矩阵的约束，转为python的z3脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个 8x8 的布尔矩阵</span></span><br><span class="line">ROWS = <span class="number">8</span></span><br><span class="line">COLS = <span class="number">8</span></span><br><span class="line">S = [[Bool(<span class="string">f&#x27;S_<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>_<span class="subst">&#123;j+<span class="number">1</span>&#125;</span>&#x27;</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)]</span><br><span class="line">solver = Solver()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要求某些项必须是正确的或者错误的</span></span><br><span class="line">solver.add(S[<span class="number">1</span>][<span class="number">4</span>] == <span class="literal">True</span>)</span><br><span class="line">solver.add(S[<span class="number">6</span>][<span class="number">4</span>] == <span class="literal">False</span>)</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">7</span>] == <span class="literal">False</span>)</span><br><span class="line">solver.add(S[<span class="number">4</span>][<span class="number">1</span>] == <span class="literal">True</span>)</span><br><span class="line">solver.add(S[<span class="number">7</span>][<span class="number">7</span>] == <span class="literal">False</span>)</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">3</span>] == <span class="literal">True</span>)</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">5</span>] == <span class="literal">False</span>)</span><br><span class="line">solver.add(S[<span class="number">3</span>][<span class="number">1</span>] == <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第x行/列正确数量小于/大于第x行/列</span></span><br><span class="line">row_1_count = Sum([If(S[<span class="number">0</span>][j], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)])</span><br><span class="line">row_4_count = Sum([If(S[<span class="number">3</span>][j], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)])</span><br><span class="line">row_6_count = Sum([If(S[<span class="number">5</span>][j], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)])</span><br><span class="line"></span><br><span class="line">col_1_count = Sum([If(S[i][<span class="number">0</span>], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)])</span><br><span class="line">col_2_count = Sum([If(S[i][<span class="number">1</span>], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)])</span><br><span class="line">col_3_count = Sum([If(S[i][<span class="number">2</span>], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)])</span><br><span class="line">col_4_count = Sum([If(S[i][<span class="number">3</span>], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)])</span><br><span class="line">col_5_count = Sum([If(S[i][<span class="number">4</span>], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)])</span><br><span class="line">col_8_count = Sum([If(S[i][<span class="number">7</span>], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)])</span><br><span class="line"></span><br><span class="line">solver.add(S[<span class="number">4</span>][<span class="number">7</span>] == (row_6_count &gt; col_2_count))</span><br><span class="line">solver.add(S[<span class="number">0</span>][<span class="number">2</span>] == (col_2_count &lt; col_3_count))</span><br><span class="line">solver.add(S[<span class="number">3</span>][<span class="number">1</span>] == (row_4_count &lt; col_2_count))</span><br><span class="line">solver.add(S[<span class="number">6</span>][<span class="number">6</span>] == (row_4_count &gt; col_8_count))</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">3</span>] == (row_1_count &lt; col_4_count))</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">2</span>] == (row_1_count &lt; col_2_count))</span><br><span class="line">solver.add(S[<span class="number">7</span>][<span class="number">2</span>] == (row_1_count &gt; col_3_count))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第n列正确数量xx</span></span><br><span class="line">solver.add(S[<span class="number">4</span>][<span class="number">0</span>] == (col_5_count &lt; <span class="number">6</span>))</span><br><span class="line">solver.add(S[<span class="number">4</span>][<span class="number">2</span>] == (col_1_count &gt; <span class="number">5</span>))</span><br><span class="line">solver.add(S[<span class="number">6</span>][<span class="number">0</span>] == (col_8_count &lt; <span class="number">4</span>))</span><br><span class="line">solver.add(S[<span class="number">0</span>][<span class="number">7</span>] == (row_1_count &gt; <span class="number">4</span>))</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">0</span>] == (row_6_count &lt; <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 会有8个正确项连成一整行/列/对角线</span></span><br><span class="line">horizontal_streak_of_8 = Or([And([S[i][j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(k, k+<span class="number">8</span>)]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(COLS - <span class="number">7</span>)])</span><br><span class="line">solver.add(S[<span class="number">1</span>][<span class="number">4</span>] == horizontal_streak_of_8)</span><br><span class="line"></span><br><span class="line">vertical_streak_of_8 = Or([And([S[i][j] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(k, k+<span class="number">8</span>)]) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS) <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(ROWS - <span class="number">7</span>)])</span><br><span class="line">solver.add(S[<span class="number">0</span>][<span class="number">4</span>] == vertical_streak_of_8)</span><br><span class="line"></span><br><span class="line">exists_8_diag = Or(Or([And([S[i][i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])]), Or([And([S[i][COLS-<span class="number">1</span>-i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])]))</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">4</span>] == exists_8_diag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵四个角的项恰好有n个是对的</span></span><br><span class="line">corners = [S[<span class="number">0</span>][<span class="number">0</span>], S[<span class="number">0</span>][COLS-<span class="number">1</span>], S[ROWS-<span class="number">1</span>][<span class="number">0</span>], S[ROWS-<span class="number">1</span>][COLS-<span class="number">1</span>]]</span><br><span class="line">corner_count = Sum([If(b, <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> b <span class="keyword">in</span> corners])</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">5</span>] == (corner_count == <span class="number">1</span>))</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">6</span>] == (corner_count == <span class="number">2</span>))</span><br><span class="line">solver.add(S[<span class="number">1</span>][<span class="number">3</span>] == (corner_count == <span class="number">3</span>))</span><br><span class="line">solver.add(S[<span class="number">7</span>][<span class="number">1</span>] == (corner_count == <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这一项周围的5项中正确的数量是奇数/偶数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_neighbors</span>(<span class="params">r, c</span>):</span><br><span class="line">    neighbors = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="number">0</span>, r-<span class="number">1</span>), <span class="built_in">min</span>(ROWS, r+<span class="number">2</span>)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">max</span>(<span class="number">0</span>, c-<span class="number">1</span>), <span class="built_in">min</span>(COLS, c+<span class="number">2</span>)):</span><br><span class="line">            <span class="keyword">if</span> (i, j) != (r, c):</span><br><span class="line">                neighbors.append(S[i][j])</span><br><span class="line">    <span class="keyword">return</span> neighbors</span><br><span class="line"></span><br><span class="line">neighbors_2_1_count = Sum([If(b, <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> b <span class="keyword">in</span> get_neighbors(<span class="number">1</span>, <span class="number">0</span>)])</span><br><span class="line">solver.add(S[<span class="number">1</span>][<span class="number">0</span>] == (neighbors_2_1_count % <span class="number">2</span> == <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">neighbors_6_7_count = Sum([If(b, <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> b <span class="keyword">in</span> get_neighbors(<span class="number">5</span>, <span class="number">6</span>)])</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">6</span>] == (neighbors_6_7_count % <span class="number">2</span> == <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存在/不存在一个项，这一项的周围8个项全是错的项</span></span><br><span class="line">all_false_neighbors_exist = Or([And([Not(n) <span class="keyword">for</span> n <span class="keyword">in</span> get_neighbors(i, j)]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)])</span><br><span class="line">solver.add(S[<span class="number">1</span>][<span class="number">2</span>] == Not(all_false_neighbors_exist))</span><br><span class="line">solver.add(S[<span class="number">5</span>][<span class="number">7</span>] == all_false_neighbors_exist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># x,x是正确的/错误的</span></span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">0</span>] == S[<span class="number">2</span>][<span class="number">2</span>])</span><br><span class="line">solver.add(S[<span class="number">6</span>][<span class="number">3</span>] == S[<span class="number">7</span>][<span class="number">5</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 坐标x,x范围内的九宫格里面有xx个正确的</span></span><br><span class="line">subgrid_count_1 = Sum([If(S[i][j], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">1</span>] == (subgrid_count_1 &gt;= <span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">subgrid_count_2 = Sum([If(S[i][j], <span class="number">4</span>, <span class="number">3</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)])</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">6</span>] == (subgrid_count_2 &lt;= <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">subgrid_count_3 = Sum([If(S[i][j], <span class="number">2</span>, <span class="number">4</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)])</span><br><span class="line">solver.add(S[<span class="number">1</span>][<span class="number">6</span>] == (subgrid_count_2 &gt; <span class="number">7</span>))</span><br><span class="line"></span><br><span class="line">subgrid_count_4 = Sum([If(S[i][j], <span class="number">3</span>, <span class="number">3</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])</span><br><span class="line">solver.add(S[<span class="number">3</span>][<span class="number">6</span>] == (subgrid_count_2 &lt; <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存在/不存在上下相邻且均正确的情况</span></span><br><span class="line">adjacent_vertical = Or([And(S[i][j], S[i+<span class="number">1</span>][j]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS - <span class="number">1</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)])</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">2</span>] == Not(adjacent_vertical))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存在/不存在上下左右均正确但自身不正确的情况</span></span><br><span class="line">adjacent_plus = Or([And(S[i-<span class="number">1</span>][j], S[i+<span class="number">1</span>][j], S[i][j-<span class="number">1</span>], S[i][j+<span class="number">1</span>], Not(S[i][j])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, ROWS-<span class="number">1</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, COLS-<span class="number">1</span>)])</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">3</span>] == Not(adjacent_plus))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存在/不存在某一项，周围的8个格子内正确的数量xx</span></span><br><span class="line">exists_high_density_spot = Or([Sum([If(n, <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> n <span class="keyword">in</span> get_neighbors(i, j)]) &gt;= <span class="number">7</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)])</span><br><span class="line">solver.add(S[<span class="number">3</span>][<span class="number">0</span>] == exists_high_density_spot)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 存在/不存在一个形状，其内部的k个均正确</span></span><br><span class="line">exists_2x2_square = Or([And(S[i][j], S[i+<span class="number">1</span>][j], S[i][j+<span class="number">1</span>], S[i+<span class="number">1</span>][j+<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS-<span class="number">1</span>) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS-<span class="number">1</span>)])</span><br><span class="line">solver.add(S[<span class="number">3</span>][<span class="number">2</span>] == exists_2x2_square)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 周围8个格子有偶数个/奇数个是正确的</span></span><br><span class="line">neighbors_4_4_count = Sum([If(b, <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> b <span class="keyword">in</span> get_neighbors(<span class="number">3</span>, <span class="number">3</span>)])</span><br><span class="line">solver.add(S[<span class="number">3</span>][<span class="number">3</span>] == (neighbors_4_4_count % <span class="number">2</span> == <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">neighbors_7_5_count = Sum([If(b, <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> b <span class="keyword">in</span> get_neighbors(<span class="number">6</span>, <span class="number">4</span>)])</span><br><span class="line">solver.add(S[<span class="number">2</span>][<span class="number">6</span>] == (neighbors_7_5_count % <span class="number">2</span> == <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 第x列正确数量在所有列中最少</span></span><br><span class="line">col_counts = [Sum([If(S[i][j], <span class="number">1</span>, <span class="number">0</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)]) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)]</span><br><span class="line">solver.add(S[<span class="number">4</span>][<span class="number">3</span>] == And([col_counts[<span class="number">6</span>] &lt;= col_counts[j] <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5,5: 存在一整行或一整列都是错的</span></span><br><span class="line">all_false_row = Or([And([Not(S[i][j]) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)])</span><br><span class="line">all_false_col = Or([And([Not(S[i][j]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS)]) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS)])</span><br><span class="line">solver.add(S[<span class="number">4</span>][<span class="number">4</span>] == Or(all_false_row, all_false_col))</span><br><span class="line"></span><br><span class="line">solution_count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> solver.check() == sat:</span><br><span class="line">    solution_count += <span class="number">1</span></span><br><span class="line">    model = solver.model()</span><br><span class="line">    matrix_solution = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS):</span><br><span class="line">        row_solution = []</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS):</span><br><span class="line">            <span class="keyword">if</span> model.evaluate(S[i][j]):</span><br><span class="line">                row_solution.append(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                row_solution.append(<span class="string">&quot;0&quot;</span>)</span><br><span class="line">        matrix_solution.append(row_solution)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> i, row <span class="keyword">in</span> <span class="built_in">enumerate</span>(matrix_solution):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  &quot;</span>.join(row))</span><br><span class="line">    </span><br><span class="line">    true_count = <span class="built_in">sum</span>(row.count(<span class="string">&quot;1&quot;</span>) <span class="keyword">for</span> row <span class="keyword">in</span> matrix_solution)</span><br><span class="line">    </span><br><span class="line">    current_solution_negation = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROWS):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(COLS):</span><br><span class="line">            <span class="keyword">if</span> model.evaluate(S[i][j]):</span><br><span class="line">                current_solution_negation.append(Not(S[i][j]))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                current_solution_negation.append(S[i][j])</span><br><span class="line">    </span><br><span class="line">    solver.add(Or(current_solution_negation))</span><br></pre></td></tr></table></figure>

<p>得到解：<code>1001011111111111010000000110100111010110000110000111000110111110</code>（十进制为<code>10952543642096005566</code>），此时程序打印出来一个图案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 2 2 1 3</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 1 1 1 1 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 1 3 1 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 1 1 1 3</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 0</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 2 2 2 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 1 1 1 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 1 1 1 2</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 2 1 1 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 3 2 1 1 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 1 1 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 2 1 1</span><br><span class="line">□ □ □ □ □ □ □ □ □ □ □ □ □ ║ 1 1 1 1 1 1</span><br><span class="line">══════════════════════════╝</span><br><span class="line">4 1 1 1 4 5 3 1 3 4 4 1 1</span><br><span class="line">1 4 5 1 4 1 1 1 1   1 1 2</span><br><span class="line">3     1     1 1 1   1 3 1</span><br><span class="line">            1   2     2 1</span><br><span class="line">                        1</span><br><span class="line">                        1</span><br></pre></td></tr></table></figure>

<p>显然，这是一个数织问题，我们可以通过在线网站恢复出这里所需的数织图案：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">████  ████    ██    ██████║ 2 2 1 3</span><br><span class="line">██  ██  ██  ██  ██  ██    ║ 1 1 1 1 1 1</span><br><span class="line">██      ██  ██████  ██  ██║ 1 1 3 1 1</span><br><span class="line">██      ██  ██  ██  ██████║ 1 1 1 1 3</span><br><span class="line">                          ║ 0</span><br><span class="line">██  ████  ████  ████    ██║ 1 2 2 2 1</span><br><span class="line">    ██    ██  ██  ██  ██  ║ 1 1 1 1 1</span><br><span class="line">██  ██    ██      ██  ████║ 1 1 1 1 2</span><br><span class="line">██  ████  ██      ██  ██  ║ 1 2 1 1 1</span><br><span class="line">██████  ████    ██  ██  ██║ 3 2 1 1 1</span><br><span class="line">  ██    ██  ██        ██  ║ 1 1 1 1</span><br><span class="line">  ██    ████    ██    ██  ║ 1 2 1 1</span><br><span class="line">  ██    ██  ██  ██  ██  ██║ 1 1 1 1 1 1</span><br><span class="line">══════════════════════════╝</span><br><span class="line">4 1 1 1 4 5 3 1 3 4 4 1 1</span><br><span class="line">1 4 5 1 4 1 1 1 1   1 1 2</span><br><span class="line">3     1     1 1 1   1 3 1</span><br><span class="line">            1   2     2 1</span><br><span class="line">                        1</span><br><span class="line">                        1</span><br></pre></td></tr></table></figure>

<p>接下来跟踪这个数织是如何构造的，注意到之前密钥正确后被转为了hex并插入了一个字节0xEF（<code>97ff4069d61871beef</code>），查看后续逻辑：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__fastcall <span class="title">sub_140002F00</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, _DWORD *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  _DWORD v4[<span class="number">7</span>]; <span class="comment">// [rsp+20h] [rbp-40h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+3Ch] [rbp-24h]</span></span><br><span class="line">  _DWORD *v6; <span class="comment">// [rsp+40h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [rsp+48h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+4Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+50h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+54h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+5Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">sub_140002E30</span>();</span><br><span class="line">    v8 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">    v7 = <span class="number">6</span> * v8;</span><br><span class="line">    *a2 = <span class="number">6</span> * v8;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v8; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( dword_14000B080[(<span class="type">unsigned</span> __int8)a1[i]] == <span class="number">-1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        *a2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    v6 = <span class="built_in">malloc</span>(<span class="number">4LL</span> * v7);</span><br><span class="line">    <span class="keyword">if</span> ( v6 )</span><br><span class="line">    &#123;</span><br><span class="line">      v11 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v8; ++j )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = dword_14000B080[(<span class="type">unsigned</span> __int8)a1[j]];</span><br><span class="line">        <span class="built_in">sub_140002EAE</span>(v5, v4);</span><br><span class="line">        <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">5</span>; ++k )</span><br><span class="line">        &#123;</span><br><span class="line">          v3 = v11++;</span><br><span class="line">          v6[v3] = v4[k];</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *a2 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    *a2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">_DWORD *<span class="title">sub_140002E30</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">255</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = dword_14000B080;</span><br><span class="line">    dword_14000B080[i] = <span class="number">-1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">63</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    result = dword_14000B080;</span><br><span class="line">    dword_14000B080[(<span class="type">unsigned</span> __int8)aAbcdefghijklmn[j]] = j;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此函数初始化了一个类似base64的映射表（结尾是_!），然后把字符换成在表中的索引，并转为6位2进制，之后在main函数中要求bit总数大于144，相当于输入的字符长度大于24，继续查看sub_140003070：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140003070</span><span class="params">(__int64 a1, <span class="type">int</span> a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE v4[<span class="number">432</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  _BYTE v5[<span class="number">27</span>]; <span class="comment">// [rsp+1D0h] [rbp+150h] BYREF</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+1EBh] [rbp+16Bh] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+1F3h] [rbp+173h]</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+1F4h] [rbp+174h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+1F8h] [rbp+178h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+1FCh] [rbp+17Ch]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+200h] [rbp+180h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+204h] [rbp+184h]</span></span><br><span class="line">  <span class="type">void</span> *Block; <span class="comment">// [rsp+208h] [rbp+188h]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+210h] [rbp+190h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+214h] [rbp+194h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+218h] [rbp+198h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+21Ch] [rbp+19Ch]</span></span><br><span class="line"></span><br><span class="line">  v6 = <span class="number">0x5FB548D0433F93FALL</span>;</span><br><span class="line">  v7 = <span class="number">62</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !a1 || a2 &lt;= <span class="number">143</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFFLL</span>;</span><br><span class="line">  Block = <span class="built_in">malloc</span>(<span class="number">0x240u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !Block )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFFLL</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a2 - <span class="number">143</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">143</span>; ++j )</span><br><span class="line">      *((_DWORD *)Block + j) = *(_DWORD *)(a1 + <span class="number">4LL</span> * (i + j));</span><br><span class="line">    <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="number">0x12u</span>);</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">143</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      v9 = k / <span class="number">8</span>;</span><br><span class="line">      v8 = <span class="number">7</span> - k % <span class="number">8</span>;</span><br><span class="line">      v5[k / <span class="number">8</span>] |= *((_BYTE *)Block + <span class="number">4</span> * k) &lt;&lt; (<span class="number">7</span> - k % <span class="number">8</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sub_140001780</span>(v4, a3, &amp;v6, <span class="number">1</span>);</span><br><span class="line">    <span class="built_in">sub_14000196F</span>(v4, v5, <span class="number">18</span>);</span><br><span class="line">    <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt;= <span class="number">143</span>; ++m )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = m / <span class="number">8</span>;</span><br><span class="line">      v11 = <span class="number">7</span> - m % <span class="number">8</span>;</span><br><span class="line">      v10 = ((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)v5[m / <span class="number">8</span>] &gt;&gt; (<span class="number">7</span> - m % <span class="number">8</span>)) &amp; <span class="number">1</span>;</span><br><span class="line">      *(_DWORD *)(<span class="number">4LL</span> * (i + m) + a1) = v10;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(Block);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是一个很明显的滑动窗口加密，一次带入144bit（18字节），key使用刚才的key，还初始化了一个额外的iv值（注意key和iv都是9字节），查看核心加密函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001780</span><span class="params">(_DWORD *a1, _BYTE *a2, _BYTE *a3, <span class="type">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">size_t</span> v4; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">size_t</span> v5; <span class="comment">// rcx</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(a1, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>((<span class="type">char</span> *)a1 + <span class="number">9</span>, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *a2 )</span><br><span class="line">      v4 = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>(a1, a2, v4);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( a3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *a3 )</span><br><span class="line">      v5 = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memcpy</span>((<span class="type">char</span> *)a1 + <span class="number">9</span>, a3, v5);</span><br><span class="line">  &#125;</span><br><span class="line">  a1[<span class="number">106</span>] = a4;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_1400016A8</span>(a1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">unsigned</span> __int64 __fastcall <span class="title">sub_1400016A8</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = (<span class="type">unsigned</span> __int64)<span class="built_in">memcpy</span>((<span class="type">void</span> *)(a1 + <span class="number">18</span>), (<span class="type">const</span> <span class="type">void</span> *)a1, <span class="number">9u</span>);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = luoshu_magic_matrix[i];</span><br><span class="line">    v5 += result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">9</span>; j &lt;= <span class="number">404</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(<span class="type">unsigned</span> __int8 *)(a1 + j - <span class="number">9</span> + <span class="number">18</span>);</span><br><span class="line">    result = v5 * (v2 + (<span class="type">unsigned</span> <span class="type">int</span>)luoshu_magic_matrix[j % <span class="number">9</span>]);</span><br><span class="line">    *(_BYTE *)(a1 + j + <span class="number">18</span>) = v5 * (v2 + luoshu_magic_matrix[j % <span class="number">9</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_14000196F</span><span class="params">(__int64 a1, __int64 a2, <span class="type">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+20h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> j; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v5 = (<span class="number">9</span> - a3 % <span class="number">9</span>) % <span class="number">9</span>;</span><br><span class="line">  v4 = a3 + v5;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v5; ++i )</span><br><span class="line">    *(_BYTE *)(a2 + a3 + i) = v5;</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)(a1 + <span class="number">424</span>) == <span class="number">1</span> )</span><br><span class="line">    <span class="built_in">sub_1400014BE</span>(a2, a1 + <span class="number">9</span>);</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; ; j += <span class="number">9</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = j;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">int</span>)j &gt;= v4 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">sub_140001850</span>(a1, (<span class="type">int</span>)j + a2);</span><br><span class="line">    <span class="keyword">if</span> ( *(_DWORD *)(a1 + <span class="number">424</span>) == <span class="number">1</span> &amp;&amp; v4 &gt; (<span class="type">int</span>)(j + <span class="number">9</span>) )</span><br><span class="line">      <span class="built_in">sub_1400014BE</span>((<span class="type">int</span>)j + <span class="number">9LL</span> + a2, (<span class="type">int</span>)j + a2);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_1400014BE</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// ecx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = *(<span class="type">unsigned</span> __int8 *)(a2 + i);</span><br><span class="line">    result = v2 ^ (<span class="type">unsigned</span> <span class="type">int</span>)*(<span class="type">unsigned</span> __int8 *)(a1 + i);</span><br><span class="line">    *(_BYTE *)(i + a1) = v2 ^ *(_BYTE *)(a1 + i);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 *__fastcall <span class="title">sub_140001850</span><span class="params">(__int64 a1, __int64 *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 *result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+27h] [rbp-19h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [rsp+2Fh] [rbp-11h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = *a2;</span><br><span class="line">  v4 = *((_BYTE *)a2 + <span class="number">8</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">44</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = a1 + <span class="number">18</span> + <span class="number">9</span> * i;</span><br><span class="line">    <span class="built_in">sub_1400014BE</span>((__int64)&amp;v3, (__int64)luoshu_magic_matrix);</span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">2</span> == <span class="number">1</span> )</span><br><span class="line">      <span class="built_in">sub_1400015D4</span>(&amp;v3, v5);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">sub_14000163E</span>(&amp;v3, v5);</span><br><span class="line">    <span class="built_in">sub_14000151B</span>(&amp;v3);</span><br><span class="line">    <span class="built_in">sub_1400014BE</span>((__int64)&amp;v3, v5);</span><br><span class="line">    <span class="keyword">if</span> ( (i &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">      <span class="built_in">sub_14000163E</span>(&amp;v3, luoshu_magic_matrix);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">sub_1400015D4</span>(&amp;v3, luoshu_magic_matrix);</span><br><span class="line">    <span class="built_in">sub_14000157E</span>(&amp;v3, luoshu_sbox);</span><br><span class="line">  &#125;</span><br><span class="line">  result = a2;</span><br><span class="line">  *a2 = v3;</span><br><span class="line">  *((_BYTE *)a2 + <span class="number">8</span>) = v4;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> __fastcall <span class="title">sub_1400015D4</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + a1) = <span class="built_in">sub_140001450</span>(*(<span class="type">unsigned</span> __int8 *)(a1 + i), *(<span class="type">unsigned</span> __int8 *)(a2 + i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001450</span><span class="params">(<span class="type">unsigned</span> __int8 a1, <span class="type">char</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (a1 &lt;&lt; (a2 &amp; <span class="number">7</span>)) | (<span class="type">unsigned</span> <span class="type">int</span>)((<span class="type">int</span>)a1 &gt;&gt; (<span class="number">8</span> - (a2 &amp; <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> __fastcall <span class="title">sub_14000163E</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + a1) = <span class="built_in">sub_140001487</span>(*(<span class="type">unsigned</span> __int8 *)(a1 + i), *(<span class="type">unsigned</span> __int8 *)(a2 + i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_140001487</span><span class="params">(<span class="type">unsigned</span> __int8 a1, <span class="type">char</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ((<span class="type">int</span>)a1 &gt;&gt; (a2 &amp; <span class="number">7</span>)) | (a1 &lt;&lt; (<span class="number">8</span> - (a2 &amp; <span class="number">7</span>)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_14000151B</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+3h] [rbp-Dh]</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [rsp+Bh] [rbp-5h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">    *((_BYTE *)&amp;v2 + i) = *(_BYTE *)(luoshu_magic_matrix[i] - <span class="number">1LL</span> + a1);</span><br><span class="line">  result = a1;</span><br><span class="line">  *(_QWORD *)a1 = v2;</span><br><span class="line">  *(_BYTE *)(a1 + <span class="number">8</span>) = v3;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_14000157E</span><span class="params">(__int64 a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(<span class="type">unsigned</span> __int8 *)(a2 + *(<span class="type">unsigned</span> __int8 *)(a1 + i));</span><br><span class="line">    *(_BYTE *)(a1 + i) = result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是一个很明显的分组加密算法，一组9字节，采用CBC模式，用到了两个矩阵，一个是洛书幻方（492357816），还有一个是S盒，同构这个加密算法：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Luo_Shu</span>:</span><br><span class="line">    order = [<span class="number">4</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">6</span>]</span><br><span class="line">    inv_order = [<span class="number">8</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">2</span>]</span><br><span class="line">    sbox = <span class="built_in">bytearray</span>.fromhex(<span class="string">&quot;38d6180ec6a4474a97a1a279e3f9610bc3fa08325f734f6cbe687bb34c1b8d3c63f5e8d8cbcfbcc19a3f6f9f70ca604930e68690c81fe56e8e002e36ea915d922d6befc9dfacf7209b9958b8741642f3b5892cda1287e1adff199e8027b68f5365de242a788295093448d233e23d55bb0d6a8a6dab0259012b56dc1472b01537ce8bb439af83108826f2408498c25bdb46517ea0a3d48543dde03a17d9aa234dfe2144c51a319d2fa5a771545c5ec441b7b1f0c0051c667f2977cc57fd4e13285af4d15096d752d3bdee9c7af8eb933bd06981032245e40a7ca9f662a83ebf7d67ec0c1de74bcded94a68c0475fc1efbb2070fd5b976112535baf1c764ae06e9&quot;</span>)</span><br><span class="line">    inv_sbox = <span class="built_in">bytearray</span>.fromhex(<span class="string">&quot;397775d3ebb4fef11267d70fe27003f286f654be7b7e4d9b0259a41db5e3ee3547a1d49e62f7885cbfb8637852403aa730a5136b68f83b7f00839acf1f6ddd298aaf4e97a2d59006692f07e51c9fbd16c391c65fab6e79bb4a76c08eac3ead142e0edb20fc60b6e019d171411773372a2caa7c154cecf5b9640bcb1ad8df92b75bd265858b96325587517281ea1e385e333d3fcee866c4088c492848caa65a2b93090a9405a8e9a9dcd99d744557fd847db1f01b82505db04bf4f96f26c818deb3278d10aea304fb34432d24bae68025d0c26ac795f301c5239c538f7a98614499566c0cd63631e422ff3ccde1e7c942b2fa894fc121da46cc0d11efedbca058&quot;</span>)</span><br><span class="line">    mode_tag = <span class="number">0</span></span><br><span class="line">    key_stream = <span class="built_in">bytearray</span>(<span class="number">405</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, message, mode_tag, key=<span class="built_in">bytearray</span>(<span class="params"><span class="number">9</span></span>), iv=<span class="built_in">bytearray</span>(<span class="params"><span class="number">9</span></span>)</span>):</span><br><span class="line">        <span class="variable language_">self</span>.mode_tag = <span class="number">0</span> <span class="keyword">if</span> mode_tag == <span class="number">0</span> <span class="keyword">else</span> <span class="number">1</span></span><br><span class="line">        <span class="keyword">try</span>: <span class="variable language_">self</span>.message = <span class="built_in">bytearray</span>(message)</span><br><span class="line">        <span class="keyword">except</span>: <span class="variable language_">self</span>.message = <span class="built_in">bytearray</span>(message.encode())</span><br><span class="line">        <span class="keyword">try</span>: <span class="variable language_">self</span>.key = <span class="built_in">bytearray</span>(key)[<span class="number">0</span>:<span class="number">9</span>]</span><br><span class="line">        <span class="keyword">except</span>: <span class="variable language_">self</span>.key = <span class="built_in">bytearray</span>(key.encode())[<span class="number">0</span>:<span class="number">9</span>]</span><br><span class="line">        <span class="keyword">try</span>: <span class="variable language_">self</span>.iv = <span class="built_in">bytearray</span>(iv)[<span class="number">0</span>:<span class="number">9</span>]</span><br><span class="line">        <span class="keyword">except</span>: <span class="variable language_">self</span>.iv = <span class="built_in">bytearray</span>(iv.encode())[<span class="number">0</span>:<span class="number">9</span>]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.key) &lt; <span class="number">9</span>: <span class="variable language_">self</span>.key+=<span class="built_in">bytearray</span>(<span class="number">9</span>-<span class="built_in">len</span>(<span class="variable language_">self</span>.key))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.iv) &lt; <span class="number">9</span>: <span class="variable language_">self</span>.iv+=<span class="built_in">bytearray</span>(<span class="number">9</span>-<span class="built_in">len</span>(<span class="variable language_">self</span>.iv))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.message) % <span class="number">9</span> == <span class="number">0</span>: <span class="variable language_">self</span>.message+=<span class="built_in">bytearray</span>(<span class="number">9</span>-<span class="built_in">len</span>(<span class="variable language_">self</span>.message)%<span class="number">9</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rol</span>(<span class="params">self, b, shift</span>):</span><br><span class="line">        shift &amp;= <span class="number">7</span></span><br><span class="line">        <span class="keyword">return</span> ((b &lt;&lt; shift) | (b &gt;&gt; (<span class="number">8</span>-shift))) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ror</span>(<span class="params">self, b, shift</span>):</span><br><span class="line">        shift &amp;= <span class="number">7</span></span><br><span class="line">        <span class="keyword">return</span> ((b &gt;&gt; shift) | (b &lt;&lt; (<span class="number">8</span>-shift))) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">xor_arrays</span>(<span class="params">self, data, key</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>): data[i] ^= key[i]</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">swap_with_order</span>(<span class="params">self, data, tag</span>):</span><br><span class="line">        tmp = <span class="built_in">bytearray</span>(<span class="built_in">len</span>(data))</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>): tmp[i] = data[<span class="variable language_">self</span>.order[i]-<span class="number">1</span>] <span class="keyword">if</span> tag == <span class="number">0</span> <span class="keyword">else</span> data[<span class="variable language_">self</span>.inv_order[i]-<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">return</span> tmp</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">rol_arrays</span>(<span class="params">self, data, key</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>): data[i] = <span class="variable language_">self</span>.rol(data[i], key[i])</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">ror_arrays</span>(<span class="params">self, data, key</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>): data[i] = <span class="variable language_">self</span>.ror(data[i], key[i])</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">sbox_swap</span>(<span class="params">self, data, sbox</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>): data[i] = sbox[data[i]]</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">inv_sbox_swap</span>(<span class="params">self, data, inv_sbox</span>):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>): data[i] = inv_sbox[data[i]]</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Key_Stream_Generate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.key_stream[<span class="number">0</span>:<span class="number">9</span>] = <span class="variable language_">self</span>.key</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">405</span>):</span><br><span class="line">            <span class="variable language_">self</span>.key_stream[i] = ((<span class="variable language_">self</span>.key_stream[i-<span class="number">9</span>] + <span class="variable language_">self</span>.order[i%<span class="number">9</span>]) * <span class="built_in">sum</span>(<span class="variable language_">self</span>.order)) &amp; <span class="number">0xFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt_Block</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">45</span>):</span><br><span class="line">            block = <span class="variable language_">self</span>.xor_arrays(block, <span class="variable language_">self</span>.order)</span><br><span class="line">            block = <span class="variable language_">self</span>.rol_arrays(block, <span class="variable language_">self</span>.key_stream[r*<span class="number">9</span>:(r+<span class="number">1</span>)*<span class="number">9</span>]) <span class="keyword">if</span> r % <span class="number">2</span> == <span class="number">1</span> <span class="keyword">else</span> <span class="variable language_">self</span>.ror_arrays(block, <span class="variable language_">self</span>.key_stream[r*<span class="number">9</span>:(r+<span class="number">1</span>)*<span class="number">9</span>])</span><br><span class="line">            block = <span class="variable language_">self</span>.swap_with_order(block, <span class="number">0</span>)</span><br><span class="line">            block = <span class="variable language_">self</span>.xor_arrays(block, <span class="variable language_">self</span>.key_stream[r*<span class="number">9</span>:(r+<span class="number">1</span>)*<span class="number">9</span>])</span><br><span class="line">            block = <span class="variable language_">self</span>.rol_arrays(block, <span class="variable language_">self</span>.order) <span class="keyword">if</span> r % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> <span class="variable language_">self</span>.ror_arrays(block, <span class="variable language_">self</span>.order)</span><br><span class="line">            block = <span class="variable language_">self</span>.sbox_swap(block, <span class="variable language_">self</span>.sbox)</span><br><span class="line">        <span class="keyword">return</span> block</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Decrypt_Block</span>(<span class="params">self, block</span>):</span><br><span class="line">        <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            block = <span class="variable language_">self</span>.inv_sbox_swap(block, <span class="variable language_">self</span>.inv_sbox)</span><br><span class="line">            block = <span class="variable language_">self</span>.rol_arrays(block, <span class="variable language_">self</span>.order) <span class="keyword">if</span> r % <span class="number">2</span> == <span class="number">1</span> <span class="keyword">else</span> <span class="variable language_">self</span>.ror_arrays(block, <span class="variable language_">self</span>.order)</span><br><span class="line">            block = <span class="variable language_">self</span>.xor_arrays(block, <span class="variable language_">self</span>.key_stream[r*<span class="number">9</span>:(r+<span class="number">1</span>)*<span class="number">9</span>])</span><br><span class="line">            block = <span class="variable language_">self</span>.swap_with_order(block, <span class="number">1</span>)</span><br><span class="line">            block = <span class="variable language_">self</span>.rol_arrays(block, <span class="variable language_">self</span>.key_stream[r*<span class="number">9</span>:(r+<span class="number">1</span>)*<span class="number">9</span>]) <span class="keyword">if</span> r % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> <span class="variable language_">self</span>.ror_arrays(block, <span class="variable language_">self</span>.key_stream[r*<span class="number">9</span>:(r+<span class="number">1</span>)*<span class="number">9</span>])</span><br><span class="line">            block = <span class="variable language_">self</span>.xor_arrays(block, <span class="variable language_">self</span>.order)</span><br><span class="line">        <span class="keyword">return</span> block</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Encrypt</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.Key_Stream_Generate()</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.mode_tag == <span class="number">1</span>:</span><br><span class="line">            <span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>] = <span class="variable language_">self</span>.xor_arrays(<span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>], <span class="variable language_">self</span>.iv)</span><br><span class="line">        <span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>] = <span class="variable language_">self</span>.Encrypt_Block(<span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>])</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(<span class="variable language_">self</span>.message)//<span class="number">9</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.mode_tag == <span class="number">1</span>:</span><br><span class="line">                <span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>] = <span class="variable language_">self</span>.xor_arrays(<span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>], <span class="variable language_">self</span>.message[(i-<span class="number">1</span>)*<span class="number">9</span>:i*<span class="number">9</span>])</span><br><span class="line">            <span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>] = <span class="variable language_">self</span>.Encrypt_Block(<span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>])</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.message</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">Decrypt</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.Key_Stream_Generate()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(<span class="variable language_">self</span>.message)//<span class="number">9</span>-<span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            <span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>] = <span class="variable language_">self</span>.Decrypt_Block(<span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>])</span><br><span class="line">            <span class="keyword">if</span> <span class="variable language_">self</span>.mode_tag == <span class="number">1</span>:</span><br><span class="line">                <span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>] = <span class="variable language_">self</span>.xor_arrays(<span class="variable language_">self</span>.message[i*<span class="number">9</span>:(i+<span class="number">1</span>)*<span class="number">9</span>], <span class="variable language_">self</span>.message[(i-<span class="number">1</span>)*<span class="number">9</span>:i*<span class="number">9</span>])</span><br><span class="line">        <span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>] = <span class="variable language_">self</span>.Decrypt_Block(<span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>])</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.mode_tag == <span class="number">1</span>:</span><br><span class="line">            <span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>] = <span class="variable language_">self</span>.xor_arrays(<span class="variable language_">self</span>.message[<span class="number">0</span>:<span class="number">9</span>], <span class="variable language_">self</span>.iv)</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.message</span><br></pre></td></tr></table></figure>

<p>加密完成后，有一个函数将比特流转为布尔方阵：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__fastcall <span class="title">sub_14000334F</span><span class="params">(_DWORD *a1, <span class="type">int</span> a2, <span class="type">int</span> *a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">double</span> v4; <span class="comment">// xmm0_8</span></span><br><span class="line">  _DWORD *v5; <span class="comment">// [rsp+28h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+48h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 &amp;&amp; a2 &gt;= <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v4 = <span class="built_in">sqrt</span>((<span class="type">double</span>)a2);</span><br><span class="line">    v6 = (<span class="type">int</span>)<span class="built_in">ceil</span>(v4);</span><br><span class="line">    v5 = <span class="built_in">calloc</span>(v6, <span class="number">4LL</span> * v6);</span><br><span class="line">    <span class="keyword">if</span> ( v5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; a2; ++i )</span><br><span class="line">        v5[i / v6 * (__int64)v6 + i % v6] = a1[i];</span><br><span class="line">      <span class="built_in">free</span>(a1);</span><br><span class="line">      <span class="keyword">if</span> ( a3 )</span><br><span class="line">        *a3 = v6;</span><br><span class="line">      <span class="keyword">return</span> v5;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>(a1);</span><br><span class="line">      <span class="keyword">if</span> ( a3 )</span><br><span class="line">        *a3 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a1 )</span><br><span class="line">      <span class="built_in">free</span>(a1);</span><br><span class="line">    <span class="keyword">if</span> ( a3 )</span><br><span class="line">      *a3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会将比特流转为比其长度大一点的最小方阵，剩下位置填充为0，继续查看最后一个函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_1400036CC</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, _DWORD *a3, __int64 a4, __int64 a5, __int64 a6, __int64 a7)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">void</span> *v9; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">void</span> *v10; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">void</span> *v11; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">void</span> *v12; <span class="comment">// rsp</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// r8d</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">void</span> *v20[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">void</span> **v21; <span class="comment">// [rsp+30h] [rbp-60h]</span></span><br><span class="line">  __int64 v22; <span class="comment">// [rsp+38h] [rbp-58h]</span></span><br><span class="line">  <span class="type">void</span> *v23; <span class="comment">// [rsp+40h] [rbp-50h]</span></span><br><span class="line">  __int64 v24; <span class="comment">// [rsp+48h] [rbp-48h]</span></span><br><span class="line">  <span class="type">void</span> **v25; <span class="comment">// [rsp+50h] [rbp-40h]</span></span><br><span class="line">  __int64 v26; <span class="comment">// [rsp+58h] [rbp-38h]</span></span><br><span class="line">  __int64 v27; <span class="comment">// [rsp+60h] [rbp-30h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v28; <span class="comment">// [rsp+68h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// [rsp+74h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> v30; <span class="comment">// [rsp+78h] [rbp-18h]</span></span><br><span class="line">  <span class="type">int</span> v31; <span class="comment">// [rsp+7Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v32; <span class="comment">// [rsp+80h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+84h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+88h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+8Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v27 = a2 - <span class="number">1LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a1 != <span class="number">13</span> || a2 != <span class="number">13</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  a3[<span class="number">4</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">5</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">6</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">11</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">15</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">16</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">17</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">21</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">24</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">25</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">27</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">38</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">41</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">44</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">46</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">53</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">55</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">59</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">61</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">62</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">69</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">71</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">72</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">76</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">77</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">79</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">82</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">83</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">87</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">88</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">89</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">92</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">94</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">95</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">107</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">114</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">117</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">118</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">120</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">122</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">132</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">134</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">135</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">142</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">146</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">149</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">157</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">158</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">162</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">164</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">166</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  a3[<span class="number">168</span>] ^= <span class="number">1u</span>;</span><br><span class="line">  <span class="built_in">SetConsoleOutputCP</span>(<span class="number">0xFDE9u</span>);</span><br><span class="line">  v32 = <span class="number">1</span>;</span><br><span class="line">  v26 = <span class="number">12</span>;</span><br><span class="line">  v9 = <span class="built_in">alloca</span>(<span class="built_in">sub_140005C60</span>());</span><br><span class="line">  v25 = v20;</span><br><span class="line">  v24 = <span class="number">12</span>;</span><br><span class="line">  v10 = <span class="built_in">alloca</span>(<span class="built_in">sub_140005C60</span>());</span><br><span class="line">  v23 = v20;</span><br><span class="line">  v22 = <span class="number">12</span>;</span><br><span class="line">  v11 = <span class="built_in">alloca</span>(<span class="built_in">sub_140005C60</span>());</span><br><span class="line">  v21 = v20;</span><br><span class="line">  v20[<span class="number">1</span>] = (<span class="type">void</span> *)<span class="number">12</span>;</span><br><span class="line">  v12 = <span class="built_in">alloca</span>(<span class="built_in">sub_140005C60</span>());</span><br><span class="line">  v20[<span class="number">0</span>] = v20;</span><br><span class="line">  <span class="built_in">memset</span>(v23, <span class="number">0</span>, <span class="number">4LL</span> * v13);</span><br><span class="line">  <span class="built_in">memset</span>(v20[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0x34u</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">13</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v31 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">13</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a3[i * (__int64)a2 + j] == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        ++v31;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v31 &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v14 = *((_DWORD *)v23 + i);</span><br><span class="line">        *((_DWORD *)v23 + i) = v14 + <span class="number">1</span>;</span><br><span class="line">        *((_DWORD *)&amp;v25[<span class="number">5</span> * i] + v14) = v31;</span><br><span class="line">        v31 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v31 &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v15 = *((_DWORD *)v23 + i);</span><br><span class="line">      *((_DWORD *)v23 + i) = v15 + <span class="number">1</span>;</span><br><span class="line">      *((_DWORD *)&amp;v25[<span class="number">5</span> * i] + v15) = v31;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !*((_DWORD *)v23 + i) )</span><br><span class="line">    &#123;</span><br><span class="line">      v16 = *((_DWORD *)v23 + i);</span><br><span class="line">      *((_DWORD *)v23 + i) = v16 + <span class="number">1</span>;</span><br><span class="line">      *((_DWORD *)&amp;v25[<span class="number">5</span> * i] + v16) = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">13</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v30 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">13</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a3[i * (__int64)a2 + j] == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        ++v30;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v30 &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v17 = *((_DWORD *)v20[<span class="number">0</span>] + j);</span><br><span class="line">        *((_DWORD *)v20[<span class="number">0</span>] + j) = v17 + <span class="number">1</span>;</span><br><span class="line">        *((_DWORD *)&amp;v21[<span class="number">5</span> * j] + v17) = v30;</span><br><span class="line">        v30 = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v30 &gt; <span class="number">0</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v18 = *((_DWORD *)v20[<span class="number">0</span>] + j);</span><br><span class="line">      *((_DWORD *)v20[<span class="number">0</span>] + j) = v18 + <span class="number">1</span>;</span><br><span class="line">      *((_DWORD *)&amp;v21[<span class="number">5</span> * j] + v18) = v30;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !*((_DWORD *)v20[<span class="number">0</span>] + j) )</span><br><span class="line">    &#123;</span><br><span class="line">      v19 = *((_DWORD *)v20[<span class="number">0</span>] + j);</span><br><span class="line">      *((_DWORD *)v20[<span class="number">0</span>] + j) = v19 + <span class="number">1</span>;</span><br><span class="line">      *((_DWORD *)&amp;v21[<span class="number">5</span> * j] + v19) = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">13</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *((_DWORD *)v23 + i) == *(_DWORD *)(<span class="number">4LL</span> * i + a5) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; *(_DWORD *)(<span class="number">4LL</span> * i + a5); ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *((_DWORD *)&amp;v25[<span class="number">5</span> * i] + k) != *(_DWORD *)(a4 + <span class="number">40LL</span> * i + <span class="number">4LL</span> * k) )</span><br><span class="line">        &#123;</span><br><span class="line">          v32 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v32 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">13</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *((_DWORD *)v20[<span class="number">0</span>] + j) == *(_DWORD *)(<span class="number">4LL</span> * j + a7) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; *(_DWORD *)(<span class="number">4LL</span> * j + a7); ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( *((_DWORD *)&amp;v21[<span class="number">5</span> * j] + k) != *(_DWORD *)(a6 + <span class="number">40LL</span> * j + <span class="number">4LL</span> * k) )</span><br><span class="line">        &#123;</span><br><span class="line">          v32 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v32 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v29 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">13</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v29 &lt; *((_DWORD *)v20[<span class="number">0</span>] + j) )</span><br><span class="line">      v29 = *((_DWORD *)v20[<span class="number">0</span>] + j);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">13</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">13</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( a3[i * (__int64)a2 + j] == <span class="number">1</span> )</span><br><span class="line">        v28 = (<span class="type">const</span> <span class="type">char</span> *)&amp;unk_1400081BA;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v28 = <span class="string">&quot;  &quot;</span>;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">char</span> *)&amp;byte_1400081A6);</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; *((_DWORD *)v23 + i); ++k )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>);</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">26</span>; ++j )</span><br><span class="line">    <span class="built_in">printf</span>((<span class="type">char</span> *)&amp;byte_1400081AF);</span><br><span class="line">  <span class="built_in">puts</span>(&amp;byte_1400081B3);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v29; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">13</span>; ++j )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( k &gt;= *((_DWORD *)v20[<span class="number">0</span>] + j) )</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">putchar</span>(<span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v32 )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nRight input! Flag is flag&#123;your input&#125;.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;\nWrong input!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> v32;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>校验了方阵是否为13*13的（169bit），如果是则对其某些位置取反，根据之前得到的目标matrix，可以恢复出来原矩阵的形态为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1100101100101</span><br><span class="line">0001011010100</span><br><span class="line">1000111010001</span><br><span class="line">0010101111011</span><br><span class="line">0100100000111</span><br><span class="line">1101111000101</span><br><span class="line">1100010101010</span><br><span class="line">1111010011001</span><br><span class="line">0011010001010</span><br><span class="line">1111101010101</span><br><span class="line">0110101000000</span><br><span class="line">0000111010010</span><br><span class="line">1010000000000</span><br></pre></td></tr></table></figure>

<p>发现是162bit，也就是输入是27字节，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">charset = (<span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sliding_decrypt_144bit</span>(<span class="params">bitstream</span>):</span><br><span class="line">    key = <span class="built_in">bytearray</span>.fromhex(<span class="string">&quot;97ff4069d61871beef&quot;</span>)</span><br><span class="line">    iv = <span class="built_in">bytearray</span>.fromhex(<span class="string">&quot;fa933f43d048b55f3e&quot;</span>)</span><br><span class="line">    total_bits = <span class="built_in">len</span>(bitstream)</span><br><span class="line">    <span class="keyword">for</span> bit_offset <span class="keyword">in</span> <span class="built_in">range</span>(total_bits - <span class="number">144</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        temp_bits = bitstream[bit_offset:bit_offset + <span class="number">144</span>]</span><br><span class="line">        block_bytes = <span class="built_in">bytearray</span>(<span class="number">18</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">144</span>):</span><br><span class="line">            byte_idx = i // <span class="number">8</span></span><br><span class="line">            bit_idx = <span class="number">7</span> - (i % <span class="number">8</span>)</span><br><span class="line">            <span class="keyword">if</span> temp_bits[i]:</span><br><span class="line">                block_bytes[byte_idx] |= (<span class="number">1</span> &lt;&lt; bit_idx)</span><br><span class="line">        encrypted_block = Luo_Shu(block_bytes, <span class="number">1</span>, key, iv).Decrypt()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">144</span>):</span><br><span class="line">            byte_idx = i // <span class="number">8</span></span><br><span class="line">            bit_idx = <span class="number">7</span> - (i % <span class="number">8</span>)</span><br><span class="line">            bit = (encrypted_block[byte_idx] &gt;&gt; bit_idx) &amp; <span class="number">1</span></span><br><span class="line">            bitstream[bit_offset + i] = bit</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bitstream_to_string</span>(<span class="params">bitstream</span>):</span><br><span class="line">    chars = []</span><br><span class="line">    num_groups = <span class="built_in">len</span>(bitstream) // <span class="number">6</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_groups):</span><br><span class="line">        group = bitstream[i*<span class="number">6</span> : (i+<span class="number">1</span>)*<span class="number">6</span>]</span><br><span class="line">        n = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> bit <span class="keyword">in</span> group:</span><br><span class="line">            n = (n &lt;&lt; <span class="number">1</span>) | bit</span><br><span class="line">        <span class="keyword">if</span> n &gt;= <span class="built_in">len</span>(charset):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        chars.append(charset[n])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(chars)</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">0</span>]</span><br><span class="line">sliding_decrypt_144bit(enc)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, enc)))</span><br><span class="line">flag = bitstream_to_string(enc)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;M4g1c_m47r1x_15_ev3rYwH3rE!&#125;</code></p>
<h1 id="Let-Operator-Dance-Alltime"><a href="#Let-Operator-Dance-Alltime" class="headerlink" title="Let Operator Dance Alltime!!!"></a>Let Operator Dance Alltime!!!</h1><h2 id="出题记录-1"><a href="#出题记录-1" class="headerlink" title="出题记录"></a>出题记录</h2><p><del>这题本来该更难的，</del> 但是觉得太难把payload换了 <del>（之前的payload是一个更难的题）</del></p>
<p>外层是PE加载器，能用密钥解密payload并通过环境变量传参，用一个多步操作映射迷宫约束了密钥</p>
<p>payload魔改自于分布式计算项目LODA，是一个类汇编语言解释器，主要解决数学问题，其在<a target="_blank" rel="noopener" href="https://github.com/loda-lang/loda-cpp">github</a>上开源并拥有<a target="_blank" rel="noopener" href="https://loda-lang.org/">官方文档</a>和<a target="_blank" rel="noopener" href="https://loda-lang.org/edit/">官方在线运行可视化</a>，payload层的主要思路也是diff源码，从main开始查找魔改点</p>
<h2 id="WP-1"><a href="#WP-1" class="headerlink" title="WP"></a>WP</h2><p>程序有UPX，脱壳.</p>
<p>脱壳后发现程序代码段很少，有一个巨大的数据段，且有几个额外段<code>.prt</code>、<code>.prd</code>、<code>.prb</code>.</p>
<p>给出的main函数显然是假的，解密后也是fakeflag，注意到.prt段的函数<code>sub_1400035C5</code>中有反调，如果有调试器则跳转至main，这说明起始函数应当位于.prt段中，不难发现是<code>sub_140003659</code>.</p>
<p>sub_140003659的起始部分打印有字符串加密，要求输入一个密钥通过<code>sub_1400030E7</code>的检验，sub_1400030E7是一个迷宫，检验输入的字符串是否在指定字符集A-Za-z0-9_!中，若存在则将其转换为对应的索引，还有一些其他校验（比如有4个下划线，结尾是感叹号等），然后解密迷宫地图，转为比特矩阵并走迷宫.</p>
<p>注意到每个字符控制的不止一步，而是很多步的组合，最终要到27,47的位置，输入的字符串会被xor 0xA作为解密后续数据的密钥.</p>
<p>解析迷宫并编写脚本求解：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line">mapping = &#123;</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>: <span class="string">&#x27;SSDD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;WDWA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;AWA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>: <span class="string">&#x27;SSS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;E&#x27;</span>: <span class="string">&#x27;WDW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;F&#x27;</span>: <span class="string">&#x27;AASA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;G&#x27;</span>: <span class="string">&#x27;SAS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;H&#x27;</span>: <span class="string">&#x27;AAA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;I&#x27;</span>: <span class="string">&#x27;AWWA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;J&#x27;</span>: <span class="string">&#x27;WDDS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;K&#x27;</span>: <span class="string">&#x27;DWWS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;L&#x27;</span>: <span class="string">&#x27;WDAW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;M&#x27;</span>: <span class="string">&#x27;ASSA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;N&#x27;</span>: <span class="string">&#x27;SAAS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;O&#x27;</span>: <span class="string">&#x27;DSSS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;P&#x27;</span>: <span class="string">&#x27;WAWS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Q&#x27;</span>: <span class="string">&#x27;AAAD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;R&#x27;</span>: <span class="string">&#x27;SDSS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;S&#x27;</span>: <span class="string">&#x27;WWDD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;T&#x27;</span>: <span class="string">&#x27;DDDS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>: <span class="string">&#x27;SSSA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;V&#x27;</span>: <span class="string">&#x27;WDDD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span>: <span class="string">&#x27;SDDD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X&#x27;</span>: <span class="string">&#x27;DDDW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Y&#x27;</span>: <span class="string">&#x27;ASSS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Z&#x27;</span>: <span class="string">&#x27;SDSD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;a&#x27;</span>: <span class="string">&#x27;SSDS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;b&#x27;</span>: <span class="string">&#x27;WSWD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: <span class="string">&#x27;SSD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;DWDD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;e&#x27;</span>: <span class="string">&#x27;WAAW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;SSA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span>: <span class="string">&#x27;AWWD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;h&#x27;</span>: <span class="string">&#x27;DDD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;i&#x27;</span>: <span class="string">&#x27;DDWW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;j&#x27;</span>: <span class="string">&#x27;SSSS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;k&#x27;</span>: <span class="string">&#x27;AAS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;l&#x27;</span>: <span class="string">&#x27;DDWS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;m&#x27;</span>: <span class="string">&#x27;AAWW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;n&#x27;</span>: <span class="string">&#x27;DDSS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>: <span class="string">&#x27;AAWA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;p&#x27;</span>: <span class="string">&#x27;DDS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;q&#x27;</span>: <span class="string">&#x27;WDDA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;r&#x27;</span>: <span class="string">&#x27;WWWD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;AAAW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;t&#x27;</span>: <span class="string">&#x27;DWWW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;u&#x27;</span>: <span class="string">&#x27;SDDW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;v&#x27;</span>: <span class="string">&#x27;AWDA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;w&#x27;</span>: <span class="string">&#x27;WAAS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;x&#x27;</span>: <span class="string">&#x27;DDWD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;AWW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;WAA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;ASSD&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;1&#x27;</span>: <span class="string">&#x27;WWWW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;2&#x27;</span>: <span class="string">&#x27;WWDW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;3&#x27;</span>: <span class="string">&#x27;AWWW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;4&#x27;</span>: <span class="string">&#x27;WWA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;5&#x27;</span>: <span class="string">&#x27;WDDW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;6&#x27;</span>: <span class="string">&#x27;DSDS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;WAWW&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;SAAA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;ASAA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;_&#x27;</span>: <span class="string">&#x27;WAAA&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;!&#x27;</span>: <span class="string">&#x27;WWAA&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;WAWWAAAWWWWWDDWWAAAAWWAAAAWWAAAWWAWAAAWAWWAWWWDWWWWWWDWWWWWDDWWAAAAAWWWWAWAAAWWWWWAA&#x27;</span></span><br><span class="line"></span><br><span class="line">maze = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11111111111111111111111111111</span></span><br><span class="line"><span class="string">10001111111111111111111111111</span></span><br><span class="line"><span class="string">11101111111111111111111111111</span></span><br><span class="line"><span class="string">11101111111111111111111111111</span></span><br><span class="line"><span class="string">11101111111111111111111111111</span></span><br><span class="line"><span class="string">11101111111111111111111111111</span></span><br><span class="line"><span class="string">11100001111111111111111111111</span></span><br><span class="line"><span class="string">11111100111111111111111111111</span></span><br><span class="line"><span class="string">11111110111111111111111111111</span></span><br><span class="line"><span class="string">11111110111111111111111111111</span></span><br><span class="line"><span class="string">11111110111111111111111111111</span></span><br><span class="line"><span class="string">11111110000001111111111111111</span></span><br><span class="line"><span class="string">11111111111101111111111111111</span></span><br><span class="line"><span class="string">11111111110001111111111111111</span></span><br><span class="line"><span class="string">11111111110111111111111111111</span></span><br><span class="line"><span class="string">11111111110111111111111111111</span></span><br><span class="line"><span class="string">11111111110111111111111111111</span></span><br><span class="line"><span class="string">11111111110111111111111111111</span></span><br><span class="line"><span class="string">11111111100111111111111111111</span></span><br><span class="line"><span class="string">11111111101111111111111111111</span></span><br><span class="line"><span class="string">11111111101111111111111111111</span></span><br><span class="line"><span class="string">11111111101111111111111111111</span></span><br><span class="line"><span class="string">11111111101111111111111111111</span></span><br><span class="line"><span class="string">11111111101111111111111111111</span></span><br><span class="line"><span class="string">11111111001111111111111111111</span></span><br><span class="line"><span class="string">11111111011111111111111111111</span></span><br><span class="line"><span class="string">11111111011111111111111111111</span></span><br><span class="line"><span class="string">11111111001111111111111111111</span></span><br><span class="line"><span class="string">11111111101111111111111111111</span></span><br><span class="line"><span class="string">11111111100111111111111111111</span></span><br><span class="line"><span class="string">11111111110000111111111111111</span></span><br><span class="line"><span class="string">11111111111110011111111111111</span></span><br><span class="line"><span class="string">11111111111111011111111111111</span></span><br><span class="line"><span class="string">11111111111111000011111111111</span></span><br><span class="line"><span class="string">11111111111111111011111111111</span></span><br><span class="line"><span class="string">11111111111111111000001111111</span></span><br><span class="line"><span class="string">11111111111111111111101111111</span></span><br><span class="line"><span class="string">11111111111111111111100000111</span></span><br><span class="line"><span class="string">11111111111111111111111110111</span></span><br><span class="line"><span class="string">11111111111111111111111000111</span></span><br><span class="line"><span class="string">11111111111111111111111011111</span></span><br><span class="line"><span class="string">11111111111111111111111011111</span></span><br><span class="line"><span class="string">11111111111111111111111011111</span></span><br><span class="line"><span class="string">11111111111111111111111011111</span></span><br><span class="line"><span class="string">11111111111111111111111000011</span></span><br><span class="line"><span class="string">11111111111111111111111111011</span></span><br><span class="line"><span class="string">11111111111111111111111111001</span></span><br><span class="line"><span class="string">11111111111111111111111111101</span></span><br><span class="line"><span class="string">11111111111111111111111111111</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">end_pos = (-<span class="number">26</span>, -<span class="number">46</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_all_solutions</span>(<span class="params">path, mapping, </span></span><br><span class="line"><span class="params">                       target_length=<span class="literal">None</span>, </span></span><br><span class="line"><span class="params">                       target_underscore=<span class="literal">None</span>, </span></span><br><span class="line"><span class="params">                       require_exclamation_at_end=<span class="literal">False</span></span>):</span><br><span class="line">    <span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">    seq_to_char = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">    <span class="keyword">for</span> char, seq <span class="keyword">in</span> mapping.items():</span><br><span class="line">        seq_to_char[seq].append(char)</span><br><span class="line"></span><br><span class="line">    len_groups = defaultdict(<span class="built_in">list</span>)</span><br><span class="line">    <span class="keyword">for</span> seq, chars <span class="keyword">in</span> seq_to_char.items():</span><br><span class="line">        len_groups[<span class="built_in">len</span>(seq)].append((seq, chars))</span><br><span class="line">    </span><br><span class="line">    lengths = <span class="built_in">sorted</span>(len_groups.keys())</span><br><span class="line"></span><br><span class="line">    results = []</span><br><span class="line">    current = []</span><br><span class="line">    count_underscore = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">backtrack</span>(<span class="params">remaining_path</span>):</span><br><span class="line">        <span class="keyword">nonlocal</span> count_underscore</span><br><span class="line"></span><br><span class="line">        cur_len = <span class="built_in">len</span>(current)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> target_length <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> cur_len &gt; target_length:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> target_underscore <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> count_underscore &gt; target_underscore:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> target_length <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            remaining_slots = target_length - cur_len</span><br><span class="line">            remaining_path_len = <span class="built_in">len</span>(remaining_path)</span><br><span class="line">            min_seq_len = <span class="built_in">min</span>(len_groups.keys())</span><br><span class="line">            max_seq_len = <span class="built_in">max</span>(len_groups.keys())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> remaining_path_len &lt; remaining_slots * min_seq_len:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">if</span> remaining_path_len &gt; remaining_slots * max_seq_len:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> remaining_path:</span><br><span class="line">            valid = <span class="literal">True</span></span><br><span class="line">            <span class="keyword">if</span> target_length <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> cur_len != target_length:</span><br><span class="line">                valid = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> target_underscore <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> count_underscore != target_underscore:</span><br><span class="line">                valid = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">if</span> require_exclamation_at_end:</span><br><span class="line">                <span class="keyword">if</span> cur_len == <span class="number">0</span> <span class="keyword">or</span> current[-<span class="number">1</span>] != <span class="string">&#x27;!&#x27;</span>:</span><br><span class="line">                    valid = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> valid:</span><br><span class="line">                results.append(<span class="string">&#x27;&#x27;</span>.join(current))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> L <span class="keyword">in</span> lengths:</span><br><span class="line">            <span class="keyword">if</span> L &gt; <span class="built_in">len</span>(remaining_path):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            prefix = remaining_path[:L]</span><br><span class="line">            <span class="keyword">if</span> prefix <span class="keyword">not</span> <span class="keyword">in</span> seq_to_char:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> char <span class="keyword">in</span> seq_to_char[prefix]:</span><br><span class="line">                is_underscore = (char == <span class="string">&#x27;_&#x27;</span>)</span><br><span class="line">                is_exclamation = (char == <span class="string">&#x27;!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> is_underscore:</span><br><span class="line">                    count_underscore += <span class="number">1</span></span><br><span class="line">                current.append(char)</span><br><span class="line">                backtrack(remaining_path[L:])</span><br><span class="line">                current.pop()</span><br><span class="line">                <span class="keyword">if</span> is_underscore:</span><br><span class="line">                    count_underscore -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    backtrack(path)</span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line"></span><br><span class="line">solutions = find_all_solutions(path, mapping, <span class="number">22</span>, <span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(solutions)</span><br></pre></td></tr></table></figure>

<p>得到密钥<code>7H15_Is_4_73tr15_m4z3!</code>，发现可以继续向后执行逻辑了，之后是一个单字节解密和一个PE文件加载器，在</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">CurrentProcess = <span class="built_in">GetCurrentProcess</span>();</span><br><span class="line"><span class="built_in">FlushInstructionCache</span>(CurrentProcess, lpBaseAddress, v6);</span><br><span class="line">nSize = <span class="number">4096</span>;</span><br><span class="line">v27 = <span class="number">4095</span>;</span><br><span class="line">v8 = <span class="built_in">alloca</span>(<span class="built_in">sub_7FF63B752640</span>());</span><br><span class="line">lpBuffer = v10;</span><br><span class="line">EnvironmentVariableA = <span class="built_in">GetEnvironmentVariableA</span>(<span class="string">&quot;LODA_ARGS&quot;</span>, v10, nSize);</span><br><span class="line"><span class="keyword">if</span> ( EnvironmentVariableA &amp;&amp; EnvironmentVariableA &lt; nSize )</span><br><span class="line">&#123;</span><br><span class="line">  Destination = (<span class="type">char</span> *)<span class="built_in">malloc</span>(EnvironmentVariableA + <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> ( Destination )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(Destination, lpBuffer);</span><br><span class="line">    v53 = <span class="number">0</span>;</span><br><span class="line">    v52 = <span class="number">0</span>;</span><br><span class="line">    v53 = <span class="built_in">realloc</span>(<span class="number">0</span>, <span class="number">8u</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v53 )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_QWORD *)v53 = <span class="string">&quot;loda.dll&quot;</span>;</span><br><span class="line">      v52 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> ( ii = <span class="built_in">strtok</span>(Destination, <span class="string">&quot; &quot;</span>); ii; ii = <span class="built_in">strtok</span>(<span class="number">0</span>, <span class="string">&quot; &quot;</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        v53 = <span class="built_in">realloc</span>(v53, <span class="number">8LL</span> * (v52 + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span> ( !v53 )</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        *((_QWORD *)v53 + v52++) = ii;</span><br><span class="line">      &#125;</span><br><span class="line">      v53 = <span class="built_in">realloc</span>(v53, <span class="number">8LL</span> * (v52 + <span class="number">1</span>));</span><br><span class="line">      <span class="keyword">if</span> ( v53 )</span><br><span class="line">      &#123;</span><br><span class="line">        *((_QWORD *)v53 + v52) = <span class="number">0</span>;</span><br><span class="line">        v23 = *((_DWORD *)v46 + <span class="number">10</span>);</span><br><span class="line">        <span class="built_in">free</span>(Block);</span><br><span class="line">        v22 = (<span class="built_in">void</span> (__fastcall *)(LPCVOID, __int64, <span class="type">void</span> *))((<span class="type">char</span> *)lpBaseAddress + v23);</span><br><span class="line">        <span class="built_in">v22</span>(lpBaseAddress, <span class="number">1</span>, v53);</span><br><span class="line">        <span class="built_in">free</span>(Destination);</span><br><span class="line">        <span class="built_in">free</span>(v53);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  v21 = *((_DWORD *)v46 + <span class="number">10</span>);</span><br><span class="line">  <span class="built_in">free</span>(Block);</span><br><span class="line">  v20 = (<span class="type">char</span> *)lpBaseAddress + v21;</span><br><span class="line">  ((<span class="built_in">void</span> (__fastcall *)(LPCVOID, __int64, _QWORD))v20)(lpBaseAddress, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>中读取了名为LODA_ARGS的环境变量值，并将其按空格拆分后解析，传入payload（实际为dll），函数在<code>v22(lpBaseAddress, 1, v53);</code>这一行进入dll内部，在此之前可以选择dump整个dll以便分析，也可以继续在动态调试中跟进.</p>
<p>之后进入dll，如果没有在LODA_ARGS中传参，那么程序会直接退出，我们可以试试创建LODA_ARGS并随机输入一些内容进行盲测，注意到此时弹出了<code>Input your flag:</code>，我们可以去dll中查找这个字符串：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hidden C++ exception states: #wind=2</span></span><br><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">sub_180024D00</span><span class="params">(<span class="type">unsigned</span> <span class="type">int</span> a1, __int64 a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  _QWORD v5[<span class="number">3</span>]; <span class="comment">// [rsp+28h] [rbp-130h] BYREF</span></span><br><span class="line">  _BYTE v6[<span class="number">128</span>]; <span class="comment">// [rsp+40h] [rbp-118h] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">128</span>]; <span class="comment">// [rsp+C0h] [rbp-98h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">sub_1801090E0</span>(v7);</span><br><span class="line">  <span class="built_in">sub_180109550</span>(v7, v5, a1, a2);</span><br><span class="line">  <span class="built_in">sub_18000A600</span>(&amp;qword_180190BB0, <span class="string">&quot;Input your flag: &quot;</span>);</span><br><span class="line">  <span class="built_in">sub_180022040</span>(&amp;qword_180190D70, &amp;qword_18018C030);</span><br><span class="line">  v4 = <span class="built_in">sub_180012930</span>(v6, v7);</span><br><span class="line">  <span class="built_in">sub_1800224F0</span>(v4, v5);</span><br><span class="line">  <span class="built_in">sub_18011C524</span>(<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">JUMPOUT</span>(<span class="number">0x180024D97LL</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此即为main函数，注意到程序在我们输入flag后弹出了一条消息：<code>Unknown command: </code>，这说明LODA_ARGS中的第一个参数是一个指令，我们可以搜索字符串或者使用万能的help进行盲测，弹出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Welcome to LODA CTF version. More information at https://loda-lang.org/</span><br><span class="line"></span><br><span class="line">Usage: loda &lt;command&gt; &lt;options&gt;</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  eval      &lt;program&gt;  Evaluate an integer sequence program (see -t,-b,-s)</span><br><span class="line">  check     &lt;program&gt;  Verify correctness of an integer sequence program (see -b)</span><br><span class="line">  mine                 Mine programs for integer sequences (see -i,-p,-P,-H)</span><br><span class="line">  submit  &lt;file&gt; [id]  Submit an integer sequence program to the central repository</span><br><span class="line">  export    &lt;program&gt;  Export a program and print the result (see -o,-t)</span><br><span class="line">  optimize  &lt;program&gt;  Optimize a program and print the result</span><br><span class="line">  minimize  &lt;program&gt;  Minimize a program and print the result (see -t)</span><br><span class="line">  profile   &lt;program&gt;  Measure program evaluation time (see -t)</span><br><span class="line">  fold &lt;program&gt; &lt;id&gt;  Fold a subprogram given by ID into a seq-operation</span><br><span class="line">  unfold    &lt;program&gt;  Unfold the first seq-operation of a program</span><br><span class="line">  mutate    &lt;program&gt;  Mutate a program to mine for integer sequences</span><br><span class="line">  setup                Run interactive setup to configure LODA</span><br><span class="line">  update               Update integer sequence and program data</span><br><span class="line">  upgrade              Check for and install the latest LODA version</span><br><span class="line"></span><br><span class="line">Targets:</span><br><span class="line">  &lt;file&gt;               Path to a LODA file (file extension: *.asm)</span><br><span class="line">  &lt;id&gt;                 ID of an integer sequence (example: A000045)</span><br><span class="line">  &lt;program&gt;            Either an &lt;file&gt; or an &lt;id&gt;</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -t &lt;number&gt;          Number of sequence terms (default: 8)</span><br><span class="line">  -b                   Print result in the OEIS b-file format</span><br><span class="line">  -o &lt;string&gt;          Export format (formula,loda,pari,range)</span><br><span class="line">  -d                   Export with dependencies to other programs</span><br><span class="line">  -s                   Evaluate program and return number of execution steps</span><br><span class="line">  -c &lt;number&gt;          Maximum number of execution steps (no limit: -1)</span><br><span class="line">  -m &lt;number&gt;          Maximum number of used memory cells (no limit: -1)</span><br><span class="line">  -z &lt;number&gt;          Maximum evaluation time in seconds (no limit: -1)</span><br><span class="line">  -l &lt;string&gt;          Log level (values: debug,info,warn,error,alert)</span><br><span class="line">  -i &lt;string&gt;          Name of miner configuration from miners.json</span><br><span class="line">  -p                   Parallel mining using default number of instances</span><br><span class="line">  -P &lt;number&gt;          Parallel mining using custom number of instances</span><br><span class="line">  -H &lt;number&gt;          Number of mining hours (default: unlimited)</span><br></pre></td></tr></table></figure>

<p>给出了一个网站<a target="_blank" rel="noopener" href="https://loda-lang.org/%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8%E8%BF%99%E9%87%8C%E6%9F%A5%E7%9C%8BLODA%E8%AF%AD%E8%A8%80%E7%9A%84%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%9C%A8github%E4%B8%8A%E8%8E%B7%E5%8F%96%E5%8E%9F%E9%A1%B9%E7%9B%AE%E7%9A%84%E6%BA%90%E4%BB%A3%E7%A0%81%E5%92%8C%E7%BC%96%E8%AF%91%E7%A8%8B%E5%BA%8F">https://loda-lang.org/，可以在这里查看LODA语言的官方文档，以及在github上获取原项目的源代码和编译程序</a>.</p>
<p>注意到LODA是一门类汇编语言，不具有显式的堆栈结构，只有无数个不限制数值上限的寄存器$0，$1，$2…$n，且$0是主要寄存器，一般情况下不支持手动初始化值，只支持初始化偏移量代入，最终程序结束后$0的值会作为返回值输出.</p>
<p>LODA编译生成的exe文件是一个解释器而非编译器，因此在题目没有显式给出额外的可执行汇编代码的情况下，汇编代码一定以某种方式存于dll内部，并通过特殊的arg进行触发.</p>
<p>尝试各种指令后发现只有evaluate没有被ban，其余的指令均被禁止使用，那么可以推测evaluate指令的解析逻辑被魔改，我们先从cmd&#x2F;main.cpp（也就是上面的程序主函数）开始，寻找所有被魔改的函数，首先查看Settings.parseArgs：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hidden C++ exception states: #wind=2</span></span><br><span class="line"><span class="function">_QWORD *__fastcall <span class="title">settings_parseargs</span><span class="params">(__int64 a1, _QWORD *a2, <span class="type">int</span> a3, __int64 a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS NUMPAD &quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  v4 = a4;</span><br><span class="line">  v93 = a4;</span><br><span class="line">  v5 = a3;</span><br><span class="line">  v6 = a2;</span><br><span class="line">  v88 = a2;</span><br><span class="line">  v87 = a1;</span><br><span class="line">  v107 = a2;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">9</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = byte_18015BEF8[i];</span><br><span class="line">    <span class="built_in">LOBYTE</span>(v8) = v8 ^ <span class="number">0xCC</span>;</span><br><span class="line">    v9 = xmmword_18018C020;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)xmmword_18018C020 &gt;= *((_QWORD *)&amp;xmmword_18018C020 + <span class="number">1</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_18000B0E0</span>(&amp;qword_18018C010, <span class="number">1</span>, <span class="number">0</span>, v8);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *(_QWORD *)&amp;xmmword_18018C020 = xmmword_18018C020 + <span class="number">1</span>;</span><br><span class="line">      v10 = &amp;qword_18018C010;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;v9 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v10 = (__int64 *)qword_18018C010;</span><br><span class="line">      *((_BYTE *)v10 + v9) = v8;</span><br><span class="line">      *((_BYTE *)v10 + v9 + <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"> ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到其中多出了一个字符串解密逻辑，byte处解密后的值为<code>Loda_Lang</code>，可惜暂时还无法查到这个字符串的xref，继续查看main函数，找到这一行<code>sub_180022040((__int64)&amp;cin, (__int64)&amp;input);</code>，其中的input必定有xref，共计xref到两个主要的函数：<code>sub_18004CCB0</code>和<code>sub_18004D1C0</code>，而这两个函数恰好均为eval&#x2F;evaluator.cpp中的函数，可以发现输入的input每8字节按大端序被转为uint64后作为LODA-VM执行器的主寄存器$0的初始化值：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v74 = v14;</span><br><span class="line">    <span class="keyword">if</span> ( v15 &gt;= v10 || v14 &gt;= v13 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v16 = v14 + v12;</span><br><span class="line">    <span class="keyword">if</span> ( v14 + v12 &gt;= v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_18004DE30</span>(a4, v15);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    v23 = &amp;input;</span><br><span class="line">    <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">      v23 = (__int64 *)input;</span><br><span class="line">    v24 = *((<span class="type">unsigned</span> __int8 *)v23 + v16);</span><br><span class="line">    v25 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v16 + <span class="number">1</span> &lt; v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v26 = &amp;input;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v26 = (__int64 *)input;</span><br><span class="line">      v25 = *((_BYTE *)v26 + v16 + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v27 = v25 | (<span class="type">unsigned</span> __int64)(v24 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    v28 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v16 + <span class="number">2</span> &lt; v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v29 = &amp;input;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v29 = (__int64 *)input;</span><br><span class="line">      v28 = *((_BYTE *)v29 + v16 + <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v30 = v28 | (v27 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    v31 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v16 + <span class="number">3</span> &lt; v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v32 = &amp;input;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v32 = (__int64 *)input;</span><br><span class="line">      v31 = *((_BYTE *)v32 + v16 + <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v33 = v31 | (v30 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    v34 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v16 + <span class="number">4</span> &lt; v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v35 = &amp;input;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v35 = (__int64 *)input;</span><br><span class="line">      v34 = *((_BYTE *)v35 + v16 + <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v36 = v34 | (v33 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    v37 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v16 + <span class="number">5</span> &lt; v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v38 = &amp;input;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v38 = (__int64 *)input;</span><br><span class="line">      v37 = *((_BYTE *)v38 + v16 + <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v39 = v37 | (v36 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    v40 = v16 + <span class="number">6</span>;</span><br><span class="line">    v41 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v16 + <span class="number">6</span> &lt; v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v42 = &amp;input;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v42 = (__int64 *)input;</span><br><span class="line">      v41 = *((_BYTE *)v42 + v40);</span><br><span class="line">    &#125;</span><br><span class="line">    v43 = v41 | (v39 &lt;&lt; <span class="number">8</span>);</span><br><span class="line">    v44 = v16 + <span class="number">7</span>;</span><br><span class="line">    v45 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v44 &lt; v13 )</span><br><span class="line">    &#123;</span><br><span class="line">      v46 = &amp;input;</span><br><span class="line">      <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C040 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v46 = (__int64 *)input;</span><br><span class="line">      v45 = *((_BYTE *)v46 + v44);</span><br><span class="line">    &#125;</span><br><span class="line">···</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>接下来查看main中的dispatch函数，在其中找到以下几行：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> ( n4 == <span class="number">8</span> &amp;&amp; !(<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">sub_18013ED70</span>(v28, <span class="string">&quot;evaluate&quot;</span>, <span class="number">8</span>) )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_77;</span><br><span class="line">  v30 = v126;</span><br><span class="line">  <span class="keyword">if</span> ( n0xF_1 &gt; <span class="number">0xF</span> )</span><br><span class="line">    v30 = v6;</span><br><span class="line">  <span class="keyword">if</span> ( n4 == <span class="number">4</span> &amp;&amp; !(<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">sub_18013ED70</span>(v30, <span class="string">&quot;eval&quot;</span>, <span class="number">4</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_77:</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)((__int64)(a2[<span class="number">1</span>] - *a2) &gt;&gt; <span class="number">5</span>) &gt; <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_18001A7B0</span>(&amp;v123, *a2 + <span class="number">32LL</span>);</span><br><span class="line">      <span class="keyword">goto</span> LABEL_341;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>进入其中的函数（Commands::evaluate）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">      <span class="built_in">sub_18013E330</span>(v67, &amp;unk_180154070, <span class="number">4148</span>);</span><br><span class="line">      v50 = <span class="number">0</span>;</span><br><span class="line">      v51 = <span class="number">0</span>;</span><br><span class="line">      v28 = <span class="built_in">sub_180110524</span>(<span class="number">4187</span>);</span><br><span class="line">      <span class="keyword">if</span> ( !v28 )</span><br><span class="line">        <span class="built_in">invalid_parameter_noinfo_noreturn</span>();</span><br><span class="line">      v29 = (v28 + <span class="number">39</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFE0uLL</span>;</span><br><span class="line">      *(_QWORD *)(v29 - <span class="number">8</span>) = v28;</span><br><span class="line">      *(_QWORD *)&amp;v50 = v29;</span><br><span class="line">      v51 = v29 + <span class="number">4148</span>;</span><br><span class="line">      <span class="built_in">sub_18013E330</span>(v29, v67, <span class="number">4148</span>);</span><br><span class="line">      *((_QWORD *)&amp;v50 + <span class="number">1</span>) = v29 + <span class="number">4148</span>;</span><br><span class="line">      <span class="keyword">if</span> ( &amp;v22[-v21] == (<span class="type">char</span> *)<span class="number">4148</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v30 = (_BYTE *)v29;</span><br><span class="line">        <span class="keyword">while</span> ( v30[v21 - v29] == *v30 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)&amp;(++v30)[-v29] &gt;= <span class="number">0x1034</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            v31 = <span class="string">&quot;Right flag!&quot;</span>;</span><br><span class="line">            <span class="keyword">goto</span> LABEL_35;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      v31 = <span class="string">&quot;Wrong flag!&quot;</span>;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v18 = <span class="built_in">sub_18000A600</span>(&amp;qword_180190BB0, <span class="string">&quot;wrong&quot;</span>);</span><br><span class="line">      <span class="built_in">LOBYTE</span>(v19) = <span class="number">10</span>;</span><br><span class="line">      v20 = <span class="built_in">sub_18000A3A0</span>(v18 + *(<span class="type">int</span> *)(*(_QWORD *)v18 + <span class="number">4LL</span>), v19);</span><br><span class="line">      <span class="built_in">sub_1800112E0</span>(v18, v20);</span><br><span class="line">      <span class="built_in">sub_180008F20</span>(v18);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>注意到了明显的密文比较逻辑，有一段巨大的密文<code>byte_180154070</code>，长达4148字节，这就是用于比较的密文，在其上还有一段异或逻辑：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v11 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( v11 &gt; <span class="number">0x7FFFFFFFFFFFFFFFLL</span> )</span><br><span class="line">    std::vector&lt;<span class="type">void</span> *&gt;::_Xlen(v13, v15, v16);</span><br><span class="line">  <span class="built_in">sub_180017600</span>(&amp;v45, &amp;v44, v16);</span><br><span class="line">  v4 = v47;</span><br><span class="line">  v22 = v46;</span><br><span class="line">  v21 = v45;</span><br><span class="line">&#125;</span><br><span class="line">v23 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> ( v11 )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v24 = &amp;v63;</span><br><span class="line">    <span class="keyword">if</span> ( v12 &gt; <span class="number">0xF</span> )</span><br><span class="line">      v24 = (__m128i *)v17;</span><br><span class="line">    v25 = v24-&gt;m128i_i8[v23];</span><br><span class="line">    v26 = &amp;qword_18018C010;</span><br><span class="line">    <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C020 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">      v26 = (__int64 *)qword_18018C010;</span><br><span class="line">    v27 = v25 ^ *((_BYTE *)v26 + v23 % (<span class="type">unsigned</span> __int64)xmmword_18018C020);</span><br><span class="line">    v43[<span class="number">0</span>] = v27;</span><br><span class="line">    <span class="keyword">if</span> ( v22 == v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">sub_1800172F0</span>(&amp;v45, v22, v43);</span><br><span class="line">      v4 = v47;</span><br><span class="line">      v22 = v46;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      *v22++ = v27;</span><br><span class="line">      v46 = v22;</span><br><span class="line">    &#125;</span><br><span class="line">    ++v23;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v23 &lt; v11 );</span><br><span class="line">  v21 = v45;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到密钥v26来源于<code>qword_18018C010</code>（此时还是空的），查询这个数组的xref，查到一个函数<code>sub_1800F1070</code>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  v8 = &amp;key;</span><br><span class="line">  <span class="keyword">if</span> ( *((_QWORD *)&amp;xmmword_18018C020 + <span class="number">1</span>) &gt; <span class="number">0xFu</span> )</span><br><span class="line">    v8 = (__int64 *)key;</span><br><span class="line">  v9 = v2[<span class="number">2</span>];</span><br><span class="line">  v10 = v2;</span><br><span class="line">  <span class="keyword">if</span> ( v2[<span class="number">3</span>] &gt; <span class="number">0xFu</span> )</span><br><span class="line">    v10 = (_QWORD *)*v2;</span><br><span class="line">  <span class="keyword">if</span> ( v9 != (_QWORD)xmmword_18018C020 )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_50;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">sub_18013ED70</span>(v10, v8, v9) )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_50;</span><br><span class="line">  <span class="keyword">try</span></span><br><span class="line">  &#123;</span><br><span class="line">    v61 = <span class="number">0</span>;</span><br><span class="line">    v17 = (__int128 *)<span class="built_in">sub_180110524</span>(<span class="number">1296</span>);</span><br><span class="line">    v16 = <span class="number">1295</span>;</span><br><span class="line">    v63 = <span class="number">1295</span>;</span><br><span class="line">    *(_BYTE *)v17 = <span class="number">0</span>;</span><br><span class="line">    *(_QWORD *)&amp;v61 = v17;</span><br><span class="line">    v62 = <span class="number">0</span>;</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v15 &lt; <span class="number">0x50F</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = v2;</span><br><span class="line">      <span class="keyword">if</span> ( v2[<span class="number">3</span>] &gt; <span class="number">0xFu</span> )</span><br><span class="line">        v12 = (_QWORD *)*v2;</span><br><span class="line">      v13 = *((<span class="type">unsigned</span> __int8 *)v12 + v15 % v2[<span class="number">2</span>]);</span><br><span class="line">      <span class="built_in">LOBYTE</span>(v13) = byte_18015A320[v15] ^ v13;</span><br><span class="line">      <span class="keyword">if</span> ( v4 &gt;= v16 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">sub_18000B0E0</span>(&amp;v61, <span class="number">1</span>, <span class="number">0</span>, v13);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v62 = v4 + <span class="number">1</span>;</span><br><span class="line">        v14 = &amp;v61;</span><br><span class="line">        <span class="keyword">if</span> ( v16 &gt; <span class="number">0xF</span> )</span><br><span class="line">          v14 = v17;</span><br><span class="line">        *((_BYTE *)v14 + v4) = v13;</span><br><span class="line">        *((_BYTE *)v14 + v4 + <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v15;</span><br><span class="line">      v16 = v63;</span><br><span class="line">      v4 = v62;</span><br><span class="line">      v17 = (__int128 *)v61;</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">  &#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>注意到了明显的依然使用这个key进行循环异或解密的数组<code>byte_18015A320</code>，而继续查询key的xref，可以发现其正式parseArgs中自解密的<code>Loda_Lang</code>，因此两个密文全部可以解密，第一串密文解密得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">583816102810052800589434335069219286405826406630421989889686064356068205809909774121462460601326025288509488060186540672688592635715723433315421893336296834148679608422191981907424653118438603335430859349845434037593630964251937832355292049020864523737762582094808993539638654563699089038209584551358553991909861266732226673248842442203439010762618318248702523232866474166818905065779215570910502879852007937495130,</span><br><span class="line">827704072678612886223153147399290850661022945529286866943398734005195447510363078995087843368215874310970056068705803945250285962553669389323971931220479551505982213885700227711843124365943461519691125733003722837430472451500047875157396636076027077284317802011824248045810864881382082857918356507197182949446072224631984230135651996398164889038209542184754161017209072489158566575505424165294117177009771871228665,</span><br><span class="line">449370908557206263669364433712787468540823965880521351163618231812271760706181910371788136598949467985463885699494505701231196552477959530645655847059958728478087576272283565004750568195960388680603835305536103068323871487543027935367209464374652644043011538829273839525068430517787713718151517918959960106113055813339343097787988060801557722656955387987222324706431849864596070783781808169580959353810072245736678,</span><br><span class="line">136723235546734809341061710477970416021661770286965197229882277483672900055557397432619926493881674610500435355836723597075190507430965956414347394506902551894990907192821436606424776631381555435487208847436931557824635268620128775278744122665436584062015233116510653693457977181245539242143819576668315412385153611755087464387481198691220636622256544747711427314977305054701211178511629210462570158054037210559471,</span><br><span class="line">582734364161892683523669045682477973399547644657127704051069076453665670665199839845898218709981400674198420657349992080050711964236166946872639282311768870391421467896217270868101814002100343832256594630059387278231073416779019701796525553394901837836140529304572096777588202847484039992411585527113959646097858840858316067820995591285034891757339656201014806182579727870789457554208061619207925734174094456906174,</span><br><span class="line">859290962943512089620583884324807994259168069031934797815738073537690886391795396959608694116540742265952662151164052010187896166280164101129250748780586227476438406030729848603651164185966148760986364047271318256291035694005499647571728360419241738332540458799415836667591886691039111151968520788415157035929894877485129278065878964965062839767234103947916397846693111696357030783770940975047296121833459368179814,</span><br><span class="line">597559553592567104251755654491068552734420942918132558186777351819277930284012291180303814813371477575242937917048475900273494053006530360987904199553195469301754073352414029996806374782850453601642716448300298513280528406165422169309241696970925786506055418197116733161648569447598597374767373408784717682835962672392156958575059887787184803167348493500601598385893665354868844213067991156387207893780603100533035,</span><br><span class="line">51371459758899855390514976341374571021497511490267510786457964055298962757456676520029757438013806266752199653793584016794833425441823101379994221385544658220407840994428598261525351677673005392418066006814237184206332707747812431962668464758795676801576458672760565675146377651690769585285569954135143756577417154046779216874479143646863007967043831145618484607607908821492512151163088100333272555355395651817292,</span><br><span class="line">701424428617789363861974889959692466334764618468458527064555566455417290608695655394264063740043008822041518107197889768213948494068810896579929622596820710394340299428108036305197469300377709904155842455439877158688532119755290910101965886099047283654442385419856452530763741924289269529802996787251638977873223698332245936564987502884804393263403453495216774156521258169977355669617271852237089492234534991667427,</span><br><span class="line">302648813311899031744908856773255354187356978276630394356874821345787992614524284580778327246433455049291405778430845498486366587619983908976667771237650357706647753992753332814803365381856567734244278341148986294910526427214290214390515305801755021147278725497232669081941725830136195646455368286701243369402712793040371378301784682786599018039026609923216448179479921564914179775067903851681440055529845164654471</span><br></pre></td></tr></table></figure>

<p>是十个巨大的数，猜测这就是程序运算后输出的结果，那么flag就应当长达80字节，继续对第二段密文进行解密：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mov</span> <span class="number">$1</span>, <span class="number">$0</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$2</span>, <span class="number">$0</span></span><br><span class="line"><span class="keyword">div</span> <span class="number">$1</span>, <span class="number">4294967296</span></span><br><span class="line">ban <span class="number">$2</span>, <span class="number">4294967295</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$3</span>, <span class="number">195948557</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$4</span>, <span class="number">3735928559</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$5</span>, <span class="number">181321950</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$6</span>, <span class="number">4277009102</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$7</span>, <span class="number">289739801</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$8</span>, <span class="number">11325165</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$9</span>, <span class="number">114</span></span><br><span class="line">lpb <span class="number">$9</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$10</span>, <span class="number">$2</span></span><br><span class="line">  <span class="keyword">mul</span> <span class="number">$10</span>, <span class="number">32</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$10</span>, <span class="number">$3</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$11</span>, <span class="number">$2</span></span><br><span class="line">  <span class="keyword">div</span> <span class="number">$11</span>, <span class="number">16</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$11</span>, <span class="number">$4</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$12</span>, <span class="number">$2</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$12</span>, <span class="number">$8</span></span><br><span class="line">  bxo <span class="number">$10</span>, <span class="number">$11</span></span><br><span class="line">  bxo <span class="number">$10</span>, <span class="number">$12</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$1</span>, <span class="number">$10</span></span><br><span class="line">  ban <span class="number">$1</span>, <span class="number">4294967295</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$8</span>, <span class="number">$7</span></span><br><span class="line">  ban <span class="number">$8</span>, <span class="number">4294967295</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$10</span>, <span class="number">$1</span></span><br><span class="line">  <span class="keyword">mul</span> <span class="number">$10</span>, <span class="number">8</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$10</span>, <span class="number">$5</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$11</span>, <span class="number">$1</span></span><br><span class="line">  <span class="keyword">div</span> <span class="number">$11</span>, <span class="number">64</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$11</span>, <span class="number">$6</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$12</span>, <span class="number">$1</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$12</span>, <span class="number">$8</span></span><br><span class="line">  bxo <span class="number">$10</span>, <span class="number">$11</span></span><br><span class="line">  bxo <span class="number">$10</span>, <span class="number">$12</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$2</span>, <span class="number">$10</span></span><br><span class="line">	ban <span class="number">$2</span>, <span class="number">4294967295</span></span><br><span class="line">  <span class="keyword">sub</span> <span class="number">$9</span>, <span class="number">1</span></span><br><span class="line">lpe</span><br><span class="line"><span class="keyword">mov</span> <span class="number">$10</span>, <span class="number">114</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$3</span>, <span class="number">1145141919</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$4</span>, <span class="number">1919810114</span></span><br><span class="line">lpb <span class="number">$10</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$5</span>, <span class="number">$0</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$10</span>, <span class="number">$5</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$6</span>, <span class="number">$1</span></span><br><span class="line">  <span class="keyword">sub</span> <span class="number">$10</span>, <span class="number">$6</span></span><br><span class="line">  ban <span class="number">$5</span>, <span class="number">$3</span></span><br><span class="line">  ban <span class="number">$10</span>, <span class="number">$5</span></span><br><span class="line">  ban <span class="number">$6</span>, <span class="number">$4</span></span><br><span class="line">  bor <span class="number">$10</span>, <span class="number">$6</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$7</span>, <span class="number">$5</span></span><br><span class="line">  bor <span class="number">$5</span>, <span class="number">$6</span></span><br><span class="line">  bxo <span class="number">$10</span>, <span class="number">$5</span></span><br><span class="line">  bxo <span class="number">$6</span>, <span class="number">$7</span></span><br><span class="line">  bxo <span class="number">$10</span>, <span class="number">$6</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$3</span>, <span class="number">$5</span></span><br><span class="line">  <span class="keyword">sub</span> <span class="number">$10</span>, <span class="number">$3</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$4</span>, <span class="number">$6</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$10</span>, <span class="number">$4</span></span><br><span class="line">  ban <span class="number">$0</span>, <span class="number">$3</span></span><br><span class="line">  ban <span class="number">$10</span>, <span class="number">$0</span></span><br><span class="line">  ban <span class="number">$1</span>, <span class="number">$4</span></span><br><span class="line">  bor <span class="number">$10</span>, <span class="number">$1</span></span><br><span class="line">lpe</span><br><span class="line"><span class="keyword">mul</span> <span class="number">$1</span>, <span class="number">4294967296</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$0</span>, <span class="number">$1</span></span><br><span class="line">bor <span class="number">$0</span>, <span class="number">$2</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$1</span>, <span class="number">142291871983652659</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$2</span>, <span class="number">98998887741403650</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$3</span>, <span class="number">1</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$4</span>, <span class="number">0</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$5</span>, <span class="number">23</span></span><br><span class="line">lpb <span class="number">$5</span></span><br><span class="line">  <span class="keyword">sub</span> <span class="number">$5</span>, <span class="number">1</span></span><br><span class="line">  <span class="keyword">mov</span> <span class="number">$4</span>, <span class="number">$2</span></span><br><span class="line">  <span class="keyword">mul</span> <span class="number">$4</span>, <span class="number">$5</span></span><br><span class="line">  <span class="keyword">add</span> <span class="number">$4</span>, <span class="number">$1</span></span><br><span class="line">  <span class="keyword">mul</span> <span class="number">$3</span>, <span class="number">$4</span></span><br><span class="line">lpe</span><br><span class="line"><span class="keyword">mov</span> <span class="number">$9</span>, <span class="number">1336</span></span><br><span class="line"><span class="keyword">mov</span> <span class="number">$1</span>, <span class="number">$0</span></span><br><span class="line">lpb <span class="number">$9</span></span><br><span class="line">  <span class="keyword">mul</span> <span class="number">$0</span>, <span class="number">$1</span></span><br><span class="line">  mod <span class="number">$0</span>, <span class="number">$3</span></span><br><span class="line">  <span class="keyword">sub</span> <span class="number">$9</span>, <span class="number">1</span></span><br><span class="line">lpe</span><br></pre></td></tr></table></figure>

<p>发现这正是题目的LODA汇编源代码，不难发现这是一个TEA加密和一个多质数RSA加密（中间的循环是junkcode，根据loda官方文档，若循环标签在循环过程中不自减，则循环不执行），编写脚本解密即可：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">b2nbe</span>(<span class="params">b, n</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(b[i:i+n], byteorder=<span class="string">&#x27;big&#x27;</span>, signed=<span class="literal">False</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(b), n)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">n2bbe</span>(<span class="params">d, n</span>):</span><br><span class="line">    b = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> nw <span class="keyword">in</span> d: b.extend(nw.to_bytes(n, byteorder=<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">583816102810052800589434335069219286405826406630421989889686064356068205809909774121462460601326025288509488060186540672688592635715723433315421893336296834148679608422191981907424653118438603335430859349845434037593630964251937832355292049020864523737762582094808993539638654563699089038209584551358553991909861266732226673248842442203439010762618318248702523232866474166818905065779215570910502879852007937495130</span>,</span><br><span class="line"><span class="number">827704072678612886223153147399290850661022945529286866943398734005195447510363078995087843368215874310970056068705803945250285962553669389323971931220479551505982213885700227711843124365943461519691125733003722837430472451500047875157396636076027077284317802011824248045810864881382082857918356507197182949446072224631984230135651996398164889038209542184754161017209072489158566575505424165294117177009771871228665</span>,</span><br><span class="line"><span class="number">449370908557206263669364433712787468540823965880521351163618231812271760706181910371788136598949467985463885699494505701231196552477959530645655847059958728478087576272283565004750568195960388680603835305536103068323871487543027935367209464374652644043011538829273839525068430517787713718151517918959960106113055813339343097787988060801557722656955387987222324706431849864596070783781808169580959353810072245736678</span>,</span><br><span class="line"><span class="number">136723235546734809341061710477970416021661770286965197229882277483672900055557397432619926493881674610500435355836723597075190507430965956414347394506902551894990907192821436606424776631381555435487208847436931557824635268620128775278744122665436584062015233116510653693457977181245539242143819576668315412385153611755087464387481198691220636622256544747711427314977305054701211178511629210462570158054037210559471</span>,</span><br><span class="line"><span class="number">582734364161892683523669045682477973399547644657127704051069076453665670665199839845898218709981400674198420657349992080050711964236166946872639282311768870391421467896217270868101814002100343832256594630059387278231073416779019701796525553394901837836140529304572096777588202847484039992411585527113959646097858840858316067820995591285034891757339656201014806182579727870789457554208061619207925734174094456906174</span>,</span><br><span class="line"><span class="number">859290962943512089620583884324807994259168069031934797815738073537690886391795396959608694116540742265952662151164052010187896166280164101129250748780586227476438406030729848603651164185966148760986364047271318256291035694005499647571728360419241738332540458799415836667591886691039111151968520788415157035929894877485129278065878964965062839767234103947916397846693111696357030783770940975047296121833459368179814</span>,</span><br><span class="line"><span class="number">597559553592567104251755654491068552734420942918132558186777351819277930284012291180303814813371477575242937917048475900273494053006530360987904199553195469301754073352414029996806374782850453601642716448300298513280528406165422169309241696970925786506055418197116733161648569447598597374767373408784717682835962672392156958575059887787184803167348493500601598385893665354868844213067991156387207893780603100533035</span>,</span><br><span class="line"><span class="number">51371459758899855390514976341374571021497511490267510786457964055298962757456676520029757438013806266752199653793584016794833425441823101379994221385544658220407840994428598261525351677673005392418066006814237184206332707747812431962668464758795676801576458672760565675146377651690769585285569954135143756577417154046779216874479143646863007967043831145618484607607908821492512151163088100333272555355395651817292</span>,</span><br><span class="line"><span class="number">701424428617789363861974889959692466334764618468458527064555566455417290608695655394264063740043008822041518107197889768213948494068810896579929622596820710394340299428108036305197469300377709904155842455439877158688532119755290910101965886099047283654442385419856452530763741924289269529802996787251638977873223698332245936564987502884804393263403453495216774156521258169977355669617271852237089492234534991667427</span>,</span><br><span class="line"><span class="number">302648813311899031744908856773255354187356978276630394356874821345787992614524284580778327246433455049291405778430845498486366587619983908976667771237650357706647753992753332814803365381856567734244278341148986294910526427214290214390515305801755021147278725497232669081941725830136195646455368286701243369402712793040371378301784682786599018039026609923216448179479921564914179775067903851681440055529845164654471</span>]</span><br><span class="line">dec = []</span><br><span class="line">p = <span class="number">142291871983652659</span></span><br><span class="line">delta = <span class="number">98998887741403650</span></span><br><span class="line">n = <span class="number">1</span></span><br><span class="line">primes = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">    ps = p + delta * i</span><br><span class="line">    n *= ps</span><br><span class="line">    primes.append(ps)</span><br><span class="line">e = <span class="number">1337</span></span><br><span class="line">phin = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">23</span>):</span><br><span class="line">    phin *= primes[i]-<span class="number">1</span></span><br><span class="line">d = inverse(e, phin)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">    dec.append(<span class="built_in">pow</span>(enc[i], d, n))</span><br><span class="line">benc = n2bbe(dec, <span class="number">8</span>)</span><br><span class="line">denc = b2nbe(benc, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">key = [<span class="number">195948557</span>, <span class="number">3735928559</span>, <span class="number">181321950</span>, <span class="number">4277009102</span>]</span><br><span class="line">delta = <span class="number">289739801</span></span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(denc)//<span class="number">2</span>):</span><br><span class="line">    m1 = denc[<span class="number">2</span>*j]</span><br><span class="line">    m2 = denc[<span class="number">2</span>*j+<span class="number">1</span>]</span><br><span class="line">    ttl = (<span class="number">11325165</span> + <span class="number">114</span> * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">114</span>):</span><br><span class="line">        m2 = (m2 - ((key[<span class="number">3</span>] + (m1 &gt;&gt; <span class="number">6</span>)) ^ (ttl + m1) ^ (key[<span class="number">2</span>] + (m1 &lt;&lt; <span class="number">3</span>)))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span>  </span><br><span class="line">        m1 = (m1 - ((key[<span class="number">1</span>] + (m2 &gt;&gt; <span class="number">4</span>)) ^ (ttl + m2) ^ (key[<span class="number">0</span>] + (m2 &lt;&lt; <span class="number">5</span>)))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    result.append(m1)</span><br><span class="line">    result.append(m2)</span><br><span class="line">flag = n2bbe(result, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p><code>flag&#123;G4m3_1ik3_D1l_DecRypt&amp;L04d3r_w17H_L0d4_14nG-yE7_4nO7h3R_4s53mB1y_L4NgUAg3!&#125;</code></p>
<h1 id="谢罪"><a href="#谢罪" class="headerlink" title="谢罪"></a><del><small>谢罪</small></del></h1><p>第一次给大比赛出题，本来排查下来觉得应该不会有什么问题的，但是实际比赛过程中还是出现了一点问题（比如mmm的少量多解问题和loda的约束迷宫未能完全约束的非预期问题等），今后在出题的时候会更认真检查潜在的漏洞，尽量避免这些问题再发生</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/09/23/crew_25_wasm/"
      title="crewCTF 2025 Reverse-WASM Vault WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        crewCTF 2025 Reverse-WASM Vault WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/08/25/nssctf_round31/"
      title="NSSCTF四周年竞赛暨Round#31竞赛 WriteUp (Reverse方向)"
     >

    <p class="title-text">
      
        NSSCTF四周年竞赛暨Round#31竞赛 WriteUp (Reverse方向)
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2026 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
