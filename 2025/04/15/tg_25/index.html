<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>TGCTF 2025 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="个人感觉reverse题目里面解数最少的index反而不是最阴间的，起码没有conforand阴间在这里仅给出我个人解出的题目的WriteUp. Crypto方向：费克特尔：直接上factordb分解n即可 12345678910from Crypto.Util.number import *c&#x3D;670610235999012099846283721569059674725712804950807">
<meta property="og:type" content="article">
<meta property="og:title" content="TGCTF 2025 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2025/04/15/tg_25/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="个人感觉reverse题目里面解数最少的index反而不是最阴间的，起码没有conforand阴间在这里仅给出我个人解出的题目的WriteUp. Crypto方向：费克特尔：直接上factordb分解n即可 12345678910from Crypto.Util.number import *c&#x3D;670610235999012099846283721569059674725712804950807">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-04-14T16:00:00.000Z">
<meta property="article:modified_time" content="2025-11-09T20:09:02.921Z">
<meta property="article:author" content="Astral Prisma">
<meta property="article:tag" content="WASM">
<meta property="article:tag" content="Obfuscate">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/AP.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/XH_2.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Ideas/">
                Ideas
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">38</div>
            </a>
        
            <a class="category-link" href="/categories/%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">
                出题记录
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/got/" rel="tag">.got</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ARM/" rel="tag">ARM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AutoRe/" rel="tag">AutoRe</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Brainfuck/" rel="tag">Brainfuck</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CUDA/" rel="tag">CUDA</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Cheat-Engine/" rel="tag">Cheat Engine</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DOS/" rel="tag">DOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Driver/" rel="tag">Driver</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Frida-Hook/" rel="tag">Frida Hook</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Harmony-OS/" rel="tag">Harmony OS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/IPC/" rel="tag">IPC</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Indirect-Jump/" rel="tag">Indirect Jump</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Kotlin/" rel="tag">Kotlin</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Lua/" rel="tag">Lua</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Obfuscate/" rel="tag">Obfuscate</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pascal/" rel="tag">Pascal</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Powershell/" rel="tag">Powershell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pyarmor/" rel="tag">Pyarmor</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/QEMU/" rel="tag">QEMU</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/R2R/" rel="tag">R2R</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Remote/" rel="tag">Remote</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Subprocess/" rel="tag">Subprocess</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Traffic/" rel="tag">Traffic</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Unicorn/" rel="tag">Unicorn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/VM/" rel="tag">VM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/WASM/" rel="tag">WASM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Wechat-Mini-Program/" rel="tag">Wechat Mini Program</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Windows-DLL/" rel="tag">Windows DLL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Yara/" rel="tag">Yara</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/il2cpp/" rel="tag">il2cpp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pickle/" rel="tag">pickle</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/x96/" rel="tag">x96</a></li></ul>
    </div>
  </div>


    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-tg_25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        TGCTF 2025 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-04-14T16:00:00.000Z" itemprop="datePublished">2025-04-15</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            12k 词 
          </div>
        </div>
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Obfuscate/" rel="tag">Obfuscate</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/WASM/" rel="tag">WASM</a></li></ul>

      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>个人感觉reverse题目里面解数最少的index反而不是最阴间的，起码没有conforand阴间</em><br><br><em>在这里仅给出我个人解出的题目的WriteUp.</em></p>
<h1 id="Crypto方向："><a href="#Crypto方向：" class="headerlink" title="Crypto方向："></a>Crypto方向：</h1><h2 id="费克特尔："><a href="#费克特尔：" class="headerlink" title="费克特尔："></a>费克特尔：</h2><p>直接上factordb分解n即可</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">c=<span class="number">670610235999012099846283721569059674725712804950807955010725968103642359765806</span></span><br><span class="line">n=<span class="number">810544624661213367964996895060815354972889892659483948276203088055391907479553</span></span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">113</span> * <span class="number">18251</span> * <span class="number">2001511</span> * <span class="number">214168842768662180574654641</span> * <span class="number">916848439436544911290378588839845528581</span></span><br><span class="line">phin = <span class="number">112</span> * <span class="number">18250</span> * <span class="number">2001510</span> * <span class="number">214168842768662180574654640</span> * <span class="number">916848439436544911290378588839845528580</span></span><br><span class="line">d = inverse(e, phin)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m).decode())</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>TGCTF{f4888_6abdc_9c2bd_9036bb}</strong></font>.</p>
<h2 id="宝宝rsa："><a href="#宝宝rsa：" class="headerlink" title="宝宝rsa："></a>宝宝rsa：</h2><p>前半段爆破e，后半段直接开方</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"></span><br><span class="line">p1 = <span class="number">8362851990079664018649774360159786938757293294328116561219351503022492961843907118845919317399785168488103775809531198339213009936918460080250107807031483</span></span><br><span class="line">q1 = <span class="number">8312546034426788223492083178829355192676175323324230533451989649056072814335528263136523605276378801682321623998646291206494179416941978672637426346496531</span></span><br><span class="line">c1 = <span class="number">39711973075443303473292859404026809299317446021917391206568511014894789946819103680496756934914058521250438186214943037578346772475409633145435232816799913236259074769958139045997486622505579239448395807857034154142067866860431132262060279168752474990452298895511880964765819538256786616223902867436130100322</span></span><br><span class="line">n1 = p1 * q1</span><br><span class="line">phin1 = (p1 - <span class="number">1</span>) * (q1 - <span class="number">1</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="keyword">while</span> e &lt;= <span class="number">2</span> ** <span class="number">19</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d1 = inverse(e, phin1)</span><br><span class="line">        m1 = <span class="built_in">pow</span>(c1, d1, n1)</span><br><span class="line">        flag1 = long_to_bytes(m1)</span><br><span class="line">        <span class="keyword">if</span> flag1[:<span class="number">6</span>] == <span class="string">b&#x27;TGCTF&#123;&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="built_in">print</span>(e, flag1[:<span class="number">6</span>])</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    e = nextprime(e)</span><br><span class="line"><span class="built_in">print</span>(flag1.decode(),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">c2 = <span class="number">51380982170049779703682835988073709896409264083198805522051459033730166821511419536113492522308604225188048202917930917221</span></span><br><span class="line">m2, tag = gmpy2.iroot(c2,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m2).decode())</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>TGCTF{!!3xP_Is_Sm@ll_But_D@ng3r0}</strong></font>.</p>
<h2 id="AAAAAAAA·真·签到："><a href="#AAAAAAAA·真·签到：" class="headerlink" title="AAAAAAAA·真·签到："></a>AAAAAAAA·真·签到：</h2><p>注意到是变位凯撒，偏移量为-1,0,1…且仅对大写字母生效，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_flag</span>(<span class="params">encrypted_flag</span>):</span><br><span class="line">    decrypted_flag = []</span><br><span class="line">    offset = -<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> encrypted_flag:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;A&#x27;</span> &lt;= char &lt;= <span class="string">&#x27;Z&#x27;</span>:</span><br><span class="line">            new_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(char) - <span class="number">65</span> + offset) % <span class="number">26</span>) + <span class="number">65</span>)</span><br><span class="line">            decrypted_flag.append(new_char)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            decrypted_flag.append(char)</span><br><span class="line">        offset += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(decrypted_flag)</span><br><span class="line">encrypted_flag = <span class="string">&quot;UGBRC&#123;RI0G!O04_5C3_OVUI_DV_MNTB&#125;&quot;</span></span><br><span class="line">decrypted_flag = decrypt_flag(encrypted_flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decrypted Flag:&quot;</span>, decrypted_flag)</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>TGCTF{WO0O!Y04_5R3_GOOD_AT_MOVE}</strong></font>.</p>
<h2 id="mm不躲猫猫："><a href="#mm不躲猫猫：" class="headerlink" title="mm不躲猫猫："></a>mm不躲猫猫：</h2><p>多组nc：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract</span>(<span class="params">file_path</span>):</span><br><span class="line">    n_list = []</span><br><span class="line">    c_list = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            line = line.strip()</span><br><span class="line">            <span class="keyword">if</span> line.startswith(<span class="string">&quot;n =&quot;</span>):</span><br><span class="line">                n_value = line.split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>].strip()</span><br><span class="line">                n_list.append(<span class="built_in">int</span>(n_value))</span><br><span class="line">            <span class="keyword">elif</span> line.startswith(<span class="string">&quot;c =&quot;</span>):</span><br><span class="line">                c_value = line.split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>].strip()</span><br><span class="line">                c_list.append(<span class="built_in">int</span>(c_value))</span><br><span class="line">    <span class="keyword">return</span> n_list, c_list</span><br><span class="line"></span><br><span class="line">file_path = <span class="string">&quot;task-mm.txt&quot;</span></span><br><span class="line">n, c = extract(file_path)</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)):</span><br><span class="line">        <span class="keyword">if</span>(i != j):</span><br><span class="line">            <span class="keyword">if</span>(gcd(n[i], n[j]) != <span class="number">1</span>): </span><br><span class="line">                p = gcd(n[i], n[j])</span><br><span class="line">                q = n[i] // p</span><br><span class="line">                phin = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">                d = inverse(e, phin)</span><br><span class="line">                m = <span class="built_in">pow</span>(c[i], d, n[i])</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>TGCTF{ExcePt10n4lY0u_Fl4gF0rY0u_555b0nus}</strong></font>.</p>
<h1 id="Misc："><a href="#Misc：" class="headerlink" title="Misc："></a>Misc：</h1><h2 id="next-is-the-end："><a href="#next-is-the-end：" class="headerlink" title="next is the end："></a>next is the end：</h2><p>编写脚本提取嵌套文件夹中的文件：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_long_path_prefix</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> path.startswith(<span class="string">&quot;\\\\?\\&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;\\\\?\\&quot;</span> + os.path.abspath(path)</span><br><span class="line">    <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_all_files_flat</span>(<span class="params">zip_path, output_dir</span>):</span><br><span class="line">    zip_path = add_long_path_prefix(zip_path)</span><br><span class="line">    output_dir = add_long_path_prefix(output_dir)</span><br><span class="line">    os.makedirs(output_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> zipfile.ZipFile(zip_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> zip_ref:</span><br><span class="line">        <span class="keyword">for</span> member <span class="keyword">in</span> zip_ref.infolist():</span><br><span class="line">            <span class="keyword">if</span> member.is_dir():</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            file_name = os.path.basename(member.filename)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> file_name:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            output_path = os.path.join(output_dir, file_name)</span><br><span class="line">            counter = <span class="number">1</span></span><br><span class="line">            <span class="keyword">while</span> os.path.exists(output_path):</span><br><span class="line">                name, ext = os.path.splitext(file_name)</span><br><span class="line">                output_path = os.path.join(output_dir, <span class="string">f&quot;<span class="subst">&#123;name&#125;</span>_<span class="subst">&#123;counter&#125;</span><span class="subst">&#123;ext&#125;</span>&quot;</span>)</span><br><span class="line">                counter += <span class="number">1</span></span><br><span class="line">            <span class="keyword">with</span> zip_ref.<span class="built_in">open</span>(member) <span class="keyword">as</span> source, <span class="built_in">open</span>(output_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> target:</span><br><span class="line">                target.write(source.read())</span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;提取文件: <span class="subst">&#123;output_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    zip_file = <span class="string">&quot;next_is_the_end.zip&quot;</span></span><br><span class="line">    output_directory = <span class="string">&quot;misc-next/&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(zip_file):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;压缩包路径不存在，请检查后重试。&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_directory):</span><br><span class="line">        os.makedirs(output_directory, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始解压...&quot;</span>)</span><br><span class="line">    extract_all_files_flat(zip_file, output_directory)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;解压完成！所有文件已提取到:&quot;</span>, output_directory)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>flag{so_great!}</strong></font>.</p>
<h2 id="你的运气是好是坏？："><a href="#你的运气是好是坏？：" class="headerlink" title="你的运气是好是坏？："></a>你的运气是好是坏？：</h2><p>无脑猜114514，居然一下子就猜对了<br><br><big><strong>但是我想问问出题人，这样没活烂整真的好么？不知道114514这个梗的就要被枪毙么？我也不是没在群里见过有人死活猜不到的，希望以后不要这么出了，没必要拿一个没意义的大粪来凑题目数量。</strong></big></p>
<h2 id="这是啥o-o："><a href="#这是啥o-o：" class="headerlink" title="这是啥o_o："></a>这是啥o_o：</h2><p>发现是一个GIF，提取帧间隔得到：[840, 710, 670, 840, 700, 1230, 890, 1110, 1170, 950, 990, 970, 1170, 1030, 1040, 1160, 950, 1170, 1120, 950, 1190, 1050, 1160, 1040, 950, 1160, 1050, 1090, 1010, 330, 1250]，除以10得到flag：<font color=deepskyblue><strong>TGCTF{You_caught_up_with_time!}</strong></font>.</p>
<h2 id="你能发现图中的秘密吗？："><a href="#你能发现图中的秘密吗？：" class="headerlink" title="你能发现图中的秘密吗？："></a>你能发现图中的秘密吗？：</h2><p>查看图片，发现没有额外数据块，考虑隐写，用zsteg得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">imagedata           .. text: &quot;&#123;|&#123;@C@M@L&quot;</span><br><span class="line">b1,r,lsb,xy         .. text: &quot;key=i_1ove_y0u&quot;</span><br><span class="line">b4,bgr,msb,xy       .. file: MPEG ADTS, layer I, v2, Monaural</span><br></pre></td></tr></table></figure>
<p>打开压缩包，发现一个pdf和一个png，其中pdf用ps打开，发现有一个隐藏图层，得到flag2：<font color=lime><strong>flag2&#x3D;_attentive_and_conscientious}</strong></font>，png文件最后有一个比别的IDAT块都要大的数据块，单独提取得到一个图片，发现其宽度是375的整数倍时好像有模糊不清的英文，爆破遍历宽高发现为1125时是正确的，flag1：<font color=lime><strong>flag{you_are_so</strong></font>，拼合得到<font color=deepskyblue><strong>flag{you_are_so_attentive_and_conscientious}</strong></font>.</p>
<h1 id="Reverse方向："><a href="#Reverse方向：" class="headerlink" title="Reverse方向："></a>Reverse方向：</h1><h2 id="Base64："><a href="#Base64：" class="headerlink" title="Base64："></a>Base64：</h2><p>查看base64函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BYTE *__fastcall <span class="title">base64</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  v2 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="built_in">strcpy</span>(v30, <span class="string">&quot;GLp/+Wn7uqX8FQ2JDR1c0M6U53sjBwyxglmrCVdSThAfEOvPHaYZNzo4ktK9iebI&quot;</span>);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v2;</span><br><span class="line">  <span class="keyword">while</span> ( *(_BYTE *)(a1 + v2) );</span><br><span class="line">  v3 = <span class="number">0</span>i64;</span><br><span class="line">  v4 = (<span class="type">int</span>)v2 / <span class="number">3</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)v2 == <span class="number">3</span> * ((<span class="type">int</span>)v2 / <span class="number">3</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    v6 = <span class="number">4</span> * v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (<span class="type">int</span>)v2 % <span class="number">3</span> == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">1</span>;</span><br><span class="line">    v6 = <span class="number">4</span> * v4 + <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( (<span class="type">int</span>)v2 % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = <span class="number">2</span>;</span><br><span class="line">    v6 = <span class="number">4</span> * v4 + <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = v31;</span><br><span class="line">    v6 = v31;</span><br><span class="line">  &#125;</span><br><span class="line">  v7 = v6;</span><br><span class="line">  v8 = v6 + <span class="number">1</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( v6 == <span class="number">-1</span>i64 )</span><br><span class="line">    v8 = <span class="number">-1</span>i64;</span><br><span class="line">  v9 = <span class="built_in">malloc</span>(v8);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">int</span>)v2 - v5 &gt; <span class="number">0</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = a1 + <span class="number">2</span>;</span><br><span class="line">    v11 = ((<span class="type">int</span>)v2 - v5 - <span class="number">1</span>i64) / <span class="number">3u</span>i64 + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v3 += <span class="number">4</span>i64;</span><br><span class="line">      v12 = *(<span class="type">unsigned</span> __int8 *)(v10 - <span class="number">2</span>) &gt;&gt; <span class="number">2</span>;</span><br><span class="line">      v10 += <span class="number">3</span>i64;</span><br><span class="line">      v13 = v12 + <span class="number">24</span>;</span><br><span class="line">      v14 = v13 - <span class="number">64</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v13 &lt;= <span class="number">0x40</span> )</span><br><span class="line">        v14 = v13;</span><br><span class="line">      v9[v3 - <span class="number">4</span>] = v30[v14];</span><br><span class="line">      v15 = ((*(<span class="type">unsigned</span> __int8 *)(v10 - <span class="number">4</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (*(_BYTE *)(v10 - <span class="number">5</span>) &amp; <span class="number">3</span>))) - <span class="number">40</span>;</span><br><span class="line">      <span class="keyword">if</span> ( ((*(<span class="type">unsigned</span> __int8 *)(v10 - <span class="number">4</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (*(_BYTE *)(v10 - <span class="number">5</span>) &amp; <span class="number">3u</span>))) + <span class="number">0x18</span> &lt;= <span class="number">0x40</span> )</span><br><span class="line">        v15 = ((*(<span class="type">unsigned</span> __int8 *)(v10 - <span class="number">4</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (*(_BYTE *)(v10 - <span class="number">5</span>) &amp; <span class="number">3</span>))) + <span class="number">0x18</span>;</span><br><span class="line">      v9[v3 - <span class="number">3</span>] = v30[v15];</span><br><span class="line">      v16 = ((*(<span class="type">unsigned</span> __int8 *)(v10 - <span class="number">3</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (*(_BYTE *)(v10 - <span class="number">4</span>) &amp; <span class="number">0xF</span>))) - <span class="number">40</span>;</span><br><span class="line">      <span class="keyword">if</span> ( ((*(<span class="type">unsigned</span> __int8 *)(v10 - <span class="number">3</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (*(_BYTE *)(v10 - <span class="number">4</span>) &amp; <span class="number">0xFu</span>))) + <span class="number">0x18</span> &lt;= <span class="number">0x40</span> )</span><br><span class="line">        v16 = ((*(<span class="type">unsigned</span> __int8 *)(v10 - <span class="number">3</span>) &gt;&gt; <span class="number">6</span>) | (<span class="number">4</span> * (*(_BYTE *)(v10 - <span class="number">4</span>) &amp; <span class="number">0xF</span>))) + <span class="number">0x18</span>;</span><br><span class="line">      v9[v3 - <span class="number">2</span>] = v30[v16];</span><br><span class="line">      v17 = (*(_BYTE *)(v10 - <span class="number">3</span>) &amp; <span class="number">0x3F</span>) - <span class="number">40</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (*(_BYTE *)(v10 - <span class="number">3</span>) &amp; <span class="number">0x3Fu</span>) + <span class="number">24</span> &lt;= <span class="number">0x40</span> )</span><br><span class="line">        v17 = (*(_BYTE *)(v10 - <span class="number">3</span>) &amp; <span class="number">0x3F</span>) + <span class="number">24</span>;</span><br><span class="line">      v9[v3 - <span class="number">1</span>] = v30[v17];</span><br><span class="line">      --v11;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 );</span><br><span class="line">  &#125;</span><br><span class="line">  v18 = v5 - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !v18 )</span><br><span class="line">  &#123;</span><br><span class="line">    v25 = (*(<span class="type">unsigned</span> __int8 *)((<span class="type">int</span>)v2 + a1 - <span class="number">1</span>) &gt;&gt; <span class="number">2</span>) - <span class="number">40</span>;</span><br><span class="line">    <span class="keyword">if</span> ( (*(<span class="type">unsigned</span> __int8 *)((<span class="type">int</span>)v2 + a1 - <span class="number">1</span>) &gt;&gt; <span class="number">2</span>) + <span class="number">24</span> &lt;= <span class="number">0x40u</span> )</span><br><span class="line">      v25 = (*(<span class="type">unsigned</span> __int8 *)((<span class="type">int</span>)v2 + a1 - <span class="number">1</span>) &gt;&gt; <span class="number">2</span>) + <span class="number">24</span>;</span><br><span class="line">    v9[v7 - <span class="number">4</span>] = v30[v25];</span><br><span class="line">    v26 = *(_BYTE *)((<span class="type">int</span>)v2 + a1 - <span class="number">1</span>) &amp; <span class="number">3</span>;</span><br><span class="line">    *(_WORD *)&amp;v9[v7 - <span class="number">2</span>] = <span class="number">0x3D3D</span>;</span><br><span class="line">    v27 = <span class="number">16</span> * v26 + <span class="number">24</span>;</span><br><span class="line">    v28 = v27 - <span class="number">64</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v27 &lt;= <span class="number">0x40</span> )</span><br><span class="line">      v28 = v27;</span><br><span class="line">    v9[v7 - <span class="number">3</span>] = v30[v28];</span><br><span class="line">    <span class="keyword">goto</span> LABEL_37;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v18 != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_37:</span><br><span class="line">    v9[v7] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> v9;</span><br><span class="line">  &#125;</span><br><span class="line">  v19 = a1 + (<span class="type">int</span>)v2;</span><br><span class="line">  v20 = (*(<span class="type">unsigned</span> __int8 *)(v19 - <span class="number">2</span>) &gt;&gt; <span class="number">2</span>) - <span class="number">40</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (*(<span class="type">unsigned</span> __int8 *)(v19 - <span class="number">2</span>) &gt;&gt; <span class="number">2</span>) + <span class="number">24</span> &lt;= <span class="number">0x40u</span> )</span><br><span class="line">    v20 = (*(<span class="type">unsigned</span> __int8 *)(v19 - <span class="number">2</span>) &gt;&gt; <span class="number">2</span>) + <span class="number">24</span>;</span><br><span class="line">  v9[v7 - <span class="number">4</span>] = v30[v20];</span><br><span class="line">  v21 = ((*(<span class="type">unsigned</span> __int8 *)(v19 - <span class="number">1</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (*(_BYTE *)(v19 - <span class="number">2</span>) &amp; <span class="number">3</span>))) - <span class="number">40</span>;</span><br><span class="line">  <span class="keyword">if</span> ( ((*(<span class="type">unsigned</span> __int8 *)(v19 - <span class="number">1</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (*(_BYTE *)(v19 - <span class="number">2</span>) &amp; <span class="number">3u</span>))) + <span class="number">24</span> &lt;= <span class="number">0x40</span> )</span><br><span class="line">    v21 = ((*(<span class="type">unsigned</span> __int8 *)(v19 - <span class="number">1</span>) &gt;&gt; <span class="number">4</span>) | (<span class="number">16</span> * (*(_BYTE *)(v19 - <span class="number">2</span>) &amp; <span class="number">3</span>))) + <span class="number">24</span>;</span><br><span class="line">  v9[v7 - <span class="number">3</span>] = v30[v21];</span><br><span class="line">  v22 = *(_BYTE *)(v19 - <span class="number">1</span>) &amp; <span class="number">0xF</span>;</span><br><span class="line">  *(_WORD *)&amp;v9[v7 - <span class="number">1</span>] = <span class="number">61</span>;</span><br><span class="line">  v23 = <span class="number">4</span> * v22 + <span class="number">24</span>;</span><br><span class="line">  v24 = <span class="number">4</span> * v22 - <span class="number">40</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v23 &lt;= <span class="number">0x40</span> )</span><br><span class="line">    v24 = v23;</span><br><span class="line">  v9[v7 - <span class="number">2</span>] = v30[v24];</span><br><span class="line">  <span class="keyword">return</span> v9;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>换表base64，又多了一些额外的加减逻辑，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">custom_base64_table = <span class="string">&quot;GLp/+Wn7uqX8FQ2JDR1c0M6U53sjBwyxglmrCVdSThAfEOvPHaYZNzo4ktK9iebI&quot;</span></span><br><span class="line">reverse_table = &#123;char: index <span class="keyword">for</span> index, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(custom_base64_table)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_transform</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="keyword">if</span> value - <span class="number">24</span> &gt;= <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> value - <span class="number">24</span></span><br><span class="line">    <span class="keyword">elif</span> value + <span class="number">40</span> &lt;= <span class="number">0x40</span>:</span><br><span class="line">        <span class="keyword">return</span> value + <span class="number">40</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> value + <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_base64_decode</span>(<span class="params">encoded_str</span>):</span><br><span class="line">    six_bit_blocks = []</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> encoded_str:</span><br><span class="line">        <span class="keyword">if</span> char == <span class="string">&#x27;=&#x27;</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        mapped_index = reverse_table[char]</span><br><span class="line">        original_index = reverse_transform(mapped_index)</span><br><span class="line">        six_bit_blocks.append(original_index)</span><br><span class="line"></span><br><span class="line">    decoded_bytes = <span class="built_in">bytearray</span>()</span><br><span class="line">    buffer = <span class="number">0</span></span><br><span class="line">    bits_left = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> six_bit_blocks:</span><br><span class="line">        buffer = (buffer &lt;&lt; <span class="number">6</span>) | block</span><br><span class="line">        bits_left += <span class="number">6</span></span><br><span class="line">        <span class="keyword">if</span> bits_left &gt;= <span class="number">8</span>:</span><br><span class="line">            decoded_bytes.append((buffer &gt;&gt; (bits_left - <span class="number">8</span>)) &amp; <span class="number">0xFF</span>)</span><br><span class="line">            bits_left -= <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(decoded_bytes)</span><br><span class="line"></span><br><span class="line">encoded_str = <span class="string">&quot;AwLdOEVEhIWtajB2CbCWCbTRVsFFC8hirfiXC9gWH9HQayCJVbB8CIF=&quot;</span></span><br><span class="line">decoded_data = custom_base64_decode(encoded_str)</span><br><span class="line"><span class="built_in">print</span>(decoded_data)</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>HZNUCTF{ad162c-2d94-434d-9222-b65dc76a32}</strong></font>.</p>
<h2 id="水果忍者："><a href="#水果忍者：" class="headerlink" title="水果忍者："></a>水果忍者：</h2><p>是unity引擎游戏，用dnspy打开assembly-csharp.dll，在gamemanager找到：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Token: 0x04000015 RID: 21</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> encryptionKey = <span class="string">&quot;HZNUHZNUHZNUHZNU&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Token: 0x04000016 RID: 22</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> iv = <span class="string">&quot;0202005503081501&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Token: 0x04000017 RID: 23</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">readonly</span> <span class="built_in">string</span> encryptedHexData = <span class="string">&quot;cecadff28e93aa5d6f65128ae33e734d3f47b4b8a050d326c534a732d51b96e2a6a80dca0d5a704a216c2e0c3cc6aaaf&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>AES解密得到<font color=deepskyblue><strong>HZNUCTF{de20-70dd-4e62-b8d0-06e}</strong></font>.</p>
<h2 id="XTEA："><a href="#XTEA：" class="headerlink" title="XTEA："></a>XTEA：</h2><p>查看main：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10[<span class="number">9</span>]; <span class="comment">// [rsp+24h] [rbp+4h] BYREF</span></span><br><span class="line">  <span class="type">void</span> *Block; <span class="comment">// [rsp+48h] [rbp+28h]</span></span><br><span class="line">  <span class="type">void</span> *v12; <span class="comment">// [rsp+68h] [rbp+48h]</span></span><br><span class="line">  <span class="type">int</span> v13[<span class="number">15</span>]; <span class="comment">// [rsp+88h] [rbp+68h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+C4h] [rbp+A4h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+E4h] [rbp+C4h]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [rsp+104h] [rbp+E4h]</span></span><br><span class="line">  <span class="type">int</span> v17; <span class="comment">// [rsp+1D4h] [rbp+1B4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v9;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">66</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_1400113A2</span>((__int64)&amp;unk_1400220A7);</span><br><span class="line">  <span class="built_in">srand</span>(<span class="number">0x7E8u</span>);</span><br><span class="line">  <span class="built_in">checkdebugger</span>(); <span class="comment">//如果有，设置为0x7E9</span></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome to HZNUCTF!!!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Plz input the cipher:\n&quot;</span>);</span><br><span class="line">  v10[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, v10) == <span class="number">1</span> ) <span class="comment">//输入的cipher作为delta</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Plz input the flag:\n&quot;</span>);</span><br><span class="line">    Block = <span class="built_in">malloc</span>(<span class="number">0x21u</span>i64);</span><br><span class="line">    v12 = <span class="built_in">malloc</span>(<span class="number">0x10u</span>i64);</span><br><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">const</span> <span class="type">char</span> *)Block) == <span class="number">1</span> ) <span class="comment">//输入flag</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j += <span class="number">4</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v17 = *((<span class="type">char</span> *)Block + j + <span class="number">3</span>) | (*((<span class="type">char</span> *)Block + j + <span class="number">2</span>) &lt;&lt; <span class="number">8</span>) | (*((<span class="type">char</span> *)Block + j + <span class="number">1</span>) &lt;&lt; <span class="number">16</span>) | (*((<span class="type">char</span> *)Block + j) &lt;&lt; <span class="number">24</span>); <span class="comment">//大端序</span></span><br><span class="line">        v13[j / <span class="number">4</span>] = v17;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">keygen</span>((__int64)v12); <span class="comment">//密钥是随机数</span></span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">7</span>; ++k ) <span class="comment">// 循环加密</span></span><br><span class="line">        <span class="built_in">XTEA</span>((<span class="type">unsigned</span> <span class="type">int</span>)v10[<span class="number">0</span>], &amp;v13[k], &amp;v13[k + <span class="number">1</span>], v12);</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">8</span>; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v13[m] != cipher[m] )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;wrong_wrong!!!&quot;</span>);</span><br><span class="line">          <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Congratulation!!!&quot;</span>);</span><br><span class="line">      <span class="built_in">free</span>(Block);</span><br><span class="line">      <span class="built_in">free</span>(v12);</span><br><span class="line">      v5 = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Invalid input.\n&quot;</span>);</span><br><span class="line">      <span class="built_in">free</span>(Block);</span><br><span class="line">      <span class="built_in">free</span>(v12);</span><br><span class="line">      v5 = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Invalid input.\n&quot;</span>);</span><br><span class="line">    v5 = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = v5;</span><br><span class="line">  <span class="built_in">sub_14001133E</span>(v8, &amp;unk_14001AD40);</span><br><span class="line">  <span class="keyword">return</span> v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现有一个原版大端序XTEA加密，其中delta要自己输入，cipher根据rand生成，动态调试绕过debugger得到密钥<font color=lime><strong>[6648,4542,2449,13336]</strong></font>，猜测delta还是<code>0x9E3779B9</code>，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">dwordenc, dwordkey, delta</span>):</span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(dwordenc) - <span class="number">1</span>):</span><br><span class="line">        m1 = dwordenc[j]</span><br><span class="line">        m2 = dwordenc[j + <span class="number">1</span>]</span><br><span class="line">        ttl = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">            m1 = (m1 + ((dwordkey[ttl &amp; <span class="number">3</span>] + ttl) ^ (m2 + ((m2 &gt;&gt; <span class="number">5</span>) ^ (m2 &lt;&lt; <span class="number">4</span>))))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            m2 = (m2 + ((dwordkey[(ttl &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + ttl) ^ (m1 + ((m1 &gt;&gt; <span class="number">5</span>) ^ (m1 &lt;&lt; <span class="number">4</span>))))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            <span class="comment"># print(hex(m1), hex(m2))</span></span><br><span class="line">        dwordenc[j] = m1</span><br><span class="line">        dwordenc[j + <span class="number">1</span>] = m2</span><br><span class="line">    <span class="keyword">return</span> dwordenc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">dwordenc, dwordkey, delta</span>):</span><br><span class="line">    rounds = <span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordenc) - <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        m1 = dwordenc[j]</span><br><span class="line">        m2 = dwordenc[j + <span class="number">1</span>]</span><br><span class="line">        ttl = (-delta * rounds) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">            m2 = (m2 - ((dwordkey[(ttl &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + ttl) ^ (m1 + ((m1 &gt;&gt; <span class="number">5</span>) ^ (m1 &lt;&lt; <span class="number">4</span>))))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            ttl = (ttl + delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            m1 = (m1 - ((dwordkey[ttl &amp; <span class="number">3</span>] + ttl) ^ (m2 + ((m2 &gt;&gt; <span class="number">5</span>) ^ (m2 &lt;&lt; <span class="number">4</span>))))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        dwordenc[j] = m1</span><br><span class="line">        dwordenc[j + <span class="number">1</span>] = m2</span><br><span class="line">    <span class="keyword">return</span> dwordenc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试加密</span></span><br><span class="line">key = [<span class="number">0x19F8</span>, <span class="number">0x11BE</span>, <span class="number">0x991</span>, <span class="number">0x3418</span>]</span><br><span class="line">m = [<span class="number">0x31323334</span>, <span class="number">0x35363738</span>, <span class="number">0x31323334</span>, <span class="number">0x35363738</span>]</span><br><span class="line">delta = <span class="number">12345678</span></span><br><span class="line">n = encrypt(m, key, delta)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(n[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">c = decrypt(n, key, delta)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(c[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">enc = [<span class="number">0x8CCB2324</span>, <span class="number">0x09A7741A</span>, <span class="number">0xFB3C678D</span>, <span class="number">0xF6083A79</span>, </span><br><span class="line">       <span class="number">0xF1CC241B</span>, <span class="number">0x39FA59F2</span>, <span class="number">0xF2ABE1CC</span>, <span class="number">0x17189F72</span>]</span><br><span class="line">delta = <span class="number">0x9E3779B9</span></span><br><span class="line">flag = decrypt(enc, key, delta)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(flag[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>输出：<font color=LimeGreen><strong>0x485a4e55, 0x4354467b, 0x6165362d, 0x39663537, 0x2d346237, 0x342d6234, 0x32332d39, 0x3865627d</strong></font></p>
<p><font color=deepskyblue><strong>HZNUCTF{ae6-9f57-4b74-b423-98eb}</strong></font>.</p>
<h2 id="蛇年的本命语言："><a href="#蛇年的本命语言：" class="headerlink" title="蛇年的本命语言："></a>蛇年的本命语言：</h2><p>Python解包反编译：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Welcome to HZNUCTF!!!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Plz input the flag:&#x27;</span>)</span><br><span class="line">inp = <span class="built_in">input</span>()</span><br><span class="line">cinp = Counter(inp)</span><br><span class="line">o1 = <span class="string">&#x27;&#x27;</span>.join((<span class="keyword">lambda</span> <span class="number">.0</span>: <span class="keyword">for</span> oidx <span class="keyword">in</span> <span class="number">.0</span>:</span><br><span class="line">                 <span class="built_in">str</span>(cinp[oidx]))(inp))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;ans1: &#x27;</span>, <span class="string">&#x27;&#x27;</span>, **(<span class="string">&#x27;end&#x27;</span>,))</span><br><span class="line"><span class="built_in">print</span>(o1)</span><br><span class="line"><span class="keyword">if</span> o1 != <span class="string">&#x27;111111116257645365477364777645752361&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;wrong_wrong!!!&#x27;</span>)</span><br><span class="line">    exit(<span class="number">1</span>)</span><br><span class="line">i1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> oidx <span class="keyword">in</span> inp:</span><br><span class="line">    <span class="keyword">if</span> cinp[oidx] &gt; <span class="number">0</span>:</span><br><span class="line">        i1 += oidx + <span class="built_in">str</span>(cinp[oidx])</span><br><span class="line">        cinp[oidx] = <span class="number">0</span></span><br><span class="line">i2 = (<span class="keyword">lambda</span> <span class="number">.0</span>: [<span class="built_in">ord</span>(oidx) <span class="keyword">for</span> oidx <span class="keyword">in</span> <span class="number">.0</span>])(i1)</span><br><span class="line">im = [</span><br><span class="line">    <span class="number">7</span> * i2[<span class="number">0</span>] == <span class="number">504</span>,</span><br><span class="line">    <span class="number">9</span> * i2[<span class="number">0</span>] - <span class="number">5</span> * i2[<span class="number">1</span>] == <span class="number">403</span>,</span><br><span class="line">    (<span class="number">2</span> * i2[<span class="number">0</span>] - <span class="number">5</span> * i2[<span class="number">1</span>]) + <span class="number">10</span> * i2[<span class="number">2</span>] == <span class="number">799</span>,</span><br><span class="line">    <span class="number">3</span> * i2[<span class="number">0</span>] + <span class="number">8</span> * i2[<span class="number">1</span>] + <span class="number">15</span> * i2[<span class="number">2</span>] + <span class="number">20</span> * i2[<span class="number">3</span>] == <span class="number">2938</span>,</span><br><span class="line">    (<span class="number">5</span> * i2[<span class="number">0</span>] + <span class="number">15</span> * i2[<span class="number">1</span>] + <span class="number">20</span> * i2[<span class="number">2</span>] - <span class="number">19</span> * i2[<span class="number">3</span>]) + <span class="number">1</span> * i2[<span class="number">4</span>] == <span class="number">2042</span>,</span><br><span class="line">    (<span class="number">7</span> * i2[<span class="number">0</span>] + <span class="number">1</span> * i2[<span class="number">1</span>] + <span class="number">9</span> * i2[<span class="number">2</span>] - <span class="number">11</span> * i2[<span class="number">3</span>]) + <span class="number">2</span> * i2[<span class="number">4</span>] + <span class="number">5</span> * i2[<span class="number">5</span>] == <span class="number">1225</span>,</span><br><span class="line">    <span class="number">11</span> * i2[<span class="number">0</span>] + <span class="number">22</span> * i2[<span class="number">1</span>] + <span class="number">33</span> * i2[<span class="number">2</span>] + <span class="number">44</span> * i2[<span class="number">3</span>] + <span class="number">55</span> * i2[<span class="number">4</span>] + <span class="number">66</span> * i2[<span class="number">5</span>] - <span class="number">77</span> * i2[<span class="number">6</span>] == <span class="number">7975</span>,</span><br><span class="line">    ((<span class="number">21</span> * i2[<span class="number">0</span>] + <span class="number">23</span> * i2[<span class="number">1</span>] + <span class="number">3</span> * i2[<span class="number">2</span>] + <span class="number">24</span> * i2[<span class="number">3</span>] - <span class="number">55</span> * i2[<span class="number">4</span>]) + <span class="number">6</span> * i2[<span class="number">5</span>] - <span class="number">7</span> * i2[<span class="number">6</span>]) + <span class="number">15</span> * i2[<span class="number">7</span>] == <span class="number">229</span>,</span><br><span class="line">    (<span class="number">2</span> * i2[<span class="number">0</span>] + <span class="number">26</span> * i2[<span class="number">1</span>] + <span class="number">13</span> * i2[<span class="number">2</span>] + <span class="number">0</span> * i2[<span class="number">3</span>] - <span class="number">65</span> * i2[<span class="number">4</span>]) + <span class="number">15</span> * i2[<span class="number">5</span>] + <span class="number">29</span> * i2[<span class="number">6</span>] + <span class="number">1</span> * i2[<span class="number">7</span>] + <span class="number">20</span> * i2[<span class="number">8</span>] == <span class="number">2107</span>,</span><br><span class="line">    (<span class="number">10</span> * i2[<span class="number">0</span>] + <span class="number">7</span> * i2[<span class="number">1</span>] + -<span class="number">9</span> * i2[<span class="number">2</span>] + <span class="number">6</span> * i2[<span class="number">3</span>] + <span class="number">7</span> * i2[<span class="number">4</span>] + <span class="number">1</span> * i2[<span class="number">5</span>] + <span class="number">22</span> * i2[<span class="number">6</span>] + <span class="number">21</span> * i2[<span class="number">7</span>] - <span class="number">22</span> * i2[<span class="number">8</span>]) + <span class="number">30</span> * i2[<span class="number">9</span>] == <span class="number">4037</span>,</span><br><span class="line">    (<span class="number">15</span> * i2[<span class="number">0</span>] + <span class="number">59</span> * i2[<span class="number">1</span>] + <span class="number">56</span> * i2[<span class="number">2</span>] + <span class="number">66</span> * i2[<span class="number">3</span>] + <span class="number">7</span> * i2[<span class="number">4</span>] + <span class="number">1</span> * i2[<span class="number">5</span>] - <span class="number">122</span> * i2[<span class="number">6</span>]) + <span class="number">21</span> * i2[<span class="number">7</span>] + <span class="number">32</span> * i2[<span class="number">8</span>] + <span class="number">3</span> * i2[<span class="number">9</span>] - <span class="number">10</span> * i2[<span class="number">10</span>] == <span class="number">4950</span>,</span><br><span class="line">    (((<span class="number">13</span> * i2[<span class="number">0</span>] + <span class="number">66</span> * i2[<span class="number">1</span>] + <span class="number">29</span> * i2[<span class="number">2</span>] + <span class="number">39</span> * i2[<span class="number">3</span>] - <span class="number">33</span> * i2[<span class="number">4</span>]) + <span class="number">13</span> * i2[<span class="number">5</span>] - <span class="number">2</span> * i2[<span class="number">6</span>]) + <span class="number">42</span> * i2[<span class="number">7</span>] + <span class="number">62</span> * i2[<span class="number">8</span>] + <span class="number">1</span> * i2[<span class="number">9</span>] - <span class="number">10</span> * i2[<span class="number">10</span>]) + <span class="number">11</span> * i2[<span class="number">11</span>] == <span class="number">12544</span>,</span><br><span class="line">    (((<span class="number">23</span> * i2[<span class="number">0</span>] + <span class="number">6</span> * i2[<span class="number">1</span>] + <span class="number">29</span> * i2[<span class="number">2</span>] + <span class="number">3</span> * i2[<span class="number">3</span>] - <span class="number">3</span> * i2[<span class="number">4</span>]) + <span class="number">63</span> * i2[<span class="number">5</span>] - <span class="number">25</span> * i2[<span class="number">6</span>]) + <span class="number">2</span> * i2[<span class="number">7</span>] + <span class="number">32</span> * i2[<span class="number">8</span>] + <span class="number">1</span> * i2[<span class="number">9</span>] - <span class="number">10</span> * i2[<span class="number">10</span>]) + <span class="number">11</span> * i2[<span class="number">11</span>] - <span class="number">12</span> * i2[<span class="number">12</span>] == <span class="number">6585</span>,</span><br><span class="line">    ((((<span class="number">223</span> * i2[<span class="number">0</span>] + <span class="number">6</span> * i2[<span class="number">1</span>] - <span class="number">29</span> * i2[<span class="number">2</span>] - <span class="number">53</span> * i2[<span class="number">3</span>] - <span class="number">3</span> * i2[<span class="number">4</span>]) + <span class="number">3</span> * i2[<span class="number">5</span>] - <span class="number">65</span> * i2[<span class="number">6</span>]) + <span class="number">0</span> * i2[<span class="number">7</span>] + <span class="number">36</span> * i2[<span class="number">8</span>] + <span class="number">1</span> * i2[<span class="number">9</span>] - <span class="number">15</span> * i2[<span class="number">10</span>]) + <span class="number">16</span> * i2[<span class="number">11</span>] - <span class="number">18</span> * i2[<span class="number">12</span>]) + <span class="number">13</span> * i2[<span class="number">13</span>] == <span class="number">6893</span>,</span><br><span class="line">    ((((<span class="number">29</span> * i2[<span class="number">0</span>] + <span class="number">13</span> * i2[<span class="number">1</span>] - <span class="number">9</span> * i2[<span class="number">2</span>] - <span class="number">93</span> * i2[<span class="number">3</span>]) + <span class="number">33</span> * i2[<span class="number">4</span>] + <span class="number">6</span> * i2[<span class="number">5</span>] + <span class="number">65</span> * i2[<span class="number">6</span>] + <span class="number">1</span> * i2[<span class="number">7</span>] - <span class="number">36</span> * i2[<span class="number">8</span>]) + <span class="number">0</span> * i2[<span class="number">9</span>] - <span class="number">16</span> * i2[<span class="number">10</span>]) + <span class="number">96</span> * i2[<span class="number">11</span>] - <span class="number">68</span> * i2[<span class="number">12</span>]) + <span class="number">33</span> * i2[<span class="number">13</span>] - <span class="number">14</span> * i2[<span class="number">14</span>] == <span class="number">1883</span>,</span><br><span class="line">    (((<span class="number">69</span> * i2[<span class="number">0</span>] + <span class="number">77</span> * i2[<span class="number">1</span>] - <span class="number">93</span> * i2[<span class="number">2</span>] - <span class="number">12</span> * i2[<span class="number">3</span>]) + <span class="number">0</span> * i2[<span class="number">4</span>] + <span class="number">0</span> * i2[<span class="number">5</span>] + <span class="number">1</span> * i2[<span class="number">6</span>] + <span class="number">16</span> * i2[<span class="number">7</span>] + <span class="number">36</span> * i2[<span class="number">8</span>] + <span class="number">6</span> * i2[<span class="number">9</span>] + <span class="number">19</span> * i2[<span class="number">10</span>] + <span class="number">66</span> * i2[<span class="number">11</span>] - <span class="number">8</span> * i2[<span class="number">12</span>]) + <span class="number">38</span> * i2[<span class="number">13</span>] - <span class="number">16</span> * i2[<span class="number">14</span>]) + <span class="number">15</span> * i2[<span class="number">15</span>] == <span class="number">8257</span>,</span><br><span class="line">    ((((<span class="number">23</span> * i2[<span class="number">0</span>] + <span class="number">2</span> * i2[<span class="number">1</span>] - <span class="number">3</span> * i2[<span class="number">2</span>] - <span class="number">11</span> * i2[<span class="number">3</span>]) + <span class="number">12</span> * i2[<span class="number">4</span>] + <span class="number">24</span> * i2[<span class="number">5</span>] + <span class="number">1</span> * i2[<span class="number">6</span>] + <span class="number">6</span> * i2[<span class="number">7</span>] + <span class="number">14</span> * i2[<span class="number">8</span>] - <span class="number">0</span> * i2[<span class="number">9</span>]) + <span class="number">1</span> * i2[<span class="number">10</span>] + <span class="number">68</span> * i2[<span class="number">11</span>] - <span class="number">18</span> * i2[<span class="number">12</span>]) + <span class="number">68</span> * i2[<span class="number">13</span>] - <span class="number">26</span> * i2[<span class="number">14</span>]) + <span class="number">15</span> * i2[<span class="number">15</span>] - <span class="number">16</span> * i2[<span class="number">16</span>] == <span class="number">5847</span>,</span><br><span class="line">    (((((<span class="number">24</span> * i2[<span class="number">0</span>] + <span class="number">0</span> * i2[<span class="number">1</span>] - <span class="number">1</span> * i2[<span class="number">2</span>] - <span class="number">15</span> * i2[<span class="number">3</span>]) + <span class="number">13</span> * i2[<span class="number">4</span>] + <span class="number">4</span> * i2[<span class="number">5</span>] + <span class="number">16</span> * i2[<span class="number">6</span>] + <span class="number">67</span> * i2[<span class="number">7</span>] + <span class="number">146</span> * i2[<span class="number">8</span>] - <span class="number">50</span> * i2[<span class="number">9</span>]) + <span class="number">16</span> * i2[<span class="number">10</span>] + <span class="number">6</span> * i2[<span class="number">11</span>] - <span class="number">1</span> * i2[<span class="number">12</span>]) + <span class="number">69</span> * i2[<span class="number">13</span>] - <span class="number">27</span> * i2[<span class="number">14</span>]) + <span class="number">45</span> * i2[<span class="number">15</span>] - <span class="number">6</span> * i2[<span class="number">16</span>]) + <span class="number">17</span> * i2[<span class="number">17</span>] == <span class="number">18257</span>,</span><br><span class="line">    ((((<span class="number">25</span> * i2[<span class="number">0</span>] + <span class="number">26</span> * i2[<span class="number">1</span>] - <span class="number">89</span> * i2[<span class="number">2</span>]) + <span class="number">16</span> * i2[<span class="number">3</span>] + <span class="number">19</span> * i2[<span class="number">4</span>] + <span class="number">44</span> * i2[<span class="number">5</span>] + <span class="number">36</span> * i2[<span class="number">6</span>] + <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">150</span> * i2[<span class="number">8</span>] - <span class="number">250</span> * i2[<span class="number">9</span>]) + <span class="number">166</span> * i2[<span class="number">10</span>] + <span class="number">126</span> * i2[<span class="number">11</span>] - <span class="number">11</span> * i2[<span class="number">12</span>]) + <span class="number">690</span> * i2[<span class="number">13</span>] - <span class="number">207</span> * i2[<span class="number">14</span>]) + <span class="number">46</span> * i2[<span class="number">15</span>] + <span class="number">6</span> * i2[<span class="number">16</span>] + <span class="number">7</span> * i2[<span class="number">17</span>] - <span class="number">18</span> * i2[<span class="number">18</span>] == <span class="number">12591</span>,</span><br><span class="line">    (((((<span class="number">5</span> * i2[<span class="number">0</span>] + <span class="number">26</span> * i2[<span class="number">1</span>] + <span class="number">8</span> * i2[<span class="number">2</span>] + <span class="number">160</span> * i2[<span class="number">3</span>] + <span class="number">9</span> * i2[<span class="number">4</span>] - <span class="number">4</span> * i2[<span class="number">5</span>]) + <span class="number">36</span> * i2[<span class="number">6</span>] + <span class="number">6</span> * i2[<span class="number">7</span>] - <span class="number">15</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">66</span> * i2[<span class="number">10</span>] + <span class="number">16</span> * i2[<span class="number">11</span>] - <span class="number">1</span> * i2[<span class="number">12</span>]) + <span class="number">690</span> * i2[<span class="number">13</span>] - <span class="number">20</span> * i2[<span class="number">14</span>]) + <span class="number">46</span> * i2[<span class="number">15</span>] + <span class="number">6</span> * i2[<span class="number">16</span>] + <span class="number">7</span> * i2[<span class="number">17</span>] - <span class="number">18</span> * i2[<span class="number">18</span>]) + <span class="number">19</span> * i2[<span class="number">19</span>] == <span class="number">52041</span>,</span><br><span class="line">    ((((((<span class="number">29</span> * i2[<span class="number">0</span>] - <span class="number">26</span> * i2[<span class="number">1</span>]) + <span class="number">0</span> * i2[<span class="number">2</span>] + <span class="number">60</span> * i2[<span class="number">3</span>] + <span class="number">90</span> * i2[<span class="number">4</span>] - <span class="number">4</span> * i2[<span class="number">5</span>]) + <span class="number">6</span> * i2[<span class="number">6</span>] + <span class="number">6</span> * i2[<span class="number">7</span>] - <span class="number">16</span> * i2[<span class="number">8</span>] - <span class="number">21</span> * i2[<span class="number">9</span>]) + <span class="number">69</span> * i2[<span class="number">10</span>] + <span class="number">6</span> * i2[<span class="number">11</span>] - <span class="number">12</span> * i2[<span class="number">12</span>]) + <span class="number">69</span> * i2[<span class="number">13</span>] - <span class="number">20</span> * i2[<span class="number">14</span>] - <span class="number">46</span> * i2[<span class="number">15</span>]) + <span class="number">65</span> * i2[<span class="number">16</span>] + <span class="number">0</span> * i2[<span class="number">17</span>] - <span class="number">1</span> * i2[<span class="number">18</span>]) + <span class="number">39</span> * i2[<span class="number">19</span>] - <span class="number">20</span> * i2[<span class="number">20</span>] == <span class="number">20253</span>,</span><br><span class="line">    (((((((<span class="number">45</span> * i2[<span class="number">0</span>] - <span class="number">56</span> * i2[<span class="number">1</span>]) + <span class="number">10</span> * i2[<span class="number">2</span>] + <span class="number">650</span> * i2[<span class="number">3</span>] - <span class="number">900</span> * i2[<span class="number">4</span>]) + <span class="number">44</span> * i2[<span class="number">5</span>] + <span class="number">66</span> * i2[<span class="number">6</span>] - <span class="number">6</span> * i2[<span class="number">7</span>] - <span class="number">6</span> * i2[<span class="number">8</span>] - <span class="number">21</span> * i2[<span class="number">9</span>]) + <span class="number">9</span> * i2[<span class="number">10</span>] - <span class="number">6</span> * i2[<span class="number">11</span>] - <span class="number">12</span> * i2[<span class="number">12</span>]) + <span class="number">69</span> * i2[<span class="number">13</span>] - <span class="number">2</span> * i2[<span class="number">14</span>] - <span class="number">406</span> * i2[<span class="number">15</span>]) + <span class="number">651</span> * i2[<span class="number">16</span>] + <span class="number">2</span> * i2[<span class="number">17</span>] - <span class="number">10</span> * i2[<span class="number">18</span>]) + <span class="number">69</span> * i2[<span class="number">19</span>] - <span class="number">0</span> * i2[<span class="number">20</span>]) + <span class="number">21</span> * i2[<span class="number">21</span>] == <span class="number">18768</span>,</span><br><span class="line">    (((((<span class="number">555</span> * i2[<span class="number">0</span>] - <span class="number">6666</span> * i2[<span class="number">1</span>]) + <span class="number">70</span> * i2[<span class="number">2</span>] + <span class="number">510</span> * i2[<span class="number">3</span>] - <span class="number">90</span> * i2[<span class="number">4</span>]) + <span class="number">499</span> * i2[<span class="number">5</span>] + <span class="number">66</span> * i2[<span class="number">6</span>] - <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">610</span> * i2[<span class="number">8</span>] - <span class="number">221</span> * i2[<span class="number">9</span>]) + <span class="number">9</span> * i2[<span class="number">10</span>] - <span class="number">23</span> * i2[<span class="number">11</span>] - <span class="number">102</span> * i2[<span class="number">12</span>]) + <span class="number">6</span> * i2[<span class="number">13</span>] + <span class="number">2050</span> * i2[<span class="number">14</span>] - <span class="number">406</span> * i2[<span class="number">15</span>]) + <span class="number">665</span> * i2[<span class="number">16</span>] + <span class="number">333</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">777</span> * i2[<span class="number">20</span>] + <span class="number">201</span> * i2[<span class="number">21</span>] - <span class="number">22</span> * i2[<span class="number">22</span>] == <span class="number">111844</span>,</span><br><span class="line">    (((((((<span class="number">1</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">333</span> * i2[<span class="number">2</span>] + <span class="number">4444</span> * i2[<span class="number">3</span>] - <span class="number">5555</span> * i2[<span class="number">4</span>]) + <span class="number">6666</span> * i2[<span class="number">5</span>] - <span class="number">666</span> * i2[<span class="number">6</span>]) + <span class="number">676</span> * i2[<span class="number">7</span>] - <span class="number">660</span> * i2[<span class="number">8</span>] - <span class="number">22</span> * i2[<span class="number">9</span>]) + <span class="number">9</span> * i2[<span class="number">10</span>] - <span class="number">73</span> * i2[<span class="number">11</span>] - <span class="number">107</span> * i2[<span class="number">12</span>]) + <span class="number">6</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] - <span class="number">6</span> * i2[<span class="number">15</span>]) + <span class="number">65</span> * i2[<span class="number">16</span>] + <span class="number">39</span> * i2[<span class="number">17</span>] + <span class="number">10</span> * i2[<span class="number">18</span>] + <span class="number">69</span> * i2[<span class="number">19</span>] + <span class="number">777</span> * i2[<span class="number">20</span>] + <span class="number">201</span> * i2[<span class="number">21</span>] - <span class="number">2</span> * i2[<span class="number">22</span>]) + <span class="number">23</span> * i2[<span class="number">23</span>] == <span class="number">159029</span>,</span><br><span class="line">    (((<span class="number">520</span> * i2[<span class="number">0</span>] - <span class="number">222</span> * i2[<span class="number">1</span>]) + <span class="number">333</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">56655</span> * i2[<span class="number">4</span>]) + <span class="number">6666</span> * i2[<span class="number">5</span>] + <span class="number">666</span> * i2[<span class="number">6</span>] + <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">220</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">73</span> * i2[<span class="number">11</span>] + <span class="number">1007</span> * i2[<span class="number">12</span>] + <span class="number">7777</span> * i2[<span class="number">13</span>] + <span class="number">2500</span> * i2[<span class="number">14</span>] + <span class="number">6666</span> * i2[<span class="number">15</span>] + <span class="number">605</span> * i2[<span class="number">16</span>] + <span class="number">390</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">99999</span> * i2[<span class="number">20</span>] + <span class="number">210</span> * i2[<span class="number">21</span>] + <span class="number">232</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>] == <span class="number">2762025</span>,</span><br><span class="line">    ((((<span class="number">1323</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">333</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">55</span> * i2[<span class="number">4</span>]) + <span class="number">666</span> * i2[<span class="number">5</span>] + <span class="number">666</span> * i2[<span class="number">6</span>] + <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">660</span> * i2[<span class="number">8</span>] - <span class="number">220</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">100</span> * i2[<span class="number">12</span>] + <span class="number">777</span> * i2[<span class="number">13</span>] + <span class="number">2500</span> * i2[<span class="number">14</span>] + <span class="number">6666</span> * i2[<span class="number">15</span>] + <span class="number">605</span> * i2[<span class="number">16</span>] + <span class="number">390</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">9999</span> * i2[<span class="number">20</span>] + <span class="number">210</span> * i2[<span class="number">21</span>] + <span class="number">232</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] == <span class="number">1551621</span>,</span><br><span class="line">    (((((<span class="number">777</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">6969</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">55</span> * i2[<span class="number">4</span>]) + <span class="number">666</span> * i2[<span class="number">5</span>] - <span class="number">6</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">220</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">100</span> * i2[<span class="number">12</span>] + <span class="number">777</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + <span class="number">65</span> * i2[<span class="number">16</span>] + <span class="number">90</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">999</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">232</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] - <span class="number">26</span> * i2[<span class="number">26</span>] == <span class="number">948348</span>,</span><br><span class="line">    ((((((<span class="number">97</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">6969</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">56</span> * i2[<span class="number">4</span>]) + <span class="number">96</span> * i2[<span class="number">5</span>] - <span class="number">6</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">10</span> * i2[<span class="number">12</span>] + <span class="number">707</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + -<span class="number">9</span> * i2[<span class="number">16</span>] + <span class="number">90</span> * i2[<span class="number">17</span>] + -<span class="number">2</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">0</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">2</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] - <span class="number">26</span> * i2[<span class="number">26</span>]) + <span class="number">27</span> * i2[<span class="number">27</span>] == <span class="number">777044</span>,</span><br><span class="line">    (((((<span class="number">177</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">699</span> * i2[<span class="number">2</span>] + <span class="number">64</span> * i2[<span class="number">3</span>] - <span class="number">56</span> * i2[<span class="number">4</span>] - <span class="number">96</span> * i2[<span class="number">5</span>] - <span class="number">66</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">10</span> * i2[<span class="number">12</span>] + <span class="number">707</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + -<span class="number">9</span> * i2[<span class="number">16</span>] + <span class="number">0</span> * i2[<span class="number">17</span>] + -<span class="number">2</span> * i2[<span class="number">18</span>] + <span class="number">69</span> * i2[<span class="number">19</span>] + <span class="number">0</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">222</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">224</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] - <span class="number">26</span> * i2[<span class="number">26</span>]) + <span class="number">27</span> * i2[<span class="number">27</span>] - <span class="number">28</span> * i2[<span class="number">28</span>] == <span class="number">185016</span>,</span><br><span class="line">    ((((((<span class="number">77</span> * i2[<span class="number">0</span>] - <span class="number">2</span> * i2[<span class="number">1</span>]) + <span class="number">6</span> * i2[<span class="number">2</span>] + <span class="number">6</span> * i2[<span class="number">3</span>] - <span class="number">96</span> * i2[<span class="number">4</span>] - <span class="number">9</span> * i2[<span class="number">5</span>] - <span class="number">6</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">0</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">10</span> * i2[<span class="number">12</span>] + <span class="number">707</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + -<span class="number">9</span> * i2[<span class="number">16</span>] + <span class="number">0</span> * i2[<span class="number">17</span>] + -<span class="number">2</span> * i2[<span class="number">18</span>] + <span class="number">9</span> * i2[<span class="number">19</span>] + <span class="number">0</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">222</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">224</span> * i2[<span class="number">24</span>]) + <span class="number">26</span> * i2[<span class="number">25</span>] - -<span class="number">58</span> * i2[<span class="number">26</span>]) + <span class="number">27</span> * i2[<span class="number">27</span>] - <span class="number">2</span> * i2[<span class="number">28</span>]) + <span class="number">29</span> * i2[<span class="number">29</span>] == <span class="number">130106</span>]</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">all</span>(im):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Congratulation!!!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;wrong_wrong!!!&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>先用z3一把梭掉后面的矩阵：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line">i2 = [Int(<span class="string">f&#x27;i2_<span class="subst">&#123;i&#125;</span>&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30</span>)]</span><br><span class="line">solver = Solver()</span><br><span class="line">im = [</span><br><span class="line">    <span class="number">7</span> * i2[<span class="number">0</span>] == <span class="number">504</span>,</span><br><span class="line">    <span class="number">9</span> * i2[<span class="number">0</span>] - <span class="number">5</span> * i2[<span class="number">1</span>] == <span class="number">403</span>,</span><br><span class="line">    (<span class="number">2</span> * i2[<span class="number">0</span>] - <span class="number">5</span> * i2[<span class="number">1</span>]) + <span class="number">10</span> * i2[<span class="number">2</span>] == <span class="number">799</span>,</span><br><span class="line">    <span class="number">3</span> * i2[<span class="number">0</span>] + <span class="number">8</span> * i2[<span class="number">1</span>] + <span class="number">15</span> * i2[<span class="number">2</span>] + <span class="number">20</span> * i2[<span class="number">3</span>] == <span class="number">2938</span>,</span><br><span class="line">    (<span class="number">5</span> * i2[<span class="number">0</span>] + <span class="number">15</span> * i2[<span class="number">1</span>] + <span class="number">20</span> * i2[<span class="number">2</span>] - <span class="number">19</span> * i2[<span class="number">3</span>]) + <span class="number">1</span> * i2[<span class="number">4</span>] == <span class="number">2042</span>,</span><br><span class="line">    (<span class="number">7</span> * i2[<span class="number">0</span>] + <span class="number">1</span> * i2[<span class="number">1</span>] + <span class="number">9</span> * i2[<span class="number">2</span>] - <span class="number">11</span> * i2[<span class="number">3</span>]) + <span class="number">2</span> * i2[<span class="number">4</span>] + <span class="number">5</span> * i2[<span class="number">5</span>] == <span class="number">1225</span>,</span><br><span class="line">    <span class="number">11</span> * i2[<span class="number">0</span>] + <span class="number">22</span> * i2[<span class="number">1</span>] + <span class="number">33</span> * i2[<span class="number">2</span>] + <span class="number">44</span> * i2[<span class="number">3</span>] + <span class="number">55</span> * i2[<span class="number">4</span>] + <span class="number">66</span> * i2[<span class="number">5</span>] - <span class="number">77</span> * i2[<span class="number">6</span>] == <span class="number">7975</span>,</span><br><span class="line">    ((<span class="number">21</span> * i2[<span class="number">0</span>] + <span class="number">23</span> * i2[<span class="number">1</span>] + <span class="number">3</span> * i2[<span class="number">2</span>] + <span class="number">24</span> * i2[<span class="number">3</span>] - <span class="number">55</span> * i2[<span class="number">4</span>]) + <span class="number">6</span> * i2[<span class="number">5</span>] - <span class="number">7</span> * i2[<span class="number">6</span>]) + <span class="number">15</span> * i2[<span class="number">7</span>] == <span class="number">229</span>,</span><br><span class="line">    (<span class="number">2</span> * i2[<span class="number">0</span>] + <span class="number">26</span> * i2[<span class="number">1</span>] + <span class="number">13</span> * i2[<span class="number">2</span>] + <span class="number">0</span> * i2[<span class="number">3</span>] - <span class="number">65</span> * i2[<span class="number">4</span>]) + <span class="number">15</span> * i2[<span class="number">5</span>] + <span class="number">29</span> * i2[<span class="number">6</span>] + <span class="number">1</span> * i2[<span class="number">7</span>] + <span class="number">20</span> * i2[<span class="number">8</span>] == <span class="number">2107</span>,</span><br><span class="line">    (<span class="number">10</span> * i2[<span class="number">0</span>] + <span class="number">7</span> * i2[<span class="number">1</span>] + -<span class="number">9</span> * i2[<span class="number">2</span>] + <span class="number">6</span> * i2[<span class="number">3</span>] + <span class="number">7</span> * i2[<span class="number">4</span>] + <span class="number">1</span> * i2[<span class="number">5</span>] + <span class="number">22</span> * i2[<span class="number">6</span>] + <span class="number">21</span> * i2[<span class="number">7</span>] - <span class="number">22</span> * i2[<span class="number">8</span>]) + <span class="number">30</span> * i2[<span class="number">9</span>] == <span class="number">4037</span>,</span><br><span class="line">    (<span class="number">15</span> * i2[<span class="number">0</span>] + <span class="number">59</span> * i2[<span class="number">1</span>] + <span class="number">56</span> * i2[<span class="number">2</span>] + <span class="number">66</span> * i2[<span class="number">3</span>] + <span class="number">7</span> * i2[<span class="number">4</span>] + <span class="number">1</span> * i2[<span class="number">5</span>] - <span class="number">122</span> * i2[<span class="number">6</span>]) + <span class="number">21</span> * i2[<span class="number">7</span>] + <span class="number">32</span> * i2[<span class="number">8</span>] + <span class="number">3</span> * i2[<span class="number">9</span>] - <span class="number">10</span> * i2[<span class="number">10</span>] == <span class="number">4950</span>,</span><br><span class="line">    (((<span class="number">13</span> * i2[<span class="number">0</span>] + <span class="number">66</span> * i2[<span class="number">1</span>] + <span class="number">29</span> * i2[<span class="number">2</span>] + <span class="number">39</span> * i2[<span class="number">3</span>] - <span class="number">33</span> * i2[<span class="number">4</span>]) + <span class="number">13</span> * i2[<span class="number">5</span>] - <span class="number">2</span> * i2[<span class="number">6</span>]) + <span class="number">42</span> * i2[<span class="number">7</span>] + <span class="number">62</span> * i2[<span class="number">8</span>] + <span class="number">1</span> * i2[<span class="number">9</span>] - <span class="number">10</span> * i2[<span class="number">10</span>]) + <span class="number">11</span> * i2[<span class="number">11</span>] == <span class="number">12544</span>,</span><br><span class="line">    (((<span class="number">23</span> * i2[<span class="number">0</span>] + <span class="number">6</span> * i2[<span class="number">1</span>] + <span class="number">29</span> * i2[<span class="number">2</span>] + <span class="number">3</span> * i2[<span class="number">3</span>] - <span class="number">3</span> * i2[<span class="number">4</span>]) + <span class="number">63</span> * i2[<span class="number">5</span>] - <span class="number">25</span> * i2[<span class="number">6</span>]) + <span class="number">2</span> * i2[<span class="number">7</span>] + <span class="number">32</span> * i2[<span class="number">8</span>] + <span class="number">1</span> * i2[<span class="number">9</span>] - <span class="number">10</span> * i2[<span class="number">10</span>]) + <span class="number">11</span> * i2[<span class="number">11</span>] - <span class="number">12</span> * i2[<span class="number">12</span>] == <span class="number">6585</span>,</span><br><span class="line">    ((((<span class="number">223</span> * i2[<span class="number">0</span>] + <span class="number">6</span> * i2[<span class="number">1</span>] - <span class="number">29</span> * i2[<span class="number">2</span>] - <span class="number">53</span> * i2[<span class="number">3</span>] - <span class="number">3</span> * i2[<span class="number">4</span>]) + <span class="number">3</span> * i2[<span class="number">5</span>] - <span class="number">65</span> * i2[<span class="number">6</span>]) + <span class="number">0</span> * i2[<span class="number">7</span>] + <span class="number">36</span> * i2[<span class="number">8</span>] + <span class="number">1</span> * i2[<span class="number">9</span>] - <span class="number">15</span> * i2[<span class="number">10</span>]) + <span class="number">16</span> * i2[<span class="number">11</span>] - <span class="number">18</span> * i2[<span class="number">12</span>]) + <span class="number">13</span> * i2[<span class="number">13</span>] == <span class="number">6893</span>,</span><br><span class="line">    ((((<span class="number">29</span> * i2[<span class="number">0</span>] + <span class="number">13</span> * i2[<span class="number">1</span>] - <span class="number">9</span> * i2[<span class="number">2</span>] - <span class="number">93</span> * i2[<span class="number">3</span>]) + <span class="number">33</span> * i2[<span class="number">4</span>] + <span class="number">6</span> * i2[<span class="number">5</span>] + <span class="number">65</span> * i2[<span class="number">6</span>] + <span class="number">1</span> * i2[<span class="number">7</span>] - <span class="number">36</span> * i2[<span class="number">8</span>]) + <span class="number">0</span> * i2[<span class="number">9</span>] - <span class="number">16</span> * i2[<span class="number">10</span>]) + <span class="number">96</span> * i2[<span class="number">11</span>] - <span class="number">68</span> * i2[<span class="number">12</span>]) + <span class="number">33</span> * i2[<span class="number">13</span>] - <span class="number">14</span> * i2[<span class="number">14</span>] == <span class="number">1883</span>,</span><br><span class="line">    (((<span class="number">69</span> * i2[<span class="number">0</span>] + <span class="number">77</span> * i2[<span class="number">1</span>] - <span class="number">93</span> * i2[<span class="number">2</span>] - <span class="number">12</span> * i2[<span class="number">3</span>]) + <span class="number">0</span> * i2[<span class="number">4</span>] + <span class="number">0</span> * i2[<span class="number">5</span>] + <span class="number">1</span> * i2[<span class="number">6</span>] + <span class="number">16</span> * i2[<span class="number">7</span>] + <span class="number">36</span> * i2[<span class="number">8</span>] + <span class="number">6</span> * i2[<span class="number">9</span>] + <span class="number">19</span> * i2[<span class="number">10</span>] + <span class="number">66</span> * i2[<span class="number">11</span>] - <span class="number">8</span> * i2[<span class="number">12</span>]) + <span class="number">38</span> * i2[<span class="number">13</span>] - <span class="number">16</span> * i2[<span class="number">14</span>]) + <span class="number">15</span> * i2[<span class="number">15</span>] == <span class="number">8257</span>,</span><br><span class="line">    ((((<span class="number">23</span> * i2[<span class="number">0</span>] + <span class="number">2</span> * i2[<span class="number">1</span>] - <span class="number">3</span> * i2[<span class="number">2</span>] - <span class="number">11</span> * i2[<span class="number">3</span>]) + <span class="number">12</span> * i2[<span class="number">4</span>] + <span class="number">24</span> * i2[<span class="number">5</span>] + <span class="number">1</span> * i2[<span class="number">6</span>] + <span class="number">6</span> * i2[<span class="number">7</span>] + <span class="number">14</span> * i2[<span class="number">8</span>] - <span class="number">0</span> * i2[<span class="number">9</span>]) + <span class="number">1</span> * i2[<span class="number">10</span>] + <span class="number">68</span> * i2[<span class="number">11</span>] - <span class="number">18</span> * i2[<span class="number">12</span>]) + <span class="number">68</span> * i2[<span class="number">13</span>] - <span class="number">26</span> * i2[<span class="number">14</span>]) + <span class="number">15</span> * i2[<span class="number">15</span>] - <span class="number">16</span> * i2[<span class="number">16</span>] == <span class="number">5847</span>,</span><br><span class="line">    (((((<span class="number">24</span> * i2[<span class="number">0</span>] + <span class="number">0</span> * i2[<span class="number">1</span>] - <span class="number">1</span> * i2[<span class="number">2</span>] - <span class="number">15</span> * i2[<span class="number">3</span>]) + <span class="number">13</span> * i2[<span class="number">4</span>] + <span class="number">4</span> * i2[<span class="number">5</span>] + <span class="number">16</span> * i2[<span class="number">6</span>] + <span class="number">67</span> * i2[<span class="number">7</span>] + <span class="number">146</span> * i2[<span class="number">8</span>] - <span class="number">50</span> * i2[<span class="number">9</span>]) + <span class="number">16</span> * i2[<span class="number">10</span>] + <span class="number">6</span> * i2[<span class="number">11</span>] - <span class="number">1</span> * i2[<span class="number">12</span>]) + <span class="number">69</span> * i2[<span class="number">13</span>] - <span class="number">27</span> * i2[<span class="number">14</span>]) + <span class="number">45</span> * i2[<span class="number">15</span>] - <span class="number">6</span> * i2[<span class="number">16</span>]) + <span class="number">17</span> * i2[<span class="number">17</span>] == <span class="number">18257</span>,</span><br><span class="line">    ((((<span class="number">25</span> * i2[<span class="number">0</span>] + <span class="number">26</span> * i2[<span class="number">1</span>] - <span class="number">89</span> * i2[<span class="number">2</span>]) + <span class="number">16</span> * i2[<span class="number">3</span>] + <span class="number">19</span> * i2[<span class="number">4</span>] + <span class="number">44</span> * i2[<span class="number">5</span>] + <span class="number">36</span> * i2[<span class="number">6</span>] + <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">150</span> * i2[<span class="number">8</span>] - <span class="number">250</span> * i2[<span class="number">9</span>]) + <span class="number">166</span> * i2[<span class="number">10</span>] + <span class="number">126</span> * i2[<span class="number">11</span>] - <span class="number">11</span> * i2[<span class="number">12</span>]) + <span class="number">690</span> * i2[<span class="number">13</span>] - <span class="number">207</span> * i2[<span class="number">14</span>]) + <span class="number">46</span> * i2[<span class="number">15</span>] + <span class="number">6</span> * i2[<span class="number">16</span>] + <span class="number">7</span> * i2[<span class="number">17</span>] - <span class="number">18</span> * i2[<span class="number">18</span>] == <span class="number">12591</span>,</span><br><span class="line">    (((((<span class="number">5</span> * i2[<span class="number">0</span>] + <span class="number">26</span> * i2[<span class="number">1</span>] + <span class="number">8</span> * i2[<span class="number">2</span>] + <span class="number">160</span> * i2[<span class="number">3</span>] + <span class="number">9</span> * i2[<span class="number">4</span>] - <span class="number">4</span> * i2[<span class="number">5</span>]) + <span class="number">36</span> * i2[<span class="number">6</span>] + <span class="number">6</span> * i2[<span class="number">7</span>] - <span class="number">15</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">66</span> * i2[<span class="number">10</span>] + <span class="number">16</span> * i2[<span class="number">11</span>] - <span class="number">1</span> * i2[<span class="number">12</span>]) + <span class="number">690</span> * i2[<span class="number">13</span>] - <span class="number">20</span> * i2[<span class="number">14</span>]) + <span class="number">46</span> * i2[<span class="number">15</span>] + <span class="number">6</span> * i2[<span class="number">16</span>] + <span class="number">7</span> * i2[<span class="number">17</span>] - <span class="number">18</span> * i2[<span class="number">18</span>]) + <span class="number">19</span> * i2[<span class="number">19</span>] == <span class="number">52041</span>,</span><br><span class="line">    ((((((<span class="number">29</span> * i2[<span class="number">0</span>] - <span class="number">26</span> * i2[<span class="number">1</span>]) + <span class="number">0</span> * i2[<span class="number">2</span>] + <span class="number">60</span> * i2[<span class="number">3</span>] + <span class="number">90</span> * i2[<span class="number">4</span>] - <span class="number">4</span> * i2[<span class="number">5</span>]) + <span class="number">6</span> * i2[<span class="number">6</span>] + <span class="number">6</span> * i2[<span class="number">7</span>] - <span class="number">16</span> * i2[<span class="number">8</span>] - <span class="number">21</span> * i2[<span class="number">9</span>]) + <span class="number">69</span> * i2[<span class="number">10</span>] + <span class="number">6</span> * i2[<span class="number">11</span>] - <span class="number">12</span> * i2[<span class="number">12</span>]) + <span class="number">69</span> * i2[<span class="number">13</span>] - <span class="number">20</span> * i2[<span class="number">14</span>] - <span class="number">46</span> * i2[<span class="number">15</span>]) + <span class="number">65</span> * i2[<span class="number">16</span>] + <span class="number">0</span> * i2[<span class="number">17</span>] - <span class="number">1</span> * i2[<span class="number">18</span>]) + <span class="number">39</span> * i2[<span class="number">19</span>] - <span class="number">20</span> * i2[<span class="number">20</span>] == <span class="number">20253</span>,</span><br><span class="line">    (((((((<span class="number">45</span> * i2[<span class="number">0</span>] - <span class="number">56</span> * i2[<span class="number">1</span>]) + <span class="number">10</span> * i2[<span class="number">2</span>] + <span class="number">650</span> * i2[<span class="number">3</span>] - <span class="number">900</span> * i2[<span class="number">4</span>]) + <span class="number">44</span> * i2[<span class="number">5</span>] + <span class="number">66</span> * i2[<span class="number">6</span>] - <span class="number">6</span> * i2[<span class="number">7</span>] - <span class="number">6</span> * i2[<span class="number">8</span>] - <span class="number">21</span> * i2[<span class="number">9</span>]) + <span class="number">9</span> * i2[<span class="number">10</span>] - <span class="number">6</span> * i2[<span class="number">11</span>] - <span class="number">12</span> * i2[<span class="number">12</span>]) + <span class="number">69</span> * i2[<span class="number">13</span>] - <span class="number">2</span> * i2[<span class="number">14</span>] - <span class="number">406</span> * i2[<span class="number">15</span>]) + <span class="number">651</span> * i2[<span class="number">16</span>] + <span class="number">2</span> * i2[<span class="number">17</span>] - <span class="number">10</span> * i2[<span class="number">18</span>]) + <span class="number">69</span> * i2[<span class="number">19</span>] - <span class="number">0</span> * i2[<span class="number">20</span>]) + <span class="number">21</span> * i2[<span class="number">21</span>] == <span class="number">18768</span>,</span><br><span class="line">    (((((<span class="number">555</span> * i2[<span class="number">0</span>] - <span class="number">6666</span> * i2[<span class="number">1</span>]) + <span class="number">70</span> * i2[<span class="number">2</span>] + <span class="number">510</span> * i2[<span class="number">3</span>] - <span class="number">90</span> * i2[<span class="number">4</span>]) + <span class="number">499</span> * i2[<span class="number">5</span>] + <span class="number">66</span> * i2[<span class="number">6</span>] - <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">610</span> * i2[<span class="number">8</span>] - <span class="number">221</span> * i2[<span class="number">9</span>]) + <span class="number">9</span> * i2[<span class="number">10</span>] - <span class="number">23</span> * i2[<span class="number">11</span>] - <span class="number">102</span> * i2[<span class="number">12</span>]) + <span class="number">6</span> * i2[<span class="number">13</span>] + <span class="number">2050</span> * i2[<span class="number">14</span>] - <span class="number">406</span> * i2[<span class="number">15</span>]) + <span class="number">665</span> * i2[<span class="number">16</span>] + <span class="number">333</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">777</span> * i2[<span class="number">20</span>] + <span class="number">201</span> * i2[<span class="number">21</span>] - <span class="number">22</span> * i2[<span class="number">22</span>] == <span class="number">111844</span>,</span><br><span class="line">    (((((((<span class="number">1</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">333</span> * i2[<span class="number">2</span>] + <span class="number">4444</span> * i2[<span class="number">3</span>] - <span class="number">5555</span> * i2[<span class="number">4</span>]) + <span class="number">6666</span> * i2[<span class="number">5</span>] - <span class="number">666</span> * i2[<span class="number">6</span>]) + <span class="number">676</span> * i2[<span class="number">7</span>] - <span class="number">660</span> * i2[<span class="number">8</span>] - <span class="number">22</span> * i2[<span class="number">9</span>]) + <span class="number">9</span> * i2[<span class="number">10</span>] - <span class="number">73</span> * i2[<span class="number">11</span>] - <span class="number">107</span> * i2[<span class="number">12</span>]) + <span class="number">6</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] - <span class="number">6</span> * i2[<span class="number">15</span>]) + <span class="number">65</span> * i2[<span class="number">16</span>] + <span class="number">39</span> * i2[<span class="number">17</span>] + <span class="number">10</span> * i2[<span class="number">18</span>] + <span class="number">69</span> * i2[<span class="number">19</span>] + <span class="number">777</span> * i2[<span class="number">20</span>] + <span class="number">201</span> * i2[<span class="number">21</span>] - <span class="number">2</span> * i2[<span class="number">22</span>]) + <span class="number">23</span> * i2[<span class="number">23</span>] == <span class="number">159029</span>,</span><br><span class="line">    (((<span class="number">520</span> * i2[<span class="number">0</span>] - <span class="number">222</span> * i2[<span class="number">1</span>]) + <span class="number">333</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">56655</span> * i2[<span class="number">4</span>]) + <span class="number">6666</span> * i2[<span class="number">5</span>] + <span class="number">666</span> * i2[<span class="number">6</span>] + <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">220</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">73</span> * i2[<span class="number">11</span>] + <span class="number">1007</span> * i2[<span class="number">12</span>] + <span class="number">7777</span> * i2[<span class="number">13</span>] + <span class="number">2500</span> * i2[<span class="number">14</span>] + <span class="number">6666</span> * i2[<span class="number">15</span>] + <span class="number">605</span> * i2[<span class="number">16</span>] + <span class="number">390</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">99999</span> * i2[<span class="number">20</span>] + <span class="number">210</span> * i2[<span class="number">21</span>] + <span class="number">232</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>] == <span class="number">2762025</span>,</span><br><span class="line">    ((((<span class="number">1323</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">333</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">55</span> * i2[<span class="number">4</span>]) + <span class="number">666</span> * i2[<span class="number">5</span>] + <span class="number">666</span> * i2[<span class="number">6</span>] + <span class="number">66</span> * i2[<span class="number">7</span>] - <span class="number">660</span> * i2[<span class="number">8</span>] - <span class="number">220</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">100</span> * i2[<span class="number">12</span>] + <span class="number">777</span> * i2[<span class="number">13</span>] + <span class="number">2500</span> * i2[<span class="number">14</span>] + <span class="number">6666</span> * i2[<span class="number">15</span>] + <span class="number">605</span> * i2[<span class="number">16</span>] + <span class="number">390</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">9999</span> * i2[<span class="number">20</span>] + <span class="number">210</span> * i2[<span class="number">21</span>] + <span class="number">232</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] == <span class="number">1551621</span>,</span><br><span class="line">    (((((<span class="number">777</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">6969</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">55</span> * i2[<span class="number">4</span>]) + <span class="number">666</span> * i2[<span class="number">5</span>] - <span class="number">6</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">220</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">100</span> * i2[<span class="number">12</span>] + <span class="number">777</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + <span class="number">65</span> * i2[<span class="number">16</span>] + <span class="number">90</span> * i2[<span class="number">17</span>] + <span class="number">100</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">999</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">232</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] - <span class="number">26</span> * i2[<span class="number">26</span>] == <span class="number">948348</span>,</span><br><span class="line">    ((((((<span class="number">97</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">6969</span> * i2[<span class="number">2</span>] + <span class="number">4</span> * i2[<span class="number">3</span>] - <span class="number">56</span> * i2[<span class="number">4</span>]) + <span class="number">96</span> * i2[<span class="number">5</span>] - <span class="number">6</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">10</span> * i2[<span class="number">12</span>] + <span class="number">707</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + -<span class="number">9</span> * i2[<span class="number">16</span>] + <span class="number">90</span> * i2[<span class="number">17</span>] + -<span class="number">2</span> * i2[<span class="number">18</span>] + <span class="number">609</span> * i2[<span class="number">19</span>] + <span class="number">0</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">2</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">24</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] - <span class="number">26</span> * i2[<span class="number">26</span>]) + <span class="number">27</span> * i2[<span class="number">27</span>] == <span class="number">777044</span>,</span><br><span class="line">    (((((<span class="number">177</span> * i2[<span class="number">0</span>] - <span class="number">22</span> * i2[<span class="number">1</span>]) + <span class="number">699</span> * i2[<span class="number">2</span>] + <span class="number">64</span> * i2[<span class="number">3</span>] - <span class="number">56</span> * i2[<span class="number">4</span>] - <span class="number">96</span> * i2[<span class="number">5</span>] - <span class="number">66</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">60</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">10</span> * i2[<span class="number">12</span>] + <span class="number">707</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + -<span class="number">9</span> * i2[<span class="number">16</span>] + <span class="number">0</span> * i2[<span class="number">17</span>] + -<span class="number">2</span> * i2[<span class="number">18</span>] + <span class="number">69</span> * i2[<span class="number">19</span>] + <span class="number">0</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">222</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">224</span> * i2[<span class="number">24</span>]) + <span class="number">25</span> * i2[<span class="number">25</span>] - <span class="number">26</span> * i2[<span class="number">26</span>]) + <span class="number">27</span> * i2[<span class="number">27</span>] - <span class="number">28</span> * i2[<span class="number">28</span>] == <span class="number">185016</span>,</span><br><span class="line">    ((((((<span class="number">77</span> * i2[<span class="number">0</span>] - <span class="number">2</span> * i2[<span class="number">1</span>]) + <span class="number">6</span> * i2[<span class="number">2</span>] + <span class="number">6</span> * i2[<span class="number">3</span>] - <span class="number">96</span> * i2[<span class="number">4</span>] - <span class="number">9</span> * i2[<span class="number">5</span>] - <span class="number">6</span> * i2[<span class="number">6</span>]) + <span class="number">96</span> * i2[<span class="number">7</span>] - <span class="number">0</span> * i2[<span class="number">8</span>] - <span class="number">20</span> * i2[<span class="number">9</span>]) + <span class="number">99</span> * i2[<span class="number">10</span>] + <span class="number">3</span> * i2[<span class="number">11</span>] + <span class="number">10</span> * i2[<span class="number">12</span>] + <span class="number">707</span> * i2[<span class="number">13</span>] + <span class="number">250</span> * i2[<span class="number">14</span>] + <span class="number">666</span> * i2[<span class="number">15</span>] + -<span class="number">9</span> * i2[<span class="number">16</span>] + <span class="number">0</span> * i2[<span class="number">17</span>] + -<span class="number">2</span> * i2[<span class="number">18</span>] + <span class="number">9</span> * i2[<span class="number">19</span>] + <span class="number">0</span> * i2[<span class="number">20</span>] + <span class="number">21</span> * i2[<span class="number">21</span>] + <span class="number">222</span> * i2[<span class="number">22</span>] + <span class="number">23</span> * i2[<span class="number">23</span>] - <span class="number">224</span> * i2[<span class="number">24</span>]) + <span class="number">26</span> * i2[<span class="number">25</span>] - -<span class="number">58</span> * i2[<span class="number">26</span>]) + <span class="number">27</span> * i2[<span class="number">27</span>] - <span class="number">2</span> * i2[<span class="number">28</span>]) + <span class="number">29</span> * i2[<span class="number">29</span>] == <span class="number">130106</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> equation <span class="keyword">in</span> im:</span><br><span class="line">    solver.add(equation)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line">    m = solver.model()</span><br><span class="line">    result = [m.evaluate(i2[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(i2))]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Solution:&quot;</span>, result)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No solution found&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出<font color=lime><strong>[72, 49, 90, 49, 78, 49, 85, 49, 67, 49, 84, 49, 70, 49, 123, 49, 97, 54, 100, 50, 55, 53, 102, 55, 45, 52, 54, 51, 125, 49]</strong></font>，即为<font color=LimeGreen><strong>H1Z1N1U1C1T1F1{1a6d275f7-463}1</strong></font>，再解出现次数：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lists = [[<span class="string">&#x27;H&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;Z&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;N&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;U&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;C&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;T&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;F&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;&#123;&#x27;</span>, <span class="number">1</span>], [<span class="string">&#x27;a&#x27;</span>, <span class="number">6</span>], [<span class="string">&#x27;d&#x27;</span>, <span class="number">2</span>], [<span class="string">&#x27;7&#x27;</span>, <span class="number">5</span>], [<span class="string">&#x27;f&#x27;</span>, <span class="number">7</span>], [<span class="string">&#x27;-&#x27;</span>, <span class="number">4</span>], [<span class="string">&#x27;6&#x27;</span>, <span class="number">3</span>], [<span class="string">&#x27;&#125;&#x27;</span>, <span class="number">1</span>]]</span><br><span class="line">count = <span class="string">b&#x27;111111116257645365477364777645752361&#x27;</span></span><br><span class="line">result = <span class="built_in">bytearray</span>(<span class="string">b&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(count)):</span><br><span class="line">    candidate = <span class="built_in">int</span>(count[j] - <span class="number">48</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(lists)):</span><br><span class="line">        <span class="keyword">if</span> lists[i][<span class="number">1</span>] == candidate:</span><br><span class="line">            result.append(<span class="built_in">ord</span>(lists[i][<span class="number">0</span>]))</span><br><span class="line">            <span class="keyword">if</span> lists[i][<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">del</span> lists[i]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(result.decode())</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>HZNUCTF{ad7fa-76a7-ff6a-fffa-7f7d6a}</strong></font>.</p>
<h2 id="randomsystem："><a href="#randomsystem：" class="headerlink" title="randomsystem："></a>randomsystem：</h2><p>发现有很多花，去花，查看main：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp-8h] [ebp-78Ch]</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [esp+0h] [ebp-784h]</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [esp+0h] [ebp-784h]</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [esp+0h] [ebp-784h]</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// [esp+0h] [ebp-784h]</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [esp+0h] [ebp-784h]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [esp+250h] [ebp-534h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+25Ch] [ebp-528h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v14; <span class="comment">// [esp+268h] [ebp-51Ch]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+274h] [ebp-510h]</span></span><br><span class="line">  <span class="type">char</span> v16; <span class="comment">// [esp+283h] [ebp-501h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+298h] [ebp-4ECh]</span></span><br><span class="line">  <span class="type">int</span> v18[<span class="number">34</span>]; <span class="comment">// [esp+2A4h] [ebp-4E0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">20</span>]; <span class="comment">// [esp+32Ch] [ebp-458h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v20[<span class="number">66</span>]; <span class="comment">// [esp+340h] [ebp-444h] BYREF</span></span><br><span class="line">  _OWORD v21[<span class="number">16</span>]; <span class="comment">// [esp+448h] [ebp-33Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v22[<span class="number">264</span>]; <span class="comment">// [esp+550h] [ebp-234h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Destination[<span class="number">96</span>]; <span class="comment">// [esp+658h] [ebp-12Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v24; <span class="comment">// [esp+6B8h] [ebp-CCh] BYREF</span></span><br><span class="line">  <span class="type">char</span> Source[<span class="number">76</span>]; <span class="comment">// [esp+6C0h] [ebp-C4h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v26; <span class="comment">// [esp+70Ch] [ebp-78h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v27; <span class="comment">// [esp+710h] [ebp-74h]</span></span><br><span class="line">  <span class="type">int</span> v28; <span class="comment">// [esp+714h] [ebp-70h]</span></span><br><span class="line">  <span class="type">int</span> v29; <span class="comment">// [esp+718h] [ebp-6Ch]</span></span><br><span class="line">  <span class="type">char</span> v30; <span class="comment">// [esp+71Ch] [ebp-68h]</span></span><br><span class="line">  <span class="type">int</span> v31[<span class="number">4</span>]; <span class="comment">// [esp+728h] [ebp-5Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v32[<span class="number">72</span>]; <span class="comment">// [esp+738h] [ebp-4Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> savedregs; <span class="comment">// [esp+784h] [ebp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">checkdebuggerjustmycode</span>(&amp;unk_<span class="number">41E0</span>A9);</span><br><span class="line">  v26 = <span class="number">0</span>;</span><br><span class="line">  v27 = <span class="number">0</span>;</span><br><span class="line">  v28 = <span class="number">0</span>;</span><br><span class="line">  v29 = <span class="number">0</span>;</span><br><span class="line">  v30 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">j_memset</span>(v22, <span class="number">0</span>, <span class="number">0x100u</span>);</span><br><span class="line">  <span class="built_in">j_memset</span>(v21, <span class="number">0</span>, <span class="built_in">sizeof</span>(v21));</span><br><span class="line">  <span class="built_in">strcpy</span>(Str, <span class="string">&quot;KeYkEy!!&quot;</span>); <span class="comment">//密钥</span></span><br><span class="line">  v20[<span class="number">0</span>] = <span class="number">376</span>; </span><br><span class="line">  v20[<span class="number">1</span>] = <span class="number">356</span>;</span><br><span class="line">… <span class="comment">//8*8矩阵</span></span><br><span class="line">  v20[<span class="number">63</span>] = <span class="number">151</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome to HZNUCTF!!!\n&quot;</span>, v7);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter something: \n&quot;</span>, v8);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%64s&quot;</span>, (<span class="type">char</span>)v32);</span><br><span class="line">  <span class="built_in">Func1</span>(v32, v31); <span class="comment">//两个加密函数</span></span><br><span class="line">  <span class="built_in">Func2</span>(v31[<span class="number">0</span>], v31[<span class="number">1</span>], &amp;v26);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">char</span>)v26 == <span class="number">0x35</span> <span class="comment">//第一个验证</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE1</span>(v26) == <span class="number">0x32</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE2</span>(v26) == <span class="number">0x36</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SHIBYTE</span>(v26) == <span class="number">0x35</span></span><br><span class="line">    &amp;&amp; (<span class="type">char</span>)v27 == <span class="number">0x35</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE1</span>(v27) == <span class="number">0x36</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE2</span>(v27) == <span class="number">0x36</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SHIBYTE</span>(v27) == <span class="number">0x35</span></span><br><span class="line">    &amp;&amp; (<span class="type">char</span>)v28 == <span class="number">0x35</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE1</span>(v28) == <span class="number">0x32</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE2</span>(v28) == <span class="number">0x36</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SHIBYTE</span>(v28) == <span class="number">0x35</span></span><br><span class="line">    &amp;&amp; (<span class="type">char</span>)v29 == <span class="number">0x35</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE1</span>(v29) == <span class="number">0x33</span></span><br><span class="line">    &amp;&amp; <span class="built_in">SBYTE2</span>(v29) == <span class="number">0x36</span></span><br><span class="line">&amp;&amp; <span class="built_in">SHIBYTE</span>(v29) == <span class="number">0x35</span> )</span><br><span class="line">  &#123;</span><br></pre></td></tr></table></figure>
<p>查看func1：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_DWORD *__cdecl <span class="title">func1</span><span class="params">(<span class="type">int</span> a1, _DWORD *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _DWORD *result; <span class="comment">// eax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+D8h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">checkdebuggerjustmycode</span>(&amp;unk_9EE0A9);</span><br><span class="line">  result = a2;</span><br><span class="line">  *a2 = <span class="number">0</span>;</span><br><span class="line">  a2[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">64</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="built_in">shl</span>(<span class="number">63</span> - i, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">HIDWORD</span>(v3) |= a2[<span class="number">1</span>];</span><br><span class="line">    *a2 |= v3;</span><br><span class="line">    a2[<span class="number">1</span>] = <span class="built_in">HIDWORD</span>(v3);</span><br><span class="line">    result = (_DWORD *)(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察汇编发现了一些没有反编译出来的逻辑，比如cmp 输入值, “1”，经过分析这是提取64位输出值中的二进制，将其写入64个二进制位（1个qword）的过程，接着查看func2：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __cdecl <span class="title">func2</span><span class="params">(__int64 a1, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+DCh] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  result = <span class="built_in">checkdebuggerjustmycode</span>(&amp;unk_9EE0A9);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">15</span>; i &gt;= <span class="number">0</span>; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = (<span class="number">7</span> * (((<span class="type">unsigned</span> __int8)a1 &amp; <span class="number">0xFu</span>) &gt; <span class="number">9</span>)) | a1 &amp; <span class="number">0xF</span> | <span class="number">0x30</span>;</span><br><span class="line">    *(_BYTE *)(i + a2) = v3;</span><br><span class="line">    <span class="built_in">LOBYTE</span>(v3) = <span class="number">4</span>;</span><br><span class="line">    a1 = <span class="built_in">shr</span> (v3, <span class="built_in">HIDWORD</span>(a1));</span><br><span class="line">    result = i - <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同理发现这是一个类似于to hex的功能，只不过是基于ascii 0x30~0x3F的，那么目标值就是<font color=red><strong>5265566552655365</strong></font>，还原得到要输入的值为<font color=red><strong>0101001001100101010101100110010101010010011001010101001101100101</strong></font>，代入验证发现正确，继续往后看：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;good_job!!!\n&quot;</span>, v9);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;So, Plz input the flag:\n&quot;</span>, v10);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%73s&quot;</span>, (<span class="type">char</span>)&amp;v24);</span><br><span class="line">    <span class="built_in">strncpy_s</span>(Destination, <span class="number">0x41u</span>, Source, <span class="number">0x40u</span>); <span class="comment">//提取中间64位</span></span><br><span class="line">    <span class="built_in">sub_41127B</span>();</span><br><span class="line">    <span class="built_in">srand</span>(Seed); <span class="comment">//2025</span></span><br><span class="line">    <span class="built_in">sub_41127B</span>();</span><br><span class="line">    <span class="built_in">j_memset</span>(v18, <span class="number">0</span>, <span class="number">0x80u</span>); <span class="comment">//这里用随机数结合if not in list then append的方式生成了一个32项的sbox</span></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">rand</span>();</span><br><span class="line">        v4 = <span class="built_in">sub_41127B</span>() % <span class="number">32</span>;</span><br><span class="line">        v16 = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; i; ++j )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v18[j] == v4 )</span><br><span class="line">          &#123;</span><br><span class="line">            v16 = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( !v16 );</span><br><span class="line">      v18[i] = v4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Func3</span>(Destination, v18); <span class="comment">//64字节用sbox进行打乱</span></span><br><span class="line">    <span class="built_in">Func4</span>(v22, Destination); <span class="comment">//填充矩阵到v22</span></span><br><span class="line">    <span class="built_in">Func5</span>(&amp;v26, Str); <span class="comment">//把target从十六进制按每两个字符为一个字节转为字符密钥“ReVeReSe”</span></span><br><span class="line"><span class="built_in">Func6</span>(matrix, v22, v21); <span class="comment">//将01矩阵与输入值对应的ascii矩阵相乘并输出矩阵</span></span><br><span class="line">    v14 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">8</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">8</span>; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        *((_DWORD *)&amp;v21[<span class="number">2</span> * k] + m) ^= Str[v14 % <span class="built_in">j_strlen</span>(Str)]; <span class="comment">//异或</span></span><br><span class="line">        ++v14;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">Func7</span> (v21, v20) == <span class="number">1</span> ) <span class="comment">//矩阵比较</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Congratulation!!!\n&quot;</span>, v11);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;wrong_wrong!!!\n&quot;</span>, v9);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_41120D</span>(&amp;savedregs, &amp;dword_412D48, <span class="number">0</span>, v3);</span><br><span class="line">  <span class="keyword">return</span> v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写脚本同构加密过程，有flag矩阵经过了打乱、相乘和异或，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>(<span class="params">m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(m.decode(), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>(<span class="params">m</span>):</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        n = (m &gt;&gt; (i * <span class="number">4</span>)) &amp; <span class="number">0xF</span></span><br><span class="line">        c = <span class="built_in">chr</span>(n + <span class="number">0x30</span>)</span><br><span class="line">        result.append(c)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">denc1</span>(<span class="params">n</span>):</span><br><span class="line">    b = <span class="built_in">bin</span>(n)[<span class="number">2</span>:]</span><br><span class="line">    b = b.zfill(<span class="number">64</span>)</span><br><span class="line">    <span class="keyword">return</span> b.encode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">denc2</span>(<span class="params">s</span>):</span><br><span class="line">    result = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(s):</span><br><span class="line">        h = <span class="built_in">ord</span>(c) - <span class="number">0x30</span></span><br><span class="line">        result |= h &lt;&lt; ((<span class="number">15</span> - i) * <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试加密</span></span><br><span class="line">binm = <span class="built_in">bytearray</span>(<span class="string">b&quot;1111111100000000111111110000000011111111000000001111111100000000&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(binm.decode())</span><br><span class="line">intm = func1(binm)</span><br><span class="line"><span class="built_in">print</span>(intm)</span><br><span class="line">hexm = func2(intm)</span><br><span class="line"><span class="built_in">print</span>(hexm)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">target = <span class="string">&quot;5265566552655365&quot;</span></span><br><span class="line"><span class="built_in">print</span>(target)</span><br><span class="line">inttar = denc2(target)</span><br><span class="line"><span class="built_in">print</span>(inttar)</span><br><span class="line">bintar = denc1(inttar)</span><br><span class="line"><span class="built_in">print</span>(bintar.decode())</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag部分</span></span><br><span class="line">sbox = [<span class="number">27</span>, <span class="number">26</span>, <span class="number">25</span>, <span class="number">23</span>, <span class="number">28</span>,  <span class="number">1</span>,  <span class="number">6</span>, <span class="number">10</span>, </span><br><span class="line">        <span class="number">20</span>,  <span class="number">7</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">31</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">21</span>, </span><br><span class="line">         <span class="number">9</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">24</span>,  <span class="number">8</span>,  <span class="number">2</span>, <span class="number">29</span>,  <span class="number">3</span>,</span><br><span class="line">        <span class="number">12</span>, <span class="number">11</span>, <span class="number">17</span>, <span class="number">16</span>,  <span class="number">0</span>, <span class="number">13</span>,  <span class="number">5</span>,  <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">bytearray</span>(<span class="string">b&quot;KeYkEy!!&quot;</span>)</span><br><span class="line"></span><br><span class="line">mat = [<span class="number">376</span>, <span class="number">356</span>, <span class="number">169</span>, <span class="number">501</span>, <span class="number">277</span>, <span class="number">329</span>, <span class="number">139</span>, <span class="number">342</span>,</span><br><span class="line">       <span class="number">380</span>, <span class="number">365</span>, <span class="number">162</span>, <span class="number">258</span>, <span class="number">381</span>, <span class="number">339</span>, <span class="number">347</span>, <span class="number">307</span>,</span><br><span class="line">       <span class="number">263</span>, <span class="number">359</span>, <span class="number">162</span>, <span class="number">484</span>, <span class="number">310</span>, <span class="number">333</span>, <span class="number">346</span>, <span class="number">339</span>,</span><br><span class="line">       <span class="number">150</span>, <span class="number">194</span>, <span class="number">175</span>, <span class="number">344</span>, <span class="number">158</span>, <span class="number">250</span>, <span class="number">128</span>, <span class="number">175</span>,</span><br><span class="line">       <span class="number">158</span>, <span class="number">173</span>, <span class="number">152</span>, <span class="number">379</span>, <span class="number">158</span>, <span class="number">292</span>, <span class="number">130</span>, <span class="number">365</span>,</span><br><span class="line">       <span class="number">197</span>,  <span class="number">20</span>, <span class="number">197</span>, <span class="number">161</span>, <span class="number">198</span>,  <span class="number">10</span>, <span class="number">207</span>, <span class="number">244</span>,</span><br><span class="line">       <span class="number">202</span>,  <span class="number">14</span>, <span class="number">204</span>, <span class="number">176</span>, <span class="number">193</span>, <span class="number">255</span>,  <span class="number">35</span>,   <span class="number">7</span>,</span><br><span class="line">       <span class="number">158</span>, <span class="number">181</span>, <span class="number">145</span>, <span class="number">353</span>, <span class="number">153</span>, <span class="number">357</span>, <span class="number">246</span>, <span class="number">151</span>]</span><br><span class="line"></span><br><span class="line">m01 = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">       <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func3</span>(<span class="params">m, sbox</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m) // <span class="number">2</span>):</span><br><span class="line">        m[i], m[<span class="built_in">len</span>(m) - sbox[i] - <span class="number">1</span>] = m[<span class="built_in">len</span>(m) - sbox[i] - <span class="number">1</span>], m[i]</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">denc3</span>(<span class="params">m, sbox</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m) // <span class="number">2</span> - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        m[i], m[<span class="built_in">len</span>(m) - sbox[i] - <span class="number">1</span>] = m[<span class="built_in">len</span>(m) - sbox[i] - <span class="number">1</span>], m[i]</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func4</span>(<span class="params">m</span>):</span><br><span class="line">    tmp = m.decode()</span><br><span class="line">    n = [<span class="literal">None</span>] * <span class="built_in">len</span>(m)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tmp)):</span><br><span class="line">        n[i] = <span class="built_in">ord</span>(tmp[i])</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">denc4</span>(<span class="params">m</span>):</span><br><span class="line">    n = <span class="built_in">bytearray</span>(m)</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func5</span>(<span class="params">target, key</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(target), <span class="number">2</span>):</span><br><span class="line">        h = <span class="built_in">int</span>(target[i])</span><br><span class="line">        l = <span class="built_in">int</span>(target[i + <span class="number">1</span>])</span><br><span class="line">        b = (h &lt;&lt; <span class="number">4</span>) | l</span><br><span class="line">        key[i // <span class="number">2</span>] = b</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func6</span>(<span class="params">m1, m2</span>):</span><br><span class="line">    m3 = [<span class="number">0</span>] * <span class="number">64</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                m3[<span class="number">8</span> * i + j] += m2[<span class="number">8</span> * k + j] * m1[<span class="number">8</span> * i + k]</span><br><span class="line">    <span class="keyword">return</span> m3</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">funcx</span>(<span class="params">mat, key</span>):</span><br><span class="line">    index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>): </span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>): </span><br><span class="line">            mat[<span class="number">8</span> * k + m] ^= key[index % <span class="built_in">len</span>(key)]</span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> mat</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func7</span>(<span class="params">m, mat</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">assert</span> m == mat</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;AssertionError&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试加密</span></span><br><span class="line">chrf = <span class="built_in">bytearray</span>(<span class="string">b&quot;0000000011111111000000001111111100000000111111110000000011111111&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(chrf.decode())</span><br><span class="line">fn3f = func3(chrf, sbox)</span><br><span class="line"><span class="built_in">print</span>(fn3f.decode())</span><br><span class="line">fn4f = func4(fn3f)</span><br><span class="line"><span class="built_in">print</span>(fn4f)</span><br><span class="line">func5(target, key)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="built_in">print</span>(key.decode())</span><br><span class="line">mf6 = func6(m01, fn4f)</span><br><span class="line"><span class="built_in">print</span>(mf6)</span><br><span class="line">mxk = funcx(mf6, key)</span><br><span class="line"><span class="built_in">print</span>(mxk)</span><br><span class="line">func7(mxk, mat)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">dex = funcx(mat,key)</span><br><span class="line"><span class="built_in">print</span>(dex)</span><br><span class="line">Af = np.array(m01)</span><br><span class="line">A = Af.reshape((<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">Cf = np.array(dex)</span><br><span class="line">C = Cf.reshape((<span class="number">8</span>, <span class="number">8</span>))</span><br><span class="line">Ai = np.linalg.inv(A)</span><br><span class="line">B = np.dot(Ai, C)</span><br><span class="line">Bf = B.flatten()</span><br><span class="line">bex = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> Bf]</span><br><span class="line"><span class="built_in">print</span>(bex)</span><br><span class="line">flag = <span class="built_in">bytearray</span>(denc3(bex, sbox))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;HZNUCTF&#123;&#123;<span class="subst">&#123;flag.decode()&#125;</span>&#125;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>HZNUCTF{3zfb899ac5c256d-7a8r59f0tccd-4fa6b8vfd111-a44ffy4r0-6dce5679da58}</strong></font>.</p>
<h2 id="conforand："><a href="#conforand：" class="headerlink" title="conforand："></a>conforand：</h2><p>查看main，发现有严重的ollvm，将函数整体复制到源代码，找到其中的有效执行流并包裹上打印，修掉报错，执行程序，得到main函数大致执行流：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">init</span>(v155, (<span class="type">const</span> <span class="type">char</span> *)v3, v4);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Welcome to HZNUCTF!!!\n&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Plz input the flag:\n&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v154);</span><br><span class="line"><span class="built_in">rc4</span>((__int64)v157, <span class="number">0x2AuLL</span>, (__int64)v155, <span class="number">9LL</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%x &quot;</span>, v163);</span><br></pre></td></tr></table></figure>
<p>可以看出是一个rc4加密，密文以十六进制形式输出，flag长度为2A，密钥长度为9，尝试解析init函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">init</span><span class="params">(<span class="type">char</span> *a1, <span class="type">const</span> <span class="type">char</span> *a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [rsp+24h] [rbp-Ch]</span></span><br><span class="line">  <span class="type">char</span> *dest; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0x3D7A06FB</span>;</span><br><span class="line">  v4 = a1;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v5;</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">0xAEE1317C</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v5 == <span class="number">0x3D7A06FB</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      dest = v4;</span><br><span class="line">      v5 = <span class="number">0x6AF64EC7</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      ((<span class="built_in">void</span> (__fastcall *)(<span class="type">char</span> *, <span class="type">const</span> <span class="type">char</span> *, __int64))sub_5s5s5s)(a1, a2, a3);</span><br><span class="line">      a1 = dest;</span><br><span class="line">      a2 = (<span class="type">const</span> <span class="type">char</span> *)(<span class="type">unsigned</span> <span class="type">int</span>)<span class="string">&quot;JustDoIt!&quot;</span>;</span><br><span class="line">      v5 = <span class="number">0xAEE1317C</span>;</span><br><span class="line">      <span class="built_in">strcpy</span>(dest, a2);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>找到了9字节密钥<font color=lime><strong>JustDoIt!</strong></font>，查看sub_5s5s5s，发现了以下几行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*v205 = time(<span class="number">0LL</span>);</span><br><span class="line">seed = *v205;</span><br><span class="line">srand(seed);</span><br></pre></td></tr></table></figure>
<p>说明有某个东西会基于时间的随机数生成，继续往下查看rc4函数，找了很久发现了这些rc4特征，将其有关联的变量重命名并查找xref，尽可能地恢复出所有调用：<br>323~325行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*sbox_j = sbox__i_sbox_j % <span class="number">257</span>;</span><br><span class="line">sbox[*sbox_i] = sbox[*sbox_j];</span><br><span class="line">sbox__j = &amp;sbox[*sbox_i];</span><br></pre></td></tr></table></figure>
<p>339~341行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sboxi = *sbox_i;</span><br><span class="line">v149 = <span class="number">257</span>;</span><br><span class="line">*sbox_i = (sboxi - <span class="number">746900618</span> + <span class="number">746900619</span>) % <span class="number">257</span>;</span><br></pre></td></tr></table></figure>
<p>365~366行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sbox_i = sboxinited;</span><br><span class="line">sbox_j = &amp;sboxinited[<span class="number">-4</span>];</span><br></pre></td></tr></table></figure>
<p>372行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v244 = v242 &lt; lenm_3;</span><br></pre></td></tr></table></figure>
<p>384~403行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">v113 = sbox__i_sbox_j;</span><br><span class="line">v114 = sbox__i_sbox_j;</span><br><span class="line">v115 = sbox__i_sbox_j;</span><br><span class="line">v116 = sbox__i_sbox_j;</span><br><span class="line">v117 = sbox__i_sbox_j;</span><br><span class="line">v118 = sbox__i_sbox_j;</span><br><span class="line">v119 = sbox__i_sbox_j;</span><br><span class="line">v131 = <span class="number">257</span>;</span><br><span class="line">v130 = sbox__i_sbox_j;</span><br><span class="line">*sbox_j = sbox__i_sbox_j % <span class="number">257</span>;</span><br><span class="line">sbox[*sbox_i] = sbox[*sbox_j];</span><br><span class="line">v129 = v119;</span><br><span class="line">v128 = v113;</span><br><span class="line">v127 = v118;</span><br><span class="line">v126 = v114;</span><br><span class="line">v125 = v115;</span><br><span class="line">v124 = v116;</span><br><span class="line">v123 = v117;</span><br><span class="line">v122 = sbox_i;</span><br></pre></td></tr></table></figure>
<p>408行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v242 = *sboxinited_1;</span><br></pre></td></tr></table></figure>
<p>438~445行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">inited = init_sbox((__int64)sbox_1, key_3);</span><br><span class="line">*sbox_i = <span class="number">0</span>;</span><br><span class="line">*sbox_j = <span class="number">0</span>;</span><br><span class="line">*<span class="type">sbox_t</span> = <span class="number">0</span>;</span><br><span class="line">*sboxinited_1 = <span class="number">0LL</span>;</span><br><span class="line">*sboxinited_1 = <span class="number">0LL</span>;</span><br><span class="line">sboxinited[<span class="number">3</span>] = inited;</span><br></pre></td></tr></table></figure>
<p>580行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( v244 )</span><br></pre></td></tr></table></figure>
<p>587~596行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sboxinit = init_sbox((__int64)sbox_1, key_3);</span><br><span class="line">*sbox_i = <span class="number">0</span>;</span><br><span class="line">*sbox_j = <span class="number">0</span>;</span><br><span class="line">*<span class="type">sbox_t</span> = <span class="number">0</span>;</span><br><span class="line">*sboxinited_1 = <span class="number">0LL</span>;</span><br><span class="line">*sboxinited_1 = <span class="number">0LL</span>;</span><br><span class="line">sboxinit_1 = sboxinit;</span><br></pre></td></tr></table></figure>
<p>634~678行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sbox[*sbox_j] = *sbox__j;</span><br><span class="line">sbox__i_sbox__j = (<span class="type">unsigned</span> __int8)sbox[*sbox_j] + (<span class="type">unsigned</span> __int8)sbox[*sbox_i];</span><br><span class="line">v134 = <span class="number">-1</span>;</span><br><span class="line">*<span class="type">sbox_t</span> = sbox__i_sbox__j % <span class="number">257</span>;</span><br><span class="line">v65 = *(<span class="type">unsigned</span> __int8 *)(message_2 + *sboxinited_1);</span><br><span class="line"><span class="type">sbox__t</span> = sbox[*<span class="type">sbox_t</span>];</span><br><span class="line">v67 = (v134 ^ <span class="number">0x7E050B95</span> | ~v134 &amp; <span class="number">0x7E050B95</span>) ^ ((v134 ^ <span class="number">0x7E050B95</span>) &amp; ((v134 ^ <span class="number">0xD7FABE8</span> | <span class="number">0xD7FABE8</span>) &amp; ~(~(v65 &amp; ~v65) | ~((v134 ^ <span class="number">0xDDA7B581</span> | ~v134 &amp; <span class="number">0xDDA7B581</span>) ^ ((v134 ^ <span class="number">0xDDA7B581</span>) &amp; (<span class="type">unsigned</span> __int8)v65 | ~v65 &amp; <span class="number">0xDDA7B581</span>))) | ((v134 ^ <span class="number">0xD7FABE8</span>) &amp; v65 &amp; ~v65 | ~(v65 &amp; ~v65) &amp; <span class="number">0xD7FABE8</span>) ^ ((v134 ^ <span class="number">0xD7FABE8</span>) &amp; ((v134 ^ <span class="number">0xDDA7B581</span> | ~v134 &amp; <span class="number">0xDDA7B581</span>) ^ ((v134 ^ <span class="number">0xDDA7B581</span>) &amp; (<span class="type">unsigned</span> __int8)v65 | ~v65 &amp; <span class="number">0xDDA7B581</span>)) | ~((v134 ^ <span class="number">0xDDA7B581</span> | ~v134 &amp; <span class="number">0xDDA7B581</span>) ^ ((v134 ^ <span class="number">0xDDA7B581</span>) &amp; (<span class="type">unsigned</span> __int8)v65 | ~v65 &amp; <span class="number">0xDDA7B581</span>)) &amp; <span class="number">0xD7FABE8</span>)) | ~((v134 ^ <span class="number">0xD7FABE8</span> | <span class="number">0xD7FABE8</span>) &amp; ~(~(v65 &amp; ~v65) | ~((v134 ^ <span class="number">0xDDA7B581</span> | ~v134 &amp; <span class="number">0xDDA7B581</span>) ^ ((v134 ^ <span class="number">0xDDA7B581</span>) &amp; (<span class="type">unsigned</span> __int8)v65 | ~v65 &amp; <span class="number">0xDDA7B581</span>))) | ((v134 ^ <span class="number">0xD7FABE8</span>) &amp; v65 &amp; ~v65 | ~(v65 &amp; ~v65) &amp; <span class="number">0xD7FABE8</span>) ^ ((v134 ^ <span class="number">0xD7FABE8</span>) &amp; ((v134 ^ <span class="number">0xDDA7B581</span> | ~v134 &amp; <span class="number">0xDDA7B581</span>) ^ ((v134 ^ <span class="number">0xDDA7B581</span>) &amp; (<span class="type">unsigned</span> __int8)v65 | ~v65 &amp; <span class="number">0xDDA7B581</span>)) | ~((v134 ^ <span class="number">0xDDA7B581</span> | ~v134 &amp; <span class="number">0xDDA7B581</span>) ^ ((v134 ^ <span class="number">0xDDA7B581</span>) &amp; (<span class="type">unsigned</span> __int8)v65 | ~v65 &amp; <span class="number">0xDDA7B581</span>)) &amp; <span class="number">0xD7FABE8</span>)) &amp; <span class="number">0x7E050B95</span>);</span><br><span class="line">v68 = ~v67 &amp; <span class="number">0x5F51A4D1</span> | (v134 ^ <span class="number">0x5F51A4D1</span>) &amp; v67;</span><br><span class="line">v69 = v68 &amp; (v134 ^ <span class="number">0x5F51A4D1</span> ^ v68);</span><br><span class="line">LOBYTE(v67) = ~(_BYTE)v134 &amp; v65 | ~*(_BYTE *)(message_2 + *sboxinited_1);</span><br><span class="line">v70 = ((v134 ^ <span class="number">0xFA</span>) &amp; ((v134 ^ <span class="number">0x56</span> | ~(_BYTE)v134 &amp; <span class="number">0x56</span>) ^ ((v134 ^ <span class="number">0x56</span>) &amp; (((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) | ~(((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) &amp; <span class="number">0x56</span>)) | ~((v134 ^ <span class="number">0x56</span> | ~(_BYTE)v134 &amp; <span class="number">0x56</span>) ^ ((v134 ^ <span class="number">0x56</span>) &amp; (((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) | ~(((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) &amp; <span class="number">0x56</span>)) &amp; <span class="number">0xFA</span>) ^ ((v134 ^ <span class="number">0xFA</span>) &amp; v67 | ~(_BYTE)v67 &amp; <span class="number">0xFA</span>);</span><br><span class="line">v71 = (v134 ^ <span class="number">0xFA</span> | <span class="number">0xFA</span>) &amp; ~(~((v134 ^ <span class="number">0x56</span> | ~(_BYTE)v134 &amp; <span class="number">0x56</span>) ^ ((v134 ^ <span class="number">0x56</span>) &amp; (((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) | ~(((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) &amp; <span class="number">0x56</span>)) | ~(_BYTE)v67) | v70;</span><br><span class="line">LOBYTE(v67) = <span class="type">sbox__t</span> &amp; ~<span class="type">sbox__t</span> ^ (~(_BYTE)v134 &amp; <span class="type">sbox__t</span> | ~<span class="type">sbox__t</span>) | <span class="type">sbox__t</span> &amp; ~<span class="type">sbox__t</span> &amp; (~(_BYTE)v134 &amp; <span class="type">sbox__t</span> | ~<span class="type">sbox__t</span>);</span><br><span class="line">LOBYTE(v68) = (v134 ^ <span class="number">0x92</span> | <span class="number">0x92</span>) &amp; ~(~(_BYTE)v67 | ~(((v134 ^ <span class="number">0xD2</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xD2</span>) ^ ((v134 ^ <span class="number">0xD2</span>) &amp; v67 | ~(_BYTE)v67 &amp; <span class="number">0xD2</span>)));</span><br><span class="line">LOBYTE(v65) = (v134 ^ <span class="number">0xA8</span> | ~(_BYTE)v134 &amp; <span class="number">0xA8</span>) ^ ((v134 ^ <span class="number">0xA8</span>) &amp; <span class="type">sbox__t</span> | ~<span class="type">sbox__t</span> &amp; <span class="number">0xA8</span>);</span><br><span class="line">v72 = (v134 ^ <span class="number">0xA1</span> | <span class="number">0xA1</span>) &amp; ~(~(~(_BYTE)v134 &amp; (((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) | ~(((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>)) | ~(_BYTE)v65) | ((v134 ^ <span class="number">0xA1</span>) &amp; (~(_BYTE)v134 &amp; (((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) | ~(((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>)) | ~(~(_BYTE)v134 &amp; (((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>) | ~(((v134 ^ <span class="number">0xEA</span>) &amp; (~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) | ~(~(_BYTE)v134 &amp; <span class="number">0xD1</span> | v134 ^ <span class="number">0xD1</span>) &amp; <span class="number">0xEA</span>) ^ <span class="number">0xEA</span>)) &amp; <span class="number">0xA1</span>) ^ ((v134 ^ <span class="number">0xA1</span>) &amp; v65 | ~(_BYTE)v65 &amp; <span class="number">0xA1</span>);</span><br><span class="line">v73 = (v134 ^ <span class="number">0x98</span> | <span class="number">0x98</span>) &amp; ~(~((~(_BYTE)v134 &amp; <span class="number">0xD0</span> | v134 ^ <span class="number">0xD0</span>) ^ <span class="number">0xD0</span> | ~(_BYTE)v134 &amp; <span class="number">0xD0</span> | (v134 ^ <span class="number">0xD0</span>) &amp; <span class="number">0xD0</span>) | ~(~(_BYTE)v134 &amp; v72 | ~v72));</span><br><span class="line">v74 = (v134 ^ <span class="number">0xB3272901</span> | ~v134 &amp; <span class="number">0xB3272901</span>) ^ ((v134 ^ <span class="number">0xB3272901</span>) &amp; v69 | ~v69 &amp; <span class="number">0xB3272901</span>);</span><br><span class="line">LOBYTE(v67) = ~(_BYTE)v134 &amp; (~(_BYTE)v134 &amp; v71 | ~v71) &amp; (~((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>) ^ <span class="number">0x2E</span> | ((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>)) &amp; <span class="number">0x2E</span>) ^ (~(_BYTE)v134 &amp; v71 | ~v71)) | ~((~(_BYTE)v134 &amp; v71 | ~v71) &amp; (~((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>) ^ <span class="number">0x2E</span> | ((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>)) &amp; <span class="number">0x2E</span>) ^ (~(_BYTE)v134 &amp; v71 | ~v71)));</span><br><span class="line">v75 = (v134 ^ <span class="number">0x4D</span> | <span class="number">0x4D</span>) &amp; ~(v134 ^ <span class="number">0x11</span> | ~((v134 ^ <span class="number">1</span> | ((v134 &amp; <span class="number">1</span>) == <span class="number">0</span>)) ^ ((v134 ^ <span class="number">1</span>) &amp; v69 | ((v69 &amp; <span class="number">1</span>) == <span class="number">0</span>))));</span><br><span class="line">LOBYTE(v69) = (v134 ^ <span class="number">0x7E</span> | <span class="number">0x7E</span>) &amp; ~(~((v134 ^ <span class="number">0xF3</span> | ~(_BYTE)v134 &amp; <span class="number">0xF3</span>) ^ ((v134 ^ <span class="number">0xF3</span>) &amp; <span class="number">0x11</span> | (v134 ^ <span class="number">0x11</span>) &amp; <span class="number">0xF3</span>)) | ~(_BYTE)v69);</span><br><span class="line">v76 = (~(_BYTE)v134 &amp; v71 | ~v71) &amp; (~((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>) ^ <span class="number">0x2E</span> | ((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>)) &amp; <span class="number">0x2E</span>) ^ (~(_BYTE)v134 &amp; v71 | ~v71)) &amp; (~((v134 ^ <span class="number">0xF3</span> | ~(_BYTE)v134 &amp; <span class="number">0xF3</span>) ^ ((v134 ^ <span class="number">0xF3</span>) &amp; <span class="number">0x11</span> | (v134 ^ <span class="number">0x11</span>) &amp; <span class="number">0xF3</span>)) ^ (~(_BYTE)v134 &amp; v71 | ~v71) &amp; (~((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>) ^ <span class="number">0x2E</span> | ((v134 ^ <span class="number">0x8D</span> | ~(_BYTE)v134 &amp; <span class="number">0x8D</span>) ^ ((v134 ^ <span class="number">0x8D</span>) &amp; <span class="number">0x2E</span> | (v134 ^ <span class="number">0x2E</span>) &amp; <span class="number">0x8D</span>)) &amp; <span class="number">0x2E</span>) ^ (~(_BYTE)v134 &amp; v71 | ~v71)));</span><br><span class="line">v133 = v74;</span><br><span class="line">v77 = (v134 ^ <span class="number">0xF0</span> | <span class="number">0xF0</span>) &amp; ~(~(_BYTE)v69 | ~v75) | ((v134 ^ <span class="number">0xF0</span>) &amp; v69 | ~(_BYTE)v69 &amp; <span class="number">0xF0</span>) ^ ((v134 ^ <span class="number">0xF0</span>) &amp; v75 | ~v75 &amp; <span class="number">0xF0</span>);</span><br><span class="line">v78 = (v134 ^ <span class="number">0xAB</span> | <span class="number">0xAB</span>) &amp; ~(~v76 | ~(v67 &amp; (v134 ^ <span class="number">0x11</span> ^ v67))) | ((v134 ^ <span class="number">0xAB</span>) &amp; v76 | ~v76 &amp; <span class="number">0xAB</span>) ^ ((v134 ^ <span class="number">0xAB</span>) &amp; v67 &amp; (v134 ^ <span class="number">0x11</span> ^ v67) | ~(v67 &amp; (v134 ^ <span class="number">0x11</span> ^ v67)) &amp; <span class="number">0xAB</span>);</span><br><span class="line">LOBYTE(v67) = (v134 ^ <span class="number">0x5B</span> | <span class="number">0x5B</span>) &amp; ~(~((v134 ^ <span class="number">0xD4</span> | <span class="number">0xD4</span>) &amp; ~(~((v134 ^ <span class="number">0xF3</span> | ~(_BYTE)v134 &amp; <span class="number">0xF3</span>) ^ ((v134 ^ <span class="number">0xF3</span>) &amp; <span class="number">0x11</span> | (v134 ^ <span class="number">0x11</span>) &amp; <span class="number">0xF3</span>)) | v134 ^ <span class="number">0x11</span>) | ((v134 ^ <span class="number">0xD4</span>) &amp; ((v134 ^ <span class="number">0xF3</span> | ~(_BYTE)v134 &amp; <span class="number">0xF3</span>) ^ ((v134 ^ <span class="number">0xF3</span>) &amp; <span class="number">0x11</span> | (v134 ^ <span class="number">0x11</span>) &amp; <span class="number">0xF3</span>)) | ~((v134 ^ <span class="number">0xF3</span> | ~(_BYTE)v134 &amp; <span class="number">0xF3</span>) ^ ((v134 ^ <span class="number">0xF3</span>) &amp; <span class="number">0x11</span> | (v134 ^ <span class="number">0x11</span>) &amp; <span class="number">0xF3</span>)) &amp; <span class="number">0xD4</span>) ^ ((v134 ^ <span class="number">0xD4</span>) &amp; <span class="number">0x11</span> | (v134 ^ <span class="number">0x11</span>) &amp; <span class="number">0xD4</span>)) | ~(~(_BYTE)v134 &amp; (v67 ^ v133 | v67 &amp; v133) | ~(v67 ^ v133 | v67 &amp; v133)));</span><br><span class="line">LOBYTE(v69) = v67 ^ ((v134 ^ <span class="number">0x52</span>) &amp; v78 | ~v78 &amp; <span class="number">0x52</span>) ^ ((v134 ^ <span class="number">0x52</span>) &amp; v77 | ~v77 &amp; <span class="number">0x52</span>) | v67 &amp; (((v134 ^ <span class="number">0x52</span>) &amp; v78 | ~v78 &amp; <span class="number">0x52</span>) ^ ((v134 ^ <span class="number">0x52</span>) &amp; v77 | ~v77 &amp; <span class="number">0x52</span>));</span><br><span class="line">LOBYTE(v74) = (v134 ^ <span class="number">0x4D</span> | ~(_BYTE)v134 &amp; <span class="number">0x4D</span>) ^ ((v134 ^ <span class="number">0x4D</span>) &amp; v68 | ~(_BYTE)v68 &amp; <span class="number">0x4D</span>);</span><br><span class="line">LOBYTE(v67) = ~(_BYTE)v134 &amp; v73 | ~v73;</span><br><span class="line">LOBYTE(v68) = (v134 ^ <span class="number">0xD9</span> | <span class="number">0xD9</span>) &amp; ~(~((v134 ^ <span class="number">0x92</span> | ~(_BYTE)v134 &amp; <span class="number">0x92</span>) ^ ((v134 ^ <span class="number">0x92</span>) &amp; <span class="number">0x4F</span> | (v134 ^ <span class="number">0x4F</span>) &amp; <span class="number">0x92</span>)) | ~(_BYTE)v68);</span><br><span class="line">v79 = (v134 ^ <span class="number">0x48</span> | <span class="number">0x48</span>) &amp; ~(v134 ^ <span class="number">0x4F</span> | ~(_BYTE)v67);</span><br><span class="line">v80 = v73 &amp; (~((v134 ^ <span class="number">0x92</span> | ~(_BYTE)v134 &amp; <span class="number">0x92</span>) ^ ((v134 ^ <span class="number">0x92</span>) &amp; <span class="number">0x4F</span> | (v134 ^ <span class="number">0x4F</span>) &amp; <span class="number">0x92</span>)) ^ v73);</span><br><span class="line">v81 = (v134 ^ <span class="number">0x9C</span> | <span class="number">0x9C</span>) &amp; ~(~v80 | ~v79) | ((v134 ^ <span class="number">0x9C</span>) &amp; v80 | ~v80 &amp; <span class="number">0x9C</span>) ^ ((v134 ^ <span class="number">0x9C</span>) &amp; v79 | ~v79 &amp; <span class="number">0x9C</span>);</span><br><span class="line">v82 = ((v134 ^ <span class="number">0xEF</span>) &amp; v81 | ~v81 &amp; <span class="number">0xEF</span>) ^ ((v134 ^ <span class="number">0xEF</span>) &amp; (v68 ^ v74 &amp; (v134 ^ <span class="number">0x4F</span> ^ v74) | v68 &amp; v74 &amp; (v134 ^ <span class="number">0x4F</span> ^ v74)) | ~(v68 ^ v74 &amp; (v134 ^ <span class="number">0x4F</span> ^ v74) | v68 &amp; v74 &amp; (v134 ^ <span class="number">0x4F</span> ^ v74)) &amp; <span class="number">0xEF</span>);</span><br><span class="line">v83 = (v134 ^ <span class="number">0x65</span>) &amp; v67 | ~(_BYTE)v67 &amp; <span class="number">0x65</span>;</span><br><span class="line">LOBYTE(v74) = ~(_BYTE)v134 &amp; ((v134 ^ <span class="number">0x65</span> | <span class="number">0x65</span>) &amp; ~(~(_BYTE)v67 | ~(_BYTE)v74) | v83 ^ ((v134 ^ <span class="number">0x65</span>) &amp; v74 | ~(_BYTE)v74 &amp; <span class="number">0x65</span>)) | ~((v134 ^ <span class="number">0x65</span> | <span class="number">0x65</span>) &amp; ~(~(_BYTE)v67 | ~(_BYTE)v74) | v83 ^ ((v134 ^ <span class="number">0x65</span>) &amp; v74 | ~(_BYTE)v74 &amp; <span class="number">0x65</span>));</span><br><span class="line">LOBYTE(v67) = v74 &amp; (~((v134 ^ <span class="number">0x92</span> | ~(_BYTE)v134 &amp; <span class="number">0x92</span>) ^ ((v134 ^ <span class="number">0x92</span>) &amp; <span class="number">0x4F</span> | (v134 ^ <span class="number">0x4F</span>) &amp; <span class="number">0x92</span>) ^ <span class="number">0x4F</span> | ((v134 ^ <span class="number">0x92</span> | ~(_BYTE)v134 &amp; <span class="number">0x92</span>) ^ ((v134 ^ <span class="number">0x92</span>) &amp; <span class="number">0x4F</span> | (v134 ^ <span class="number">0x4F</span>) &amp; <span class="number">0x92</span>)) &amp; <span class="number">0x4F</span>) ^ v74);</span><br><span class="line">LOBYTE(v68) = (v134 ^ <span class="number">0xDC</span> | <span class="number">0xDC</span>) &amp; ~(~(_BYTE)v67 | ~v82) | ((v134 ^ <span class="number">0xDC</span>) &amp; v67 | ~(_BYTE)v67 &amp; <span class="number">0xDC</span>) ^ ((v134 ^ <span class="number">0xDC</span>) &amp; v82 | ~v82 &amp; <span class="number">0xDC</span>);</span><br><span class="line">v84 = (v134 ^ <span class="number">0x77</span> | <span class="number">0x77</span>) &amp; ~(~(~(_BYTE)v134 &amp; v69 | ~(_BYTE)v69) | v134 ^ <span class="number">0x30</span>);</span><br><span class="line">LOBYTE(v69) = (v134 ^ <span class="number">0x4A</span> | <span class="number">0x4A</span>) &amp; ~(~(~(_BYTE)v134 &amp; <span class="number">0x30</span> | v134 ^ <span class="number">0x30</span>) | ~(_BYTE)v69);</span><br><span class="line">LOBYTE(v67) = ~((v134 ^ <span class="number">0x61</span> | ~(_BYTE)v134 &amp; <span class="number">0x61</span>) ^ ((v134 ^ <span class="number">0x61</span>) &amp; v68 | ~(_BYTE)v68 &amp; <span class="number">0x61</span>));</span><br><span class="line">v85 = v68 &amp; (~(~(_BYTE)v134 &amp; <span class="number">0x30</span> | v134 ^ <span class="number">0x30</span>) ^ v68);</span><br><span class="line">LOBYTE(v74) = v69 ^ v84 | v69 &amp; v84;</span><br><span class="line">v86 = v85 ^ (v134 ^ <span class="number">0x8C</span> | <span class="number">0x8C</span>) &amp; ~(v134 ^ <span class="number">0x30</span> | v67) | v85 &amp; (v134 ^ <span class="number">0x8C</span> | <span class="number">0x8C</span>) &amp; ~(v134 ^ <span class="number">0x30</span> | v67);</span><br><span class="line">*(_BYTE *)(message_2 + *sboxinited_1) = ~v86 &amp; v74 | ~(_BYTE)v74 &amp; v86;</span><br></pre></td></tr></table></figure>
<p>721行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sbox__i_sbox_j = (<span class="type">unsigned</span> __int8)sbox[*sbox_i] + *sbox_j;</span><br></pre></td></tr></table></figure>
<p>729~736行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">sbox_t</span> = sboxinited;</span><br><span class="line">sboxinited_1 = (__int64 *)&amp;sboxinited[<span class="number">-4</span>];</span><br><span class="line">message_2 = message_1;</span><br><span class="line">lenm_2 = lenm_1;</span><br><span class="line">key_2 = key_1;</span><br><span class="line">lenkey_2 = lenkey_1;</span><br><span class="line">sbox_1 = sbox;</span><br><span class="line">key_3 = key_1;</span><br></pre></td></tr></table></figure>
<p>775行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v247 = *sboxinited_1;</span><br></pre></td></tr></table></figure>
<p>783行：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*sboxinited_1 = v248;</span><br></pre></td></tr></table></figure>
<p>将这些行打上断点调试，恢复出PRGA的执行流：<br><br><font color=lime><strong>Init_sbox → 初始化I, j, t等参数为0 → 在密文长度内循环{i自增模257 → j &#x3D; si + j模257 → si &#x3D; sj → sj &#x3D; si → t &#x3D; si + sj模257 → 对明文和st进行操作（结合动调发现还是异或不变）}</strong></font><br><br>再观察KSA部分，也用上面的方法恢复出执行流：</p>
<p><font color=lime><strong>初始化各种数据（包括一个额外的s盒） → 初始化第一个s盒为1~257 → 初始化第二个s盒为密钥的当前索引取模密钥长度再异或（推测）rand值，接下来在257轮循环内：{j &#x3D; 当前的j与两个s盒的加和取模257 → 交换第一个s盒的第ij项}</strong></font></p>
<p>动态调试注意到这个rand值只获取了一次，随后便被一直使用，所以不需要爆破时间戳，仅需爆破异或值即可，综上，结合所给密文，编写同构加解密脚本并爆破：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">m, key, xor</span>):</span><br><span class="line">    sbox1 = [<span class="number">0</span>] * <span class="number">257</span></span><br><span class="line">    sbox2 = [<span class="number">0</span>] * <span class="number">257</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">257</span>):</span><br><span class="line">        sbox1[i] = i &amp; <span class="number">0xFF</span></span><br><span class="line">        sbox2[i] = (key[i % <span class="built_in">len</span>(key)] ^ xor) &amp; <span class="number">0xFF</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">257</span>):</span><br><span class="line">        j = (j + sbox1[i] + sbox2[i]) % <span class="number">257</span></span><br><span class="line">        sbox1[i], sbox1[j] = sbox1[j], sbox1[i]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(m)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">257</span></span><br><span class="line">        j = (j + sbox1[i]) % <span class="number">257</span></span><br><span class="line">        sbox1[i] = sbox1[j]</span><br><span class="line">        m[k] ^= sbox1[(<span class="number">2</span> * sbox1[i]) % <span class="number">257</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytearray</span>(m)</span><br><span class="line"></span><br><span class="line">encflag = [<span class="number">0x83</span>, <span class="number">0x1e</span>, <span class="number">0x9c</span>, <span class="number">0x48</span>, <span class="number">0x7a</span>, <span class="number">0xfa</span>, <span class="number">0xe8</span>, <span class="number">0x88</span>, <span class="number">0x36</span>, <span class="number">0xd5</span>, <span class="number">0x0a</span>, <span class="number">0x08</span>, <span class="number">0xf6</span>, <span class="number">0xa7</span>,</span><br><span class="line">           <span class="number">0x70</span>, <span class="number">0x0f</span>, <span class="number">0xfd</span>, <span class="number">0x67</span>, <span class="number">0xdd</span>, <span class="number">0xd4</span>, <span class="number">0x3c</span>, <span class="number">0xa7</span>, <span class="number">0xed</span>, <span class="number">0x8d</span>, <span class="number">0x51</span>, <span class="number">0x10</span>, <span class="number">0xce</span>, <span class="number">0x6a</span>,</span><br><span class="line">           <span class="number">0x9e</span>, <span class="number">0x56</span>, <span class="number">0x57</span>, <span class="number">0x83</span>, <span class="number">0x56</span>, <span class="number">0xe7</span>, <span class="number">0x67</span>, <span class="number">0x9a</span>, <span class="number">0x67</span>, <span class="number">0x22</span>, <span class="number">0x24</span>, <span class="number">0x6e</span>, <span class="number">0xcd</span>, <span class="number">0x2f</span>]</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&quot;JustDoIt!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> xor <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xFF</span>):</span><br><span class="line">    flag = rc4(encflag.copy(), key, xor)</span><br><span class="line">    <span class="keyword">if</span> flag.startswith(<span class="string">b&quot;HZNUCTF&#123;&quot;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(xor))</span><br><span class="line">        <span class="built_in">print</span>(flag.decode())</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>HZNUCTF{489b88-1305-411e-b1f4-88a3070a73}</strong></font>.</p>
<h2 id="exchange："><a href="#exchange：" class="headerlink" title="exchange："></a>exchange：</h2><p>先脱upx，发现可以运行了，查看main：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *Source; <span class="comment">// [rsp+28h] [rbp+8h]</span></span><br><span class="line">  <span class="type">char</span> Destination[<span class="number">44</span>]; <span class="comment">// [rsp+48h] [rbp+28h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">36</span>]; <span class="comment">// [rsp+74h] [rbp+54h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *v11; <span class="comment">// [rsp+98h] [rbp+78h]</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">100</span>]; <span class="comment">// [rsp+C0h] [rbp+A0h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+124h] [rbp+104h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v14; <span class="comment">// [rsp+144h] [rbp+124h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v15; <span class="comment">// [rsp+164h] [rbp+144h]</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">32</span>]; <span class="comment">// [rsp+184h] [rbp+164h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">32</span>]; <span class="comment">// [rsp+1A4h] [rbp+184h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18; <span class="comment">// [rsp+1C4h] [rbp+1A4h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v7;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">114</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_7FF76FC713CA</span>((__int64)&amp;unk_7FF76FC860A6);</span><br><span class="line">  Source = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x2Au</span>i64);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome to HZNUCTF!!!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Plz input the flag:\n&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Source);</span><br><span class="line">  <span class="built_in">strncpy_s</span>(Destination, <span class="number">9u</span>i64, Source, <span class="number">8u</span>i64);</span><br><span class="line">  <span class="built_in">strncpy_s</span>(Str1, <span class="number">2u</span>i64, Source + <span class="number">40</span>, <span class="number">1u</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">j_strcmp</span>(Destination, <span class="string">&quot;HZNUCTF&#123;&quot;</span>) &amp;&amp; !<span class="built_in">j_strcmp</span>(Str1, <span class="string">&quot;&#125;&quot;</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">0x24u</span>i64);</span><br><span class="line">    <span class="built_in">strncpy_s</span>(v11, <span class="number">0x24u</span>i64, Source + <span class="number">8</span>, <span class="number">0x20u</span>i64);</span><br><span class="line">    <span class="built_in">memset</span>(v12, <span class="number">0</span>, <span class="number">0x41u</span>i64);</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j += <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = <span class="number">0</span>;</span><br><span class="line">      v15 = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">memset</span>(v16, <span class="number">0</span>, <span class="number">5u</span>i64);</span><br><span class="line">      <span class="built_in">memset</span>(v17, <span class="number">0</span>, <span class="number">3u</span>i64);</span><br><span class="line">      v14 = v11[j];</span><br><span class="line">      <span class="built_in">sub_7FF76FC71393</span>((__int64)v16, <span class="string">&quot;%x&quot;</span>, v14); <span class="comment">//flag包裹的32字符被按ascii读取，0=30, 1=31 … 8=38, 9=39, a=41, b=42, c=43, d=44, e=45, f=46</span></span><br><span class="line">      v15 = v11[j + <span class="number">1</span>];</span><br><span class="line">      <span class="built_in">sub_7FF76FC71393</span>((__int64)v17, <span class="string">&quot;%x&quot;</span>, v15); </span><br><span class="line">      <span class="built_in">j_strcat</span>(v16, v17);</span><br><span class="line">      v18 = v16[<span class="number">1</span>];</span><br><span class="line">      v16[<span class="number">1</span>] = v16[<span class="number">2</span>];</span><br><span class="line">      v16[<span class="number">2</span>] = v18;</span><br><span class="line">      <span class="built_in">j_strcat</span>(v12, v16); <span class="comment">//每两字符对应的4字节进行了交换，3046→3406，abcd→acbd</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">check</span>((__int64)v12, (__int64)Destination); <span class="comment">//v12是64个字节，destination是HZNUCTF&#123;</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Congratulation!!!\n&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(v11);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(Source);</span><br><span class="line">  <span class="built_in">sub_7FF76FC7135C</span>(v6, &amp;unk_7FF76FC7D390);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现会按ascii读取flag包裹的内容，并每2字节进行了交换，查看check：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">sub_7FF76FC77F30</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v2; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// edx</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+30h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Src[<span class="number">96</span>]; <span class="comment">// [rsp+40h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">64</span>]; <span class="comment">// [rsp+A0h] [rbp+70h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+F4h] [rbp+C4h]</span></span><br><span class="line"></span><br><span class="line">  v2 = &amp;v7;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">58</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v2 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v2 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">sub_7FF76FC713CA</span>((__int64)&amp;unk_7FF76FC860A6);</span><br><span class="line">  <span class="built_in">j_memcpy</span>(v9, Src, <span class="built_in">sizeof</span>(v9));</span><br><span class="line">  <span class="built_in">LOBYTE</span>(v4) = <span class="number">8</span>;</span><br><span class="line">  <span class="built_in">sub_7FF76FC713B6</span>(a2, v4, a1, (<span class="type">int</span>)Src, <span class="number">8</span>); <span class="comment">//这是一个魔改DES</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)Src[j] != dword_7FF76FC80000[j] ) <span class="comment">//密文</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;wrong_wrong!!!\n&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">sub_7FF76FC7135C</span>(v6, &amp;unk_7FF76FC7D1F0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现了一个DES加密，密钥为<code>HZNUCTF&#123;</code>，查看该DES：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">DES_0</span><span class="params">(__int64 key, <span class="type">char</span> a2, <span class="type">const</span> <span class="type">void</span> *m, <span class="type">void</span> *out, <span class="type">unsigned</span> <span class="type">int</span> a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">char</span> *v5; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">char</span> v10[<span class="number">32</span>]; <span class="comment">// [rsp+0h] [rbp-20h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">280</span>]; <span class="comment">// [rsp+30h] [rbp+10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> key_1[<span class="number">32</span>]; <span class="comment">// [rsp+148h] [rbp+128h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v14[<span class="number">204</span>]; <span class="comment">// [rsp+168h] [rbp+148h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15; <span class="comment">// [rsp+234h] [rbp+214h]</span></span><br><span class="line"></span><br><span class="line">  v5 = &amp;v11;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">90</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v5 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v5 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">checkfordebuggerjustmycode</span>(byte_7FF76FC860A6);</span><br><span class="line">  <span class="keyword">if</span> ( a5 &amp;&amp; key &amp;&amp; out &amp;&amp; m )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( a2 == <span class="number">8</span> || a2 == <span class="number">16</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">j_memmove</span>(out, m, (<span class="type">int</span>)(<span class="number">8</span> * a5));</span><br><span class="line">      v15 = a2;</span><br><span class="line">      <span class="keyword">if</span> ( a2 == <span class="number">8</span> ) <span class="comment">//DES</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">j_memcpy</span>(key_1, (<span class="type">const</span> <span class="type">void</span> *)key, <span class="number">8u</span>i64);</span><br><span class="line">        <span class="built_in">Func1</span>((__int64)v12, (__int64)key_1);</span><br><span class="line">        <span class="built_in">Func2</span>((__int64)v12, (__int64)out, a5);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v15 != <span class="number">16</span> ) <span class="comment">//3DES</span></span><br><span class="line">        &#123;</span><br><span class="line">          v7 = <span class="number">0xFFFFFFFF</span>i64;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_18;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">j_memcpy</span>(key_1, (<span class="type">const</span> <span class="type">void</span> *)key, <span class="number">8u</span>i64);</span><br><span class="line">        <span class="built_in">j_memcpy</span>(v14, (<span class="type">const</span> <span class="type">void</span> *)(key + <span class="number">8</span>), <span class="number">8u</span>i64);</span><br><span class="line">        <span class="built_in">Func1</span>((__int64)v12, (__int64)key_1);</span><br><span class="line">        <span class="built_in">Func2</span>((__int64)v12, (__int64)out, a5);</span><br><span class="line">        <span class="built_in">Func1</span>((__int64)v12, (__int64)v14);</span><br><span class="line">        <span class="built_in">Func3</span>((__int64)v12, (__int64)out, a5);</span><br><span class="line">        <span class="built_in">Func1</span>((__int64)v12, (__int64)key_1);</span><br><span class="line">        <span class="built_in">Func2</span>((__int64)v12, (__int64)out, a5);</span><br><span class="line">      &#125;</span><br><span class="line">      v7 = <span class="number">0</span>i64;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_18;</span><br><span class="line">    &#125;</span><br><span class="line">    v7 = <span class="number">0xFFFFFFFF</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="number">0xFFFFFFFF</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">LABEL_18:</span><br><span class="line">  v8 = v7;</span><br><span class="line">  <span class="built_in">sub_7FF76FC7135C</span>(v10, &amp;unk_7FF76FC7D120);</span><br><span class="line">  <span class="keyword">return</span> v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>经过观察发现该DES是被魔改的，但是由于下面是3DES，所以Func3一定是解密函数，不妨把上面的DES的call Func2 patch为call Func3（毕竟参数都一样），E8 FC EF FF FF改为E8 BD ED FF FF，成功patch为Func3，进行动态调试，将密文patch进v12，观察执行后的字段：<font color=lime><strong>333936147332632923d96353321d3345636826d26314621d3349330463126348</strong></font>，可以注意到成功解密，换位后得到<font color=lime><strong>33393164733262392d396533312d343566382d626134612d3439303461326438</strong></font>，fromhex得到<font color=lime><strong>391ds2b9-9e31-45f8-ba4a-4904a2d8</strong></font>，flag：<font color=deepskyblue><strong>HZNUCTF{391ds2b9-9e31-45f8-ba4a-4904a2d8}</strong></font>.</p>
<h2 id="index："><a href="#index：" class="headerlink" title="index："></a>index：</h2><p>发现是wasm文件，但是前四字节的magic被改成了大写，改回小写后用ghidra解析：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">undefined4 <span class="title">export::main</span><span class="params">(undefined4 param1,undefined4 param2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  undefined4 uVar1;</span><br><span class="line">  uVar1 = <span class="built_in">main_0</span>();</span><br><span class="line">  <span class="keyword">return</span> uVar1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看main0（函数名称已手动恢复）：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">undefined4 <span class="title">main_0</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(s_Welcome_to_HZNUCTF!!!_ram_000100ae,<span class="number">0</span>);</span><br><span class="line">  <span class="built_in">printf</span>(s_Plz_input_the_key:_ram_00010051,<span class="number">0</span>);</span><br><span class="line">  local_70 = &amp;local_40;</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="number">0x10026</span>,&amp;local_70);</span><br><span class="line">  iVar1 = <span class="built_in">strcmp</span>(&amp;local_40,s_TGCTF404_ram_00011020); <span class="comment">//TGCTF404</span></span><br><span class="line">  <span class="keyword">if</span> (iVar1 == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">xor51</span>(&amp;local_40); <span class="comment">//每个字节异或0x51</span></span><br><span class="line">    <span class="built_in">printf</span>(s_Ok,_let’s_go!!!_ram_0001007a,<span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(s_Plz_input_the_flag:_ram_00010065,<span class="number">0</span>);</span><br><span class="line">    local_80[<span class="number">0</span>] = &amp;local_30;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="number">0x10026</span>,local_80);</span><br><span class="line">    iVar1 = <span class="built_in">strlen</span>(&amp;local_30); <span class="comment">//长度为32</span></span><br><span class="line">    <span class="keyword">if</span> (iVar1 == <span class="number">0x20</span>) &#123;</span><br><span class="line">      <span class="built_in">encrypt1</span>(&amp;local_30,&amp;local_60); <span class="comment">//第一个加密</span></span><br><span class="line">      <span class="keyword">for</span> (local_64 = <span class="number">0</span>; local_64 &lt; <span class="number">8</span>; local_64 = local_64 + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="built_in">encrypt2</span>((<span class="type">int</span>)&amp;local_60 + local_64 * <span class="number">4</span>,&amp;local_40); <span class="comment">//一次加密4字节</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> (local_68 = <span class="number">0</span>; local_68 &lt; <span class="number">8</span>; local_68 = local_68 + <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (local_6c = <span class="number">0</span>; local_6c &lt; <span class="number">4</span>; local_6c = local_6c + <span class="number">1</span>) &#123;</span><br><span class="line">          <span class="keyword">if</span> ((uint)*(byte *)((<span class="type">int</span>)&amp;local_60 + local_6c + local_68 * <span class="number">4</span>) !=</span><br><span class="line">              DWORD_ARRAY_ram_00010fa0[local_68 * <span class="number">4</span> + local_6c]) &#123; <span class="comment">//与密文比较</span></span><br><span class="line">            <span class="built_in">printf</span>(s_wrong_wrong!!!_ram_00010042,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">printf</span>(s_Congratulation!!!_ram_0001008b,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(s_wrong_wrong!!!_ram_00010042,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(s_wrong_wrong!!!_ram_0001009e,<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是首先读取输入存储在v0+64，然后与<font color=red><strong>TGCTF404</strong></font>进行比较，如果相等，进入异或0x51的函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">xor51</span><span class="params">(<span class="type">int</span> param1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> iVar1;</span><br><span class="line">  <span class="type">int</span> local_c;</span><br><span class="line">  </span><br><span class="line">  iVar1 = <span class="built_in">strlen</span>(param1);</span><br><span class="line">  <span class="keyword">for</span> (local_c = <span class="number">0</span>; local_c &lt; iVar1; local_c = local_c + <span class="number">1</span>) &#123;</span><br><span class="line">    *(byte *)(param1 + local_c) = *(byte *)(param1 + local_c) ^ <span class="number">0x51</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是将TGCTF404循环异或0x51，继续分析main0，接下来输入flag，存储在80，且要求长度为32，接下来进行了一个类似于randomize的函数，将打乱的结果存储在32，循环用encrypt2和异或后的key进行加密，之后将密文与0x10fa0位置的dword密文进行比较，输出结果，先提取密文，得到<font color=lime><strong>841c6bf74922d642507b42f446a98362d13280426a10a3f2e2b80b76b0dc0251</strong></font>，继续分析加密逻辑，先查看encrypt1：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">encrypt1</span><span class="params">(<span class="type">int</span> param1,<span class="type">int</span> param2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> local_14;</span><br><span class="line">  <span class="type">int</span> local_10;</span><br><span class="line">  <span class="type">int</span> local_c;</span><br><span class="line">  </span><br><span class="line">  local_c = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">unnamed_function_15</span>(<span class="number">0x194</span>);</span><br><span class="line">  <span class="built_in">unnamed_function_8</span>(param1,<span class="number">0x20</span>);</span><br><span class="line">  <span class="keyword">for</span> (local_10 = <span class="number">0</span>; local_10 &lt; <span class="number">8</span>; local_10 = local_10 + <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (local_14 = <span class="number">0</span>; local_14 &lt; <span class="number">4</span>; local_14 = local_14 + <span class="number">1</span>) &#123;</span><br><span class="line">      *(undefined *)(param2 + local_10 * <span class="number">4</span> + local_14) = *(undefined *)(param1 + local_c);</span><br><span class="line">      local_c = local_c + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">unnamed_function_15</span><span class="params">(<span class="type">int</span> param1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  uRam00011208 = (ulonglong)(param1 - <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">unnamed_function_8</span><span class="params">(<span class="type">int</span> param1,<span class="type">int</span> param2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  undefined uVar1;</span><br><span class="line">  <span class="type">int</span> iVar2;</span><br><span class="line">  byte local_11;</span><br><span class="line">  <span class="type">int</span> local_c;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (<span class="number">1</span> &lt; param2) &#123;</span><br><span class="line">    <span class="keyword">for</span> (local_c = <span class="number">0</span>; local_c &lt; param2 + <span class="number">-1</span>; local_c = local_c + <span class="number">1</span>) &#123;</span><br><span class="line">      iVar2 = <span class="built_in">unnamed_function_16</span>();</span><br><span class="line">      iVar2 = local_c + iVar2 / (<span class="number">0x7fffffff</span> / (param2 - local_c) + <span class="number">1</span>);</span><br><span class="line">      uVar1 = *(undefined *)(param1 + iVar2);</span><br><span class="line">      *(undefined *)(param1 + iVar2) = *(undefined *)(param1 + local_c);</span><br><span class="line">      *(undefined *)(param1 + local_c) = uVar1;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">uint <span class="title">unnamed_function_16</span><span class="params">(<span class="type">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  lRam00011208 = lRam00011208 * <span class="number">0x5851f42d4c957f2d</span> + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> (uint)((ulonglong)lRam00011208 &gt;&gt; <span class="number">0x21</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是将输入的明文随机打乱，随机数种子为0x194（404），再分析encrypt2，发现这个函数是被循环调用的，一次只加密了输入值的一个dword，循环8次，查看encrypt2：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">encrypt2</span><span class="params">(<span class="type">int</span> param1,<span class="type">int</span> param2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> iVar1;</span><br><span class="line">  uint uVar2;</span><br><span class="line">  <span class="type">int</span> local_1c;</span><br><span class="line">  byte local_15;</span><br><span class="line">  byte local_9;</span><br><span class="line">  </span><br><span class="line">  iVar1 = (<span class="type">int</span>)*(<span class="type">char</span> *)(param2 + iRam00011200) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">  uVar2 = (<span class="type">int</span>)*(<span class="type">char</span> *)(param2 + iRam00011200) &amp; <span class="number">0xf</span>;</span><br><span class="line">  iRam00011200 = iRam00011200 + <span class="number">1</span>;</span><br><span class="line">  <span class="built_in">encrypt3</span>(ARRAY_ram_00010ea0,(<span class="type">int</span>)(<span class="type">char</span>)ARRAY_ram_00010da0[uVar2 + iVar1 * <span class="number">0x10</span>]); <span class="comment">//带入SM4的sbox和密钥的全局索引</span></span><br><span class="line">  <span class="keyword">for</span> (local_1c = <span class="number">0</span>; local_1c &lt; <span class="number">4</span>; local_1c = local_1c + <span class="number">1</span>) &#123;</span><br><span class="line">    *(byte *)(param1 + local_1c) = *(byte *)(param1 + local_1c) ^ ARRAY_ram_00010ea0[iVar1 * <span class="number">0x10</span> + local_1c * <span class="number">0x11</span> + uVar2 ]; <span class="comment">//异或低字节+循环索引*0x11</span></span><br><span class="line">    *(byte *)(param1 + local_1c) = *(byte *)(param1 + local_1c) ^ s_TGCTF404_ram_00011020[local_1 c];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中0x10ea0的位置是SM4的S盒，0x10da0的位置是AES的S盒，继续查看encrypt3：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">encrypt3</span><span class="params">(<span class="type">int</span> param1,undefined4 param2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> local_c;</span><br><span class="line">  byte local_5;</span><br><span class="line">  <span class="keyword">for</span> (local_c = <span class="number">0</span>; local_c &lt; <span class="number">0x100</span>; local_c = local_c + <span class="number">1</span>) &#123;</span><br><span class="line">    *(byte *)(param1 + local_c) = *(byte *)(param1 + local_c) ^ (byte)param2;</span><br><span class="line">    *(undefined *)(param1 + local_c) = *(undefined *)(param1 + local_c);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>encrypt3对SM4的S盒进行异或AES的S盒的指定索引的值，构成新的S盒，回到encrypt2，发现是将字符异或新的S盒的指定索引，然后再异或被异或后的密钥，综上所述已经分析完毕，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">AES_sbox = [<span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>,</span><br><span class="line">            <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>, <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>,</span><br><span class="line">            <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>,</span><br><span class="line">            <span class="number">0x72</span>, <span class="number">0xC0</span>, <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>,</span><br><span class="line">            <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>, <span class="number">0x04</span>, <span class="number">0xC7</span>,</span><br><span class="line">            <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>,</span><br><span class="line">            <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>, <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>,</span><br><span class="line">            <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">            <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>,</span><br><span class="line">            <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>, <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>,</span><br><span class="line">            <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>,</span><br><span class="line">            <span class="number">0x9F</span>, <span class="number">0xA8</span>, <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>,</span><br><span class="line">            <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>, <span class="number">0xCD</span>, <span class="number">0x0C</span>,</span><br><span class="line">            <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>,</span><br><span class="line">            <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>, <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>,</span><br><span class="line">            <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">            <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>,</span><br><span class="line">            <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>, <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>,</span><br><span class="line">            <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>,</span><br><span class="line">            <span class="number">0xAE</span>, <span class="number">0x08</span>, <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>,</span><br><span class="line">            <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>, <span class="number">0x70</span>, <span class="number">0x3E</span>,</span><br><span class="line">            <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>,</span><br><span class="line">            <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>, <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>,</span><br><span class="line">            <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">            <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>,</span><br><span class="line">            <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>]</span><br><span class="line"></span><br><span class="line">SM4_sbox = [<span class="number">0xD6</span>, <span class="number">0x90</span>, <span class="number">0xE9</span>, <span class="number">0xFE</span>, <span class="number">0xCC</span>, <span class="number">0xE1</span>, <span class="number">0x3D</span>, <span class="number">0xB7</span>, <span class="number">0x16</span>, <span class="number">0xB6</span>,</span><br><span class="line">            <span class="number">0x14</span>, <span class="number">0xC2</span>, <span class="number">0x28</span>, <span class="number">0xFB</span>, <span class="number">0x2C</span>, <span class="number">0x05</span>, <span class="number">0x2B</span>, <span class="number">0x67</span>, <span class="number">0x9A</span>, <span class="number">0x76</span>,</span><br><span class="line">            <span class="number">0x2A</span>, <span class="number">0xBE</span>, <span class="number">0x04</span>, <span class="number">0xC3</span>, <span class="number">0xAA</span>, <span class="number">0x44</span>, <span class="number">0x13</span>, <span class="number">0x26</span>, <span class="number">0x49</span>, <span class="number">0x86</span>,</span><br><span class="line">            <span class="number">0x06</span>, <span class="number">0x99</span>, <span class="number">0x9C</span>, <span class="number">0x42</span>, <span class="number">0x50</span>, <span class="number">0xF4</span>, <span class="number">0x91</span>, <span class="number">0xEF</span>, <span class="number">0x98</span>, <span class="number">0x7A</span>,</span><br><span class="line">            <span class="number">0x33</span>, <span class="number">0x54</span>, <span class="number">0x0B</span>, <span class="number">0x43</span>, <span class="number">0xED</span>, <span class="number">0xCF</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0xE4</span>, <span class="number">0xB3</span>,</span><br><span class="line">            <span class="number">0x1C</span>, <span class="number">0xA9</span>, <span class="number">0xC9</span>, <span class="number">0x08</span>, <span class="number">0xE8</span>, <span class="number">0x95</span>, <span class="number">0x80</span>, <span class="number">0xDF</span>, <span class="number">0x94</span>, <span class="number">0xFA</span>,</span><br><span class="line">            <span class="number">0x75</span>, <span class="number">0x8F</span>, <span class="number">0x3F</span>, <span class="number">0xA6</span>, <span class="number">0x47</span>, <span class="number">0x07</span>, <span class="number">0xA7</span>, <span class="number">0xFC</span>, <span class="number">0xF3</span>, <span class="number">0x73</span>,</span><br><span class="line">            <span class="number">0x17</span>, <span class="number">0xBA</span>, <span class="number">0x83</span>, <span class="number">0x59</span>, <span class="number">0x3C</span>, <span class="number">0x19</span>, <span class="number">0xE6</span>, <span class="number">0x85</span>, <span class="number">0x4F</span>, <span class="number">0xA8</span>,</span><br><span class="line">            <span class="number">0x68</span>, <span class="number">0x6B</span>, <span class="number">0x81</span>, <span class="number">0xB2</span>, <span class="number">0x71</span>, <span class="number">0x64</span>, <span class="number">0xDA</span>, <span class="number">0x8B</span>, <span class="number">0xF8</span>, <span class="number">0xEB</span>,</span><br><span class="line">            <span class="number">0x0F</span>, <span class="number">0x4B</span>, <span class="number">0x70</span>, <span class="number">0x56</span>, <span class="number">0x9D</span>, <span class="number">0x35</span>, <span class="number">0x1E</span>, <span class="number">0x24</span>, <span class="number">0x0E</span>, <span class="number">0x5E</span>,</span><br><span class="line">            <span class="number">0x63</span>, <span class="number">0x58</span>, <span class="number">0xD1</span>, <span class="number">0xA2</span>, <span class="number">0x25</span>, <span class="number">0x22</span>, <span class="number">0x7C</span>, <span class="number">0x3B</span>, <span class="number">0x01</span>, <span class="number">0x21</span>,</span><br><span class="line">            <span class="number">0x78</span>, <span class="number">0x87</span>, <span class="number">0xD4</span>, <span class="number">0x00</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0x9F</span>, <span class="number">0xD3</span>, <span class="number">0x27</span>, <span class="number">0x52</span>,</span><br><span class="line">            <span class="number">0x4C</span>, <span class="number">0x36</span>, <span class="number">0x02</span>, <span class="number">0xE7</span>, <span class="number">0xA0</span>, <span class="number">0xC4</span>, <span class="number">0xC8</span>, <span class="number">0x9E</span>, <span class="number">0xEA</span>, <span class="number">0xBF</span>,</span><br><span class="line">            <span class="number">0x8A</span>, <span class="number">0xD2</span>, <span class="number">0x40</span>, <span class="number">0xC7</span>, <span class="number">0x38</span>, <span class="number">0xB5</span>, <span class="number">0xA3</span>, <span class="number">0xF7</span>, <span class="number">0xF2</span>, <span class="number">0xCE</span>,</span><br><span class="line">            <span class="number">0xF9</span>, <span class="number">0x61</span>, <span class="number">0x15</span>, <span class="number">0xA1</span>, <span class="number">0xE0</span>, <span class="number">0xAE</span>, <span class="number">0x5D</span>, <span class="number">0xA4</span>, <span class="number">0x9B</span>, <span class="number">0x34</span>,</span><br><span class="line">            <span class="number">0x1A</span>, <span class="number">0x55</span>, <span class="number">0xAD</span>, <span class="number">0x93</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0xF5</span>, <span class="number">0x8C</span>, <span class="number">0xB1</span>, <span class="number">0xE3</span>,</span><br><span class="line">            <span class="number">0x1D</span>, <span class="number">0xF6</span>, <span class="number">0xE2</span>, <span class="number">0x2E</span>, <span class="number">0x82</span>, <span class="number">0x66</span>, <span class="number">0xCA</span>, <span class="number">0x60</span>, <span class="number">0xC0</span>, <span class="number">0x29</span>,</span><br><span class="line">            <span class="number">0x23</span>, <span class="number">0xAB</span>, <span class="number">0x0D</span>, <span class="number">0x53</span>, <span class="number">0x4E</span>, <span class="number">0x6F</span>, <span class="number">0xD5</span>, <span class="number">0xDB</span>, <span class="number">0x37</span>, <span class="number">0x45</span>,</span><br><span class="line">            <span class="number">0xDE</span>, <span class="number">0xFD</span>, <span class="number">0x8E</span>, <span class="number">0x2F</span>, <span class="number">0x03</span>, <span class="number">0xFF</span>, <span class="number">0x6A</span>, <span class="number">0x72</span>, <span class="number">0x6D</span>, <span class="number">0x6C</span>,</span><br><span class="line">            <span class="number">0x5B</span>, <span class="number">0x51</span>, <span class="number">0x8D</span>, <span class="number">0x1B</span>, <span class="number">0xAF</span>, <span class="number">0x92</span>, <span class="number">0xBB</span>, <span class="number">0xDD</span>, <span class="number">0xBC</span>, <span class="number">0x7F</span>,</span><br><span class="line">            <span class="number">0x11</span>, <span class="number">0xD9</span>, <span class="number">0x5C</span>, <span class="number">0x41</span>, <span class="number">0x1F</span>, <span class="number">0x10</span>, <span class="number">0x5A</span>, <span class="number">0xD8</span>, <span class="number">0x0A</span>, <span class="number">0xC1</span>,</span><br><span class="line">            <span class="number">0x31</span>, <span class="number">0x88</span>, <span class="number">0xA5</span>, <span class="number">0xCD</span>, <span class="number">0x7B</span>, <span class="number">0xBD</span>, <span class="number">0x2D</span>, <span class="number">0x74</span>, <span class="number">0xD0</span>, <span class="number">0x12</span>,</span><br><span class="line">            <span class="number">0xB8</span>, <span class="number">0xE5</span>, <span class="number">0xB4</span>, <span class="number">0xB0</span>, <span class="number">0x89</span>, <span class="number">0x69</span>, <span class="number">0x97</span>, <span class="number">0x4A</span>, <span class="number">0x0C</span>, <span class="number">0x96</span>,</span><br><span class="line">            <span class="number">0x77</span>, <span class="number">0x7E</span>, <span class="number">0x65</span>, <span class="number">0xB9</span>, <span class="number">0xF1</span>, <span class="number">0x09</span>, <span class="number">0xC5</span>, <span class="number">0x6E</span>, <span class="number">0xC6</span>, <span class="number">0x84</span>,</span><br><span class="line">            <span class="number">0x18</span>, <span class="number">0xF0</span>, <span class="number">0x7D</span>, <span class="number">0xEC</span>, <span class="number">0x3A</span>, <span class="number">0xDC</span>, <span class="number">0x4D</span>, <span class="number">0x20</span>, <span class="number">0x79</span>, <span class="number">0xEE</span>,</span><br><span class="line">            <span class="number">0x5F</span>, <span class="number">0x3E</span>, <span class="number">0xD7</span>, <span class="number">0xCB</span>, <span class="number">0x39</span>, <span class="number">0x48</span>]</span><br><span class="line"></span><br><span class="line">sbox = SM4_sbox.copy()</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">bytearray</span>(<span class="string">b&quot;TGCTF404&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 还原密钥再次加密</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    key[i] ^= <span class="number">0x51</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 还原被加密的SM4的sbox</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>):</span><br><span class="line">        SM4_sbox[j] ^= AES_sbox[key[i]] <span class="comment"># 异或密钥索引8次</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 密文</span></span><br><span class="line">cipher = <span class="built_in">bytearray</span>.fromhex(<span class="string">&quot;841c6bf74922d642507b42f446a98362d13280426a10a3f2e2b80b76b0dc0251&quot;</span>)</span><br><span class="line">result = <span class="built_in">bytearray</span>(<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    enc = cipher[i * <span class="number">4</span> : (i + <span class="number">1</span>) * <span class="number">4</span>] <span class="comment"># 4字节</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        enc[j] ^= key[j]</span><br><span class="line">        enc[j] ^= SM4_sbox[j * <span class="number">0x11</span> + key[i]] <span class="comment"># key的字节</span></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>): <span class="comment"># 解密一层sbox</span></span><br><span class="line">        SM4_sbox[k] ^= AES_sbox[key[i]]</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        result[<span class="number">4</span> * i + l] = enc[l] ^ <span class="number">0x51</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">bytearray</span>([enc[l] ^ <span class="number">0x51</span>]).decode(),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">assert</span> SM4_sbox == sbox</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line">dec = result.copy()</span><br><span class="line"><span class="comment"># 加密回去以验证</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    m = result[i * <span class="number">4</span> : (i + <span class="number">1</span>) * <span class="number">4</span>]</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x100</span>): <span class="comment"># 加密</span></span><br><span class="line">        SM4_sbox[k] ^= AES_sbox[key[i]]</span><br><span class="line">    <span class="keyword">for</span> l <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        m[l] ^= <span class="number">0x51</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        m[j] ^= SM4_sbox[j * <span class="number">0x11</span> + key[i]] <span class="comment"># key的字节</span></span><br><span class="line">        m[j] ^= key[j]</span><br><span class="line">    result[i * <span class="number">4</span> : (i + <span class="number">1</span>) * <span class="number">4</span>] = m</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> result == cipher</span><br></pre></td></tr></table></figure>
<p>得到中间密文<font color=lime><strong>Z49H539c{–6}d4888bTUCf8NeFe–e9</strong></font>，继续解密一阶段的洗牌算法，编写脚本同构加密过程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">randd</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* <span class="built_in">array</span>, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> j = i + rand() / (<span class="number">0x7FFF</span> / (length - i) + <span class="number">1</span>);</span><br><span class="line">            <span class="type">uint8_t</span> temp = <span class="built_in">array</span>[j];</span><br><span class="line">            <span class="built_in">array</span>[j] = <span class="built_in">array</span>[i];</span><br><span class="line">            <span class="built_in">array</span>[i] = temp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">encrypt1</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span>* param1, <span class="type">unsigned</span> <span class="type">char</span>* param2)</span> &#123;</span><br><span class="line">    <span class="type">int</span> local_c = <span class="number">0</span>;</span><br><span class="line">    srand(<span class="number">0x194</span>);</span><br><span class="line">    randd(param1, <span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++) &#123;</span><br><span class="line">            param2[i * <span class="number">4</span> + j] = param1[local_c++];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> input[<span class="number">33</span>] = <span class="string">&quot;123456ABCDEFGHiJKLMNOPQRSTUVWXYZ&quot;</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> output[<span class="number">32</span>] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> original[<span class="number">32</span>];</span><br><span class="line">    <span class="built_in">memcpy</span>(original, input, <span class="number">32</span>);  </span><br><span class="line">    encrypt1(input, output);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;before -&gt; after:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">32</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (output[j] == original[i]) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;input[%2d] (&#x27;%c&#x27;) -&gt; output[%2d] (&#x27;%c&#x27;)\n&quot;</span>, i, original[i], j, output[j]);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nafter:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, (output[i] &gt;= <span class="number">32</span> &amp;&amp; output[i] &lt;= <span class="number">126</span>) ? output[i] : <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到对照表：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">before -&gt; after:</span><br><span class="line">input[ <span class="number">0</span>] (<span class="string">&#x27;1&#x27;</span>) -&gt; output[ <span class="number">3</span>] (<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">input[ <span class="number">1</span>] (<span class="string">&#x27;2&#x27;</span>) -&gt; output[ <span class="number">0</span>] (<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">input[ <span class="number">2</span>] (<span class="string">&#x27;3&#x27;</span>) -&gt; output[<span class="number">24</span>] (<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">input[ <span class="number">3</span>] (<span class="string">&#x27;4&#x27;</span>) -&gt; output[<span class="number">20</span>] (<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">input[ <span class="number">4</span>] (<span class="string">&#x27;5&#x27;</span>) -&gt; output[<span class="number">21</span>] (<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">input[ <span class="number">5</span>] (<span class="string">&#x27;6&#x27;</span>) -&gt; output[<span class="number">19</span>] (<span class="string">&#x27;6&#x27;</span>)</span><br><span class="line">input[ <span class="number">6</span>] (<span class="string">&#x27;A&#x27;</span>) -&gt; output[<span class="number">26</span>] (<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">input[ <span class="number">7</span>] (<span class="string">&#x27;B&#x27;</span>) -&gt; output[ <span class="number">8</span>] (<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">input[ <span class="number">8</span>] (<span class="string">&#x27;C&#x27;</span>) -&gt; output[<span class="number">22</span>] (<span class="string">&#x27;C&#x27;</span>)</span><br><span class="line">input[ <span class="number">9</span>] (<span class="string">&#x27;D&#x27;</span>) -&gt; output[<span class="number">17</span>] (<span class="string">&#x27;D&#x27;</span>)</span><br><span class="line">input[<span class="number">10</span>] (<span class="string">&#x27;E&#x27;</span>) -&gt; output[<span class="number">31</span>] (<span class="string">&#x27;E&#x27;</span>)</span><br><span class="line">input[<span class="number">11</span>] (<span class="string">&#x27;F&#x27;</span>) -&gt; output[<span class="number">15</span>] (<span class="string">&#x27;F&#x27;</span>)</span><br><span class="line">input[<span class="number">12</span>] (<span class="string">&#x27;G&#x27;</span>) -&gt; output[ <span class="number">9</span>] (<span class="string">&#x27;G&#x27;</span>)</span><br><span class="line">input[<span class="number">13</span>] (<span class="string">&#x27;H&#x27;</span>) -&gt; output[<span class="number">13</span>] (<span class="string">&#x27;H&#x27;</span>)</span><br><span class="line">input[<span class="number">14</span>] (<span class="string">&#x27;i&#x27;</span>) -&gt; output[<span class="number">25</span>] (<span class="string">&#x27;i&#x27;</span>)</span><br><span class="line">input[<span class="number">15</span>] (<span class="string">&#x27;J&#x27;</span>) -&gt; output[<span class="number">23</span>] (<span class="string">&#x27;J&#x27;</span>)</span><br><span class="line">input[<span class="number">16</span>] (<span class="string">&#x27;K&#x27;</span>) -&gt; output[ <span class="number">4</span>] (<span class="string">&#x27;K&#x27;</span>)</span><br><span class="line">input[<span class="number">17</span>] (<span class="string">&#x27;L&#x27;</span>) -&gt; output[<span class="number">10</span>] (<span class="string">&#x27;L&#x27;</span>)</span><br><span class="line">input[<span class="number">18</span>] (<span class="string">&#x27;M&#x27;</span>) -&gt; output[<span class="number">14</span>] (<span class="string">&#x27;M&#x27;</span>)</span><br><span class="line">input[<span class="number">19</span>] (<span class="string">&#x27;N&#x27;</span>) -&gt; output[<span class="number">11</span>] (<span class="string">&#x27;N&#x27;</span>)</span><br><span class="line">input[<span class="number">20</span>] (<span class="string">&#x27;O&#x27;</span>) -&gt; output[<span class="number">30</span>] (<span class="string">&#x27;O&#x27;</span>)</span><br><span class="line">input[<span class="number">21</span>] (<span class="string">&#x27;P&#x27;</span>) -&gt; output[<span class="number">28</span>] (<span class="string">&#x27;P&#x27;</span>)</span><br><span class="line">input[<span class="number">22</span>] (<span class="string">&#x27;Q&#x27;</span>) -&gt; output[ <span class="number">6</span>] (<span class="string">&#x27;Q&#x27;</span>)</span><br><span class="line">input[<span class="number">23</span>] (<span class="string">&#x27;R&#x27;</span>) -&gt; output[<span class="number">27</span>] (<span class="string">&#x27;R&#x27;</span>)</span><br><span class="line">input[<span class="number">24</span>] (<span class="string">&#x27;S&#x27;</span>) -&gt; output[ <span class="number">1</span>] (<span class="string">&#x27;S&#x27;</span>)</span><br><span class="line">input[<span class="number">25</span>] (<span class="string">&#x27;T&#x27;</span>) -&gt; output[ <span class="number">5</span>] (<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line">input[<span class="number">26</span>] (<span class="string">&#x27;U&#x27;</span>) -&gt; output[<span class="number">29</span>] (<span class="string">&#x27;U&#x27;</span>)</span><br><span class="line">input[<span class="number">27</span>] (<span class="string">&#x27;V&#x27;</span>) -&gt; output[<span class="number">18</span>] (<span class="string">&#x27;V&#x27;</span>)</span><br><span class="line">input[<span class="number">28</span>] (<span class="string">&#x27;W&#x27;</span>) -&gt; output[ <span class="number">2</span>] (<span class="string">&#x27;W&#x27;</span>)</span><br><span class="line">input[<span class="number">29</span>] (<span class="string">&#x27;X&#x27;</span>) -&gt; output[ <span class="number">7</span>] (<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line">input[<span class="number">30</span>] (<span class="string">&#x27;Y&#x27;</span>) -&gt; output[<span class="number">16</span>] (<span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">input[<span class="number">31</span>] (<span class="string">&#x27;Z&#x27;</span>) -&gt; output[<span class="number">12</span>] (<span class="string">&#x27;Z&#x27;</span>)</span><br><span class="line"></span><br><span class="line">after:</span><br><span class="line"><span class="number">2</span>SW1KTQXBGLNZHMFYDV645CJ3iARPUOE</span><br></pre></td></tr></table></figure>
<p>编写脚本解密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">char</span> output[<span class="number">33</span>] = <span class="string">&quot;Z49H539c&#123;--6&#125;d4888bTUCf8NeFe--e9&quot;</span>;</span><br><span class="line">    <span class="type">char</span> input[<span class="number">33</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> mapping[<span class="number">32</span>] = &#123;</span><br><span class="line">        <span class="number">3</span>, <span class="number">0</span>, <span class="number">24</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">19</span>, <span class="number">26</span>, <span class="number">8</span>,</span><br><span class="line">        <span class="number">22</span>, <span class="number">17</span>, <span class="number">31</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">13</span>, <span class="number">25</span>, <span class="number">23</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">11</span>, <span class="number">30</span>, <span class="number">28</span>, <span class="number">6</span>, <span class="number">27</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">5</span>, <span class="number">29</span>, <span class="number">18</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">16</span>, <span class="number">12</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</span><br><span class="line">        input[i] = output[mapping[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    input[<span class="number">32</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, input);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color=deepskyblue><strong>HZNUCTF{f898-de85-46e-9e43-b9c8}</strong></font>.</p>
<h1 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h1><p>本次比赛费了很大劲终于把re ak了…<br><br>对三道压轴题的评价：<br><br>conforand的ollvm是真的<font color=red><strong>辣</strong></font><font color=orange><strong>眼</strong></font><font color=yellow><strong>睛</strong></font><br><br>exchange的patch call解密函数实际上是非预期，不过魔改DES我是真逆不太动（x）<br><br>index还好，换个工具解析就行，就是随机数部分有点不稳定，直接用反编译出来的貌似不太行，用库函数反而出了…</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/04/27/actf_25/"
      title="ACTF 2025 WriteUp (Reverse方向)"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        ACTF 2025 WriteUp (Reverse方向)
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/04/14/npcctf_25_final/"
      title="NPC²CTF 2025 决赛 WriteUp (Reverse & Misc 方向)"
     >

    <p class="title-text">
      
        NPC²CTF 2025 决赛 WriteUp (Reverse &amp; Misc 方向)
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2026 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
