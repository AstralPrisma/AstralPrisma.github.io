<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>VNCTF 2025 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="第一次遇到鸿蒙软件逆向，简单学了学之后成功做出来了 签到题：欢迎！：打开容器发现是“文本替换器”，只能执行指定的指令：sed&#39;s&#x2F;&#123;.\*&#125;&#x2F; text &#x2F;g&#39; path，并给出了一个示例文本文档，题目说明flag在环境变量内，首先在右侧路径的位置输入环境变量：&#x2F;proc&#x2F;self&#x2F;environ，返回以下内容： 1RET2SHELL\_34\_656\_POR">
<meta property="og:type" content="article">
<meta property="og:title" content="VNCTF 2025 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2025/02/09/vn_25/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="第一次遇到鸿蒙软件逆向，简单学了学之后成功做出来了 签到题：欢迎！：打开容器发现是“文本替换器”，只能执行指定的指令：sed&#39;s&#x2F;&#123;.\*&#125;&#x2F; text &#x2F;g&#39; path，并给出了一个示例文本文档，题目说明flag在环境变量内，首先在右侧路径的位置输入环境变量：&#x2F;proc&#x2F;self&#x2F;environ，返回以下内容： 1RET2SHELL\_34\_656\_POR">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-02-09T04:00:00.000Z">
<meta property="article:modified_time" content="2025-04-20T19:22:12.070Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">24</div>
            </a>
        
            <a class="category-link" href="/categories/Ideas/">
                Ideas
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-vn_25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        VNCTF 2025 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-02-09T04:00:00.000Z" itemprop="datePublished">2025-02-09</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            7.7k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>第一次遇到鸿蒙软件逆向，简单学了学之后成功做出来了</em></p>
<h2 id="签到题："><a href="#签到题：" class="headerlink" title="签到题："></a>签到题：</h2><h3 id="欢迎！："><a href="#欢迎！：" class="headerlink" title="欢迎！："></a>欢迎！：</h3><p>打开容器发现是“文本替换器”，只能执行指定的指令：<code>sed&#39;s/&#123;.\*&#125;/ text /g&#39; path</code>，并给出了一个示例文本文档，题目说明flag在环境变量内，首先在右侧路径的位置输入环境变量：<code>/proc/self/environ</code>，返回以下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RET2SHELL\_34\_656\_PORT=tcp://10.233.17.192:3000RET2SHELL\_34\_656\_SERVICE\_PORT=3000KUBERNETES\_SERVICE\_PORT=443KUBERNETES\_PORT=tcp://10.233.0.1:443RET2SHELL\_34\_388\_PORT=tcp://10.233.2.153:3000RET2SHELL\_34\_388\_SERVICE\_PORT=3000RET2SHELL\_34\_488\_SERVICE\_PORT=3000RET2SHELL\_34\_488\_PORT=tcp://10.233.29.73:3000HOSTNAME=ret2shell-34-76BUN\_INSTALL\_BIN=/usr/local/binSHLVL=1RET2SHELL\_34\_76\_PORT\_3000\_TCP\_ADDR=10.233.56.123HOME=/home/ctfRET2SHELL\_34\_78\_PORT\_3000\_TCP\_ADDR=10.233.37.202RET2SHELL\_34\_322\_PORT\_3000\_TCP\_ADDR=10.233.46.29RET2SHELL\_34\_76\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_76\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_78\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_513\_PORT\_3000\_TCP\_ADDR=10.233.38.34RET2SHELL\_34\_261\_PORT\_3000\_TCP\_ADDR=10.233.32.69RET2SHELL\_34\_370\_PORT\_3000\_TCP\_ADDR=10.233.50.48RET2SHELL\_34\_322\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_78\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_335\_PORT\_3000\_TCP\_ADDR=10.233.36.17RET2SHELL\_34\_322\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_261\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_513\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_642\_PORT\_3000\_TCP\_ADDR=10.233.7.77RET2SHELL\_34\_261\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_513\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_370\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_76\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_652\_PORT\_3000\_TCP\_ADDR=10.233.4.122RET2SHELL\_34\_335\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_370\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_78\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_335\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_654\_PORT\_3000\_TCP\_ADDR=10.233.10.93RET2SHELL\_34\_642\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_642\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_322\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_652\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_76\_PORT\_3000\_TCP=tcp://10.233.56.123:3000RET2SHELL\_34\_652\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_76\_SERVICE\_HOST=10.233.56.123RET2SHELL\_34\_656\_PORT\_3000\_TCP\_ADDR=10.233.17.192KUBERNETES\_PORT\_443\_TCP\_ADDR=10.233.0.1RET2SHELL\_34\_261\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_654\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_78\_PORT\_3000\_TCP=tcp://10.233.37.202:3000RET2SHELL\_34\_513\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/bun-node-fallback-binRET2SHELL\_34\_370\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_654\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_388\_PORT\_3000\_TCP\_ADDR=10.233.2.153RET2SHELL\_34\_322\_PORT\_3000\_TCP=tcp://10.233.46.29:3000RET2SHELL\_34\_78\_SERVICE\_HOST=10.233.37.202RET2SHELL\_34\_656\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_488\_PORT\_3000\_TCP\_ADDR=10.233.29.73RET2SHELL\_34\_322\_SERVICE\_HOST=10.233.46.29RET2SHELL\_34\_335\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000KUBERNETES\_PORT\_443\_TCP\_PORT=443RET2SHELL\_34\_261\_PORT\_3000\_TCP=tcp://10.233.32.69:3000KUBERNETES\_PORT\_443\_TCP\_PROTO=tcpRET2SHELL\_34\_656\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_513\_PORT\_3000\_TCP=tcp://10.233.38.34:3000RET2SHELL\_34\_642\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_652\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_513\_SERVICE\_HOST=10.233.38.34RET2SHELL\_34\_388\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_370\_PORT\_3000\_TCP=tcp://10.233.50.48:3000RET2SHELL\_34\_261\_SERVICE\_HOST=10.233.32.69RET2SHELL\_34\_335\_PORT\_3000\_TCP=tcp://10.233.36.17:3000RET2SHELL\_34\_388\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_488\_PORT\_3000\_TCP\_PORT=3000RET2SHELL\_34\_370\_SERVICE\_HOST=10.233.50.48RET2SHELL\_34\_76\_SERVICE\_PORT=3000RET2SHELL\_34\_488\_PORT\_3000\_TCP\_PROTO=tcpRET2SHELL\_34\_654\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_76\_PORT=tcp://10.233.56.123:3000RET2SHELL\_34\_335\_SERVICE\_HOST=10.233.36.17RET2SHELL\_34\_642\_PORT\_3000\_TCP=tcp://10.233.7.77:3000RET2SHELL\_34\_642\_SERVICE\_HOST=10.233.7.77RET2SHELL\_34\_652\_PORT\_3000\_TCP=tcp://10.233.4.122:3000RET2SHELL\_34\_78\_PORT=tcp://10.233.37.202:3000RET2SHELL\_34\_78\_SERVICE\_PORT=3000RET2SHELL\_34\_656\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_652\_SERVICE\_HOST=10.233.4.122RET2SHELL\_34\_322\_PORT=tcp://10.233.46.29:3000RET2SHELL\_34\_322\_SERVICE\_PORT=3000RET2SHELL\_34\_654\_PORT\_3000\_TCP=tcp://10.233.10.93:3000RET2SHELL\_34\_388\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_654\_SERVICE\_HOST=10.233.10.93KUBERNETES\_SERVICE\_PORT\_HTTPS=443KUBERNETES\_PORT\_443\_TCP=tcp://10.233.0.1:443RET2SHELL\_34\_261\_PORT=tcp://10.233.32.69:3000RET2SHELL\_34\_488\_SERVICE\_PORT\_SIGNIN\_TEST\_FILEREPLACER=3000RET2SHELL\_34\_513\_SERVICE\_PORT=3000RET2SHELL\_34\_261\_SERVICE\_PORT=3000RET2SHELL\_34\_656\_PORT\_3000\_TCP=tcp://10.233.17.192:3000RET2SHELL\_34\_513\_PORT=tcp://10.233.38.34:3000RET2SHELL\_34\_370\_SERVICE\_PORT=3000RET2SHELL\_34\_656\_SERVICE\_HOST=10.233.17.192RET2SHELL\_34\_370\_PORT=tcp://10.233.50.48:3000RET2SHELL\_34\_335\_SERVICE\_PORT=3000RET2SHELL\_34\_335\_PORT=tcp://10.233.36.17:3000RET2SHELL\_34\_388\_PORT\_3000\_TCP=tcp://10.233.2.153:3000KUBERNETES\_SERVICE\_HOST=10.233.0.1PWD=/home/ctfRET2SHELL\_34\_488\_PORT\_3000\_TCP=tcp://10.233.29.73:3000RET2SHELL\_34\_642\_PORT=tcp://10.233.7.77:3000RET2SHELL\_34\_388\_SERVICE\_HOST=10.233.2.153RET2SHELL\_34\_642\_SERVICE\_PORT=3000RET2SHELL\_34\_488\_SERVICE\_HOST=10.233.29.73RET2SHELL\_34\_652\_SERVICE\_PORT=3000RET2SHELL\_34\_652\_PORT=tcp://10.233.4.122:3000FLAG=VNCTFRET2SHELL\_34\_654\_PORT=tcp://10.233.10.93:3000RET2SHELL\_34\_654\_SERVICE\_PORT=3000NODE\_ENV=productionBUN\_RUNTIME\_TRANSPILER\_CACHE\_PATH=0</span><br></pre></td></tr></table></figure>
<p>注意到了其中的<code>FLAG=VNCTF</code>，后面则是其他的内容，则已经定位到flag了，接下来要绕过sed的替换就很简单了，直接输入<code>\0</code>绕过替换，得到FLAG&#x3D;<font color=deepskyblue><strong>VNCTF{W3lc0M3_4nd_HAvE_@-g0OD_tlmE_qfX08kJju3Sr@39@G3V7Pe}</strong></font>.</p>
<h2 id="Crypto方向"><a href="#Crypto方向" class="headerlink" title="Crypto方向:"></a>Crypto方向:</h2><h3 id="Easymath"><a href="#Easymath" class="headerlink" title="Easymath:"></a>Easymath:</h3><p>题目给出了一个多项式，是x减去三个质数的数的乘积，则二次项、一次项、常数项系数分别对应<code>-(n0+n1+n2)</code>、<code>(n0n1+n1n2+n0n2)</code>、<code>n0n1n2</code>，写出脚本求解：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> symbols, solve</span><br><span class="line"></span><br><span class="line">x = symbols(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">a = <span class="number">15264966144147258587171776703005926730518438603688487721465</span>  <span class="comment"># m + n + p</span></span><br><span class="line">b = <span class="number">76513250180666948190254989703768338299723386154619468700730085586057638716434556720233473454400881002065319569292923</span>  <span class="comment"># mn + mp + np</span></span><br><span class="line">c = <span class="number">125440939526343949494022113552414275560444252378483072729156599143746741258532431664938677330319449789665352104352620658550544887807433866999963624320909981994018431526620619</span>  <span class="comment"># mnp</span></span><br><span class="line">polynomial = x**<span class="number">3</span> - a*x**<span class="number">2</span> + b*x - c</span><br><span class="line"></span><br><span class="line">roots = solve(polynomial, x)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;The roots (values of m, n, p) are: &quot;</span>, roots)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(roots[i])</span><br><span class="line">n = roots[<span class="number">0</span>]*roots[<span class="number">1</span>]*roots[<span class="number">2</span>]</span><br><span class="line">phin = (roots[<span class="number">0</span>]-<span class="number">1</span>)*(roots[<span class="number">1</span>]-<span class="number">1</span>)*(roots[<span class="number">2</span>]-<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(phin)</span><br></pre></td></tr></table></figure>
<p>得到解和N：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">The roots (values of m, n, p) are:  </span><br><span class="line">[<span class="number">3868765709106144154703556118635822400623994075212553582411</span>, </span><br><span class="line"><span class="number">5487564316951417093934647798659941512646442958127439071827</span>, </span><br><span class="line"><span class="number">5908636118089697338533572785710162817248001570348495067227</span>]</span><br><span class="line">N=<span class="number">125440939526343949494022113552414275560444252378483072729156599143746741258532431664938677330319449789665352104352620658550544887807433866999963624320909981994018431526620619</span></span><br></pre></td></tr></table></figure>
<p>然后flag是用e&#x3D;2加密的，用中国剩余定理求解：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> mod_inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n0 = <span class="number">3868765709106144154703556118635822400623994075212553582411</span></span><br><span class="line">n1 = <span class="number">5487564316951417093934647798659941512646442958127439071827</span></span><br><span class="line">n2 = <span class="number">5908636118089697338533572785710162817248001570348495067227</span></span><br><span class="line">c = <span class="number">24884251313604275189259571459005374365204772270250725590014651519125317134307160341658199551661333326703566996431067426138627332156507267671028553934664652787411834581708944</span></span><br><span class="line">N = n0 * n1 * n2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modular_sqrt</span>(<span class="params">a, p</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">legendre_symbol</span>(<span class="params">a, p</span>):</span><br><span class="line">        ls = <span class="built_in">pow</span>(a, (p - <span class="number">1</span>) // <span class="number">2</span>, p)</span><br><span class="line">        <span class="keyword">if</span> ls == p - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> ls</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> legendre_symbol(a, p) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">elif</span> p == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    <span class="keyword">elif</span> p % <span class="number">4</span> == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(a, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">    s = p - <span class="number">1</span></span><br><span class="line">    e = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> s % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        s //= <span class="number">2</span></span><br><span class="line">        e += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    n = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> legendre_symbol(n, p) != -<span class="number">1</span>:</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    x = <span class="built_in">pow</span>(a, (s + <span class="number">1</span>) // <span class="number">2</span>, p)</span><br><span class="line">    b = <span class="built_in">pow</span>(a, s, p)</span><br><span class="line">    g = <span class="built_in">pow</span>(n, s, p)</span><br><span class="line">    r = e</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        t = b</span><br><span class="line">        m = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(r):</span><br><span class="line">            <span class="keyword">if</span> t == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            t = <span class="built_in">pow</span>(t, <span class="number">2</span>, p)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> m == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">        gs = <span class="built_in">pow</span>(g, <span class="number">2</span> ** (r - m - <span class="number">1</span>), p)</span><br><span class="line">        g = (gs * gs) % p</span><br><span class="line">        x = (x * gs) % p</span><br><span class="line">        b = (b * g) % p</span><br><span class="line">        r = m</span><br><span class="line"></span><br><span class="line">sqrt_n0 = modular_sqrt(c % n0, n0)</span><br><span class="line">sqrt_n1 = modular_sqrt(c % n1, n1)</span><br><span class="line">sqrt_n2 = modular_sqrt(c % n2, n2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chinese_remainder_theorem</span>(<span class="params">items</span>):</span><br><span class="line">    total = <span class="number">0</span></span><br><span class="line">    prod = reduce(<span class="keyword">lambda</span> a, b: a*b, (item[<span class="number">1</span>] <span class="keyword">for</span> item <span class="keyword">in</span> items))</span><br><span class="line">    <span class="keyword">for</span> a, n <span class="keyword">in</span> items:</span><br><span class="line">        p = prod // n</span><br><span class="line">        total += a * mod_inverse(p, n) * p</span><br><span class="line">    <span class="keyword">return</span> total % prod</span><br><span class="line"></span><br><span class="line">possible_flags = []</span><br><span class="line"><span class="keyword">for</span> sign0 <span class="keyword">in</span> [<span class="number">1</span>, -<span class="number">1</span>]:</span><br><span class="line">    <span class="keyword">for</span> sign1 <span class="keyword">in</span> [<span class="number">1</span>, -<span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">for</span> sign2 <span class="keyword">in</span> [<span class="number">1</span>, -<span class="number">1</span>]:</span><br><span class="line">            items = [(sign0*sqrt_n0, n0), (sign1*sqrt_n1, n1),</span><br><span class="line">                     (sign2*sqrt_n2, n2)]</span><br><span class="line">            possible_flag = chinese_remainder_theorem(items)</span><br><span class="line">            possible_flags.append(possible_flag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(possible_flags)):</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(possible_flags[i]))</span><br></pre></td></tr></table></figure>
<p>输出如下：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;9\xb3\x11\x03\*o\xd4v\xbcU@\x14R\xd4\xa5\xf1&#x27;nX\xe0V\x0e\x98\x92\x05\x19\x0750\x19\xdc\x8d\xb9\xee\xc9\x90\x00\xe9\xa4\xab:\xc6qh5`\x83G\x80@\n\xf6`\x0b|#\xd9\x90,\xb1\x07\xa5\xcba\x81\xb1\x19f\xcb\xd2\xb8\xc6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;&gt;PO\x0eF\x7f\\$\xf8\x9e!\xf6\x05\x11\x0c\xd5v\x0cY\xa3\xe4\xbf\xf4\xe8|y \xa2\xeet\x0bm\\\xf7\x0cX\x80&lt;\x1d\xd06\x9b0\xf5%\x16\xc0\xb6v\x96)\n\xde\x1a\xc5!\xfa%\x11$\xe6h\x84\xc1\xb4\xda\x01\x11\xb5kFS&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;&#125;\x8f\x96I\xdf\xd5j\xfa\xff\xe2N\x02\x9a@\x90vO\xef\xe9\xa7&lt;7\xb72\xa5\xeb6\x88\x19\xbcs\xec\xb2H\xd4\xe1\_\x8b\xab\xfd\xdc\x9b:\n\xad\x15\xa3m\xd1k\xceb\x00\xb3\x06P\x99\xf1\x93\xc6z/\x888\x9dI\x91h\xf4Ex\xbb&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;VNCTF&#123;90dcfb2dfb21a21e0c8715cbf3643f4a47d3e2e4b3f7b7975954e6d9701d9648&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;\x81\x807\xceSW\xfc6\xdbbi\x17\x88\x18.\x8d\xda)\x87\xa8f\x86I(V\xda\xe1\x93mO\xdd\xff\xee\xe4\xafC\x12ub\xbai\xa7\x92\xcd8\x01x\x18`\xf5&#125;\xb2\x10O\xe0\xe4H\x1c\x0fo\xec)\xcf\*p\x0f\xb0\xa1qu\x95N&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">b&quot;\x04F\xef\xc7\xc7\xc9\x0cu\x0b\xe4~&#123;P\n\x02&#125;\xeck\xcfb\\\x7f\xf7&amp;\x14&#x27;\xe2&lt;\x88\xf6\xccyo\xd2\x0e\x95\x19\x1e\x17\xf0\xc4p\x8c&#x27;\xbdQ\t\x0c\xc2\xef\xe6\xb2F\xd6\x11\xc8\xe7\_\xb0\x0e\xa8^\x80)\x02\xf7\x83q\xb3dU\x10&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;C\x867\x03a\x1f\x1bK\x13(\xaa\x87\xe59\x86\x1e\xc6O\_e\xb3\xf7\xb9p=\x99\xf8!\xb4?4\xf8\xc5#\xd7\x1d\xf8m\xa6\x1ejp\x95=EO\xeb\xc4\x1d\xc5\x8c\tinR\xf7\x87,2\xb0&lt;%\x83\x9f\xebg\x13\xc8\xf2&gt;\x87x&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="string">b&#x27;H#u\x0e&#125;.\xa2\xf9Oq\x8ci\x97u\xed\x03\x14\xed`)B\xa9\x15\xc6\xb4\xfa\x11\x8fr\x99c\xd8h,\x19\xe6w\xc0\x1fCfET\xca5\x06)3\x14\x1b\xaa\x1d\xe7&#125;\x9b\xf5\xa7\xc1\x17$\x1a\xe8=\x00\x1e\x8f\xfbs\xdb\xd7\x15\x05&#x27;</span></span><br></pre></td></tr></table></figure>
<p>则flag为<font color=deepskyblue><strong>VNCTF{90dcfb2dfb21a21e0c8715cbf3643f4a47d3e2e4b3f7b7975954e6d9701d9648}</strong></font>.</p>
<h2 id="Misc方向"><a href="#Misc方向" class="headerlink" title="Misc方向:"></a>Misc方向:</h2><h3 id="VN-Lang"><a href="#VN-Lang" class="headerlink" title="VN_Lang:"></a>VN_Lang:</h3><p>Ida打开，动态调试，搜索字符串，找到flag：<font color=deepskyblue><strong>VNCTF{CtJBEEFcPvlcJISEfe18ncSWLf4JB8BwlmJD0T0NM2hQQ}</strong></font>.</p>
<h2 id="Reverse方向"><a href="#Reverse方向" class="headerlink" title="Reverse方向:"></a>Reverse方向:</h2><h3 id="kotlindroid"><a href="#kotlindroid" class="headerlink" title="kotlindroid:"></a>kotlindroid:</h3><p>代码含有混淆jadx没法正确反编译，用jeb反编译，仔细检查后发现了一个关键的activity：<code>SearchAcitivityKt</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">SearchActivityKt</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Brush gradient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">List</span> <span class="variable">list0</span> <span class="operator">=</span> CollectionsKt.listOf(<span class="keyword">new</span> <span class="title class_">Color</span>[]&#123;Color.box-impl(<span class="number">0xFFFF000000000000L</span>), Color.box-impl(<span class="number">0xFF0000FF00000000L</span>), Color.box-impl(<span class="number">0xFF00FF0000000000L</span>)&#125;);</span><br><span class="line">        SearchActivityKt.gradient = Companion.horizontalGradient-8A-3gB4$<span class="keyword">default</span>(Brush.Companion, list0, <span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">Button</span><span class="params">(String text, Composer $composer, <span class="type">int</span> $changed)</span> &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter(text, <span class="string">&quot;text&quot;</span>);</span><br><span class="line">        <span class="type">Composer</span> <span class="variable">composer1</span> <span class="operator">=</span> $composer.startRestartGroup(<span class="number">0xF00ABC3C</span>);</span><br><span class="line">        ComposerKt.sourceInformation(composer1, <span class="string">&quot;C(Button)74@2243L7,75@2255L848:SearchActivity.kt#w7hpty&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(((($changed &amp; <span class="number">14</span>) == <span class="number">0</span> ? $changed | (composer1.changed(text) ? <span class="number">4</span> : <span class="number">2</span>) : $changed) &amp; <span class="number">11</span>) == <span class="number">2</span> &amp;&amp; (composer1.getSkipping())) &#123;</span><br><span class="line">            composer1.skipToGroupEnd();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            ComposerKt.sourceInformationMarkerStart(composer1, <span class="number">0x789C5F52</span>, <span class="string">&quot;CC:CompositionLocal.kt#9igjgp&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">object0</span> <span class="operator">=</span> composer1.consume(((CompositionLocal)AndroidCompositionLocals_androidKt.getLocalContext()));</span><br><span class="line">            ComposerKt.sourceInformationMarkerEnd(composer1);</span><br><span class="line">            composer1.startReplaceableGroup(<span class="number">0xE32F0E82</span>);</span><br><span class="line">            ComposerKt.sourceInformation(composer1, <span class="string">&quot;CC(Column)P(2,3,1)77@3865L61,78@3931L133:Column.kt#2w3rfo&quot;</span>);</span><br><span class="line">            <span class="type">MeasurePolicy</span> <span class="variable">measurePolicy0</span> <span class="operator">=</span> ColumnKt.columnMeasurePolicy(Arrangement.INSTANCE.getTop(), Alignment.Companion.getCenterHorizontally(), composer1, <span class="number">0x30</span>);</span><br><span class="line">            composer1.startReplaceableGroup(-<span class="number">1323940314</span>);</span><br><span class="line">            ComposerKt.sourceInformation(composer1, <span class="string">&quot;CC(Layout)P(!1,2)78@3182L23,80@3272L420:Layout.kt#80mrfh&quot;</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> ComposablesKt.getCurrentCompositeKeyHash(composer1, <span class="number">0</span>);</span><br><span class="line">            <span class="type">CompositionLocalMap</span> <span class="variable">compositionLocalMap0</span> <span class="operator">=</span> composer1.getCurrentCompositionLocalMap();</span><br><span class="line">            <span class="type">Function0</span> <span class="variable">function00</span> <span class="operator">=</span> ComposeUiNode.Companion.getConstructor();</span><br><span class="line">            <span class="type">Function3</span> <span class="variable">function30</span> <span class="operator">=</span> LayoutKt.modifierMaterializerOf(AlignmentLineKt.paddingFromBaseline-VpY3zN4(((Modifier)Modifier.Companion), <span class="number">800.0f</span>, <span class="number">16.0f</span>));</span><br><span class="line">            <span class="keyword">if</span>(!(composer1.getApplier() <span class="keyword">instanceof</span> Applier)) &#123;</span><br><span class="line">                ComposablesKt.invalidApplier();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            composer1.startReusableNode();</span><br><span class="line">            <span class="keyword">if</span>(composer1.getInserting()) &#123;</span><br><span class="line">                composer1.createNode(function00);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                composer1.useNode();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="type">Composer</span> <span class="variable">composer2</span> <span class="operator">=</span> Updater.constructor-impl(composer1);</span><br><span class="line">            Updater.set-impl(composer2, measurePolicy0, ComposeUiNode.Companion.getSetMeasurePolicy());</span><br><span class="line">            Updater.set-impl(composer2, compositionLocalMap0, ComposeUiNode.Companion.getSetResolvedCompositionLocals());</span><br><span class="line">            <span class="type">Function2</span> <span class="variable">function20</span> <span class="operator">=</span> ComposeUiNode.Companion.getSetCompositeKeyHash();</span><br><span class="line">            <span class="keyword">if</span>((composer2.getInserting()) || !Intrinsics.areEqual(composer2.rememberedValue(), Integer.valueOf(v1))) &#123;</span><br><span class="line">                composer2.updateRememberedValue(Integer.valueOf(v1));</span><br><span class="line">                composer2.apply(Integer.valueOf(v1), function20);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            function30.invoke(SkippableUpdater.box-impl(SkippableUpdater.constructor-impl(composer1)), composer1, Integer.valueOf(<span class="number">0</span>));</span><br><span class="line">            composer1.startReplaceableGroup(<span class="number">2058660585</span>);</span><br><span class="line">            ComposerKt.sourceInformationMarkerStart(composer1, <span class="number">0x107E0298</span>, <span class="string">&quot;C79@3979L9:Column.kt#2w3rfo&quot;</span>);</span><br><span class="line">            <span class="type">ColumnScope</span> <span class="variable">$this$Button_u24lambda_u247</span> <span class="operator">=</span> (ColumnScope)ColumnScopeInstance.INSTANCE;</span><br><span class="line">            ComposerKt.sourceInformationMarkerStart(composer1, <span class="number">0x86B909DE</span>, <span class="string">&quot;C83@2477L620:SearchActivity.kt#w7hpty&quot;</span>);</span><br><span class="line">            ButtonKt.Button(() -&gt; &#123;</span><br><span class="line">                Intrinsics.checkNotNullParameter(text, <span class="string">&quot;$text&quot;</span>);</span><br><span class="line">                Intrinsics.checkNotNullParameter(((Context)object0), <span class="string">&quot;$context&quot;</span>);</span><br><span class="line">                <span class="type">Collection</span> <span class="variable">destination$iv$iv</span> <span class="operator">=</span> (Collection)<span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">8</span>);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="number">0</span>; v1 &lt; <span class="number">8</span>; ++v1) &#123;</span><br><span class="line">                    destination$iv$iv.add(Byte.valueOf(((<span class="type">byte</span>)(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x76</span>, <span class="number">99</span>, <span class="number">101</span>, <span class="number">0x7E</span>, <span class="number">0x7C</span>, <span class="number">0x72</span>, <span class="number">110</span>, <span class="number">100</span>&#125;[v1] ^ <span class="number">23</span>))));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="type">byte</span>[] arr_b = CollectionsKt.toByteArray(((Collection)(((List)destination$iv$iv))));</span><br><span class="line">                <span class="type">Collection</span> <span class="variable">destination$iv$iv</span> <span class="operator">=</span> (Collection)<span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">8</span>);</span><br><span class="line">                <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>; v &lt; <span class="number">8</span>; ++v) &#123;</span><br><span class="line">                    destination$iv$iv.add(Byte.valueOf(((<span class="type">byte</span>)(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x7B</span>, <span class="number">0x71</span>, <span class="number">109</span>, <span class="number">99</span>, <span class="number">97</span>, <span class="number">0x7A</span>, <span class="number">0x7C</span>, <span class="number">105</span>&#125;[v] ^ <span class="number">8</span>))));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                SearchActivityKt.check(text, ((Context)object0), ArraysKt.plus(arr_b, CollectionsKt.toByteArray(((Collection)(((List)destination$iv$iv))))));</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;,         <span class="comment">// onClick:kotlin.jvm.functions.Function0</span></span><br><span class="line">                            SizeKt.fillMaxWidth$<span class="keyword">default</span>(PaddingKt.padding-3ABfNKs(((Modifier)Modifier.Companion), <span class="number">16.0f</span>), <span class="number">0.0f</span>, <span class="number">1</span>, <span class="literal">null</span>), <span class="comment">// modifier:androidx.compose.ui.Modifier</span></span><br><span class="line">                            <span class="literal">false</span>, <span class="comment">// enabled:boolean</span></span><br><span class="line">                            <span class="literal">null</span>, <span class="comment">// shape:androidx.compose.ui.graphics.Shape</span></span><br><span class="line">                            <span class="literal">null</span>, <span class="comment">// colors:androidx.compose.material3.ButtonColors</span></span><br><span class="line">                            <span class="literal">null</span>, <span class="comment">// elevation:androidx.compose.material3.ButtonElevation</span></span><br><span class="line">                            <span class="literal">null</span>, <span class="comment">// border:androidx.compose.foundation.BorderStroke</span></span><br><span class="line">                            <span class="literal">null</span>, <span class="comment">// contentPadding:androidx.compose.foundation.layout.PaddingValues</span></span><br><span class="line">                            <span class="literal">null</span>, <span class="comment">// interactionSource:androidx.compose.foundation.interaction.MutableInteractionSource</span></span><br><span class="line">                            ComposableSingletons.SearchActivityKt.INSTANCE.getLambda-<span class="number">4</span>$app_debug(), <span class="comment">// content:kotlin.jvm.functions.Function3</span></span><br><span class="line">                            composer1, <span class="comment">// $composer:androidx.compose.runtime.Composer</span></span><br><span class="line">                            <span class="number">0x30000030</span>, <span class="comment">// $changed:int</span></span><br><span class="line">                            <span class="number">508</span> <span class="comment">// v1:int</span></span><br><span class="line">                            );</span><br><span class="line">            ComposerKt.sourceInformationMarkerEnd(composer1);</span><br><span class="line">            ComposerKt.sourceInformationMarkerEnd(composer1);</span><br><span class="line">            composer1.endReplaceableGroup();</span><br><span class="line">            composer1.endNode();</span><br><span class="line">            composer1.endReplaceableGroup();</span><br><span class="line">            composer1.endReplaceableGroup();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">ScopeUpdateScope</span> <span class="variable">scopeUpdateScope0</span> <span class="operator">=</span> composer1.endRestartGroup();</span><br><span class="line">        <span class="keyword">if</span>(scopeUpdateScope0 != <span class="literal">null</span>) &#123;</span><br><span class="line">            scopeUpdateScope0.updateScope((Composer composer0, <span class="comment">/* MISSING LAMBDA PARAMETER */</span>) -&gt; &#123;</span><br><span class="line">                Intrinsics.checkNotNullParameter(text, <span class="string">&quot;$text&quot;</span>);</span><br><span class="line">                SearchActivityKt.Button(text, composer0, RecomposeScopeImplKt.updateChangedFlags($changed | <span class="number">1</span>));</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Detected as a lambda impl.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unit Button$lambda$<span class="number">7</span>$lambda$<span class="number">6</span>(String $text, Context $context) &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter($text, <span class="string">&quot;$text&quot;</span>);</span><br><span class="line">        Intrinsics.checkNotNullParameter($context, <span class="string">&quot;$context&quot;</span>);</span><br><span class="line">        <span class="type">Collection</span> <span class="variable">destination$iv$iv</span> <span class="operator">=</span> (Collection)<span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="number">0</span>; v1 &lt; <span class="number">8</span>; ++v1) &#123;</span><br><span class="line">            destination$iv$iv.add(Byte.valueOf(((<span class="type">byte</span>)(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x76</span>, <span class="number">99</span>, <span class="number">101</span>, <span class="number">0x7E</span>, <span class="number">0x7C</span>, <span class="number">0x72</span>, <span class="number">110</span>, <span class="number">100</span>&#125;[v1] ^ <span class="number">23</span>))));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] arr_b = CollectionsKt.toByteArray(((Collection)(((List)destination$iv$iv))));</span><br><span class="line">        <span class="type">Collection</span> <span class="variable">destination$iv$iv</span> <span class="operator">=</span> (Collection)<span class="keyword">new</span> <span class="title class_">ArrayList</span>(<span class="number">8</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>; v &lt; <span class="number">8</span>; ++v) &#123;</span><br><span class="line">            destination$iv$iv.add(Byte.valueOf(((<span class="type">byte</span>)(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x7B</span>, <span class="number">0x71</span>, <span class="number">109</span>, <span class="number">99</span>, <span class="number">97</span>, <span class="number">0x7A</span>, <span class="number">0x7C</span>, <span class="number">105</span>&#125;[v] ^ <span class="number">8</span>))));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SearchActivityKt.check($text, $context, ArraysKt.plus(arr_b, CollectionsKt.toByteArray(((Collection)(((List)destination$iv$iv))))));</span><br><span class="line">        <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    String Decryptor: 1 succeeded, 1 failed</span></span><br><span class="line"><span class="comment">    - Failure: access$generateIV()&lt;byte[]&gt; @ Lcom/atri/ezcompose/SearchActivityKt$sec$1;-&gt;invokeSuspend(Ljava/lang/Object;)Ljava/lang/Object;+76h</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] access$generateIV() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">49</span>, <span class="number">49</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">49</span>, <span class="number">52</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">check</span><span class="params">(String text, Context context, <span class="type">byte</span>[] key)</span> &#123;</span><br><span class="line">        SearchActivityKt.sec(context, <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(key, <span class="string">&quot;AES&quot;</span>), text, (String flag) -&gt; &#123;</span><br><span class="line">            Intrinsics.checkNotNullParameter(context, <span class="string">&quot;$context&quot;</span>);</span><br><span class="line">            Intrinsics.checkNotNullParameter(flag, <span class="string">&quot;flag&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(Intrinsics.areEqual(flag, <span class="string">&quot;MTE0NTE0HMuJKLOW1BqCAi2MxpHYjGjpPq82XXQ/jgx5WYrZ2MV53a9xjQVbRaVdRiXFrSn6EcQPzA==&quot;</span>)) &#123;</span><br><span class="line">                Toast.makeText(context, ((CharSequence)<span class="string">&quot;Congratulations! :)&quot;</span>), <span class="number">0</span>).show();</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Toast.makeText(context, ((CharSequence)<span class="string">&quot;Wrong :(&quot;</span>), <span class="number">0</span>).show();</span><br><span class="line">            <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Detected as a lambda impl.</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Unit check$lambda$<span class="number">14</span>(Context $context, String flag) &#123;</span><br><span class="line">        Intrinsics.checkNotNullParameter($context, <span class="string">&quot;$context&quot;</span>);</span><br><span class="line">        Intrinsics.checkNotNullParameter(flag, <span class="string">&quot;flag&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(Intrinsics.areEqual(flag, <span class="string">&quot;MTE0NTE0HMuJKLOW1BqCAi2MxpHYjGjpPq82XXQ/jgx5WYrZ2MV53a9xjQVbRaVdRiXFrSn6EcQPzA==&quot;</span>)) &#123;</span><br><span class="line">            Toast.makeText($context, ((CharSequence)<span class="string">&quot;Congratulations! :)&quot;</span>), <span class="number">0</span>).show();</span><br><span class="line">            <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Toast.makeText($context, ((CharSequence)<span class="string">&quot;Wrong :(&quot;</span>), <span class="number">0</span>).show();</span><br><span class="line">        <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Cipher <span class="title function_">createCipher</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher0</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/GCM/NoPadding&quot;</span>);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(cipher0, <span class="string">&quot;getInstance(...)&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> cipher0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// String Decryptor: 1 succeeded, 0 failed</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] generateIV() &#123;</span><br><span class="line">        <span class="type">byte</span>[] arr_b = <span class="string">&quot;114514&quot;</span>.getBytes(Charsets.UTF_8);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(arr_b, <span class="string">&quot;getBytes(...)&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> arr_b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> GCMParameterSpec <span class="title function_">getGCMParameterSpec</span><span class="params">(<span class="type">byte</span>[] iv)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">GCMParameterSpec</span>(<span class="number">0x80</span>, iv);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Brush <span class="title function_">getGradient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SearchActivityKt.gradient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">sec</span><span class="params">(Context context, SecretKeySpec secretKey, String text, Function1 onResult)</span> &#123;</span><br><span class="line">        BuildersKt__Builders_commonKt.launch$<span class="keyword">default</span>(CoroutineScopeKt.CoroutineScope(((CoroutineContext)Dispatchers.getIO())), <span class="literal">null</span>, <span class="literal">null</span>, ((Function2)<span class="keyword">new</span> <span class="title class_">SearchActivityKt</span>.sec<span class="number">.1</span>(secretKey, text, onResult, <span class="literal">null</span>)), <span class="number">3</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察得到很明显的AES-GCM加密，密钥是<code>(new byte[]&#123;0x76, 99, 101, 0x7E, 0x7C, 0x72, 110, 100&#125;[v1] ^ 23)</code>和<code>(new byte[]&#123;0x7B, 0x71, 109, 99, 97, 0x7A, 0x7C, 105&#125;[v] ^ 8)</code>的拼合（<font color=red><strong>atrikeyssyekirta</strong></font>），iv是<code>new byte[]&#123;49, 49, 52, 53, 49, 52&#125;</code>（<font color=red><strong>114514</strong></font>），密文base64是<font color=lime><strong>“MTE0NTE0HMuJKLOW1BqCAi2MxpHYjGjpPq82XXQ&#x2F;jgx5WYrZ2MV53a9xjQVbRaVdRiXFrSn6EcQPzA&#x3D;&#x3D;”</strong></font>，动态调试发现密文的前6字节是iv，后16字节是GCM模式特有的验证tag，至此把内容全部输入cyberchef解密发现并不正确，接着动态调试，找到一个关键的加密函数<code>SearchActivityKt.sec.1</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">SearchActivityKt</span>.sec<span class="number">.1</span> <span class="keyword">extends</span> <span class="title class_">SuspendLambda</span> <span class="keyword">implements</span> <span class="title class_">Function2</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> Function1 $onResult;</span><br><span class="line">    <span class="keyword">final</span> SecretKeySpec $secretKey;</span><br><span class="line">    <span class="keyword">final</span> String $text;</span><br><span class="line">    <span class="type">int</span> label;</span><br><span class="line"></span><br><span class="line">    SearchActivityKt.sec<span class="number">.1</span>(SecretKeySpec secretKeySpec0, String s, Function1 function10, Continuation continuation0) &#123;</span><br><span class="line">        <span class="built_in">this</span>.$secretKey = secretKeySpec0;</span><br><span class="line">        <span class="built_in">this</span>.$text = s;</span><br><span class="line">        <span class="built_in">this</span>.$onResult = function10;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">2</span>, continuation0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Continuation <span class="title function_">create</span><span class="params">(Object object0, Continuation continuation0)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (Continuation)<span class="keyword">new</span> <span class="title class_">SearchActivityKt</span>.sec<span class="number">.1</span>(<span class="built_in">this</span>.$secretKey, <span class="built_in">this</span>.$text, <span class="built_in">this</span>.$onResult, continuation0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object object0, Object object1)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.invoke(((CoroutineScope)object0), ((Continuation)object1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invoke</span><span class="params">(CoroutineScope coroutineScope0, Continuation continuation0)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((SearchActivityKt.sec<span class="number">.1</span>)<span class="built_in">this</span>.create(coroutineScope0, continuation0)).invokeSuspend(Unit.INSTANCE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invokeSuspend</span><span class="params">(Object object0)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">object1</span> <span class="operator">=</span> IntrinsicsKt.getCOROUTINE_SUSPENDED();</span><br><span class="line">        <span class="keyword">switch</span>(<span class="built_in">this</span>.label) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line">                ResultKt.throwOnFailure(object0);</span><br><span class="line">                SearchActivityKt.sec<span class="number">.1</span> <span class="built_in">this</span> = <span class="built_in">this</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="type">Cipher</span> <span class="variable">cipher0</span> <span class="operator">=</span> SearchActivityKt.createCipher();</span><br><span class="line">                    <span class="type">byte</span>[] arr_b = &#123;<span class="number">49</span>, <span class="number">49</span>, <span class="number">52</span>, <span class="number">53</span>, <span class="number">49</span>, <span class="number">52</span>&#125;;</span><br><span class="line">                    <span class="type">GCMParameterSpec</span> <span class="variable">gCMParameterSpec0</span> <span class="operator">=</span> SearchActivityKt.getGCMParameterSpec(arr_b);</span><br><span class="line">                    cipher0.init(<span class="number">1</span>, ((Key)<span class="built_in">this</span>.$secretKey), ((AlgorithmParameterSpec)gCMParameterSpec0));</span><br><span class="line">                    <span class="type">byte</span>[] arr_b1 = JNI.INSTANCE.getAt().getBytes(Charsets.UTF_8);</span><br><span class="line">                    Intrinsics.checkNotNullExpressionValue(arr_b1, <span class="string">&quot;getBytes(...)&quot;</span>);</span><br><span class="line">                    cipher0.updateAAD(arr_b1);</span><br><span class="line">                    <span class="type">Charset</span> <span class="variable">charset0</span> <span class="operator">=</span> StandardCharsets.UTF_8;</span><br><span class="line">                    Intrinsics.checkNotNullExpressionValue(charset0, <span class="string">&quot;UTF_8&quot;</span>);</span><br><span class="line">                    <span class="type">byte</span>[] arr_b2 = <span class="built_in">this</span>.$text.getBytes(charset0);</span><br><span class="line">                    Intrinsics.checkNotNullExpressionValue(arr_b2, <span class="string">&quot;getBytes(...)&quot;</span>);</span><br><span class="line">                    <span class="type">byte</span>[] arr_b3 = cipher0.doFinal(arr_b2);</span><br><span class="line">                    Intrinsics.checkNotNull(arr_b3);</span><br><span class="line">                    <span class="type">byte</span>[] arr_b4 = ArraysKt.plus(arr_b, arr_b3);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> Base64.encode$<span class="keyword">default</span>(((Base64)Base64.Default), arr_b4, <span class="number">0</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="literal">null</span>);</span><br><span class="line">                    <span class="type">Function2</span> <span class="variable">function20</span> <span class="operator">=</span> (Function2)<span class="keyword">new</span> <span class="title class_">Function2</span>(s, <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">final</span> String $flag;</span><br><span class="line">                        <span class="keyword">final</span> Function1 $onResult;</span><br><span class="line">                        <span class="type">int</span> label;</span><br><span class="line"></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">this</span>.$onResult = function10;</span><br><span class="line">                            <span class="built_in">this</span>.$flag = s;</span><br><span class="line">                            <span class="built_in">super</span>(<span class="number">2</span>, continuation0);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span>  <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> Continuation <span class="title function_">create</span><span class="params">(Object object0, Continuation continuation0)</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> (Continuation)<span class="keyword">new</span> <span class="title class_">com</span>.atri.ezcompose.SearchActivityKt.sec<span class="number">.1</span><span class="number">.1</span>(<span class="built_in">this</span>.$onResult, <span class="built_in">this</span>.$flag, continuation0);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span>  <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">                        <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object object0, Object object1)</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">this</span>.invoke(((CoroutineScope)object0), ((Continuation)object1));</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invoke</span><span class="params">(CoroutineScope coroutineScope0, Continuation continuation0)</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> ((com.atri.ezcompose.SearchActivityKt.sec<span class="number">.1</span><span class="number">.1</span>)<span class="built_in">this</span>.create(coroutineScope0, continuation0)).invokeSuspend(Unit.INSTANCE);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span>  <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invokeSuspend</span><span class="params">(Object object0)</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="built_in">this</span>.label != <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;call to \&#x27;resume\&#x27; before \&#x27;invoke\&#x27; with coroutine&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            ResultKt.throwOnFailure(object0);</span><br><span class="line">                            <span class="built_in">this</span>.$onResult.invoke(<span class="built_in">this</span>.$flag);</span><br><span class="line">                            <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="built_in">this</span>.label = <span class="number">1</span>;</span><br><span class="line">                    <span class="type">Object</span> <span class="variable">object2</span> <span class="operator">=</span> BuildersKt.withContext(((CoroutineContext)Dispatchers.getMain()), function20, ((Continuation)<span class="built_in">this</span>));</span><br><span class="line">                    <span class="keyword">return</span> object2 != object1 ? Unit.INSTANCE : object1;</span><br><span class="line">                label_25:</span><br><span class="line">                    <span class="built_in">this</span> = <span class="built_in">this</span>;</span><br><span class="line">                    ResultKt.throwOnFailure(object0);</span><br><span class="line">                    <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span>(Exception exception0) &#123;</span><br><span class="line">                    Log.e(<span class="string">&quot;sec&quot;</span>, <span class="string">&quot;Error occurred&quot;</span>, ((Throwable)exception0));</span><br><span class="line">                    <span class="type">Function2</span> <span class="variable">function21</span> <span class="operator">=</span> (Function2)<span class="keyword">new</span> <span class="title class_">Function2</span>(<span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">final</span> Function1 $onResult;</span><br><span class="line">                        <span class="type">int</span> label;</span><br><span class="line"></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="built_in">this</span>.$onResult = function10;</span><br><span class="line">                            <span class="built_in">super</span>(<span class="number">2</span>, continuation0);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span>  <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> Continuation <span class="title function_">create</span><span class="params">(Object object0, Continuation continuation0)</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> (Continuation)<span class="keyword">new</span> <span class="title class_">com</span>.atri.ezcompose.SearchActivityKt.sec<span class="number">.1</span><span class="number">.2</span>(<span class="built_in">this</span>.$onResult, continuation0);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span>  <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">                        <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object object0, Object object1)</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="built_in">this</span>.invoke(((CoroutineScope)object0), ((Continuation)object1));</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invoke</span><span class="params">(CoroutineScope coroutineScope0, Continuation continuation0)</span> &#123;</span><br><span class="line">                            <span class="keyword">return</span> ((com.atri.ezcompose.SearchActivityKt.sec<span class="number">.1</span><span class="number">.2</span>)<span class="built_in">this</span>.create(coroutineScope0, continuation0)).invokeSuspend(Unit.INSTANCE);</span><br><span class="line">                        &#125;</span><br><span class="line"></span><br><span class="line">                        <span class="meta">@Override</span>  <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">                        <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invokeSuspend</span><span class="params">(Object object0)</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span>(<span class="built_in">this</span>.label != <span class="number">0</span>) &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;call to \&#x27;resume\&#x27; before \&#x27;invoke\&#x27; with coroutine&quot;</span>);</span><br><span class="line">                            &#125;</span><br><span class="line"></span><br><span class="line">                            ResultKt.throwOnFailure(object0);</span><br><span class="line">                            <span class="built_in">this</span>.$onResult.invoke(<span class="string">&quot;Error occurred&quot;</span>);</span><br><span class="line">                            <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    <span class="built_in">this</span>.label = <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">return</span> BuildersKt.withContext(((CoroutineContext)Dispatchers.getMain()), function21, ((Continuation)<span class="built_in">this</span>)) != object1 ? Unit.INSTANCE : object1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">                <span class="keyword">goto</span> label_25;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">                ResultKt.throwOnFailure(object0);</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">default</span>: &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;call to \&#x27;resume\&#x27; before \&#x27;invoke\&#x27; with coroutine&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意到其中有AAD的加入，动态调试到JNI那一行找到AAD：string@24461:<font color=lime><strong>“mysecretadd”</strong></font>，带入解密，成功解出，得到<font color=deepskyblue><strong>flag：VNCTF{Y0U_@re_th3_Ma5t3r_0f_C0mp0s3}</strong></font>.</p>
<h3 id="Hook-Fish："><a href="#Hook-Fish：" class="headerlink" title="Hook Fish："></a>Hook Fish：</h3><p>观察MainActivity：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BroadcastReceiver downloadCompleteReceiver;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> downloadID;</span><br><span class="line">    <span class="keyword">private</span> DownloadManager downloadManager;</span><br><span class="line">    <span class="keyword">private</span> File downloadedFile;</span><br><span class="line">    String encodeText;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MainActivity</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.downloadCompleteReceiver = <span class="keyword">new</span> <span class="title class_">BroadcastReceiver</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.content.BroadcastReceiver</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onReceive</span><span class="params">(Context context, Intent intent)</span> &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">v</span> <span class="operator">=</span> intent.getLongExtra(<span class="string">&quot;extra_download_id&quot;</span>, -<span class="number">1L</span>);</span><br><span class="line">                <span class="keyword">if</span>(MainActivity.<span class="built_in">this</span>.downloadID == v) &#123;</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.loadClass(MainActivity.<span class="built_in">this</span>.encodeText);</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.fish_fade();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">code</span><span class="params">(<span class="type">char</span>[] a, <span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(index &gt;= a.length - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        a[index] = (<span class="type">char</span>)(a[index] ^ a[index + <span class="number">1</span>]);</span><br><span class="line">        a[index + <span class="number">1</span>] = (<span class="type">char</span>)(a[index] ^ a[index + <span class="number">1</span>]);</span><br><span class="line">        a[index] = (<span class="type">char</span>)(a[index] ^ a[index + <span class="number">1</span>]);</span><br><span class="line">        MainActivity.code(a, index + <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decode</span><span class="params">(String boy)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">class0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.getExternalFilesDir(Environment.DIRECTORY_DOWNLOADS), <span class="string">&quot;hook_fish.dex&quot;</span>).getAbsolutePath(), <span class="built_in">this</span>.getCacheDir().getAbsolutePath(), <span class="literal">null</span>, <span class="built_in">this</span>.getClassLoader()).loadClass(<span class="string">&quot;fish.hook_fish&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">object0</span> <span class="operator">=</span> class0.newInstance();</span><br><span class="line">            <span class="keyword">return</span> (String)class0.getMethod(<span class="string">&quot;decode&quot;</span>, String.class).invoke(object0, boy);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(String girl)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">class0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.getExternalFilesDir(Environment.DIRECTORY_DOWNLOADS), <span class="string">&quot;hook_fish.dex&quot;</span>).getAbsolutePath(), <span class="built_in">this</span>.getCacheDir().getAbsolutePath(), <span class="literal">null</span>, <span class="built_in">this</span>.getClassLoader()).loadClass(<span class="string">&quot;fish.hook_fish&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">object0</span> <span class="operator">=</span> class0.newInstance();</span><br><span class="line">            <span class="keyword">return</span> (String)class0.getMethod(<span class="string">&quot;encode&quot;</span>, String.class).invoke(object0, girl);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] arr_b = str.getBytes();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr_b.length; ++i) &#123;</span><br><span class="line">            arr_b[i] = (<span class="type">byte</span>)(arr_b[i] + <span class="number">68</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">hexStringBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="number">0</span>; v1 &lt; arr_b.length; ++v1) &#123;</span><br><span class="line">            hexStringBuilder.append(String.format(<span class="string">&quot;%02x&quot;</span>, ((<span class="type">byte</span>)arr_b[v1])));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">char</span>[] arr_c = hexStringBuilder.toString().toCharArray();</span><br><span class="line">        MainActivity.code(arr_c, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr_c.length; ++i) &#123;</span><br><span class="line">            arr_c[i] = arr_c[i] &gt;= <span class="number">97</span> &amp;&amp; arr_c[i] &lt;= <span class="number">102</span> ? ((<span class="type">char</span>)(arr_c[i] - <span class="number">49</span> + i % <span class="number">4</span>)) : ((<span class="type">char</span>)(arr_c[i] + <span class="number">55</span> + i % <span class="number">10</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Log.d(<span class="string">&quot;encrypt: &quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>(arr_c));</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(arr_c);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fish</span><span class="params">(String fileUrl)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.getExternalFilesDir(Environment.DIRECTORY_DOWNLOADS), <span class="string">&quot;hook_fish.dex&quot;</span>);</span><br><span class="line">        <span class="type">DownloadManager</span> <span class="variable">downloadManager</span> <span class="operator">=</span> (DownloadManager)<span class="built_in">this</span>.getSystemService(<span class="string">&quot;download&quot;</span>);</span><br><span class="line">        DownloadManager.<span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DownloadManager</span>.Request(Uri.parse(fileUrl));</span><br><span class="line">        request.setTitle(<span class="string">&quot;钓鱼&quot;</span>);</span><br><span class="line">        request.setDestinationUri(Uri.fromFile(file));</span><br><span class="line">        request.setAllowedOverRoaming(<span class="literal">false</span>);</span><br><span class="line">        request.setAllowedOverMetered(<span class="literal">false</span>);</span><br><span class="line">        <span class="built_in">this</span>.downloadID = downloadManager.enqueue(request);</span><br><span class="line">        Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;Fishing......&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">fish_fade</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.getExternalFilesDir(Environment.DIRECTORY_DOWNLOADS), <span class="string">&quot;hook_fish.dex&quot;</span>).delete();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">loadClass</span><span class="params">(String input0)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="built_in">this</span>.encode(input0);</span><br><span class="line">        <span class="type">DexClassLoader</span> <span class="variable">dLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DexClassLoader</span>(Uri.fromFile(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="built_in">this</span>.getExternalFilesDir(Environment.DIRECTORY_DOWNLOADS), <span class="string">&quot;hook_fish.dex&quot;</span>)).toString(), <span class="literal">null</span>, <span class="literal">null</span>, ClassLoader.getSystemClassLoader().getParent());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Class</span> <span class="variable">class0</span> <span class="operator">=</span> dLoader.loadClass(<span class="string">&quot;fish.hook_fish&quot;</span>);</span><br><span class="line">            <span class="type">Object</span> <span class="variable">object0</span> <span class="operator">=</span> class0.newInstance();</span><br><span class="line">            <span class="keyword">if</span>(((Boolean)class0.getMethod(<span class="string">&quot;check&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;).invoke(object0, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;s1&#125;)).booleanValue()) &#123;</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;恭喜，鱼上钩了！&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(layout.activity_main);</span><br><span class="line">        <span class="type">EditText</span> <span class="variable">editText</span> <span class="operator">=</span> (EditText)<span class="built_in">this</span>.findViewById(id.editTextText);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="built_in">this</span>.getString(string.pool);</span><br><span class="line">        <span class="built_in">this</span>.downloadManager = (DownloadManager)<span class="built_in">this</span>.getSystemService(<span class="string">&quot;download&quot;</span>);</span><br><span class="line">        ((Button)<span class="built_in">this</span>.findViewById(id.download_button)).setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> editText.getText().toString();</span><br><span class="line">                <span class="keyword">if</span>(!s.isEmpty()) &#123;</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.encodeText = MainActivity.encrypt(s);</span><br><span class="line">                    MainActivity.<span class="built_in">this</span>.fish(s);</span><br><span class="line">                    <span class="type">List</span> <span class="variable">list0</span> <span class="operator">=</span> Arrays.asList(<span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;鲈鱼&quot;</span>, <span class="string">&quot;鳕鱼&quot;</span>, <span class="string">&quot;甲鱼&quot;</span>, <span class="string">&quot;咸鱼&quot;</span>, <span class="string">&quot;金鱼&quot;</span>, <span class="string">&quot;鲮鱼&quot;</span>, <span class="string">&quot;鲅鱼&quot;</span>, <span class="string">&quot;鲫鱼&quot;</span>, <span class="string">&quot;山椒鱼&quot;</span>, <span class="string">&quot;鮰鱼&quot;</span>&#125;);</span><br><span class="line">                    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;收获一条&quot;</span> + ((String)list0.get(<span class="keyword">new</span> <span class="title class_">Random</span>().nextInt(list0.size()))) + <span class="string">&quot;,但是鱼逃走了&quot;</span>;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>, s1, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>, <span class="string">&quot;请先输入口令，并在联网条件下再钓鱼&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">this</span>.registerReceiver(<span class="built_in">this</span>.downloadCompleteReceiver, <span class="keyword">new</span> <span class="title class_">IntentFilter</span>(<span class="string">&quot;android.intent.action.DOWNLOAD_COMPLETE&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.appcompat.app.AppCompatActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onDestroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onDestroy();</span><br><span class="line">        <span class="built_in">this</span>.unregisterReceiver(<span class="built_in">this</span>.downloadCompleteReceiver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到一个加密和比较的过程，还有一个dex在比较时联网下载，先用frida把dex在动态调试时dump出来：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message, data</span>):</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        payload = message[<span class="string">&#x27;payload&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> payload.get(<span class="string">&#x27;type&#x27;</span>) == <span class="string">&#x27;dex_content&#x27;</span>:</span><br><span class="line">            dex_content = <span class="built_in">bytes</span>(payload.get(<span class="string">&#x27;content&#x27;</span>))</span><br><span class="line">            output_path = <span class="string">&quot;E:/CTF/hook_fish_dumped.dex&quot;</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(output_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(dex_content)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Dex dumped to <span class="subst">&#123;os.path.abspath(output_path)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># JavaScript注入代码</span></span><br><span class="line">jscode = <span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">File</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.io.File&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">FileInputStream</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.io.FileInputStream&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">ByteArrayOutputStream</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.io.ByteArrayOutputStream&#x27;</span>);</span><br><span class="line">    <span class="title class_">File</span>.<span class="property">delete</span>.<span class="title function_">overload</span>().<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> path = <span class="variable language_">this</span>.<span class="title function_">getAbsolutePath</span>();</span><br><span class="line">        <span class="keyword">if</span> (path.<span class="title function_">endsWith</span>(<span class="string">&#x27;hook_fish.dex&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Detected deletion of Dex file: &#x27;</span> + path);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">exists</span>()) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;File does not exist: &quot;</span> + path);</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">delete</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">canRead</span>()) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;No read permission for the file: &quot;</span> + path);</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">delete</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> fis = <span class="title class_">FileInputStream</span>.$new(<span class="variable language_">this</span>);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;File opened successfully.&quot;</span>);</span><br><span class="line">                <span class="keyword">var</span> bos = <span class="title class_">ByteArrayOutputStream</span>.$new();</span><br><span class="line">                <span class="keyword">var</span> buffer = <span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&#x27;byte&#x27;</span>, <span class="title class_">Array</span>(<span class="number">1024</span>).<span class="title function_">fill</span>(<span class="number">0</span>));</span><br><span class="line">                <span class="keyword">var</span> bytesRead;</span><br><span class="line">                <span class="keyword">while</span> ((bytesRead = fis.<span class="title function_">read</span>(buffer)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    bos.<span class="title function_">write</span>(buffer, <span class="number">0</span>, bytesRead);</span><br><span class="line">                &#125;</span><br><span class="line">                fis.<span class="title function_">close</span>();</span><br><span class="line">                <span class="keyword">var</span> byteArray = bos.<span class="title function_">toByteArray</span>();</span><br><span class="line">                <span class="keyword">var</span> resultArray = [];</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; byteArray.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    resultArray.<span class="title function_">push</span>(byteArray[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                bos.<span class="title function_">close</span>();</span><br><span class="line">                <span class="title function_">send</span>(&#123;<span class="attr">type</span>: <span class="string">&quot;dex_content&quot;</span>, <span class="attr">content</span>: resultArray&#125;);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Exception occurred while reading file: &quot;</span> + e);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Stack trace: &quot;</span> + (e.<span class="property">stack</span> ? e.<span class="property">stack</span> : <span class="string">&quot;No stack trace available&quot;</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">delete</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">delete</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">target_process</span>):</span><br><span class="line">    device = frida.get_usb_device()</span><br><span class="line">    pid = device.spawn([target_process])</span><br><span class="line">    session = device.attach(pid)</span><br><span class="line"></span><br><span class="line">    script = session.create_script(jscode)</span><br><span class="line">    script.on(<span class="string">&#x27;message&#x27;</span>, on_message)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Attaching from the process.&#x27;</span>)</span><br><span class="line">    script.load()</span><br><span class="line">    device.resume(pid)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sys.stdin.read()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Detaching from the process.&quot;</span>)</span><br><span class="line">        session.detach()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    process = frida.get_usb_device(-<span class="number">1</span>).enumerate_processes()</span><br><span class="line">    <span class="built_in">print</span>(process)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage: python dump_dex.py &lt;package_name&gt;&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    target_process = sys.argv[<span class="number">1</span>]</span><br><span class="line">    main(target_process)</span><br></pre></td></tr></table></figure>
<p>成功获得dex文件后反编译查看：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> fish;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">hook_fish</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HashMap fish_dcode;</span><br><span class="line">    <span class="keyword">private</span> HashMap fish_ecode;</span><br><span class="line">    <span class="keyword">private</span> String strr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">hook_fish</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strr = <span class="string">&quot;jjjliijijjjjjijiiiiijijiijjiijijjjiiiiijjjjliiijijjjjljjiilijijiiiiiljiijjiiliiiiiiiiiiiljiijijiliiiijjijijjijijijijiilijiijiiiiiijiljijiilijijiiiijjljjjljiliiijjjijiiiljijjijiiiiiiijjliiiljjijiiiliiiiiiljjiijiijiijijijjiijjiijjjijjjljiliiijijiiiijjliijiijiiliiliiiiiiljiijjiiliiijjjliiijjljjiijiiiijiijjiijijjjiiliiliiijiijijijiijijiiijjjiijjijiiiljiijiijilji&quot;</span>;</span><br><span class="line">        <span class="built_in">this</span>.encode_map();</span><br><span class="line">        <span class="built_in">this</span>.decode_map();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s.equals(<span class="built_in">this</span>.strr);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">decode</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">v1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>; v1 &lt; s.length() / <span class="number">5</span>; v += <span class="number">5</span>) &#123;</span><br><span class="line">            stringBuilder0.append(<span class="built_in">this</span>.fish_dcode.get(s.substring(v, v + <span class="number">5</span>)));</span><br><span class="line">            ++v1;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> stringBuilder0.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decode_map</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode = hashMap0;</span><br><span class="line">        hashMap0.put(<span class="string">&quot;iiijj&quot;</span>, Character.valueOf(<span class="string">&#x27;a&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjjii&quot;</span>, Character.valueOf(<span class="string">&#x27;b&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jijij&quot;</span>, Character.valueOf(<span class="string">&#x27;c&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjijj&quot;</span>, Character.valueOf(<span class="string">&#x27;d&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjjjj&quot;</span>, Character.valueOf(<span class="string">&#x27;e&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;ijjjj&quot;</span>, Character.valueOf(<span class="string">&#x27;f&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjjji&quot;</span>, Character.valueOf(<span class="string">&#x27;g&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iijii&quot;</span>, Character.valueOf(<span class="string">&#x27;h&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;ijiji&quot;</span>, Character.valueOf(<span class="string">&#x27;i&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iiiji&quot;</span>, Character.valueOf(<span class="string">&#x27;j&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjjij&quot;</span>, Character.valueOf(<span class="string">&#x27;k&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jijji&quot;</span>, Character.valueOf(<span class="string">&#x27;l&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;ijiij&quot;</span>, Character.valueOf(<span class="string">&#x27;m&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iijji&quot;</span>, Character.valueOf(<span class="string">&#x27;n&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;ijjij&quot;</span>, Character.valueOf(<span class="string">&#x27;o&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jiiji&quot;</span>, Character.valueOf(<span class="string">&#x27;p&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;ijijj&quot;</span>, Character.valueOf(<span class="string">&#x27;q&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jijii&quot;</span>, Character.valueOf(<span class="string">&#x27;r&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iiiii&quot;</span>, Character.valueOf(<span class="string">&#x27;s&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjiij&quot;</span>, Character.valueOf(<span class="string">&#x27;t&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;ijjji&quot;</span>, Character.valueOf(<span class="string">&#x27;u&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jiiij&quot;</span>, Character.valueOf(<span class="string">&#x27;v&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iiiij&quot;</span>, Character.valueOf(<span class="string">&#x27;w&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iijij&quot;</span>, Character.valueOf(<span class="string">&#x27;x&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjiji&quot;</span>, Character.valueOf(<span class="string">&#x27;y&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jijjj&quot;</span>, Character.valueOf(<span class="string">&#x27;z&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iijjl&quot;</span>, Character.valueOf(<span class="string">&#x27;1&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iiilj&quot;</span>, Character.valueOf(<span class="string">&#x27;2&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iliii&quot;</span>, Character.valueOf(<span class="string">&#x27;3&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jiili&quot;</span>, Character.valueOf(<span class="string">&#x27;4&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jilji&quot;</span>, Character.valueOf(<span class="string">&#x27;5&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iliji&quot;</span>, Character.valueOf(<span class="string">&#x27;6&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjjlj&quot;</span>, Character.valueOf(<span class="string">&#x27;7&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;ijljj&quot;</span>, Character.valueOf(<span class="string">&#x27;8&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;iljji&quot;</span>, Character.valueOf(<span class="string">&#x27;9&#x27;</span>));</span><br><span class="line">        <span class="built_in">this</span>.fish_dcode.put(<span class="string">&quot;jjjli&quot;</span>, Character.valueOf(<span class="string">&#x27;0&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">encode</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">stringBuilder0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> <span class="number">0</span>; v &lt; s.length(); ++v) &#123;</span><br><span class="line">            stringBuilder0.append(((String)<span class="built_in">this</span>.fish_ecode.get(Character.valueOf(((<span class="type">char</span>)s.charAt(v))))));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> stringBuilder0.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">encode_map</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">HashMap</span> <span class="variable">hashMap0</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode = hashMap0;</span><br><span class="line">        hashMap0.put(Character.valueOf(<span class="string">&#x27;a&#x27;</span>), <span class="string">&quot;iiijj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;b&#x27;</span>), <span class="string">&quot;jjjii&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;c&#x27;</span>), <span class="string">&quot;jijij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;d&#x27;</span>), <span class="string">&quot;jjijj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;e&#x27;</span>), <span class="string">&quot;jjjjj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;f&#x27;</span>), <span class="string">&quot;ijjjj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;g&#x27;</span>), <span class="string">&quot;jjjji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;h&#x27;</span>), <span class="string">&quot;iijii&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;i&#x27;</span>), <span class="string">&quot;ijiji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;j&#x27;</span>), <span class="string">&quot;iiiji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;k&#x27;</span>), <span class="string">&quot;jjjij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;l&#x27;</span>), <span class="string">&quot;jijji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;m&#x27;</span>), <span class="string">&quot;ijiij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;n&#x27;</span>), <span class="string">&quot;iijji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;o&#x27;</span>), <span class="string">&quot;ijjij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;p&#x27;</span>), <span class="string">&quot;jiiji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;q&#x27;</span>), <span class="string">&quot;ijijj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;r&#x27;</span>), <span class="string">&quot;jijii&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;s&#x27;</span>), <span class="string">&quot;iiiii&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;t&#x27;</span>), <span class="string">&quot;jjiij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;u&#x27;</span>), <span class="string">&quot;ijjji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;v&#x27;</span>), <span class="string">&quot;jiiij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;w&#x27;</span>), <span class="string">&quot;iiiij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;x&#x27;</span>), <span class="string">&quot;iijij&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;y&#x27;</span>), <span class="string">&quot;jjiji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;z&#x27;</span>), <span class="string">&quot;jijjj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;1&#x27;</span>), <span class="string">&quot;iijjl&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;2&#x27;</span>), <span class="string">&quot;iiilj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;3&#x27;</span>), <span class="string">&quot;iliii&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;4&#x27;</span>), <span class="string">&quot;jiili&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;5&#x27;</span>), <span class="string">&quot;jilji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;6&#x27;</span>), <span class="string">&quot;iliji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;7&#x27;</span>), <span class="string">&quot;jjjlj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;8&#x27;</span>), <span class="string">&quot;ijljj&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;9&#x27;</span>), <span class="string">&quot;iljji&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.fish_ecode.put(Character.valueOf(<span class="string">&#x27;0&#x27;</span>), <span class="string">&quot;jjjli&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>是对a-z以及0-9的重映射，编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">decode_map = &#123;</span><br><span class="line">    <span class="string">&quot;iiijj&quot;</span>: <span class="string">&#x27;a&#x27;</span>, <span class="string">&quot;jjjii&quot;</span>: <span class="string">&#x27;b&#x27;</span>, <span class="string">&quot;jijij&quot;</span>: <span class="string">&#x27;c&#x27;</span>, <span class="string">&quot;jjijj&quot;</span>: <span class="string">&#x27;d&#x27;</span>, <span class="string">&quot;jjjjj&quot;</span>: <span class="string">&#x27;e&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;ijjjj&quot;</span>: <span class="string">&#x27;f&#x27;</span>, <span class="string">&quot;jjjji&quot;</span>: <span class="string">&#x27;g&#x27;</span>, <span class="string">&quot;iijii&quot;</span>: <span class="string">&#x27;h&#x27;</span>, <span class="string">&quot;ijiji&quot;</span>: <span class="string">&#x27;i&#x27;</span>, <span class="string">&quot;iiiji&quot;</span>: <span class="string">&#x27;j&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;jjjij&quot;</span>: <span class="string">&#x27;k&#x27;</span>, <span class="string">&quot;jijji&quot;</span>: <span class="string">&#x27;l&#x27;</span>, <span class="string">&quot;ijiij&quot;</span>: <span class="string">&#x27;m&#x27;</span>, <span class="string">&quot;iijji&quot;</span>: <span class="string">&#x27;n&#x27;</span>, <span class="string">&quot;ijjij&quot;</span>: <span class="string">&#x27;o&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;jiiji&quot;</span>: <span class="string">&#x27;p&#x27;</span>, <span class="string">&quot;ijijj&quot;</span>: <span class="string">&#x27;q&#x27;</span>, <span class="string">&quot;jijii&quot;</span>: <span class="string">&#x27;r&#x27;</span>, <span class="string">&quot;iiiii&quot;</span>: <span class="string">&#x27;s&#x27;</span>, <span class="string">&quot;jjiij&quot;</span>: <span class="string">&#x27;t&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;ijjji&quot;</span>: <span class="string">&#x27;u&#x27;</span>, <span class="string">&quot;jiiij&quot;</span>: <span class="string">&#x27;v&#x27;</span>, <span class="string">&quot;iiiij&quot;</span>: <span class="string">&#x27;w&#x27;</span>, <span class="string">&quot;iijij&quot;</span>: <span class="string">&#x27;x&#x27;</span>, <span class="string">&quot;jjiji&quot;</span>: <span class="string">&#x27;y&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;jijjj&quot;</span>: <span class="string">&#x27;z&#x27;</span>, <span class="string">&quot;iijjl&quot;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&quot;iiilj&quot;</span>: <span class="string">&#x27;2&#x27;</span>, <span class="string">&quot;iliii&quot;</span>: <span class="string">&#x27;3&#x27;</span>, <span class="string">&quot;jiili&quot;</span>: <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;jilji&quot;</span>: <span class="string">&#x27;5&#x27;</span>, <span class="string">&quot;iliji&quot;</span>: <span class="string">&#x27;6&#x27;</span>, <span class="string">&quot;jjjlj&quot;</span>: <span class="string">&#x27;7&#x27;</span>, <span class="string">&quot;ijljj&quot;</span>: <span class="string">&#x27;8&#x27;</span>, <span class="string">&quot;iljji&quot;</span>: <span class="string">&#x27;9&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;jjjli&quot;</span>: <span class="string">&#x27;0&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">encoded_str</span>):</span><br><span class="line">    decoded_chars = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(encoded_str), <span class="number">5</span>):</span><br><span class="line">        segment = encoded_str[i:i+<span class="number">5</span>]</span><br><span class="line">        <span class="keyword">if</span> segment <span class="keyword">in</span> decode_map:</span><br><span class="line">            decoded_chars.append(decode_map[segment])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Warning: Unknown segment &#x27;<span class="subst">&#123;segment&#125;</span>&#x27;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(decoded_chars)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    encoded_string = <span class="string">&quot;jjjliijijjjjjijiiiiijijiijjiijijjjiiiiijjjjliiijijjjjljjiilijijiiiiiljiijjiiliiiiiiiiiiiljiijijiliiiijjijijjijijijijiilijiijiiiiiijiljijiilijijiiiijjljjjljiliiijjjijiiiljijjijiiiiiiijjliiiljjijiiiliiiiiiljjiijiijiijijijjiijjiijjjijjjljiliiijijiiiijjliijiijiiliiliiiiiiljiijjiiliiijjjliiijjljjiijiiiijiijjiijijjjiiliiliiijiijijijiijijiiijjjiijjijiiiljiijiijilji&quot;</span></span><br><span class="line">    decoded_string = decode(encoded_string)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Decoded string:&quot;</span>, decoded_string)</span><br></pre></td></tr></table></figure>
<p>得到中间密文：<font color=lime><strong>0qksrtuw0x74r2n3s2x3ooi4ps54r173k2os12r32pmqnu73r1h432n301twnq43prruo2h5</strong></font>，再接着看MainActivity中的加密，发现分为几步：①每个字节的ASCII+68并转为十六进制 ②调用静态方法code让相邻两个字符的值交换 ③根据每个字符是否在a-f之间来应用不同的映射(两种映射的值域交集为空集)，据此写出解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_transform</span>(<span class="params">cipher_char, index</span>):</span><br><span class="line">    cipher_ascii = <span class="built_in">ord</span>(cipher_char)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="number">48</span> &lt;= cipher_ascii &lt;= <span class="number">56</span>:</span><br><span class="line">        original_ascii = cipher_ascii - index % <span class="number">4</span> + <span class="number">49</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">chr</span>(original_ascii)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        original_ascii = cipher_ascii - <span class="number">55</span> - index % <span class="number">10</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">chr</span>(original_ascii)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher_str</span>):</span><br><span class="line">    plain_chars = []</span><br><span class="line">    <span class="keyword">for</span> index, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(cipher_str):</span><br><span class="line">        plain_chars.append(reverse_transform(char, index))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(plain_chars)</span><br><span class="line"></span><br><span class="line">cipher_text = <span class="string">&quot;0qksrtuw0x74r2n3s2x3ooi4ps54r173k2os12r32pmqnu73r1h432n301twnq43prruo2h5&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Encrypted:&quot;</span>, cipher_text)</span><br><span class="line">stg1 = decrypt(cipher_text)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;DecStage1:&quot;</span>, stg1)</span><br><span class="line">stg2 = <span class="built_in">list</span>(stg1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(stg2)-<span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">    stg2[i], stg2[i+<span class="number">1</span>] = stg2[i+<span class="number">1</span>], stg2[i]</span><br><span class="line">resultstg2 = <span class="string">&#x27;&#x27;</span>.join(stg2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;DecStage2:&quot;</span>, resultstg2)</span><br><span class="line">hex_array = [resultstg2[i:i+<span class="number">2</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(resultstg2), <span class="number">2</span>)]</span><br><span class="line">result = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(<span class="built_in">int</span>(hex_str, <span class="number">16</span>) - <span class="number">68</span>) <span class="keyword">for</span> hex_str <span class="keyword">in</span> hex_array)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Result:&quot;</span>, result)</span><br></pre></td></tr></table></figure>
<p>输出flag：<font color=deepskyblue><strong>VNCTF{u_re4l1y_kn0w_H0Ok_my_f1Sh!1l}</strong></font>.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Encrypted: 0qksrtuw0x74r2n3s2x3ooi4ps54r173k2os12r32pmqnu73r1h432n301twnq43prruo2h5</span><br><span class="line"></span><br><span class="line">DecStage1: a9297889a8fb9b3a6b9a870b57db3afa2b47bb3ac84739fa3a1bdb3aaa5779ca56570b1c</span><br><span class="line"></span><br><span class="line">DecStage2: 9a9287988abfb9a3b6a978b075bda3afb274bba38c7493afa3b1bda3aa7597ac6575b0c1</span><br><span class="line"></span><br><span class="line">Result: VNCTF&#123;u\_re4l1y\_kn0w\_H0Ok\_my\_f1Sh!1l&#125;.</span><br></pre></td></tr></table></figure>

<h3 id="Fuko’s-starfish："><a href="#Fuko’s-starfish：" class="headerlink" title="Fuko’s starfish："></a>Fuko’s starfish：</h3><p>反编译查看是一个小游戏，分为猜数字、贪吃蛇和第三步的输入密钥，然后整个程序不知道塞了多少反调试反正一调就直接闪退，再观察附带的starfish.dll，发现第三步游戏在dll里面，前两个游戏没啥关键信息就不分析了，仔细观察所给的dll，发现好几个函数有花（特征是call $+5后一大段然后一个jz一个retn），把jz改jmp，其他没用的全抹掉，观察到几个关键函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __noreturn <span class="title function_">sub_1800025F0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> i; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v1; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v3; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">16</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  __int128 v5; <span class="comment">// [rsp+30h] [rbp-50h]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">16</span>]; <span class="comment">// [rsp+90h] [rbp+10h] BYREF</span></span><br><span class="line">  _BYTE v7[<span class="number">30</span>]; <span class="comment">// [rsp+A0h] [rbp+20h]</span></span><br><span class="line">  __int128 v8; <span class="comment">// [rsp+C0h] [rbp+40h]</span></span><br><span class="line">  <span class="type">char</span> v9; <span class="comment">// [rsp+D0h] [rbp+50h]</span></span><br><span class="line">  _BYTE v10[<span class="number">31</span>]; <span class="comment">// [rsp+D1h] [rbp+51h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// [rsp+F0h] [rbp+70h]</span></span><br><span class="line">  __int128 v12; <span class="comment">// [rsp+100h] [rbp+80h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v13; <span class="comment">// [rsp+110h] [rbp+90h]</span></span><br><span class="line"></span><br><span class="line">  *(_OWORD *)&amp;v7[<span class="number">14</span>] = *(__int128 *)((<span class="type">char</span> *)&amp;xmmword_18000A9C0 + <span class="number">14</span>);</span><br><span class="line">  *(_OWORD *)v7 = xmmword_18000A9C0;</span><br><span class="line">  *(_OWORD *)Str = xmmword_18000A9B0;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>i64; <span class="built_in">strlen</span>(Str) &gt; i; ++i )</span><br><span class="line">    Str[i] ^= <span class="number">0x17u</span>;</span><br><span class="line">  <span class="built_in">puts</span>(Str);												<span class="comment">//这部分是加密的输出文字，让提供一个final key</span></span><br><span class="line">  vfscanf(v1, v4);</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  v12 = <span class="number">0</span>i64;</span><br><span class="line">  v13 = <span class="number">0</span>;</span><br><span class="line">  *(_OWORD *)&amp;v10[<span class="number">15</span>] = v5;</span><br><span class="line">  AES(&amp;v10[<span class="number">15</span>], &amp;v12);										<span class="comment">//这个函数比较复杂（我自己命的名），在下面详细分析</span></span><br><span class="line">  v5 = <span class="number">0</span>i64;</span><br><span class="line">  AES(v4, &amp;v10[<span class="number">15</span>]);</span><br><span class="line">  v9 = v11;</span><br><span class="line">  v8 = *(_OWORD *)&amp;v10[<span class="number">15</span>];</span><br><span class="line">  *(_OWORD *)v10 = v12;</span><br><span class="line">  *(_WORD *)&amp;v10[<span class="number">16</span>] = v13;</span><br><span class="line">  v2 = <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">while</span> ( *((_BYTE *)&amp;v8 + <span class="number">2</span> * v2) == byte_18000A890[<span class="number">2</span> * v2]				<span class="comment">//显而易见的比较flag部分，flag长度为32</span></span><br><span class="line">       &amp;&amp; *((_BYTE *)&amp;v8 + <span class="number">2</span> * v2 + <span class="number">1</span>) == byte_18000A890[<span class="number">2</span> * v2 + <span class="number">1</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ++v2 == <span class="number">16</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = <span class="string">&quot;right!&quot;</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_10;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v3 = <span class="string">&quot;wrong&quot;</span>;</span><br><span class="line">LABEL_10:</span><br><span class="line">  <span class="built_in">puts</span>(v3);</span><br><span class="line">  Sleep(<span class="number">0xFA0u</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此已经找到了flag的密文：<font color=lime><strong>[3d 01 1c 19 0b a0 90 81 5f 67 27 31 a8 9a a4 74 97 36 21 67 ab 2e b4 a0 94 18 d3 7d 93 e6 46 e7]</strong></font>，对于那两个标橙色的函数详细分析：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">  v145 = a2;</span><br><span class="line">  v140 = a1;</span><br><span class="line">  v146 = <span class="number">0</span>i64;</span><br><span class="line">  v2 = byte_18000E1E0;</span><br><span class="line">  v3 = byte_18000E1F0;</span><br><span class="line">  v4 = byte_18000E1F2;</span><br><span class="line">  v5 = byte_18000E200;</span><br><span class="line">  v6 = byte_18000E204;</span><br><span class="line">  v7 = byte_18000E210;</span><br><span class="line">  v8 = byte_18000E950;</span><br><span class="line">  v9 = byte_18000E220;</span><br><span class="line">  LOBYTE(v139) = byte_18000E228;</span><br><span class="line">  v126 = byte_18000E230;</span><br><span class="line">  v127 = byte_18000E232;</span><br><span class="line">  v129 = byte_18000E240;</span><br><span class="line">  LOBYTE(v138) = byte_18000E244;</span><br><span class="line">  LOBYTE(v131) = byte_18000E960;</span><br><span class="line">  v128 = byte_18000E962;</span><br><span class="line">  LOBYTE(v130) = byte_18000E970;</span><br><span class="line">  pbDebuggerPresent = <span class="number">0</span>;</span><br><span class="line">  CurrentProcess = GetCurrentProcess();</span><br><span class="line">  CheckRemoteDebuggerPresent(CurrentProcess, &amp;pbDebuggerPresent);</span><br><span class="line">  <span class="keyword">if</span> ( pbDebuggerPresent )</span><br><span class="line">  &#123;</span><br><span class="line">    v132 = v5;</span><br><span class="line">    v133 = v4;</span><br><span class="line">    v134 = v3;</span><br><span class="line">    v135 = v9;</span><br><span class="line">    v125 = v2;</span><br><span class="line">    v11 = v8;</span><br><span class="line">    v136 = v7;</span><br><span class="line">    v137 = v6;</span><br><span class="line">    v12 = v127;</span><br><span class="line">    v13 = v126;</span><br><span class="line">    v14 = v128;</span><br><span class="line">    LOWORD(v148) = <span class="number">0x1D39</span>;</span><br><span class="line">    *(_DWORD *)Str = <span class="number">0x397A7A5F</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>i64; <span class="built_in">strlen</span>(Str) &gt; i; ++i )</span><br><span class="line">      Str[i] ^= <span class="number">0x17u</span>;</span><br><span class="line">    <span class="built_in">vfprintf</span>((FILE *<span class="type">const</span>)<span class="string">&quot;%s&quot;</span>, Str, v16);</span><br><span class="line">    v17 = v14;</span><br><span class="line">    v18 = v139;</span><br><span class="line">    v19 = v12;</span><br><span class="line">    v20 = v137;</span><br><span class="line">    v21 = v129;</span><br><span class="line">    v22 = v136;</span><br><span class="line">    v23 = v11;</span><br><span class="line">    v24 = v125;</span><br><span class="line">    v25 = v135;</span><br><span class="line">    v26 = v134;</span><br><span class="line">    v27 = v133;</span><br><span class="line">    v28 = v132;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v125 = v2 ^ <span class="number">0x17</span>;</span><br><span class="line">    v29 = v3 ^ <span class="number">0x17</span>;</span><br><span class="line">    v30 = v4 ^ <span class="number">0x17</span>;</span><br><span class="line">    v28 = v5 ^ <span class="number">0x17</span>;</span><br><span class="line">    v22 = v7 ^ <span class="number">0x17</span>;</span><br><span class="line">    v23 = v8 ^ <span class="number">0x17</span>;</span><br><span class="line">    v25 = v9 ^ <span class="number">0x17</span>;</span><br><span class="line">    v18 = v139 ^ <span class="number">0x17</span>;</span><br><span class="line">    v13 = v126 ^ <span class="number">0x17</span>;</span><br><span class="line">    v20 = v6 ^ <span class="number">0x17</span>;</span><br><span class="line">    v19 = v127 ^ <span class="number">0x17</span>;</span><br><span class="line">    v21 = v129 ^ <span class="number">0x17</span>;</span><br><span class="line">    LOBYTE(v138) = v138 ^ <span class="number">0x17</span>;</span><br><span class="line">    LOBYTE(v131) = v131 ^ <span class="number">0x17</span>;</span><br><span class="line">    v17 = v128 ^ <span class="number">0x17</span>;</span><br><span class="line">    LOBYTE(v130) = v130 ^ <span class="number">0x17</span>;</span><br><span class="line">    v24 = v125;</span><br><span class="line">    v26 = v29;</span><br><span class="line">    v27 = v30;</span><br><span class="line">  &#125;</span><br><span class="line">  Str[<span class="number">0</span>] = v28;</span><br><span class="line">  Str[<span class="number">1</span>] = v27;</span><br><span class="line">  Str[<span class="number">2</span>] = v26;</span><br><span class="line">  Str[<span class="number">3</span>] = v24;</span><br><span class="line">  v148 = v25 | (v23 &lt;&lt; <span class="number">8</span>) | (v22 &lt;&lt; <span class="number">16</span>) | (v20 &lt;&lt; <span class="number">24</span>);</span><br><span class="line">  LODWORD(v149) = v21 | (v19 &lt;&lt; <span class="number">8</span>) | (v13 &lt;&lt; <span class="number">16</span>) | (v18 &lt;&lt; <span class="number">24</span>);</span><br><span class="line">  v31 = v17;</span><br><span class="line">  v32 = RijnDael_AES_LONG_18000A8B0[v17];</span><br><span class="line">……（以下省略）</span><br></pre></td></tr></table></figure>
<p>可以注意到这是一个包含了AES加密的函数（由于没有初始化向量猜测是ECB模式），经过分析发现带入的两个参数里面第一个参数是要加密的内容，第二个参数是加密结果的缓冲区，那么密钥在哪？这时发现函数调用了恰好16个全局变量，找到这16个全局变量，发现是<font color=red><strong>11 45 14 19 19 81 11 45 14 19 19 81 ?? ?? ?? ??</strong></font>，由于这个题目根本就不想要我调试（不然塞这么多反调试干嘛），密钥一定不是这个数值（毕竟还有四个字节未知），查看这些全局变量的交叉引用，发现了一个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">ThreadProc</span><span class="params">(LPVOID lpThreadParameter)</span></span><br><span class="line">&#123;</span><br><span class="line">  v1 = rand();</span><br><span class="line">  byte_18000E1E0 = v1 + v1 / <span class="number">255</span>;</span><br><span class="line">  v2 = rand();</span><br><span class="line">  byte_18000E1F0 = v2 + v2 / <span class="number">255</span>;</span><br><span class="line">  v3 = rand();</span><br><span class="line">  byte_18000E1F2 = v3 + v3 / <span class="number">255</span>;</span><br><span class="line">  v4 = rand();</span><br><span class="line">  byte_18000E200 = v4 + v4 / <span class="number">255</span>;</span><br><span class="line">  v5 = rand();</span><br><span class="line">  byte_18000E204 = v5 + v5 / <span class="number">255</span>;</span><br><span class="line">  v6 = rand();</span><br><span class="line">  byte_18000E210 = v6 + v6 / <span class="number">255</span>;</span><br><span class="line">  v7 = rand();</span><br><span class="line">  byte_18000E950 = v7 + v7 / <span class="number">255</span>;</span><br><span class="line">  v8 = rand();</span><br><span class="line">  byte_18000E220 = v8 + v8 / <span class="number">255</span>;</span><br><span class="line">  v9 = rand();</span><br><span class="line">  byte_18000E228 = v9 + v9 / <span class="number">255</span>;</span><br><span class="line">  v10 = rand();</span><br><span class="line">  byte_18000E230 = v10 + v10 / <span class="number">255</span>;</span><br><span class="line">  v11 = rand();</span><br><span class="line">  byte_18000E232 = v11 + v11 / <span class="number">255</span>;</span><br><span class="line">  v12 = rand();</span><br><span class="line">  byte_18000E240 = v12 + v12 / <span class="number">255</span>;</span><br><span class="line">  v13 = rand();</span><br><span class="line">  byte_18000E244 = v13 + v13 / <span class="number">255</span>;</span><br><span class="line">  v14 = rand();</span><br><span class="line">  byte_18000E960 = v14 + v14 / <span class="number">255</span>;</span><br><span class="line">  v15 = rand();</span><br><span class="line">  byte_18000E962 = v15 + v15 / <span class="number">255</span>;</span><br><span class="line">  v16 = rand();</span><br><span class="line">  byte_18000E970 = v16 + v16 / <span class="number">255</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">6</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就很奇怪了，16个字节居然是全随机，不动态调试根本无法获取其值，但结合密文是固定的，并且下面return了一个诡异的数：6i64，不难猜测这里可能藏了一个花，在汇编界面打开一看还真是，抹掉花之后获得真正的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">  srand(<span class="number">0x1BF52u</span>);</span><br><span class="line">  v17 = rand();</span><br><span class="line">  byte_18000E1E0 = v17 + v17 / <span class="number">255</span>;</span><br><span class="line">  v18 = rand();</span><br><span class="line">  byte_18000E1F0 = v18 + v18 / <span class="number">255</span>;</span><br><span class="line">  v19 = rand();</span><br><span class="line">  byte_18000E1F2 = v19 + v19 / <span class="number">255</span>;</span><br><span class="line">  v20 = rand();</span><br><span class="line">  byte_18000E200 = v20 + v20 / <span class="number">255</span>;</span><br><span class="line">  v21 = rand();</span><br><span class="line">  byte_18000E204 = v21 + v21 / <span class="number">255</span>;</span><br><span class="line">  v22 = rand();</span><br><span class="line">  byte_18000E210 = v22 + v22 / <span class="number">255</span>;</span><br><span class="line">  v23 = rand();</span><br><span class="line">  byte_18000E950 = v23 + v23 / <span class="number">255</span>;</span><br><span class="line">  v24 = rand();</span><br><span class="line">  byte_18000E220 = v24 + v24 / <span class="number">255</span>;</span><br><span class="line">  v25 = rand();</span><br><span class="line">  byte_18000E228 = v25 + v25 / <span class="number">255</span>;</span><br><span class="line">  v26 = rand();</span><br><span class="line">  byte_18000E230 = v26 + v26 / <span class="number">255</span>;</span><br><span class="line">  v27 = rand();</span><br><span class="line">  byte_18000E232 = v27 + v27 / <span class="number">255</span>;</span><br><span class="line">  v28 = rand();</span><br><span class="line">  byte_18000E240 = v28 + v28 / <span class="number">255</span>;</span><br><span class="line">  v29 = rand();</span><br><span class="line">  byte_18000E244 = v29 + v29 / <span class="number">255</span>;</span><br><span class="line">  v30 = rand();</span><br><span class="line">  byte_18000E960 = v30 + v30 / <span class="number">255</span>;</span><br><span class="line">  v31 = rand();</span><br><span class="line">  byte_18000E962 = v31 + v31 / <span class="number">255</span>;</span><br><span class="line">  v32 = rand();</span><br><span class="line">  byte_18000E970 = v32 + v32 / <span class="number">255</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以注意到下面又生成了16次随机值，但这次给了固定的srand，这意味着每个随机值其实都是固定的，那么不言而喻这应该就是密钥了，编写C语言程序取得随机值：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> seed = <span class="number">0x1BF52u</span>;</span><br><span class="line">    srand(seed);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i) &#123;</span><br><span class="line">        <span class="type">int</span> rand_val = rand();</span><br><span class="line">        <span class="type">int</span> result = rand_val + rand_val / <span class="number">255</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Random value %d: %d, Processed: %d\n&quot;</span>, i+<span class="number">1</span>, rand_val, result);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Random value 1: 13545, Processed: 13598</span><br><span class="line">Random value 2: 19112, Processed: 19186</span><br><span class="line">Random value 3: 12729, Processed: 12778</span><br><span class="line">Random value 4: 29322, Processed: 29436</span><br><span class="line">Random value 5: 16702, Processed: 16767</span><br><span class="line">Random value 6: 2078, Processed: 2086</span><br><span class="line">Random value 7: 10043, Processed: 10082</span><br><span class="line">Random value 8: 2201, Processed: 2209</span><br><span class="line">Random value 9: 6796, Processed: 6822</span><br><span class="line">Random value 10: 11264, Processed: 11308</span><br><span class="line">Random value 11: 9582, Processed: 9619</span><br><span class="line">Random value 12: 25786, Processed: 25887</span><br><span class="line">Random value 13: 17729, Processed: 17798</span><br><span class="line">Random value 14: 9432, Processed: 9468</span><br><span class="line">Random value 15: 11586, Processed: 11631</span><br><span class="line">Random value 16: 24167, Processed: 24261</span><br></pre></td></tr></table></figure>
<p>又因为全局变量限定了是byte，再转成字节并拼合：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">values = [</span><br><span class="line">    <span class="number">13598</span>, <span class="number">19186</span>, <span class="number">12778</span>, <span class="number">29436</span>, <span class="number">16767</span>, <span class="number">2086</span>, <span class="number">10082</span>, <span class="number">2209</span>,</span><br><span class="line">    <span class="number">6822</span>, <span class="number">11308</span>, <span class="number">9619</span>, <span class="number">25887</span>, <span class="number">17798</span>, <span class="number">9468</span>, <span class="number">11631</span>, <span class="number">24261</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_to_byte_array</span>(<span class="params">values</span>):</span><br><span class="line">    byte_array = []</span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> values:</span><br><span class="line">        byte_value = value &amp; <span class="number">0xFF</span></span><br><span class="line">        byte_array.append(byte_value)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(byte_array)</span><br><span class="line"></span><br><span class="line">byte_array = convert_to_byte_array(values)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hex representation:&quot;</span>, byte_array.<span class="built_in">hex</span>())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Byte array:&quot;</span>, <span class="built_in">list</span>(byte_array))</span><br></pre></td></tr></table></figure>
<p>得到结果：Hex representation: <font color=lime><strong>1ef2eafc7f2662a1a62c931f86fc6fc5</strong></font></p>
<p>将十六进制数组异或0x17得到<font color=LimeGreen><strong>09e5fdeb683175b6b13b840891eb78d2</strong></font>，在cyberchef选择AES-ECB&#x2F;NoPadding解密得到flag：<font color=deepskyblue><strong>VNCTF{W0w_u_g0t_Fuk0’s_st4rf1sh}</strong></font>.</p>
<h3 id="抽奖转盘："><a href="#抽奖转盘：" class="headerlink" title="抽奖转盘："></a>抽奖转盘：</h3><p>发现是鸿蒙应用，先改成.zip，取出其中的.abc字节码，扔进jadx-dev进行反编译，大量寻找后得到以下几个关键信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//来自index类</span></span><br><span class="line"><span class="comment">//文本框</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;@<span class="number">1</span>*#^b(Object functionObject, Object newTarget, Index <span class="built_in">this</span>, Object arg0, Object arg1) &#123;</span><br><span class="line">        obj = TextInput.create;</span><br><span class="line">        obj2 = createobjectwithbuffer([<span class="string">&quot;controller&quot;</span>, <span class="number">0</span>]);</span><br><span class="line">        obj2.controller = _lexenv_0_1_.textInputControllerX;</span><br><span class="line">        obj(obj2);</span><br><span class="line">        TextInput.type(InputType.Password);</span><br><span class="line">        TextInput.height(<span class="keyword">import</span> &#123; <span class="keyword">default</span> as CommonContants &#125; from <span class="string">&quot;@normalized:N&amp;&amp;&amp;entry/src/main/common/CommonContants&amp;&quot;</span>.FULL_PARENT);</span><br><span class="line">        obj3 = TextInput.margin;</span><br><span class="line">        obj4 = createobjectwithbuffer([<span class="string">&quot;left&quot;</span>, <span class="number">0</span>]);</span><br><span class="line">        obj5 = createobjectwithbuffer([<span class="string">&quot;id&quot;</span>, <span class="number">16777265</span>, <span class="string">&quot;type&quot;</span>, <span class="number">10002</span>, <span class="string">&quot;params&quot;</span>, <span class="number">0</span>, <span class="string">&quot;bundleName&quot;</span>, <span class="string">&quot;com.game.vnctf&quot;</span>, <span class="string">&quot;moduleName&quot;</span>, <span class="string">&quot;entry&quot;</span>]);</span><br><span class="line">        obj5.params = [Object];</span><br><span class="line">        obj4.left = obj5;</span><br><span class="line">        obj3(obj4);</span><br><span class="line">        TextInput.layoutWeight(<span class="keyword">import</span> &#123; <span class="keyword">default</span> as CommonContants &#125; from <span class="string">&quot;@normalized:N&amp;&amp;&amp;entry/src/main/common/CommonContants&amp;&quot;</span>.TEXTINPUT_LAYOUT_WEIGHT);</span><br><span class="line">        TextInput.onChange(#~@<span class="number">0</span>&gt;@<span class="number">1</span>*^b*#);<span class="comment">//输入后读取并存入</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//按钮</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;@<span class="number">1</span>*#^d(Object functionObject, Object newTarget, Index <span class="built_in">this</span>, Object arg0, Object arg1) &#123;</span><br><span class="line">        obj = Button.createWithLabel;</span><br><span class="line">        obj2 = createobjectwithbuffer([<span class="string">&quot;id&quot;</span>, <span class="number">16777229</span>, <span class="string">&quot;type&quot;</span>, <span class="number">10003</span>, <span class="string">&quot;params&quot;</span>, <span class="number">0</span>, <span class="string">&quot;bundleName&quot;</span>, <span class="string">&quot;com.game.vnctf&quot;</span>, <span class="string">&quot;moduleName&quot;</span>, <span class="string">&quot;entry&quot;</span>]);</span><br><span class="line">        obj2.params = [Object];</span><br><span class="line">        obj(obj2);</span><br><span class="line">        obj3 = Button.fontSize;</span><br><span class="line">        obj4 = createobjectwithbuffer([<span class="string">&quot;id&quot;</span>, <span class="number">16777264</span>, <span class="string">&quot;type&quot;</span>, <span class="number">10002</span>, <span class="string">&quot;params&quot;</span>, <span class="number">0</span>, <span class="string">&quot;bundleName&quot;</span>, <span class="string">&quot;com.game.vnctf&quot;</span>, <span class="string">&quot;moduleName&quot;</span>, <span class="string">&quot;entry&quot;</span>]);</span><br><span class="line">        obj4.params = [Object];</span><br><span class="line">        obj3(obj4);</span><br><span class="line">        Button.fontWeight(<span class="keyword">import</span> &#123; <span class="keyword">default</span> as CommonContants &#125; from <span class="string">&quot;@normalized:N&amp;&amp;&amp;entry/src/main/common/CommonContants&amp;&quot;</span>.FONT_WEIGHT);</span><br><span class="line">        Button.height(<span class="keyword">import</span> &#123; <span class="keyword">default</span> as CommonContants &#125; from <span class="string">&quot;@normalized:N&amp;&amp;&amp;entry/src/main/common/CommonContants&amp;&quot;</span>.FULL_PARENT);</span><br><span class="line">        obj5 = Button.width;</span><br><span class="line">        obj6 = createobjectwithbuffer([<span class="string">&quot;id&quot;</span>, <span class="number">16777244</span>, <span class="string">&quot;type&quot;</span>, <span class="number">10002</span>, <span class="string">&quot;params&quot;</span>, <span class="number">0</span>, <span class="string">&quot;bundleName&quot;</span>, <span class="string">&quot;com.game.vnctf&quot;</span>, <span class="string">&quot;moduleName&quot;</span>, <span class="string">&quot;entry&quot;</span>]);</span><br><span class="line">        obj6.params = [Object];</span><br><span class="line">        obj5(obj6);</span><br><span class="line">        Button.onClick(#~@<span class="number">0</span>&gt;@<span class="number">1</span>*^d*#);<span class="comment">//按下按钮触发libhello.so调用以及加密</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//读取文本框中的输入值作为arg0，存入长度到_lexenv_0_1_.numX，具体值到_lexenv_0_1_.pw</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;@<span class="number">1</span>*^b*#(Object functionObject, Object newTarget, Index <span class="built_in">this</span>, Object arg0) &#123;</span><br><span class="line">        _lexenv_0_1_.numX = arg0.length;</span><br><span class="line">        _lexenv_0_1_.pw = arg0;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//导入libhello.so，调用其中的MyCry方法，加密输入值，三个参数分别为长度、24、具体值</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;@<span class="number">1</span>*^d*#(Object functionObject, Object newTarget, Index <span class="built_in">this</span>) &#123;</span><br><span class="line">        libHello = <span class="keyword">import</span> &#123; <span class="keyword">default</span> as libHello &#125; from <span class="string">&quot;@normalized:Y&amp;&amp;&amp;libhello.so&amp;&quot;</span>;</span><br><span class="line">        MyCry = libHello.MyCry(_lexenv_0_1_.numX, <span class="number">24</span>, _lexenv_0_1_.pw);</span><br><span class="line">        router = <span class="keyword">import</span> &#123; <span class="keyword">default</span> as router &#125; from <span class="string">&quot;@ohos:router&quot;</span>;</span><br><span class="line">        obj = router.pushUrl;</span><br><span class="line">        obj2 = createobjectwithbuffer([<span class="string">&quot;url&quot;</span>, <span class="string">&quot;pages/MyPage&quot;</span>, <span class="string">&quot;params&quot;</span>, <span class="number">0</span>]);</span><br><span class="line">        obj3 = createobjectwithbuffer([<span class="string">&quot;result&quot;</span>, <span class="number">0</span>]);</span><br><span class="line">        obj3.result = MyCry;</span><br><span class="line">        obj2.params = obj3;</span><br><span class="line">        obj(obj2);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//设置result属性</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;#result^<span class="number">1</span>(Object functionObject, Object newTarget, Index <span class="built_in">this</span>, Object arg0) &#123;</span><br><span class="line">        obj = <span class="built_in">this</span>.__result;</span><br><span class="line">        obj.set(arg0);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//来自MyPage类</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Multi-variable type inference failed */</span></span><br><span class="line"><span class="comment">//ASCII值+1并异或0x7</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;@<span class="number">4</span>*#(Object functionObject, Object newTarget, MyPage <span class="built_in">this</span>, Object arg0, Object arg1) &#123;</span><br><span class="line">        _lexenv_0_0_[arg1] = (arg0 + <span class="number">1</span>) ^ <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r14v12, types: [int] */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r14v14, types: [Object, int] */</span></span><br><span class="line"><span class="comment">//比较函数</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;@<span class="number">4</span>*#^<span class="number">1</span>(Object functionObject, Object newTarget, MyPage <span class="built_in">this</span>, Object arg0, Object arg1) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((_lexenv_0_1_[arg1] == _lexenv_0_0_[arg1] ? <span class="number">1</span> : <span class="number">0</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        r14 = tonumer(_lexenv_0_2_) + <span class="number">1</span>;</span><br><span class="line">        _lexenv_0_2_;</span><br><span class="line">        _lexenv_0_2_ = r14;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//最关键的方法之一，_lexenv_0_1_的值明显是flag密文</span></span><br><span class="line">    <span class="comment">/* JADX WARN: Type inference failed for: r13v38, types: [int] */</span></span><br><span class="line">    <span class="keyword">public</span> Object #~@<span class="number">0</span>&gt;#startAnimator(Object functionObject, Object newTarget, MyPage <span class="built_in">this</span>) &#123;</span><br><span class="line">        newlexenvwithname([<span class="number">6</span>, <span class="string">&quot;array&quot;</span>, <span class="number">0</span>, <span class="string">&quot;ay&quot;</span>, <span class="number">1</span>, <span class="string">&quot;tempangle&quot;</span>, <span class="number">2</span>, <span class="string">&quot;randomAngle&quot;</span>, <span class="number">3</span>, <span class="string">&quot;4newTarget&quot;</span>, <span class="number">4</span>, <span class="string">&quot;this&quot;</span>, <span class="number">5</span>], <span class="number">6</span>);</span><br><span class="line">        _lexenv_0_4_ = newTarget;</span><br><span class="line">        _lexenv_0_5_ = <span class="built_in">this</span>;</span><br><span class="line">        _lexenv_0_3_ = <span class="literal">null</span>;</span><br><span class="line">        _lexenv_0_2_ = <span class="literal">null</span>;</span><br><span class="line">        buffer = <span class="keyword">import</span> &#123; <span class="keyword">default</span> as buffer &#125; from <span class="string">&quot;@ohos:buffer&quot;</span>;</span><br><span class="line">        _lexenv_0_0_ = Uint8Array(buffer.from(_lexenv_0_5_.result).buffer); <span class="comment">//十六进制数组，libhello加密结果</span></span><br><span class="line">        _lexenv_0_1_ = createarraywithbuffer([<span class="number">101</span>, <span class="number">74</span>, <span class="number">76</span>, <span class="number">49</span>, <span class="number">101</span>, <span class="number">76</span>, <span class="number">117</span>, <span class="number">87</span>, <span class="number">55</span>, <span class="number">69</span>, <span class="number">118</span>, <span class="number">68</span>, <span class="number">118</span>, <span class="number">69</span>, <span class="number">55</span>, <span class="number">67</span>, <span class="number">61</span>, <span class="number">83</span>, <span class="number">62</span>, <span class="number">111</span>, <span class="number">81</span>, <span class="number">77</span>, <span class="number">115</span>, <span class="number">101</span>, <span class="number">53</span>, <span class="number">73</span>, <span class="number">83</span>, <span class="number">66</span>, <span class="number">68</span>, <span class="number">114</span>, <span class="number">109</span>, <span class="number">108</span>, <span class="number">75</span>, <span class="number">66</span>, <span class="number">97</span>, <span class="number">117</span>, <span class="number">93</span>, <span class="number">127</span>, <span class="number">115</span>, <span class="number">124</span>, <span class="number">109</span>, <span class="number">82</span>, <span class="number">93</span>, <span class="number">115</span>]); <span class="comment">//flag密文</span></span><br><span class="line">        ldlexvar = _lexenv_0_0_;</span><br><span class="line">        ldlexvar.forEach(#~@<span class="number">0</span>&gt;@<span class="number">4</span>*#); <span class="comment">//加密后的结果每一位再加上1，之后异或0x7</span></span><br><span class="line">        ldlexvar2 = _lexenv_0_0_;</span><br><span class="line">        ldlexvar2.forEach(#~@<span class="number">0</span>&gt;@<span class="number">4</span>*#^<span class="number">1</span>); <span class="comment">//比较加密结果和密文的值</span></span><br><span class="line">        round = Math.round(<span class="number">104</span> - _lexenv_0_2_);</span><br><span class="line">        _lexenv_0_3_;</span><br><span class="line">        _lexenv_0_3_ = round;</span><br><span class="line">        console.log(<span class="string">&quot;当前角度&quot;</span>, _lexenv_0_3_);</span><br><span class="line">        ldlexvar3 = _lexenv_0_5_;</span><br><span class="line">        obj = _lexenv_0_5_.drawModel;</span><br><span class="line">        ldlexvar3.prizeData = obj.showPrizeData(_lexenv_0_3_);</span><br><span class="line">        obj2 = Context.animateTo;</span><br><span class="line">        obj3 = createobjectwithbuffer([<span class="string">&quot;duration&quot;</span>, <span class="number">0</span>, <span class="string">&quot;curve&quot;</span>, <span class="number">0</span>, <span class="string">&quot;delay&quot;</span>, <span class="number">0</span>, <span class="string">&quot;iterations&quot;</span>, <span class="number">1</span>, <span class="string">&quot;playMode&quot;</span>, <span class="number">0</span>, <span class="string">&quot;onFinish&quot;</span>, <span class="number">0</span>]);</span><br><span class="line">        obj3.duration = <span class="keyword">import</span> &#123; <span class="keyword">default</span> as CommonConstants &#125; from <span class="string">&quot;@normalized:N&amp;&amp;&amp;entry/src/main/common/constants/CommonConstants&amp;&quot;</span>.DURATION;</span><br><span class="line">        obj3.curve = Curve.Ease;</span><br><span class="line">        obj3.playMode = PlayMode.Normal;</span><br><span class="line">        obj3.onFinish = #~@<span class="number">0</span>&gt;@<span class="number">4</span>*#onFinish;</span><br><span class="line">        obj2(obj3, #~@<span class="number">0</span>&gt;@<span class="number">4</span>*#^<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>则该应用在解题部分（加密部分）的逻辑已经清晰：输入的文本会先带入libhello.so，在其中进行加密后输出，输入值的每一位的ASCII值加上1，之后与0x7异或，并与输出的再次加密的flag密文进行比较，接下来反编译libhello.so：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">MyCry</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+28h] [rbp-178h]</span></span><br><span class="line">  <span class="type">double</span> v4; <span class="comment">// [rsp+40h] [rbp-160h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+88h] [rbp-118h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+90h] [rbp-110h] BYREF</span></span><br><span class="line">  __int64 v7[<span class="number">3</span>]; <span class="comment">// [rsp+98h] [rbp-108h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [rsp+B7h] [rbp-E9h] BYREF</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+B8h] [rbp-E8h] BYREF</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+C0h] [rbp-E0h] BYREF</span></span><br><span class="line">  __int64 v11[<span class="number">3</span>]; <span class="comment">// [rsp+C8h] [rbp-D8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">24</span>]; <span class="comment">// [rsp+E0h] [rbp-C0h] BYREF</span></span><br><span class="line">  <span class="type">double</span> y; <span class="comment">// [rsp+F8h] [rbp-A8h] BYREF</span></span><br><span class="line">  <span class="type">double</span> x; <span class="comment">// [rsp+100h] [rbp-A0h] BYREF</span></span><br><span class="line">  __int64 v15; <span class="comment">// [rsp+108h] [rbp-98h] BYREF</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">112</span>]; <span class="comment">// [rsp+110h] [rbp-90h] BYREF</span></span><br><span class="line">  __int64 s[<span class="number">4</span>]; <span class="comment">// [rsp+180h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  s[<span class="number">3</span>] = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="keyword">if</span> ( a1 &amp;&amp; a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    v15 = <span class="number">3LL</span>;</span><br><span class="line">    <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x18u</span>LL);</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)napi_get_cb_info(a1, a2, &amp;v15, s, <span class="number">0LL</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      OH_LOG_Print(<span class="number">0LL</span>, <span class="number">6LL</span>, <span class="number">65280LL</span>, (__int64)<span class="string">&quot;MyCry&quot;</span>, <span class="string">&quot;api_get_cb_info failed&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      x = <span class="number">0.0</span>;</span><br><span class="line">      y = <span class="number">0.0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)napi_get_value_double(a1, s[<span class="number">0</span>], &amp;x) || (<span class="type">unsigned</span> <span class="type">int</span>)napi_get_value_double(a1, s[<span class="number">1</span>], &amp;y) )<span class="comment">//x和y就是长度和24</span></span><br><span class="line">      &#123;</span><br><span class="line">        OH_LOG_Print(<span class="number">0LL</span>, <span class="number">6LL</span>, <span class="number">65280LL</span>, (__int64)<span class="string">&quot;MyCry&quot;</span>, <span class="string">&quot;napi_get_value failed&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        sub_287D0(v12, a1, s[<span class="number">2</span>]);</span><br><span class="line">        sub_288E0(v12);</span><br><span class="line">        OH_LOG_Print(<span class="number">0LL</span>, <span class="number">6LL</span>, <span class="number">65280LL</span>, (__int64)<span class="string">&quot;MyCry&quot;</span>, <span class="string">&quot;ts_putString str = %&#123;public&#125;s&quot;</span>);</span><br><span class="line">        sub_28900(v11);</span><br><span class="line">        v10 = sub_28990((__int64)v12);</span><br><span class="line">        v9 = sub_28A00((__int64)v12);</span><br><span class="line">        <span class="keyword">while</span> ( (sub_28A80(&amp;v10, &amp;v9) &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v8 = *(_BYTE *)sub_28AB0(&amp;v10) + <span class="number">3</span>; <span class="comment">//字符串的十六进制值+3</span></span><br><span class="line">          sub_28AD0(v11, &amp;v8);</span><br><span class="line">          sub_28B30(&amp;v10);</span><br><span class="line">        &#125;</span><br><span class="line">        v4 = _mm_cvtepi32_pd(_mm_cvttpd_epi32((__m128d)COERCE_UNSIGNED_INT64(hypot(x, y)))).m128d_f64[<span class="number">0</span>]; <span class="comment">//欧几里得距离</span></span><br><span class="line">        <span class="built_in">std</span>::__n1::basic_string&lt;<span class="type">char</span>,<span class="built_in">std</span>::__n1::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::__n1::allocator&lt;<span class="type">char</span>&gt;&gt;::basic_string[abi:v15004]&lt;decltype(nullptr)&gt;(</span><br><span class="line">          (__int64)v7,</span><br><span class="line">          (__int64)<span class="string">&quot;Take_it_easy&quot;</span>); <span class="comment">//密钥</span></span><br><span class="line">        OH_LOG_Print(<span class="number">0LL</span>, <span class="number">6LL</span>, <span class="number">65280LL</span>, (__int64)”MyCry”, “Result: %&#123;public&#125;f”);</span><br><span class="line">        <span class="keyword">if</span> ( v4 == <span class="number">40.0</span> ) <span class="comment">//这里两者距离为40，求得字符串长度为32</span></span><br><span class="line">          Alternative_RC4_1(v11, (__int64)v7, (<span class="type">int</span>)v4); <span class="comment">//魔改RC4加密，额外异或值是40</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          Alternative_RC4_2(v11, (__int64)v7); <span class="comment">//魔改RC4加密，额外异或值是24</span></span><br><span class="line">        <span class="built_in">memset</span>(dest, <span class="number">0</span>, <span class="number">0x64u</span>LL);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int64)sub_27AE0(v11) &lt; <span class="number">0x5A</span> ) <span class="comment">//长度不超过90的情况下编码成base64</span></span><br><span class="line">          base64_encode((__int64)v11, dest);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="built_in">strcpy</span>(dest, <span class="string">&quot;oh!you_are_toooooo_long!!!!!!&quot;</span>);</span><br><span class="line">        v3 = <span class="built_in">strlen</span>(dest);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)napi_create_string_utf8(a1, (__int64)dest, v3, (__int64)&amp;v6) )</span><br><span class="line">        &#123;</span><br><span class="line">          OH_LOG_Print(<span class="number">0LL</span>, <span class="number">6LL</span>, <span class="number">65280LL</span>, (__int64)<span class="string">&quot;MyCry&quot;</span>, <span class="string">&quot;napi_create_double failed&quot;</span>);</span><br><span class="line">          v5 = <span class="number">0LL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          v5 = v6;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">std</span>::__n1::basic_string&lt;<span class="type">char</span>,<span class="built_in">std</span>::__n1::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::__n1::allocator&lt;<span class="type">char</span>&gt;&gt;::~basic_string(v7);</span><br><span class="line">        sub_28BD0(v11);</span><br><span class="line">        <span class="built_in">std</span>::__n1::basic_string&lt;<span class="type">char</span>,<span class="built_in">std</span>::__n1::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::__n1::allocator&lt;<span class="type">char</span>&gt;&gt;::~basic_string(v12);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    OH_LOG_Print(<span class="number">0LL</span>, <span class="number">6LL</span>, <span class="number">65280LL</span>, (__int64)<span class="string">&quot;MyCry&quot;</span>, <span class="string">&quot;env or exports is null&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>至此全部加密已经解析完毕，开始解密：</p>
<p>flag密文异或0x7之后-1得到：<font color=lime><strong>aLJ5aJqO&#x2F;ApBpA&#x2F;C9S8gUIsa1MSDBtijKDeqYwsziTYs</strong></font>，共有44位，并且恰好在base64字符集的范围内，解码后得到中间密文的十六进制表达：<font color=LimeGreen><strong>\x68\xb2\x79\x68\x9a\x8e\xfc\x0a\x41\xa4\x0f\xc2\xf5\x2f\x20\x50\x8b\x1a\xd4\xc4\x83\x06\xd8\xa3\x28\x37\xaa\x63\x0b\x33\x89\x36\x2c</strong></font>，然后用RC4解密，密钥为<font color=orange><strong>Take_it_easy</strong></font>，再异或40，得到<font color=red><strong>\x59\x51\x46\x57\x49\x7e\x4d\x58\x76\x77\x62\x27\x71\x68\x62\x4c\x64\x76\x77\x62\x67\x64\x71\x66\x68\x62\x35\x33\x35\x38\x24\x80\x03</strong></font>，再减去3，得到flag：<font color=deepskyblue><strong>VNCTF{JUst_$ne_Iast_dance_2025!}</strong></font>.</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/02/11/n1_25/"
      title="N1CTF Junior 2025 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        N1CTF Junior 2025 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2024/12/09/hectf_24/"
      title="HECTF 2024 WriteUp"
     >

    <p class="title-text">
      
        HECTF 2024 WriteUp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
