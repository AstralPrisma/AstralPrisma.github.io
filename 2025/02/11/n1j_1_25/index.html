<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>N1CTF Junior 2025 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="只做了reverse方向的题目。从2月3日HGAME CTF开始到2月8日的VNCTF再到2月9日的N1CTF Junior，长线作战使得此时已经有些乏力了，三道逆向题目中，第一道（easy-re）由于缺少root过的arm架构安卓手机，在艰难分析手撕ollvm后因发现关键值需要动态调试获取而望洋兴叹… Reverse方向:5mc：反编译观察main： 1234567891011121314151">
<meta property="og:type" content="article">
<meta property="og:title" content="N1CTF Junior 2025 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2025/02/11/n1j_1_25/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="只做了reverse方向的题目。从2月3日HGAME CTF开始到2月8日的VNCTF再到2月9日的N1CTF Junior，长线作战使得此时已经有些乏力了，三道逆向题目中，第一道（easy-re）由于缺少root过的arm架构安卓手机，在艰难分析手撕ollvm后因发现关键值需要动态调试获取而望洋兴叹… Reverse方向:5mc：反编译观察main： 1234567891011121314151">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-02-10T16:00:00.000Z">
<meta property="article:modified_time" content="2025-11-09T20:18:42.281Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/AP.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/XH_2.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Ideas/">
                Ideas
                <div class="category-count">3</div>
            </a>
        
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">39</div>
            </a>
        
            <a class="category-link" href="/categories/%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">
                出题记录
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      
  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">标签</h3>
      <ul class="widget-tag-list" itemprop="keywords"><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/got/" rel="tag">.got</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/ARM/" rel="tag">ARM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Android/" rel="tag">Android</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/AutoRe/" rel="tag">AutoRe</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Brainfuck/" rel="tag">Brainfuck</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/C/" rel="tag">C#</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/CUDA/" rel="tag">CUDA</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Cheat-Engine/" rel="tag">Cheat Engine</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/DOS/" rel="tag">DOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Driver/" rel="tag">Driver</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Frida-Hook/" rel="tag">Frida Hook</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Golang/" rel="tag">Golang</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Harmony-OS/" rel="tag">Harmony OS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/IPC/" rel="tag">IPC</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Indirect-Jump/" rel="tag">Indirect Jump</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Kotlin/" rel="tag">Kotlin</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Lua/" rel="tag">Lua</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Mac/" rel="tag">Mac</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Obfuscate/" rel="tag">Obfuscate</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pascal/" rel="tag">Pascal</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Powershell/" rel="tag">Powershell</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Pyarmor/" rel="tag">Pyarmor</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Python/" rel="tag">Python</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/QEMU/" rel="tag">QEMU</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/R2R/" rel="tag">R2R</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Remote/" rel="tag">Remote</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Rust/" rel="tag">Rust</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Subprocess/" rel="tag">Subprocess</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Traffic/" rel="tag">Traffic</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Unicorn/" rel="tag">Unicorn</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/VM/" rel="tag">VM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/WASM/" rel="tag">WASM</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Wechat-Mini-Program/" rel="tag">Wechat Mini Program</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Windows-DLL/" rel="tag">Windows DLL</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/Yara/" rel="tag">Yara</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/iOS/" rel="tag">iOS</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/il2cpp/" rel="tag">il2cpp</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/pickle/" rel="tag">pickle</a></li><li class="widget-tag-list-item"><a class="widget-tag-list-link" href="/tags/x96/" rel="tag">x96</a></li></ul>
    </div>
  </div>


    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-n1j_1_25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        N1CTF Junior 2025 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-02-10T16:00:00.000Z" itemprop="datePublished">2025-02-11</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            5.5k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>只做了reverse方向的题目。从2月3日HGAME CTF开始到2月8日的VNCTF再到2月9日的N1CTF Junior，长线作战使得此时已经有些乏力了，三道逆向题目中，第一道（easy-re）由于缺少root过的arm架构安卓手机，在艰难分析手撕ollvm后因发现关键值需要动态调试获取而望洋兴叹…</em></p>
<h1 id="Reverse方向"><a href="#Reverse方向" class="headerlink" title="Reverse方向:"></a>Reverse方向:</h1><h2 id="5mc："><a href="#5mc：" class="headerlink" title="5mc："></a>5mc：</h2><p>反编译观察main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  _BYTE *v5; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v7; <span class="comment">// rsi</span></span><br><span class="line">  _BYTE *v8; <span class="comment">// rcx</span></span><br><span class="line">  _BYTE *v9; <span class="comment">// r15</span></span><br><span class="line">  _BYTE *v10; <span class="comment">// r12</span></span><br><span class="line">  __int64 v11; <span class="comment">// r14</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v12; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v13; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v14; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">int</span> v15; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v16; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v17; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v18; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v19; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">char</span> v20; <span class="comment">// r8</span></span><br><span class="line">  __int64 i; <span class="comment">// rbx</span></span><br><span class="line">  __int64 j; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> v23; <span class="comment">// edi</span></span><br><span class="line">  __int64 v24; <span class="comment">// rbx</span></span><br><span class="line">  _OWORD *v25; <span class="comment">// rax</span></span><br><span class="line">  _OWORD *v26; <span class="comment">// rcx</span></span><br><span class="line">  __int128 v27; <span class="comment">// xmm1</span></span><br><span class="line">  <span class="type">void</span> *v28; <span class="comment">// rdi</span></span><br><span class="line">  __int64 k; <span class="comment">// rbx</span></span><br><span class="line">  __int64 m; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">const</span> __m128i *v31; <span class="comment">// r8</span></span><br><span class="line">  __int64 v32; <span class="comment">// rax</span></span><br><span class="line">  __int8 *v33; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">const</span> __m128i *v34; <span class="comment">// rcx</span></span><br><span class="line">  __m128i v35; <span class="comment">// xmm0</span></span><br><span class="line">  __m128i v36; <span class="comment">// xmm2</span></span><br><span class="line">  __m128i v37; <span class="comment">// xmm1</span></span><br><span class="line">  <span class="type">int</span> v38; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v39; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v40[<span class="number">18</span>]; <span class="comment">// [rsp+20h] [rbp-E0h]</span></span><br><span class="line">  DWORD flOldProtect[<span class="number">4</span>]; <span class="comment">// [rsp+B0h] [rbp-50h] BYREF</span></span><br><span class="line">  LPVOID lpAddress[<span class="number">18</span>]; <span class="comment">// [rsp+C0h] [rbp-40h]</span></span><br><span class="line">  <span class="type">char</span> Buf1[<span class="number">40</span>]; <span class="comment">// [rsp+150h] [rbp+50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v40[<span class="number">0</span>] = (__int64)sub_7FF7C9755250;</span><br><span class="line">  v40[<span class="number">1</span>] = (__int64)&amp;unk_7FF7C9754A30;</span><br><span class="line">  v40[<span class="number">2</span>] = (__int64)&amp;unk_7FF7C9754DD0;</span><br><span class="line">  v40[<span class="number">3</span>] = (__int64)&amp;unk_7FF7C97554F0;</span><br><span class="line">  v40[<span class="number">4</span>] = (__int64)&amp;unk_7FF7C97555D0;</span><br><span class="line">  v40[<span class="number">5</span>] = (__int64)&amp;unk_7FF7C9754C10;</span><br><span class="line">  v40[<span class="number">6</span>] = (__int64)&amp;unk_7FF7C9754EB0;</span><br><span class="line">  v40[<span class="number">7</span>] = (__int64)&amp;unk_7FF7C9755090;</span><br><span class="line">  v40[<span class="number">8</span>] = (__int64)&amp;unk_7FF7C9755330;</span><br><span class="line">  v40[<span class="number">9</span>] = (__int64)&amp;unk_7FF7C9754CF0;</span><br><span class="line">  v40[<span class="number">10</span>] = (__int64)&amp;unk_7FF7C9755170;</span><br><span class="line">  v40[<span class="number">11</span>] = (__int64)&amp;unk_7FF7C9755410;</span><br><span class="line">  v40[<span class="number">12</span>] = (__int64)&amp;unk_7FF7C9754B30;</span><br><span class="line">  v40[<span class="number">13</span>] = (__int64)&amp;unk_7FF7C9755790;</span><br><span class="line">  v40[<span class="number">14</span>] = (__int64)&amp;unk_7FF7C9754F90;</span><br><span class="line">  v40[<span class="number">15</span>] = (__int64)&amp;unk_7FF7C97556B0;</span><br><span class="line">  v40[<span class="number">16</span>] = (__int64)&amp;unk_7FF7C9755870;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Buf1);</span><br><span class="line">  v3 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v3;</span><br><span class="line">  <span class="keyword">while</span> ( Buf1[v3] );</span><br><span class="line">  <span class="keyword">if</span> ( v3 == <span class="number">32</span> ) <span class="comment">//flag的长度为32</span></span><br><span class="line">  &#123;</span><br><span class="line">    srand(<span class="number">0x1BF52u</span>);</span><br><span class="line">    v5 = off_7FF7C9755068;</span><br><span class="line">    v6 = <span class="number">0</span>;</span><br><span class="line">    v7 = off_7FF7C9755070;</span><br><span class="line">    v8 = off_7FF7C9755068;</span><br><span class="line">    v9 = off_7FF7C9755078;</span><br><span class="line">    v10 = off_7FF7C9755080;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      *v8++ = v6++;</span><br><span class="line">    <span class="keyword">while</span> ( v6 &lt; <span class="number">256</span> );</span><br><span class="line">    v11 = <span class="number">512</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v12 = rand();</span><br><span class="line">      v13 = rand();</span><br><span class="line">      v14 = v5[v12];</span><br><span class="line">      v5[v12] = v5[v13];</span><br><span class="line">      v5[v13] = v14;</span><br><span class="line">      --v11;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 );</span><br><span class="line">    v15 = <span class="number">0</span>;</span><br><span class="line">    v16 = v7;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      *v16++ = v15++;</span><br><span class="line">    <span class="keyword">while</span> ( v15 &lt; <span class="number">32</span> );</span><br><span class="line">    v17 = <span class="number">32</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v18 = rand() % <span class="number">32</span>;</span><br><span class="line">      v19 = rand() % <span class="number">32</span>;</span><br><span class="line">      v20 = v7[v18];</span><br><span class="line">      v7[v18] = v7[v19];</span><br><span class="line">      v7[v19] = v20;</span><br><span class="line">      --v17;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v17 );</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>i64; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">      v9[i] = rand();</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>i64; j &lt; <span class="number">32</span>; ++j )</span><br><span class="line">      v10[j] = rand();</span><br><span class="line">    v23 = <span class="number">0</span>;</span><br><span class="line">    v24 = <span class="number">0</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v25 = VirtualAlloc(<span class="number">0</span>i64, <span class="number">0xD2u</span>i64, <span class="number">0x1000u</span>, <span class="number">4u</span>);</span><br><span class="line">      lpAddress[v24] = v25;</span><br><span class="line">      <span class="keyword">if</span> ( !v25 )</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">      v26 = (_OWORD *)v40[v24];</span><br><span class="line">      ++v23;</span><br><span class="line">      ++v24;</span><br><span class="line">      *v25 = *v26;</span><br><span class="line">      v25[<span class="number">1</span>] = v26[<span class="number">1</span>];</span><br><span class="line">      v25[<span class="number">2</span>] = v26[<span class="number">2</span>];</span><br><span class="line">      v25[<span class="number">3</span>] = v26[<span class="number">3</span>];</span><br><span class="line">      v25[<span class="number">4</span>] = v26[<span class="number">4</span>];</span><br><span class="line">      v25[<span class="number">5</span>] = v26[<span class="number">5</span>];</span><br><span class="line">      v25[<span class="number">6</span>] = v26[<span class="number">6</span>];</span><br><span class="line">      v27 = v26[<span class="number">7</span>];</span><br><span class="line">      v26 += <span class="number">8</span>;</span><br><span class="line">      v25[<span class="number">7</span>] = v27;</span><br><span class="line">      v25[<span class="number">8</span>] = *v26;</span><br><span class="line">      v25[<span class="number">9</span>] = v26[<span class="number">1</span>];</span><br><span class="line">      v25[<span class="number">10</span>] = v26[<span class="number">2</span>];</span><br><span class="line">      v25[<span class="number">11</span>] = v26[<span class="number">3</span>];</span><br><span class="line">      v25[<span class="number">12</span>] = v26[<span class="number">4</span>];</span><br><span class="line">      *((_WORD *)v25 + <span class="number">104</span>) = *((_WORD *)v26 + <span class="number">40</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v23 &lt; <span class="number">17</span> );</span><br><span class="line">    v28 = lpAddress[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> ( k = <span class="number">0</span>i64; k &lt; <span class="number">16</span>; ++k )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>i64; m &lt; <span class="number">17</span>; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( m != k + <span class="number">1</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v31 = (<span class="type">const</span> __m128i *)lpAddress[m];</span><br><span class="line">          v32 = <span class="number">0</span>i64;</span><br><span class="line">          v33 = (__int8 *)lpAddress[k + <span class="number">1</span>];</span><br><span class="line">          <span class="keyword">if</span> ( v31 &lt;= (<span class="type">const</span> __m128i *)(v33 + <span class="number">209</span>) &amp;&amp; &amp;v31[<span class="number">13</span>].m128i_i8[<span class="number">1</span>] &gt;= v33 )</span><br><span class="line">            <span class="keyword">goto</span> LABEL_37;</span><br><span class="line">          v34 = v31 + <span class="number">2</span>;</span><br><span class="line">          <span class="keyword">do</span></span><br><span class="line">          &#123;</span><br><span class="line">            v35 = _mm_loadu_si128(v34 - <span class="number">2</span>);</span><br><span class="line">            v34 += <span class="number">4</span>;</span><br><span class="line">            v36 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;v33[v32 + <span class="number">32</span>]);</span><br><span class="line">            v34[<span class="number">-6</span>] = _mm_xor_si128(_mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;v33[v32]), v35);</span><br><span class="line">            v34[<span class="number">-5</span>] = _mm_xor_si128(_mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;v33[v32 + <span class="number">16</span>]), _mm_loadu_si128(v34 - <span class="number">5</span>));</span><br><span class="line">            v37 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;v33[v32 + <span class="number">48</span>]);</span><br><span class="line">            v32 += <span class="number">64</span>i64;</span><br><span class="line">            v34[<span class="number">-4</span>] = _mm_xor_si128(v36, _mm_loadu_si128(v34 - <span class="number">4</span>));</span><br><span class="line">            v34[<span class="number">-3</span>] = _mm_xor_si128(v37, _mm_loadu_si128(v34 - <span class="number">3</span>));</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">while</span> ( v32 &lt; <span class="number">192</span> );</span><br><span class="line">          <span class="keyword">if</span> ( v32 &lt; <span class="number">210</span> )</span><br><span class="line">          &#123;</span><br><span class="line">LABEL_37:</span><br><span class="line">            <span class="keyword">do</span></span><br><span class="line">            &#123;</span><br><span class="line">              v31-&gt;m128i_i8[v32] ^= v33[v32];</span><br><span class="line">              ++v32;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> ( v32 &lt; <span class="number">210</span> );</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">memset</span>(lpAddress[k + <span class="number">1</span>], <span class="number">0</span>, <span class="number">0xD2u</span>i64);</span><br><span class="line">      VirtualProtect(v28, <span class="number">0xD2u</span>i64, <span class="number">0x20u</span>, flOldProtect);</span><br><span class="line">      ((<span class="type">void</span> (__fastcall *)(<span class="type">char</span> *, <span class="type">void</span> **))v28)(Buf1, &amp;off_7FF7C9755068); <span class="comment">//SMC函数</span></span><br><span class="line">      VirtualProtect(v28, <span class="number">0xD2u</span>i64, <span class="number">4u</span>, flOldProtect);</span><br><span class="line">    &#125;</span><br><span class="line">    v38 = <span class="built_in">memcmp</span>(Buf1, &amp;unk_7FF7C9754B08, <span class="number">0x20u</span>i64); <span class="comment">//比较结果</span></span><br><span class="line">    v39 = <span class="string">&quot;right\n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v38 )</span><br><span class="line">      v39 = <span class="string">&quot;wrong\n&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(v39);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;wrong\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现了一个SMC的加密，然后就是比较了，密文为<font color=lime><strong>[0x5B, 0x2D, 0xE9, 0x66, 0xED, 0x39, 0x90, 0x23, 0xAF, 0xDA, 0xEB, 0x2E, 0xD1, 0x0D, 0xBB, 0xBD, 0x57, 0x52, 0x02, 0xB0, 0xBA, 0x9D, 0x52, 0xFA, 0x67, 0xEE, 0xA3, 0x85, 0xA9, 0x84, 0xE2, 0x6F]</strong></font>，动态调试着重看SMC部分，发现SMC部分的代码一共执行16次，且函数一共有许多种（有点像VM），执行逻辑为：</p>
<p><font color=red><strong>01 02 03(5,3) 04(1,7) 01 02 03(2,6) 04(4,4) 01 02 03(5,3) 04(3,5) 01 02 03(6,2) 04(7,1)</strong></font></p>
<p>列出这些函数，第一种：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1FC33450000</span><span class="params">(__int64 a1, __int64 *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = *a2; <span class="comment">//第一个对照表：256字节</span></span><br><span class="line">  v3 = *a2;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i ) <span class="comment">//循环32次</span></span><br><span class="line">  &#123;</span><br><span class="line">    result = *(<span class="type">unsigned</span> __int8 *)(v3 + *(<span class="type">unsigned</span> __int8 *)(a1 + i)); <span class="comment">//加密方式：在a2中找到以a1为索引的值</span></span><br><span class="line">    *(_BYTE *)(a1 + i) = result; <span class="comment">//写回原字符</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动态调试得到对照表:<font color=violet><strong>[0xB0, 0xF0, 0x21, 0xCF, 0xF2, 0x04, 0x3A, 0x68, 0x84, 0x7B, 0x39, 0x86, 0x36, 0x87, 0x9B, 0xF7, 0x3D, 0x18, 0x1E, 0x61, 0x1B, 0x2E, 0x6C, 0xDF, 0x2C, 0xAE, 0x65, 0x9D, 0xEB, 0x2F, 0xDA, 0xF4, 0xDE, 0xCA, 0x56, 0x92, 0x75, 0x3B, 0x62, 0x45, 0x06, 0x3C, 0x52, 0x33, 0x6E, 0x25, 0xCE, 0xA3, 0xD2, 0x44, 0xA1, 0x4A, 0x58, 0xB1, 0xA0, 0x2A, 0x47, 0x0A, 0x02, 0xAF, 0x50, 0xC3, 0xDC, 0xEA, 0xE5, 0x0D, 0x67, 0x91, 0xE1, 0x51, 0xE3, 0xC1, 0xAA, 0x95, 0x5C, 0x79, 0x72, 0x1C, 0x3F, 0xB8, 0xE8, 0x1F, 0xFF, 0x7A, 0x73, 0x26, 0x54, 0x9E, 0xED, 0xA9, 0x41, 0x20, 0xEF, 0xA6, 0x48, 0x97, 0x4F, 0xD4, 0xBB, 0x23, 0x66, 0xD9, 0xE4, 0x0B, 0x30, 0x15, 0xD7, 0x6B, 0x19, 0xCD, 0xC4, 0x08, 0xB4, 0xC8, 0x14, 0xFD, 0x7F, 0x28, 0x0E, 0x05, 0x0F, 0x4B, 0x6F, 0xF5, 0x90, 0x76, 0xBF, 0x60, 0xE7, 0x24, 0x78, 0x6D, 0x71, 0xA8, 0x43, 0xB5, 0x0C, 0x31, 0xF9, 0xA2, 0x9C, 0x99, 0xF6, 0x2D, 0xDB, 0xB7, 0xC9, 0x85, 0x81, 0x03, 0x64, 0x1D, 0x07, 0x34, 0x5A, 0xBD, 0x37, 0x4C, 0xA7, 0x5F, 0x46, 0xE9, 0x35, 0x93, 0x8D, 0xA5, 0xFB, 0x42, 0x01, 0xC2, 0x17, 0x12, 0x1A, 0x77, 0xC6, 0x53, 0x83, 0x4D, 0xB2, 0x10, 0x2B, 0xF8, 0x88, 0x6A, 0x3E, 0xD0, 0x7C, 0x63, 0x40, 0x27, 0xBE, 0xD5, 0x38, 0xD1, 0x74, 0xB6, 0x57, 0x94, 0xAB, 0x8A, 0xB9, 0xBC, 0x7D, 0xB3, 0x96, 0x7E, 0xFC, 0xAD, 0x22, 0x4E, 0xFA, 0xE0, 0xCB, 0x8B, 0xEE, 0x32, 0xA4, 0x16, 0xFE, 0x5B, 0x13, 0xDD, 0xC0, 0x9A, 0x5E, 0x8E, 0x29, 0xF3, 0x8F, 0x49, 0xE6, 0x9F, 0xF1, 0xC5, 0x70, 0x55, 0x8C, 0x11, 0xCC, 0x5D, 0xEC, 0x00, 0xAC, 0x89, 0xD3, 0x82, 0x69, 0xD6, 0xBA, 0xD8, 0x59, 0x98, 0x09, 0x80, 0xE2, 0xC7]</strong></font></p>
<p>继续往后看第二种加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1FC33450000</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v3[<span class="number">44</span>]; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [rsp+2Ch] [rbp-14h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+30h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = *(_QWORD *)(a2 + <span class="number">8</span>);</span><br><span class="line">  v5 = result; <span class="comment">//设置v5的值为新的对照表（32字节长度）</span></span><br><span class="line">  v4 = <span class="number">32</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(<span class="type">unsigned</span> __int8 *)(i + a1);</span><br><span class="line">    v3[*(<span class="type">unsigned</span> __int8 *)(v5 + i)] = result;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">31</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (<span class="type">unsigned</span> __int8)v3[j];</span><br><span class="line">    *(_BYTE *)(*(<span class="type">unsigned</span> __int8 *)(v5 + j) + a1) = result;	<span class="comment">//按给定的32位对照表两次打乱给出的32字节的数据</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>动态调试得到第二个对照表：<font color=LimeGreen><strong>[0x13, 0x1F, 0x10, 0x1D, 0x01, 0x0D, 0x07, 0x15, 0x08, 0x06, 0x16, 0x00, 0x0F, 0x0C, 0x02, 0x05, 0x0E, 0x03, 0x12, 0x04, 0x18, 0x14, 0x1A, 0x1C, 0x1E, 0x19, 0x09, 0x1B, 0x11, 0x0B, 0x17, 0x0A]</strong></font>，接着看第三个加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__fastcall <span class="title function_">sub_20367C90000</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  _BYTE *v3; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v4 = *(_QWORD *)(a2 + <span class="number">16</span>); <span class="comment">//异或表v4</span></span><br><span class="line">  result = *(_BYTE **)(a2 + <span class="number">24</span>); <span class="comment">//加和表v3</span></span><br><span class="line">  v3 = result;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(a1 + i) = (*(_BYTE *)(v4 + i) ^ *(_BYTE *)(a1 + i)) + v3[i]; <span class="comment">//异或并加和</span></span><br><span class="line">    result = (_BYTE *)(a1 + i);</span><br><span class="line">    *result = ((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)*result &gt;&gt; <span class="number">5</span>) | (<span class="number">8</span> * *result); <span class="comment">//低五位|高三位</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>同理得到第三、四个表：<font color=orange><strong>[0x7D, 0xB7, 0x24, 0x7E, 0xC3, 0x6B, 0xBD, 0xD8, 0x7F, 0x13, 0x6E, 0x0F, 0x43, 0xCD, 0x6B, 0xCF, 0x18, 0x4F, 0x26, 0x18, 0x12, 0x2A, 0x7E, 0x9B, 0x27, 0x4C, 0x33, 0x67, 0x40, 0xC9, 0x9E, 0xC4]</strong></font> 和 <font color=lime><strong>[0x91, 0xDB, 0x9F, 0x5F, 0x26, 0x27, 0xD6, 0xA8, 0xBF, 0x41, 0x16, 0x79, 0xDE, 0x73, 0x16, 0xF8, 0x1E, 0xBA, 0x6A, 0xBE, 0xC6, 0x12, 0xB2, 0x39, 0x9E, 0xF3, 0x12, 0x4E, 0x02, 0x1C, 0xE2, 0x43]</strong></font>，看第四个加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__fastcall <span class="title function_">sub_20367C90000</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  _BYTE *v3; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v4 = *(_QWORD *)(a2 + <span class="number">16</span>);</span><br><span class="line">  result = *(_BYTE **)(a2 + <span class="number">24</span>);</span><br><span class="line">  v3 = result;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(a1 + i) = *(_BYTE *)(v4 + i) ^ (*(_BYTE *)(a1 + i) + v3[i]); <span class="comment">//加和并异或</span></span><br><span class="line">    result = (_BYTE *)(a1 + i);</span><br><span class="line">    *result = ((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)*result &gt;&gt; <span class="number">1</span>) | (*result &lt;&lt; <span class="number">7</span>); </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现和第三个相比变化不大，到第七个函数的时候是第三种改了改参数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*(_BYTE *)(a1 + i) = (*(_BYTE *)(v4 + i) ^ *(_BYTE *)(a1 + i)) + v3[i];</span><br><span class="line">result = (_BYTE *)(a1 + i);</span><br><span class="line">*result = ((<span class="type">int</span>)(<span class="type">unsigned</span> __int8)*result &gt;&gt; <span class="number">2</span>) | (*result &lt;&lt; <span class="number">6</span>);</span><br></pre></td></tr></table></figure>
<p>也是同类型的，这里不再分析，第八个函数同理：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*(_BYTE *)(a1 + i) = *(_BYTE *)(v4 + i) ^ (*(_BYTE *)(a1 + i) + v3[i]);</span><br><span class="line">result = (_BYTE *)(a1 + i);</span><br><span class="line">*result = ((int)(unsigned __int8)*result &gt;&gt; 4) | (16 * *result);</span><br></pre></td></tr></table></figure>
<p>由于类型基本一样，这类可以分成两种：一种是先异或后加和，一种是先加和后异或，编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_E1</span>(<span class="params">input_data, offset_table</span>):</span><br><span class="line">    encrypted_data = <span class="built_in">bytearray</span>(input_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        encrypted_data[i] = offset_table[encrypted_data[i]]</span><br><span class="line">    <span class="keyword">return</span> encrypted_data</span><br><span class="line"><span class="comment">#第一种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_D1</span>(<span class="params">encrypted_data, offset_table</span>):</span><br><span class="line">    reverse_table = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> original_value, offset_value <span class="keyword">in</span> <span class="built_in">enumerate</span>(offset_table):</span><br><span class="line">        reverse_table[offset_value] = original_value</span><br><span class="line">    decrypted_data = <span class="built_in">bytearray</span>(encrypted_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        decrypted_data[i] = reverse_table[decrypted_data[i]]</span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"><span class="comment">#第一种加密方式的对照表</span></span><br><span class="line">array1 = [<span class="number">0xB0</span>, <span class="number">0xF0</span>, <span class="number">0x21</span>, <span class="number">0xCF</span>, <span class="number">0xF2</span>, <span class="number">0x04</span>, <span class="number">0x3A</span>, <span class="number">0x68</span>, <span class="number">0x84</span>, <span class="number">0x7B</span>, <span class="number">0x39</span>, <span class="number">0x86</span>, <span class="number">0x36</span>, <span class="number">0x87</span>, <span class="number">0x9B</span>, <span class="number">0xF7</span>, </span><br><span class="line">          <span class="number">0x3D</span>, <span class="number">0x18</span>, <span class="number">0x1E</span>, <span class="number">0x61</span>, <span class="number">0x1B</span>, <span class="number">0x2E</span>, <span class="number">0x6C</span>, <span class="number">0xDF</span>, <span class="number">0x2C</span>, <span class="number">0xAE</span>, <span class="number">0x65</span>, <span class="number">0x9D</span>, <span class="number">0xEB</span>, <span class="number">0x2F</span>, <span class="number">0xDA</span>, <span class="number">0xF4</span>, </span><br><span class="line">          <span class="number">0xDE</span>, <span class="number">0xCA</span>, <span class="number">0x56</span>, <span class="number">0x92</span>, <span class="number">0x75</span>, <span class="number">0x3B</span>, <span class="number">0x62</span>, <span class="number">0x45</span>, <span class="number">0x06</span>, <span class="number">0x3C</span>, <span class="number">0x52</span>, <span class="number">0x33</span>, <span class="number">0x6E</span>, <span class="number">0x25</span>, <span class="number">0xCE</span>, <span class="number">0xA3</span>, </span><br><span class="line">          <span class="number">0xD2</span>, <span class="number">0x44</span>, <span class="number">0xA1</span>, <span class="number">0x4A</span>, <span class="number">0x58</span>, <span class="number">0xB1</span>, <span class="number">0xA0</span>, <span class="number">0x2A</span>, <span class="number">0x47</span>, <span class="number">0x0A</span>, <span class="number">0x02</span>, <span class="number">0xAF</span>, <span class="number">0x50</span>, <span class="number">0xC3</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, </span><br><span class="line">          <span class="number">0xE5</span>, <span class="number">0x0D</span>, <span class="number">0x67</span>, <span class="number">0x91</span>, <span class="number">0xE1</span>, <span class="number">0x51</span>, <span class="number">0xE3</span>, <span class="number">0xC1</span>, <span class="number">0xAA</span>, <span class="number">0x95</span>, <span class="number">0x5C</span>, <span class="number">0x79</span>, <span class="number">0x72</span>, <span class="number">0x1C</span>, <span class="number">0x3F</span>, <span class="number">0xB8</span>, </span><br><span class="line">          <span class="number">0xE8</span>, <span class="number">0x1F</span>, <span class="number">0xFF</span>, <span class="number">0x7A</span>, <span class="number">0x73</span>, <span class="number">0x26</span>, <span class="number">0x54</span>, <span class="number">0x9E</span>, <span class="number">0xED</span>, <span class="number">0xA9</span>, <span class="number">0x41</span>, <span class="number">0x20</span>, <span class="number">0xEF</span>, <span class="number">0xA6</span>, <span class="number">0x48</span>, <span class="number">0x97</span>, </span><br><span class="line">          <span class="number">0x4F</span>, <span class="number">0xD4</span>, <span class="number">0xBB</span>, <span class="number">0x23</span>, <span class="number">0x66</span>, <span class="number">0xD9</span>, <span class="number">0xE4</span>, <span class="number">0x0B</span>, <span class="number">0x30</span>, <span class="number">0x15</span>, <span class="number">0xD7</span>, <span class="number">0x6B</span>, <span class="number">0x19</span>, <span class="number">0xCD</span>, <span class="number">0xC4</span>, <span class="number">0x08</span>, </span><br><span class="line">          <span class="number">0xB4</span>, <span class="number">0xC8</span>, <span class="number">0x14</span>, <span class="number">0xFD</span>, <span class="number">0x7F</span>, <span class="number">0x28</span>, <span class="number">0x0E</span>, <span class="number">0x05</span>, <span class="number">0x0F</span>, <span class="number">0x4B</span>, <span class="number">0x6F</span>, <span class="number">0xF5</span>, <span class="number">0x90</span>, <span class="number">0x76</span>, <span class="number">0xBF</span>, <span class="number">0x60</span>, </span><br><span class="line">          <span class="number">0xE7</span>, <span class="number">0x24</span>, <span class="number">0x78</span>, <span class="number">0x6D</span>, <span class="number">0x71</span>, <span class="number">0xA8</span>, <span class="number">0x43</span>, <span class="number">0xB5</span>, <span class="number">0x0C</span>, <span class="number">0x31</span>, <span class="number">0xF9</span>, <span class="number">0xA2</span>, <span class="number">0x9C</span>, <span class="number">0x99</span>, <span class="number">0xF6</span>, <span class="number">0x2D</span>, </span><br><span class="line">          <span class="number">0xDB</span>, <span class="number">0xB7</span>, <span class="number">0xC9</span>, <span class="number">0x85</span>, <span class="number">0x81</span>, <span class="number">0x03</span>, <span class="number">0x64</span>, <span class="number">0x1D</span>, <span class="number">0x07</span>, <span class="number">0x34</span>, <span class="number">0x5A</span>, <span class="number">0xBD</span>, <span class="number">0x37</span>, <span class="number">0x4C</span>, <span class="number">0xA7</span>, <span class="number">0x5F</span>, </span><br><span class="line">          <span class="number">0x46</span>, <span class="number">0xE9</span>, <span class="number">0x35</span>, <span class="number">0x93</span>, <span class="number">0x8D</span>, <span class="number">0xA5</span>, <span class="number">0xFB</span>, <span class="number">0x42</span>, <span class="number">0x01</span>, <span class="number">0xC2</span>, <span class="number">0x17</span>, <span class="number">0x12</span>, <span class="number">0x1A</span>, <span class="number">0x77</span>, <span class="number">0xC6</span>, <span class="number">0x53</span>, </span><br><span class="line">          <span class="number">0x83</span>, <span class="number">0x4D</span>, <span class="number">0xB2</span>, <span class="number">0x10</span>, <span class="number">0x2B</span>, <span class="number">0xF8</span>, <span class="number">0x88</span>, <span class="number">0x6A</span>, <span class="number">0x3E</span>, <span class="number">0xD0</span>, <span class="number">0x7C</span>, <span class="number">0x63</span>, <span class="number">0x40</span>, <span class="number">0x27</span>, <span class="number">0xBE</span>, <span class="number">0xD5</span>, </span><br><span class="line">          <span class="number">0x38</span>, <span class="number">0xD1</span>, <span class="number">0x74</span>, <span class="number">0xB6</span>, <span class="number">0x57</span>, <span class="number">0x94</span>, <span class="number">0xAB</span>, <span class="number">0x8A</span>, <span class="number">0xB9</span>, <span class="number">0xBC</span>, <span class="number">0x7D</span>, <span class="number">0xB3</span>, <span class="number">0x96</span>, <span class="number">0x7E</span>, <span class="number">0xFC</span>, <span class="number">0xAD</span>, </span><br><span class="line">          <span class="number">0x22</span>, <span class="number">0x4E</span>, <span class="number">0xFA</span>, <span class="number">0xE0</span>, <span class="number">0xCB</span>, <span class="number">0x8B</span>, <span class="number">0xEE</span>, <span class="number">0x32</span>, <span class="number">0xA4</span>, <span class="number">0x16</span>, <span class="number">0xFE</span>, <span class="number">0x5B</span>, <span class="number">0x13</span>, <span class="number">0xDD</span>, <span class="number">0xC0</span>, <span class="number">0x9A</span>, </span><br><span class="line">          <span class="number">0x5E</span>, <span class="number">0x8E</span>, <span class="number">0x29</span>, <span class="number">0xF3</span>, <span class="number">0x8F</span>, <span class="number">0x49</span>, <span class="number">0xE6</span>, <span class="number">0x9F</span>, <span class="number">0xF1</span>, <span class="number">0xC5</span>, <span class="number">0x70</span>, <span class="number">0x55</span>, <span class="number">0x8C</span>, <span class="number">0x11</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, </span><br><span class="line">          <span class="number">0xEC</span>, <span class="number">0x00</span>, <span class="number">0xAC</span>, <span class="number">0x89</span>, <span class="number">0xD3</span>, <span class="number">0x82</span>, <span class="number">0x69</span>, <span class="number">0xD6</span>, <span class="number">0xBA</span>, <span class="number">0xD8</span>, <span class="number">0x59</span>, <span class="number">0x98</span>, <span class="number">0x09</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xC7</span>]</span><br><span class="line"><span class="comment">#第二种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_E2</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    v3 = <span class="built_in">bytearray</span>(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v3[a2[i]] = a1[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(v3)</span><br><span class="line"><span class="comment">#第二种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_D2</span>(<span class="params">shuffled_data, a2</span>):</span><br><span class="line">    v3 = <span class="built_in">bytearray</span>(<span class="number">32</span>)</span><br><span class="line">    reverse_map = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        reverse_map[a2[i]] = i</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v3[reverse_map[i]] = shuffled_data[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(v3)</span><br><span class="line"><span class="comment">#第二种加密方式的对照表</span></span><br><span class="line">array2 = [<span class="number">0x13</span>, <span class="number">0x1F</span>, <span class="number">0x10</span>, <span class="number">0x1D</span>, <span class="number">0x01</span>, <span class="number">0x0D</span>, <span class="number">0x07</span>, <span class="number">0x15</span>, <span class="number">0x08</span>, <span class="number">0x06</span>, <span class="number">0x16</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0x0C</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, </span><br><span class="line">          <span class="number">0x0E</span>, <span class="number">0x03</span>, <span class="number">0x12</span>, <span class="number">0x04</span>, <span class="number">0x18</span>, <span class="number">0x14</span>, <span class="number">0x1A</span>, <span class="number">0x1C</span>, <span class="number">0x1E</span>, <span class="number">0x19</span>, <span class="number">0x09</span>, <span class="number">0x1B</span>, <span class="number">0x11</span>, <span class="number">0x0B</span>, <span class="number">0x17</span>, <span class="number">0x0A</span>]</span><br><span class="line"><span class="comment">#第三种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_E3</span>(<span class="params">input_data, xor_table, add_table, v1, v2</span>):</span><br><span class="line">    transformed_data = <span class="built_in">bytearray</span>(input_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = transformed_data[i] ^ xor_table[i]</span><br><span class="line">        temp = (temp + add_table[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        transformed_data[i] = ((temp &gt;&gt; v1) | (temp &lt;&lt; v2)) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> transformed_data</span><br><span class="line"><span class="comment">#第三种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_D3</span>(<span class="params">encrypted_data, xor_table, add_table, v1, v2</span>):</span><br><span class="line">    decrypted_data = <span class="built_in">bytearray</span>(encrypted_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = decrypted_data[i]</span><br><span class="line">        temp = ((temp &lt;&lt; v1) | (temp &gt;&gt; v2)) &amp; <span class="number">0xFF</span></span><br><span class="line">        temp = (temp - add_table[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        decrypted_data[i] = temp ^ xor_table[i]</span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"><span class="comment">#第四种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_E4</span>(<span class="params">input_data, xor_table, add_table, v1, v2</span>):</span><br><span class="line">    transformed_data = <span class="built_in">bytearray</span>(input_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = transformed_data[i] + add_table[i] &amp; <span class="number">0xFF</span></span><br><span class="line">        temp ^= xor_table[i]</span><br><span class="line">        transformed_data[i] = ((temp &gt;&gt; v1) | (temp &lt;&lt; v2)) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> transformed_data</span><br><span class="line"><span class="comment">#第四种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SMC_D4</span>(<span class="params">encrypted_data, xor_table, add_table, v1, v2</span>):</span><br><span class="line">    decrypted_data = <span class="built_in">bytearray</span>(encrypted_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = decrypted_data[i]</span><br><span class="line">        temp = ((temp &lt;&lt; v1) | (temp &gt;&gt; v2)) &amp; <span class="number">0xFF</span></span><br><span class="line">        temp ^= xor_table[i]</span><br><span class="line">        decrypted_data[i] = (temp - add_table[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"><span class="comment">#第三四种加密方式的表</span></span><br><span class="line">xor_table = [<span class="number">0x7D</span>, <span class="number">0xB7</span>, <span class="number">0x24</span>, <span class="number">0x7E</span>, <span class="number">0xC3</span>, <span class="number">0x6B</span>, <span class="number">0xBD</span>, <span class="number">0xD8</span>, <span class="number">0x7F</span>, <span class="number">0x13</span>, <span class="number">0x6E</span>, <span class="number">0x0F</span>, <span class="number">0x43</span>, <span class="number">0xCD</span>, <span class="number">0x6B</span>, <span class="number">0xCF</span>,</span><br><span class="line">             <span class="number">0x18</span>, <span class="number">0x4F</span>, <span class="number">0x26</span>, <span class="number">0x18</span>, <span class="number">0x12</span>, <span class="number">0x2A</span>, <span class="number">0x7E</span>, <span class="number">0x9B</span>, <span class="number">0x27</span>, <span class="number">0x4C</span>, <span class="number">0x33</span>, <span class="number">0x67</span>, <span class="number">0x40</span>, <span class="number">0xC9</span>, <span class="number">0x9E</span>, <span class="number">0xC4</span>]</span><br><span class="line">add_table = [<span class="number">0x91</span>, <span class="number">0xDB</span>, <span class="number">0x9F</span>, <span class="number">0x5F</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0xD6</span>, <span class="number">0xA8</span>, <span class="number">0xBF</span>, <span class="number">0x41</span>, <span class="number">0x16</span>, <span class="number">0x79</span>, <span class="number">0xDE</span>, <span class="number">0x73</span>, <span class="number">0x16</span>, <span class="number">0xF8</span>,</span><br><span class="line">             <span class="number">0x1E</span>, <span class="number">0xBA</span>, <span class="number">0x6A</span>, <span class="number">0xBE</span>, <span class="number">0xC6</span>, <span class="number">0x12</span>, <span class="number">0xB2</span>, <span class="number">0x39</span>, <span class="number">0x9E</span>, <span class="number">0xF3</span>, <span class="number">0x12</span>, <span class="number">0x4E</span>, <span class="number">0x02</span>, <span class="number">0x1C</span>, <span class="number">0xE2</span>, <span class="number">0x43</span>]</span><br><span class="line"><span class="comment">#加密过程：用于测试</span></span><br><span class="line">input_data = <span class="string">b&#x27;12345678901234567890123456789012&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">input_data = SMC_E1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;0# E1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E2(SMC_E2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;1# E2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E3(input_data, xor_table, add_table, <span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;2# E3 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E4(input_data, xor_table, add_table, <span class="number">1</span>, <span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;3# E4 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">input_data = SMC_E1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;4# E1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E2(SMC_E2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;5# E2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E3(input_data, xor_table, add_table, <span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;6# E3 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E4(input_data, xor_table, add_table, <span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;7# E4 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">input_data = SMC_E1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;8# E1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E2(SMC_E2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;9# E2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E3(input_data, xor_table, add_table, <span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A# E3 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E4(input_data, xor_table, add_table, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;B# E4 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">input_data = SMC_E1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C# E1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E2(SMC_E2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;D# E2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E3(input_data, xor_table, add_table, <span class="number">6</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;E# E3 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_E4(input_data, xor_table, add_table, <span class="number">7</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;F# E4 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment">#解密过程</span></span><br><span class="line">input_data = <span class="string">b&#x27;\x5b\x2d\xe9\x66\xed\x39\x90\x23\xaf\xda\xeb\x2e\xd1\x0d\xbb\xbd\x57\x52\x02\xb0\xba\x9d\x52\xfa\x67\xee\xa3\x85\xa9\x84\xe2\x6f&#x27;</span></span><br><span class="line">input_data = SMC_D4(input_data, xor_table, add_table, <span class="number">7</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;F# D4 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D3(input_data, xor_table, add_table, <span class="number">6</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;E# D3 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D2(SMC_D2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;D# D2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C# D1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">input_data = SMC_D4(input_data, xor_table, add_table, <span class="number">3</span>, <span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;B# D4 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D3(input_data, xor_table, add_table, <span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;A# D3 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D2(SMC_D2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;9# D2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;8# D1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">input_data = SMC_D4(input_data, xor_table, add_table, <span class="number">4</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;7# D4 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D3(input_data, xor_table, add_table, <span class="number">2</span>, <span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;6# D3 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D2(SMC_D2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;5# D2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;4# D1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">input_data = SMC_D4(input_data, xor_table, add_table, <span class="number">1</span>, <span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;3# D4 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D3(input_data, xor_table, add_table, <span class="number">5</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;2# D3 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D2(SMC_D2(input_data, array2), array2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;1# D2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">input_data = SMC_D1(input_data, array1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;0# D1 Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">F# D4 data: bytearray(b&#x27;?F1\xee\x0f\xd0\x1f\xa1\xe9=\x85\x9f\xcd\xd8\xa0\x19\x95\xac\xbd\x82\x89\xd2\xa5\xad\xf6H\xd0W\x92o\r0&#x27;)</span><br><span class="line">E# D3 data: bytearray(b&#x27;C\x01\x89&quot;^fL\x18\xc4\x1d%a\xd6\x0ey\x81_&gt;#\xfa\x8e\x88\xc9\xa98S\x11\xe0\xe2v\xff\r&#x27;)</span><br><span class="line">D# D2 data: b&#x27;^%ya\r\xd6\x88\x8e\xc4\x18\x11\xfaf\x81_\x0e\x89v#\x01\xff8\x1d&gt;\xa9SL\xe0&quot;C\xe2\xc9&#x27;</span><br><span class="line">C# D1 Data: bytearray(b&#x27;\xe0-K\x13A\xf7\xb6\xe1n\x11\xed\xd2d\x94\x9fv\xf3&#125;c\xa8R\xc0\x97\xb8Y\xaf\x9d\xd3\xd0\x86\xfe\x92&#x27;)</span><br><span class="line">B# D4 data: bytearray(b&#x27;\xe9\x03\xdf\x87\xa3\xad2/MZ\xeb \x82\xf6\x81\x84i\xea\xd3\x9f\xba\x1a\x10%O&gt;\xcd\xab\xc4\xe1\x87\r&#x27;)</span><br><span class="line">A# D3 data: bytearray(b&#x27;\xd12x\xef\x8d\xe5\xcd\xe5\x95\x19\t\x841\xa6qW\x17\xec6-\x83\x1b.\xf0l\x98\x94@\xd6\xe9\x90\x9a&#x27;)</span><br><span class="line">9# D2 data: b&#x27;\x8d\tq\x84\x9a1\x1b\x83\x95\xe5\x94-\xe5W\x17\xa6x\xe962\x90l\x19\xec\xf0\x98\xcd@\xef\xd1\xd6.&#x27;</span><br><span class="line">8# D1 Data: bytearray(b&#x27;\xa4\xfc\x84\x08\xdf\x89\x14\xb0I@\xc5\x8f@\xc4\xaa]\x82\xa1\x0c\xd7|\x16l\xf0\x01\xfbm\xbc\\\xc1\xf7\x15&#x27;)</span><br><span class="line">7# D4 data: bytearray(b&#x27;\xa6\x9d\xcd\x9f\x18\xcc&amp;+,\xd6\x1c~i\x0e\xab&quot;\x12\x9b|\xa7\x0f9\x06[\x99\x00\xd3^\x83\xb9\xffR&#x27;)</span><br><span class="line">6# D3 data: bytearray(b&#x27;t,\xbca\xf9g\x7f\xdc\x8e\t4\x8f\x84\x08\xf3_2\xfb\xa1\xf8d\xf8\x18\xaf\xefA\x0eLL\x03\x83\xc2&#x27;)</span><br><span class="line">5# D2 data: b&#x27;\xf94\xf3\x8f\xc2\x84\xf8d\x8e\xdc\x0e\xf8g_2\x08\xbc\x03\xa1,\x83\xef\t\xfb\xafA\x7fLatL\x18&#x27;</span><br><span class="line">4# D1 Data: bytearray(b&#x27;\x8a\x99\xe3\xe4\xa9\x08\xb5\x96\xe1&gt;v\xb5B\x9f\xd7o\xc9\x952\x18\xb0\\\xfc\xa6;Zt\x9d\x13\xc2\x9d\x11&#x27;)</span><br><span class="line">3# D4 data: bytearray(b&#x27;\xd7\xa9DXjT\x00M\xfd.l\xeb\xe9\x7f\xae\x19m\xaa\xd8j\xad\x80\xd5\x9d\xb3\x05\xc9\x0ed0\xc3\xa3&#x27;)</span><br><span class="line">2# D3 data: bytearray(b&#x27;\x14\xed\xcd\xd2\xe4\x08\x97\xd9\x7f\x97\x19\x0b\x1c\xb1\xd4\xe4\x97\xd4\x97\x97\xfd\xd4v\xe1\xff\xe1\x14\x14\xca#\x08\xf5&#x27;)</span><br><span class="line">1# D2 data: b&#x27;\xe4\x19\xd4\x0b\xf5\x1c\xd4\xfd\x7f\xd9\x14\x97\x08\xe4\x97\xb1\xcd#\x97\xed\x08\xff\x97\xd4\xe1\xe1\x97\x14\xd2\x14\xcav&#x27;</span><br><span class="line">0# D1 Data: bytearray(b&#x27;flag&#123;Master_of_5mc_XoR_aDD_r0r!&#125;&#x27;)</span><br></pre></td></tr></table></figure>
<p>则flag为：<font color=deepskyblue><strong>flag{Master_of_5mc_XoR_aDD_r0r!}</strong></font>.</p>
<h2 id="df5："><a href="#df5：" class="headerlink" title="df5："></a>df5：</h2><p>查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v3; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v4; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v7; <span class="comment">// rcx</span></span><br><span class="line">  _BYTE *v8; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v10; <span class="comment">// r14</span></span><br><span class="line">  _BYTE *v11; <span class="comment">// rcx</span></span><br><span class="line">  _BYTE *v12; <span class="comment">// r15</span></span><br><span class="line">  _BYTE *v13; <span class="comment">// r12</span></span><br><span class="line">  __int64 v14; <span class="comment">// rbp</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v15; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v16; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v17; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">int</span> v18; <span class="comment">// eax</span></span><br><span class="line">  _BYTE *v19; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v20; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v21; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v22; <span class="comment">// al</span></span><br><span class="line">  <span class="type">char</span> v23; <span class="comment">// r8</span></span><br><span class="line">  __int64 i; <span class="comment">// rbx</span></span><br><span class="line">  __int64 j; <span class="comment">// rbx</span></span><br><span class="line">  <span class="type">int</span> v26; <span class="comment">// eax</span></span><br><span class="line">  __int64 v28[<span class="number">4</span>]; <span class="comment">// [rsp+28h] [rbp-70h]</span></span><br><span class="line">  <span class="type">char</span> Buf1[<span class="number">40</span>]; <span class="comment">// [rsp+48h] [rbp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v3 = <span class="number">0</span>i64;</span><br><span class="line">  v28[<span class="number">0</span>] = (__int64)sub_7FF7BB5410E0; <span class="comment">//四种不同的加密方式</span></span><br><span class="line">  v28[<span class="number">1</span>] = (__int64)sub_7FF7BB5412A0;</span><br><span class="line">  v28[<span class="number">2</span>] = (__int64)sub_7FF7BB541610;</span><br><span class="line">  v28[<span class="number">3</span>] = (__int64)sub_7FF7BB5416B0;</span><br><span class="line">  sub_7FF7BB541020(<span class="string">&quot;flag:&quot;</span>, argv, envp);</span><br><span class="line">  sub_7FF7BB541080(<span class="string">&quot;%s&quot;</span>, Buf1);</span><br><span class="line">  v6 = <span class="number">-1</span>i64;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">    ++v6;</span><br><span class="line">  <span class="keyword">while</span> ( Buf1[v6] );</span><br><span class="line">  <span class="keyword">if</span> ( v6 == <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    srand(<span class="number">0x1BF52u</span>);</span><br><span class="line">    v8 = off_7FF7BB565B90;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    v10 = off_7FF7BB565B98;</span><br><span class="line">    v11 = off_7FF7BB565B90;</span><br><span class="line">    v12 = off_7FF7BB565BA0;</span><br><span class="line">    v13 = off_7FF7BB565BA8;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      *v11++ = v9++;</span><br><span class="line">    <span class="keyword">while</span> ( v9 &lt; <span class="number">256</span> );</span><br><span class="line">    v14 = <span class="number">512</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15 = rand();</span><br><span class="line">      v16 = rand();</span><br><span class="line">      v17 = v8[v15];</span><br><span class="line">      v8[v15] = v8[v16];</span><br><span class="line">      v8[v16] = v17;</span><br><span class="line">      --v14;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v14 );</span><br><span class="line">    v18 = <span class="number">0</span>;</span><br><span class="line">    v19 = v10;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      *v19++ = v18++;</span><br><span class="line">    <span class="keyword">while</span> ( v18 &lt; <span class="number">32</span> );</span><br><span class="line">    v20 = <span class="number">32</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v21 = rand() % <span class="number">32</span>;</span><br><span class="line">      v22 = rand() % <span class="number">32</span>;</span><br><span class="line">      v23 = v10[v21];</span><br><span class="line">      v10[v21] = v10[v22];</span><br><span class="line">      v10[v22] = v23;</span><br><span class="line">      --v20;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v20 );</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>i64; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">      v12[i] = rand();</span><br><span class="line">    <span class="keyword">for</span> ( j = <span class="number">0</span>i64; j &lt; <span class="number">32</span>; ++j )</span><br><span class="line">      v13[j] = rand();</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">      ((<span class="type">void</span> (__fastcall *)(<span class="type">char</span> *, <span class="type">void</span> **))v28[Buf1[v3++] &amp; <span class="number">3</span>])(Buf1, &amp;off_7FF7BB565B90); <span class="comment">//选择什么样的加密方式由输入值决定</span></span><br><span class="line">    <span class="keyword">while</span> ( v3 &lt; <span class="number">32</span> );</span><br><span class="line">    v26 = <span class="built_in">memcmp</span>(Buf1, &amp;unk_7FF7BB565AD0, <span class="number">0x20u</span>i64);</span><br><span class="line">    v7 = <span class="string">&quot;right\n&quot;</span>;</span><br><span class="line">    v4 = <span class="string">&quot;wrong\n&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v26 )</span><br><span class="line">      v7 = <span class="string">&quot;wrong\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="string">&quot;wrong\n&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_7FF7BB541020(v7, v4, v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现函数结构和5mc很相似，flag密文为：<font color=lime><strong>[0x65, 0x3E, 0x43, 0xB8, 0xBA, 0xDB, 0xF6, 0x88, 0x25, 0x1B, 0x28, 0xC7, 0xC0, 0x54, 0xA6, 0x4A, 0x90, 0x37, 0xBC, 0x29, 0x41, 0xAA, 0x28, 0xDB, 0x9A, 0x59, 0x63, 0x9E, 0x4B, 0xCF, 0x2E, 0x41]</strong></font>，但极其诡异的是加密方式的选择由输入的值来决定：输入值从第0个索引开始遍历，计算该值按位与3的值并调用函数列表v28中的这个索引对应的函数，带入输入值和一些数组的偏移量进行加密，加密之后的结果又决定了下一个值该使用哪个加密，若加密非单字节加密，则基本上无解，先将这四个加密函数反编译，先看索引为0的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7BB5410E0</span><span class="params">(<span class="type">unsigned</span> __int8 *a1, __int64 *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  v2 = *a2;</span><br><span class="line">  v4 = a1[<span class="number">1</span>];</span><br><span class="line">  *a1 = *(_BYTE *)(*a1 + *a2);</span><br><span class="line">  v5 = *(_BYTE *)(v4 + v2);</span><br><span class="line">  v6 = a1[<span class="number">2</span>];</span><br><span class="line">  a1[<span class="number">1</span>] = v5;</span><br><span class="line">  v7 = *(_BYTE *)(v6 + v2);</span><br><span class="line">  v8 = a1[<span class="number">3</span>];</span><br><span class="line">  a1[<span class="number">2</span>] = v7;</span><br><span class="line">  …中间部分省略…</span><br><span class="line">  v61 = *(_BYTE *)(v60 + v2);</span><br><span class="line">  v62 = a1[<span class="number">30</span>];</span><br><span class="line">  a1[<span class="number">29</span>] = v61;</span><br><span class="line">  v63 = *(_BYTE *)(v62 + v2);</span><br><span class="line">  result = a1[<span class="number">31</span>];</span><br><span class="line">  a1[<span class="number">30</span>] = v63;</span><br><span class="line">  a1[<span class="number">31</span>] = *(_BYTE *)(result + v2);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这个函数等效的就是上一题的S盒替换，并且动态调试查看发现S盒也没有改变，再看索引为1的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7BB5412A0</span><span class="params">(<span class="type">char</span> *a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int8 *v2; <span class="comment">// r9</span></span><br><span class="line">  __int64 v4; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v5; <span class="comment">// r8</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// al</span></span><br><span class="line">  __int64 v7; <span class="comment">// rcx</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">31</span>]; <span class="comment">// [rsp+0h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v10; <span class="comment">// [rsp+1Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  v2 = *(<span class="type">unsigned</span> __int8 **)(a2 + <span class="number">8</span>);</span><br><span class="line">  v4 = v2[<span class="number">1</span>];</span><br><span class="line">  v5 = *v2;</span><br><span class="line">  v9[v5] = *a1;</span><br><span class="line">  v9[v4] = a1[<span class="number">1</span>];</span><br><span class="line">  v6 = a1[<span class="number">2</span>];</span><br><span class="line">  v7 = v2[<span class="number">3</span>];</span><br><span class="line">  v9[v2[<span class="number">2</span>]] = v6;</span><br><span class="line">  v9[v7] = a1[<span class="number">3</span>];</span><br><span class="line">  …</span><br><span class="line">  v9[v2[<span class="number">31</span>]] = a1[<span class="number">31</span>];</span><br><span class="line">  a1[v5] = v9[<span class="number">0</span>];</span><br><span class="line">  a1[v2[<span class="number">1</span>]] = v9[<span class="number">1</span>];</span><br><span class="line">  …</span><br><span class="line">  a1[v2[<span class="number">30</span>]] = v9[<span class="number">30</span>];</span><br><span class="line">  result = v10;</span><br><span class="line">  a1[v2[<span class="number">31</span>]] = v10;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这个函数也是上一题的打乱函数，并且打乱用的对照表也没变，再看索引为2的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">__m128i *__fastcall <span class="title function_">sub_7FF7BB541610</span><span class="params">(<span class="type">const</span> __m128i *a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v2; <span class="comment">// r8</span></span><br><span class="line">  __int8 *v3; <span class="comment">// r10</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v4; <span class="comment">// r9</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// r9</span></span><br><span class="line">  __m128i *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// r8</span></span><br><span class="line">  __int64 v8; <span class="comment">// r10</span></span><br><span class="line">  __int8 *v9; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// cl</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v11; <span class="comment">// r9</span></span><br><span class="line">  __int64 v12; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v13; <span class="comment">// r8</span></span><br><span class="line">  __m128i v14; <span class="comment">// xmm0</span></span><br><span class="line"></span><br><span class="line">  v2 = *(_QWORD *)(a2 + <span class="number">24</span>); <span class="comment">//上一题的第四个表</span></span><br><span class="line">  v3 = &amp;a1[<span class="number">1</span>].m128i_i8[<span class="number">15</span>];</span><br><span class="line">  v4 = *(_QWORD *)(a2 + <span class="number">16</span>); <span class="comment">//上一题的第三个表</span></span><br><span class="line">  <span class="keyword">if</span> ( ((<span class="type">unsigned</span> __int64)a1 &gt; v2 + <span class="number">31</span> || (<span class="type">unsigned</span> __int64)v3 &lt; v2) &amp;&amp; ((<span class="type">unsigned</span> __int64)a1 &gt; v4 + <span class="number">31</span> || (<span class="type">unsigned</span> __int64)v3 &lt; v4) )</span><br><span class="line">  &#123;</span><br><span class="line">v11 = v4 – v2;</span><br><span class="line">v12 = <span class="number">2</span>i64;</span><br><span class="line">v13 = v2 – (_QWORD)a1;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">      result = (__m128i *)((<span class="type">char</span> *)a1 + v13); <span class="comment">//v2，第四个表</span></span><br><span class="line">      v14 = _mm_loadu_si128(a1++);</span><br><span class="line">      a1[<span class="number">-1</span>] = _mm_add_epi8(_mm_xor_si128(_mm_loadu_si128((__m128i *)((<span class="type">char</span> *)result + v11)), v14),_mm_loadu_si128(result)); <span class="comment">//先异或后相加</span></span><br><span class="line">      --v12;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v12 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = v4 - v2;</span><br><span class="line">    result = (__m128i *)a1;</span><br><span class="line">    v7 = v2 - (_QWORD)a1;</span><br><span class="line">    v8 = <span class="number">32</span>i64;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v9 = &amp;result-&gt;m128i_i8[v7];</span><br><span class="line">      v10 = result-&gt;m128i_i8[<span class="number">0</span>] ^ result-&gt;m128i_i8[v7 + v5];</span><br><span class="line">      result = (__m128i *)((<span class="type">char</span> *)result + <span class="number">1</span>);</span><br><span class="line">      result[<span class="number">-1</span>].m128i_i8[<span class="number">15</span>] = *v9 + v10; <span class="comment">//先异或后相加</span></span><br><span class="line">      --v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现还是上一题的加密方式，是其中的第三种，但是移除了最后的位移动，再看索引为3的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> __fastcall <span class="title function_">sub_7FF7BB5416B0</span><span class="params">(_BYTE *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> result; <span class="comment">// al</span></span><br><span class="line"></span><br><span class="line">  *a1 = __ROR1__(*a1, <span class="number">3</span>);</span><br><span class="line">  a1[<span class="number">1</span>] = __ROR1__(a1[<span class="number">1</span>], <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">…</span><br><span class="line">  a1[<span class="number">30</span>] = __ROR1__(a1[<span class="number">30</span>], <span class="number">3</span>);</span><br><span class="line">  result = __ROR1__(a1[<span class="number">31</span>], <span class="number">3</span>);</span><br><span class="line">  a1[<span class="number">31</span>] = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这部分补齐了位移动，只不过换成了定值3，至此四种加密方式已经解析完毕，但困难的是获取这四种加密方式的顺序，仔细考虑后发现，如果解密后对应字符按位与3的值不符合要求，则证明不是这种解密，基于此编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#第一种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_E1</span>(<span class="params">input_data, offset_table</span>):</span><br><span class="line">    encrypted_data = <span class="built_in">bytearray</span>(input_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        encrypted_data[i] = offset_table[encrypted_data[i]]</span><br><span class="line">    <span class="keyword">return</span> encrypted_data</span><br><span class="line"><span class="comment">#第一种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_D1</span>(<span class="params">encrypted_data, offset_table</span>):</span><br><span class="line">    reverse_table = [<span class="number">0</span>] * <span class="number">256</span></span><br><span class="line">    <span class="keyword">for</span> original_value, offset_value <span class="keyword">in</span> <span class="built_in">enumerate</span>(offset_table):</span><br><span class="line">        reverse_table[offset_value] = original_value</span><br><span class="line">    decrypted_data = <span class="built_in">bytearray</span>(encrypted_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        decrypted_data[i] = reverse_table[decrypted_data[i]]</span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"><span class="comment">#第一种加密方式的对照表</span></span><br><span class="line">array1 = [<span class="number">0xB0</span>, <span class="number">0xF0</span>, <span class="number">0x21</span>, <span class="number">0xCF</span>, <span class="number">0xF2</span>, <span class="number">0x04</span>, <span class="number">0x3A</span>, <span class="number">0x68</span>, <span class="number">0x84</span>, <span class="number">0x7B</span>, <span class="number">0x39</span>, <span class="number">0x86</span>, <span class="number">0x36</span>, <span class="number">0x87</span>, <span class="number">0x9B</span>, <span class="number">0xF7</span>, </span><br><span class="line">          <span class="number">0x3D</span>, <span class="number">0x18</span>, <span class="number">0x1E</span>, <span class="number">0x61</span>, <span class="number">0x1B</span>, <span class="number">0x2E</span>, <span class="number">0x6C</span>, <span class="number">0xDF</span>, <span class="number">0x2C</span>, <span class="number">0xAE</span>, <span class="number">0x65</span>, <span class="number">0x9D</span>, <span class="number">0xEB</span>, <span class="number">0x2F</span>, <span class="number">0xDA</span>, <span class="number">0xF4</span>, </span><br><span class="line">          <span class="number">0xDE</span>, <span class="number">0xCA</span>, <span class="number">0x56</span>, <span class="number">0x92</span>, <span class="number">0x75</span>, <span class="number">0x3B</span>, <span class="number">0x62</span>, <span class="number">0x45</span>, <span class="number">0x06</span>, <span class="number">0x3C</span>, <span class="number">0x52</span>, <span class="number">0x33</span>, <span class="number">0x6E</span>, <span class="number">0x25</span>, <span class="number">0xCE</span>, <span class="number">0xA3</span>, </span><br><span class="line">          <span class="number">0xD2</span>, <span class="number">0x44</span>, <span class="number">0xA1</span>, <span class="number">0x4A</span>, <span class="number">0x58</span>, <span class="number">0xB1</span>, <span class="number">0xA0</span>, <span class="number">0x2A</span>, <span class="number">0x47</span>, <span class="number">0x0A</span>, <span class="number">0x02</span>, <span class="number">0xAF</span>, <span class="number">0x50</span>, <span class="number">0xC3</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, </span><br><span class="line">          <span class="number">0xE5</span>, <span class="number">0x0D</span>, <span class="number">0x67</span>, <span class="number">0x91</span>, <span class="number">0xE1</span>, <span class="number">0x51</span>, <span class="number">0xE3</span>, <span class="number">0xC1</span>, <span class="number">0xAA</span>, <span class="number">0x95</span>, <span class="number">0x5C</span>, <span class="number">0x79</span>, <span class="number">0x72</span>, <span class="number">0x1C</span>, <span class="number">0x3F</span>, <span class="number">0xB8</span>, </span><br><span class="line">          <span class="number">0xE8</span>, <span class="number">0x1F</span>, <span class="number">0xFF</span>, <span class="number">0x7A</span>, <span class="number">0x73</span>, <span class="number">0x26</span>, <span class="number">0x54</span>, <span class="number">0x9E</span>, <span class="number">0xED</span>, <span class="number">0xA9</span>, <span class="number">0x41</span>, <span class="number">0x20</span>, <span class="number">0xEF</span>, <span class="number">0xA6</span>, <span class="number">0x48</span>, <span class="number">0x97</span>, </span><br><span class="line">          <span class="number">0x4F</span>, <span class="number">0xD4</span>, <span class="number">0xBB</span>, <span class="number">0x23</span>, <span class="number">0x66</span>, <span class="number">0xD9</span>, <span class="number">0xE4</span>, <span class="number">0x0B</span>, <span class="number">0x30</span>, <span class="number">0x15</span>, <span class="number">0xD7</span>, <span class="number">0x6B</span>, <span class="number">0x19</span>, <span class="number">0xCD</span>, <span class="number">0xC4</span>, <span class="number">0x08</span>, </span><br><span class="line">          <span class="number">0xB4</span>, <span class="number">0xC8</span>, <span class="number">0x14</span>, <span class="number">0xFD</span>, <span class="number">0x7F</span>, <span class="number">0x28</span>, <span class="number">0x0E</span>, <span class="number">0x05</span>, <span class="number">0x0F</span>, <span class="number">0x4B</span>, <span class="number">0x6F</span>, <span class="number">0xF5</span>, <span class="number">0x90</span>, <span class="number">0x76</span>, <span class="number">0xBF</span>, <span class="number">0x60</span>, </span><br><span class="line">          <span class="number">0xE7</span>, <span class="number">0x24</span>, <span class="number">0x78</span>, <span class="number">0x6D</span>, <span class="number">0x71</span>, <span class="number">0xA8</span>, <span class="number">0x43</span>, <span class="number">0xB5</span>, <span class="number">0x0C</span>, <span class="number">0x31</span>, <span class="number">0xF9</span>, <span class="number">0xA2</span>, <span class="number">0x9C</span>, <span class="number">0x99</span>, <span class="number">0xF6</span>, <span class="number">0x2D</span>, </span><br><span class="line">          <span class="number">0xDB</span>, <span class="number">0xB7</span>, <span class="number">0xC9</span>, <span class="number">0x85</span>, <span class="number">0x81</span>, <span class="number">0x03</span>, <span class="number">0x64</span>, <span class="number">0x1D</span>, <span class="number">0x07</span>, <span class="number">0x34</span>, <span class="number">0x5A</span>, <span class="number">0xBD</span>, <span class="number">0x37</span>, <span class="number">0x4C</span>, <span class="number">0xA7</span>, <span class="number">0x5F</span>, </span><br><span class="line">          <span class="number">0x46</span>, <span class="number">0xE9</span>, <span class="number">0x35</span>, <span class="number">0x93</span>, <span class="number">0x8D</span>, <span class="number">0xA5</span>, <span class="number">0xFB</span>, <span class="number">0x42</span>, <span class="number">0x01</span>, <span class="number">0xC2</span>, <span class="number">0x17</span>, <span class="number">0x12</span>, <span class="number">0x1A</span>, <span class="number">0x77</span>, <span class="number">0xC6</span>, <span class="number">0x53</span>, </span><br><span class="line">          <span class="number">0x83</span>, <span class="number">0x4D</span>, <span class="number">0xB2</span>, <span class="number">0x10</span>, <span class="number">0x2B</span>, <span class="number">0xF8</span>, <span class="number">0x88</span>, <span class="number">0x6A</span>, <span class="number">0x3E</span>, <span class="number">0xD0</span>, <span class="number">0x7C</span>, <span class="number">0x63</span>, <span class="number">0x40</span>, <span class="number">0x27</span>, <span class="number">0xBE</span>, <span class="number">0xD5</span>, </span><br><span class="line">          <span class="number">0x38</span>, <span class="number">0xD1</span>, <span class="number">0x74</span>, <span class="number">0xB6</span>, <span class="number">0x57</span>, <span class="number">0x94</span>, <span class="number">0xAB</span>, <span class="number">0x8A</span>, <span class="number">0xB9</span>, <span class="number">0xBC</span>, <span class="number">0x7D</span>, <span class="number">0xB3</span>, <span class="number">0x96</span>, <span class="number">0x7E</span>, <span class="number">0xFC</span>, <span class="number">0xAD</span>, </span><br><span class="line">          <span class="number">0x22</span>, <span class="number">0x4E</span>, <span class="number">0xFA</span>, <span class="number">0xE0</span>, <span class="number">0xCB</span>, <span class="number">0x8B</span>, <span class="number">0xEE</span>, <span class="number">0x32</span>, <span class="number">0xA4</span>, <span class="number">0x16</span>, <span class="number">0xFE</span>, <span class="number">0x5B</span>, <span class="number">0x13</span>, <span class="number">0xDD</span>, <span class="number">0xC0</span>, <span class="number">0x9A</span>, </span><br><span class="line">          <span class="number">0x5E</span>, <span class="number">0x8E</span>, <span class="number">0x29</span>, <span class="number">0xF3</span>, <span class="number">0x8F</span>, <span class="number">0x49</span>, <span class="number">0xE6</span>, <span class="number">0x9F</span>, <span class="number">0xF1</span>, <span class="number">0xC5</span>, <span class="number">0x70</span>, <span class="number">0x55</span>, <span class="number">0x8C</span>, <span class="number">0x11</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, </span><br><span class="line">          <span class="number">0xEC</span>, <span class="number">0x00</span>, <span class="number">0xAC</span>, <span class="number">0x89</span>, <span class="number">0xD3</span>, <span class="number">0x82</span>, <span class="number">0x69</span>, <span class="number">0xD6</span>, <span class="number">0xBA</span>, <span class="number">0xD8</span>, <span class="number">0x59</span>, <span class="number">0x98</span>, <span class="number">0x09</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xC7</span>]</span><br><span class="line"><span class="comment">#第二种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_E2</span>(<span class="params">a1, a2</span>):</span><br><span class="line">    v3 = <span class="built_in">bytearray</span>(<span class="number">32</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v3[a2[i]] = a1[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(v3)</span><br><span class="line"><span class="comment">#第二种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_D2</span>(<span class="params">shuffled_data, a2</span>):</span><br><span class="line">    v3 = <span class="built_in">bytearray</span>(<span class="number">32</span>)</span><br><span class="line">    reverse_map = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        reverse_map[a2[i]] = i</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v3[reverse_map[i]] = shuffled_data[i]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(v3)</span><br><span class="line"><span class="comment">#第二种加密方式的对照表</span></span><br><span class="line">array2 = [<span class="number">0x13</span>, <span class="number">0x1F</span>, <span class="number">0x10</span>, <span class="number">0x1D</span>, <span class="number">0x01</span>, <span class="number">0x0D</span>, <span class="number">0x07</span>, <span class="number">0x15</span>, <span class="number">0x08</span>, <span class="number">0x06</span>, <span class="number">0x16</span>, <span class="number">0x00</span>, <span class="number">0x0F</span>, <span class="number">0x0C</span>, <span class="number">0x02</span>, <span class="number">0x05</span>, </span><br><span class="line">          <span class="number">0x0E</span>, <span class="number">0x03</span>, <span class="number">0x12</span>, <span class="number">0x04</span>, <span class="number">0x18</span>, <span class="number">0x14</span>, <span class="number">0x1A</span>, <span class="number">0x1C</span>, <span class="number">0x1E</span>, <span class="number">0x19</span>, <span class="number">0x09</span>, <span class="number">0x1B</span>, <span class="number">0x11</span>, <span class="number">0x0B</span>, <span class="number">0x17</span>, <span class="number">0x0A</span>]</span><br><span class="line"><span class="comment">#第三种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_E3</span>(<span class="params">input_data, xor_table, add_table</span>):</span><br><span class="line">    transformed_data = <span class="built_in">bytearray</span>(input_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = transformed_data[i] ^ xor_table[i]</span><br><span class="line">        transformed_data[i] = (temp + add_table[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> transformed_data</span><br><span class="line"><span class="comment">#第三种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_D3</span>(<span class="params">encrypted_data, xor_table, add_table</span>):</span><br><span class="line">    decrypted_data = <span class="built_in">bytearray</span>(encrypted_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        temp = (decrypted_data[i] - add_table[i]) &amp; <span class="number">0xFF</span></span><br><span class="line">        decrypted_data[i] = temp ^ xor_table[i]</span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"><span class="comment">#第三种加密方式的表</span></span><br><span class="line">xor_table = [<span class="number">0x7D</span>, <span class="number">0xB7</span>, <span class="number">0x24</span>, <span class="number">0x7E</span>, <span class="number">0xC3</span>, <span class="number">0x6B</span>, <span class="number">0xBD</span>, <span class="number">0xD8</span>, <span class="number">0x7F</span>, <span class="number">0x13</span>, <span class="number">0x6E</span>, <span class="number">0x0F</span>, <span class="number">0x43</span>, <span class="number">0xCD</span>, <span class="number">0x6B</span>, <span class="number">0xCF</span>,</span><br><span class="line">             <span class="number">0x18</span>, <span class="number">0x4F</span>, <span class="number">0x26</span>, <span class="number">0x18</span>, <span class="number">0x12</span>, <span class="number">0x2A</span>, <span class="number">0x7E</span>, <span class="number">0x9B</span>, <span class="number">0x27</span>, <span class="number">0x4C</span>, <span class="number">0x33</span>, <span class="number">0x67</span>, <span class="number">0x40</span>, <span class="number">0xC9</span>, <span class="number">0x9E</span>, <span class="number">0xC4</span>]</span><br><span class="line">add_table = [<span class="number">0x91</span>, <span class="number">0xDB</span>, <span class="number">0x9F</span>, <span class="number">0x5F</span>, <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0xD6</span>, <span class="number">0xA8</span>, <span class="number">0xBF</span>, <span class="number">0x41</span>, <span class="number">0x16</span>, <span class="number">0x79</span>, <span class="number">0xDE</span>, <span class="number">0x73</span>, <span class="number">0x16</span>, <span class="number">0xF8</span>,</span><br><span class="line">             <span class="number">0x1E</span>, <span class="number">0xBA</span>, <span class="number">0x6A</span>, <span class="number">0xBE</span>, <span class="number">0xC6</span>, <span class="number">0x12</span>, <span class="number">0xB2</span>, <span class="number">0x39</span>, <span class="number">0x9E</span>, <span class="number">0xF3</span>, <span class="number">0x12</span>, <span class="number">0x4E</span>, <span class="number">0x02</span>, <span class="number">0x1C</span>, <span class="number">0xE2</span>, <span class="number">0x43</span>]</span><br><span class="line"><span class="comment">#第四种加密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_E4</span>(<span class="params">input_data</span>):</span><br><span class="line">    transformed_data = <span class="built_in">bytearray</span>(input_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        transformed_data[i] = ((transformed_data[i] &gt;&gt; <span class="number">3</span>) | (transformed_data[i] &lt;&lt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> transformed_data</span><br><span class="line"><span class="comment">#第四种解密方式</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DFS_D4</span>(<span class="params">encrypted_data</span>):</span><br><span class="line">    decrypted_data = <span class="built_in">bytearray</span>(encrypted_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        decrypted_data[i] = ((decrypted_data[i] &lt;&lt; <span class="number">3</span>) | (decrypted_data[i] &gt;&gt; <span class="number">5</span>)) &amp; <span class="number">0xFF</span></span><br><span class="line">    <span class="keyword">return</span> decrypted_data</span><br><span class="line"><span class="comment">#加密部分，用于测试</span></span><br><span class="line">input_data = <span class="string">b&#x27;12345678901234567890123456789012&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original Data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">bytearray</span>(input_data)[i] &amp; <span class="number">3</span> == <span class="number">0</span>):</span><br><span class="line">        input_data = DFS_E1(input_data, array1)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span># E1 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">bytearray</span>(input_data)[i] &amp; <span class="number">3</span> == <span class="number">1</span>):</span><br><span class="line">        input_data = DFS_E2(DFS_E2(input_data, array2), array2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span># E2 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">bytearray</span>(input_data)[i] &amp; <span class="number">3</span> == <span class="number">2</span>):</span><br><span class="line">        input_data = DFS_E3(input_data, xor_table, add_table)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span># E3 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">bytearray</span>(input_data)[i] &amp; <span class="number">3</span> == <span class="number">3</span>):</span><br><span class="line">        input_data = DFS_E4(input_data)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;i+<span class="number">1</span>&#125;</span># E4 data: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"><span class="comment">#单个加密函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">testcrypt</span>(<span class="params">input_data, index</span>):</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">bytearray</span>(input_data)[index] &amp; <span class="number">3</span> == <span class="number">0</span>):</span><br><span class="line">        test = DFS_E1(input_data, array1)</span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">bytearray</span>(input_data)[index] &amp; <span class="number">3</span> == <span class="number">1</span>):</span><br><span class="line">        test = DFS_E2(DFS_E2(input_data, array2), array2)</span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">bytearray</span>(input_data)[index] &amp; <span class="number">3</span> == <span class="number">2</span>):</span><br><span class="line">        test = DFS_E3(input_data, xor_table, add_table)</span><br><span class="line">    <span class="keyword">elif</span>(<span class="built_in">bytearray</span>(input_data)[index] &amp; <span class="number">3</span> == <span class="number">3</span>):</span><br><span class="line">        test = DFS_E4(input_data)</span><br><span class="line">    <span class="keyword">return</span> test</span><br><span class="line"><span class="comment">#验证函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify</span>(<span class="params">input_data, index</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Testing index:<span class="subst">&#123;index&#125;</span>&quot;</span>)</span><br><span class="line">    tag = []</span><br><span class="line">    test = [<span class="literal">None</span>]*<span class="number">4</span></span><br><span class="line">    test[<span class="number">0</span>] = DFS_D1(input_data, array1)</span><br><span class="line">    test[<span class="number">1</span>] = DFS_D2(DFS_D2(input_data, array2), array2)</span><br><span class="line">    test[<span class="number">2</span>] = DFS_D3(input_data, xor_table, add_table)</span><br><span class="line">    test[<span class="number">3</span>] = DFS_D4(input_data)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">if</span>(testcrypt(test[i], index) == input_data):</span><br><span class="line">            tag.append(i)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">assert</span>(<span class="built_in">len</span>(tag) == <span class="number">1</span>)</span><br><span class="line">        unique_solution = test[tag[<span class="number">0</span>]]</span><br><span class="line">        <span class="keyword">return</span> tag, unique_solution, <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        solutions = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(tag)):</span><br><span class="line">            solutions.append(test[tag[i]])</span><br><span class="line">        <span class="keyword">return</span> tag, solutions, <span class="literal">False</span></span><br><span class="line"><span class="comment">#DFS部分</span></span><br><span class="line">dead_end_count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dfs_decrypt</span>(<span class="params">input_data, depth=<span class="number">0</span>, total_depth=<span class="number">32</span></span>):</span><br><span class="line">    <span class="keyword">global</span> dead_end_count</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> depth == total_depth:</span><br><span class="line">        <span class="keyword">if</span> input_data[:<span class="number">4</span>] == <span class="string">b&#x27;flag&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Correct decryption found: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    index_to_check = total_depth - depth - <span class="number">1</span></span><br><span class="line">    tag, solutions, is_unique = verify(input_data, index_to_check)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> is_unique:</span><br><span class="line">        <span class="keyword">if</span> dfs_decrypt(solutions, depth + <span class="number">1</span>, total_depth):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(solutions) == <span class="number">0</span>:</span><br><span class="line">            dead_end_count += <span class="number">1</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Incremented dead end count to: <span class="subst">&#123;dead_end_count&#125;</span> at depth <span class="subst">&#123;depth&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> decrypted_data <span class="keyword">in</span> solutions:</span><br><span class="line">            <span class="keyword">if</span> dfs_decrypt(decrypted_data, depth + <span class="number">1</span>, total_depth):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">input_data = <span class="string">b&#x27;e&gt;C\xb8\xba\xdb\xf6\x88%\x1b(\xc7\xc0T\xa6J\x907\xbc)A\xaa(\xdb\x9aYc\x9eK\xcf.A&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Encrypted flag: <span class="subst">&#123;input_data&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> dfs_decrypt(input_data):</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Failed to find a solution&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>运行脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Encrypted flag: <span class="string">b&#x27;e&gt;C\xb8\xba\xdb\xf6\x88%\x1b(\xc7\xc0T\xa6J\x907\xbc)A\xaa(\xdb\x9aYc\x9eK\xcf.A&#x27;</span></span><br><span class="line">Testing index:<span class="number">31</span></span><br><span class="line">Testing index:<span class="number">30</span></span><br><span class="line">Testing index:<span class="number">29</span></span><br><span class="line">Testing index:<span class="number">28</span></span><br><span class="line">Incremented dead end count to: <span class="number">1</span> at depth <span class="number">3</span></span><br><span class="line">Testing index:<span class="number">28</span></span><br><span class="line">Testing index:<span class="number">27</span></span><br><span class="line">…</span><br><span class="line">Testing index:<span class="number">4</span></span><br><span class="line">Testing index:<span class="number">3</span></span><br><span class="line">Testing index:<span class="number">2</span></span><br><span class="line">Testing index:<span class="number">1</span></span><br><span class="line">Incremented dead end count to: <span class="number">103</span> at depth <span class="number">30</span></span><br><span class="line">Testing index:<span class="number">1</span></span><br><span class="line">Testing index:<span class="number">0</span></span><br><span class="line">Incremented dead end count to: <span class="number">104</span> at depth <span class="number">31</span></span><br><span class="line">Testing index:<span class="number">0</span></span><br><span class="line">Correct decryption found: <span class="built_in">bytearray</span>(<span class="string">b&#x27;flag&#123;Ea5y_enCrypt_And_decrYpt!!&#125;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>flag{Ea5y_enCrypt_And_decrYpt!!}</strong></font>.</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/02/17/hgame_25/"
      title="HGAME 2025 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        HGAME 2025 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/02/09/vn_25/"
      title="VNCTF 2025 WriteUp"
     >

    <p class="title-text">
      
        VNCTF 2025 WriteUp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2026 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
