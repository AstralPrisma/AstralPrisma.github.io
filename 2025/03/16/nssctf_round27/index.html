<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>NSSCTF Round#27 Basic Reverse个人赛 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="比赛开始后十几分钟还没上题，差点以为比赛取消了前两题纯签到，后面两题有点意思，不过难度也是签到级别的 easyre：发现main函数反编译不出来，在前面有一大坨花指令： 123456789101112131415161718192021222324252627282930313233343536373839404142.text:00411DA8                 xor     e">
<meta property="og:type" content="article">
<meta property="og:title" content="NSSCTF Round#27 Basic Reverse个人赛 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2025/03/16/nssctf_round27/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="比赛开始后十几分钟还没上题，差点以为比赛取消了前两题纯签到，后面两题有点意思，不过难度也是签到级别的 easyre：发现main函数反编译不出来，在前面有一大坨花指令： 123456789101112131415161718192021222324252627282930313233343536373839404142.text:00411DA8                 xor     e">
<meta property="og:locale">
<meta property="article:published_time" content="2025-03-16T09:00:00.000Z">
<meta property="article:modified_time" content="2025-03-25T13:11:15.794Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">12</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-nssctf_round27" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        NSSCTF Round#27 Basic Reverse个人赛 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-03-16T09:00:00.000Z" itemprop="datePublished">2025-03-16</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            2k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><del>比赛开始后十几分钟还没上题，差点以为比赛取消了</del><br><br>前两题纯签到，后面两题有点意思，不过难度也是签到级别的</p>
<h2 id="easyre："><a href="#easyre：" class="headerlink" title="easyre："></a>easyre：</h2><p>发现main函数反编译不出来，在前面有一大坨花指令：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00411DA8                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00411<span class="keyword">DAA</span>                 <span class="keyword">jz</span>      short loc_411DAF</span><br><span class="line"><span class="symbol">.text:</span>00411<span class="keyword">DAA</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DAC                 <span class="built_in">db</span>  <span class="number">11h</span></span><br><span class="line"><span class="symbol">.text:</span>00411DAD                 <span class="built_in">db</span>  <span class="number">22h</span> <span class="comment">; &quot;</span></span><br><span class="line"><span class="symbol">.text:</span>00411DAE                 <span class="built_in">db</span>  <span class="number">33h</span> <span class="comment">; 3</span></span><br><span class="line"><span class="symbol">.text:</span>00411DAF <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DAF</span><br><span class="line"><span class="symbol">.text:</span>00411DAF loc_411DAF:                             <span class="comment">; CODE XREF: .text:00411DAA↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DAF                 <span class="keyword">jz</span>      short loc_411DB9</span><br><span class="line"><span class="symbol">.text:</span>00411DB1                 <span class="keyword">jnz</span>     short loc_411DB9</span><br><span class="line"><span class="symbol">.text:</span>00411DB1 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB3                 <span class="built_in">db</span> <span class="number">0E8h</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB4 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB4</span><br><span class="line"><span class="symbol">.text:</span>00411DB4 loc_411DB4:                             <span class="comment">; CODE XREF: .text:loc_411DBE↓j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB4                                         <span class="comment">; .text:00411DC0↓j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB4                 <span class="keyword">jz</span>      short loc_411DC3</span><br><span class="line"><span class="symbol">.text:</span>00411DB6                 <span class="keyword">jnz</span>     short loc_411DC3</span><br><span class="line"><span class="symbol">.text:</span>00411DB6 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB8                 <span class="built_in">db</span> <span class="number">0E8h</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB9 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB9</span><br><span class="line"><span class="symbol">.text:</span>00411DB9 loc_411DB9:                             <span class="comment">; CODE XREF: .text:loc_411DAF↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB9                                         <span class="comment">; .text:00411DB1↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DB9                 <span class="keyword">jz</span>      short loc_411DBE</span><br><span class="line"><span class="symbol">.text:</span>00411DBB                 <span class="keyword">jnz</span>     short loc_411DBE</span><br><span class="line"><span class="symbol">.text:</span>00411DBB <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DBD                 <span class="built_in">db</span> <span class="number">0E9h</span></span><br><span class="line"><span class="symbol">.text:</span>00411DBE <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DBE</span><br><span class="line"><span class="symbol">.text:</span>00411DBE loc_411DBE:                             <span class="comment">; CODE XREF: .text:loc_411DB9↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DBE                                         <span class="comment">; .text:00411DBB↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DBE                 <span class="keyword">jz</span>      short loc_411DB4</span><br><span class="line"><span class="symbol">.text:</span>00411DC0                 <span class="keyword">jnz</span>     short loc_411DB4</span><br><span class="line"><span class="symbol">.text:</span>00411DC0 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DC2                 <span class="built_in">db</span> <span class="number">0E9h</span></span><br><span class="line"><span class="symbol">.text:</span>00411DC3 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00411DC3</span><br><span class="line"><span class="symbol">.text:</span>00411DC3 loc_411DC3:                             <span class="comment">; CODE XREF: .text:loc_411DB4↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DC3                                         <span class="comment">; .text:00411DB6↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00411DC3                 <span class="keyword">push</span>    <span class="number">100h</span></span><br></pre></td></tr></table></figure>
<p>全部nop掉，反编译得到main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_411D80</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v0; <span class="comment">// eax</span></span><br><span class="line">  __int64 v2; <span class="comment">// [esp-8h] [ebp-970h]</span></span><br><span class="line">  <span class="type">char</span> v3; <span class="comment">// [esp+0h] [ebp-968h]</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+0h] [ebp-968h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+310h] [ebp-658h]</span></span><br><span class="line">  <span class="type">size_t</span> v6; <span class="comment">// [esp+31Ch] [ebp-64Ch]</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">520</span>]; <span class="comment">// [esp+328h] [ebp-640h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">520</span>]; <span class="comment">// [esp+530h] [ebp-438h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">264</span>]; <span class="comment">// [esp+738h] [ebp-230h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v10[<span class="number">32</span>]; <span class="comment">// [esp+840h] [ebp-128h]</span></span><br><span class="line">  <span class="type">char</span> v11[<span class="number">260</span>]; <span class="comment">// [esp+860h] [ebp-108h] BYREF</span></span><br><span class="line">  <span class="type">int</span> savedregs; <span class="comment">// [esp+968h] [ebp+0h] BYREF</span></span><br><span class="line"></span><br><span class="line">  j_memset(v11, <span class="number">0</span>, <span class="number">0x100u</span>);</span><br><span class="line">  v10[<span class="number">0</span>] = <span class="number">65</span>;</span><br><span class="line">  v10[<span class="number">1</span>] = <span class="number">-15</span>;</span><br><span class="line">  v10[<span class="number">2</span>] = <span class="number">-53</span>;</span><br><span class="line">  v10[<span class="number">3</span>] = <span class="number">125</span>;</span><br><span class="line">  v10[<span class="number">4</span>] = <span class="number">8</span>;</span><br><span class="line">  v10[<span class="number">5</span>] = <span class="number">8</span>;</span><br><span class="line">  v10[<span class="number">6</span>] = <span class="number">92</span>;</span><br><span class="line">  v10[<span class="number">7</span>] = <span class="number">105</span>;</span><br><span class="line">  v10[<span class="number">8</span>] = <span class="number">-23</span>;</span><br><span class="line">  v10[<span class="number">9</span>] = <span class="number">-7</span>;</span><br><span class="line">  v10[<span class="number">10</span>] = <span class="number">53</span>;</span><br><span class="line">  v10[<span class="number">11</span>] = <span class="number">88</span>;</span><br><span class="line">  v10[<span class="number">12</span>] = <span class="number">89</span>;</span><br><span class="line">  v10[<span class="number">13</span>] = <span class="number">104</span>;</span><br><span class="line">  v10[<span class="number">14</span>] = <span class="number">-62</span>;</span><br><span class="line">  v10[<span class="number">15</span>] = <span class="number">18</span>;</span><br><span class="line">  v10[<span class="number">16</span>] = <span class="number">-63</span>;</span><br><span class="line">  v10[<span class="number">17</span>] = <span class="number">-39</span>;</span><br><span class="line">  v10[<span class="number">18</span>] = <span class="number">-69</span>;</span><br><span class="line">  v10[<span class="number">19</span>] = <span class="number">47</span>;</span><br><span class="line">  v10[<span class="number">20</span>] = <span class="number">109</span>;</span><br><span class="line">  v10[<span class="number">21</span>] = <span class="number">17</span>;</span><br><span class="line">  v10[<span class="number">22</span>] = <span class="number">-124</span>;</span><br><span class="line">  v10[<span class="number">23</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v9, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>);</span><br><span class="line">  j_memset(&amp;v9[<span class="number">65</span>], <span class="number">0</span>, <span class="number">0xBFu</span>);</span><br><span class="line">  j_memset(Str, <span class="number">0</span>, <span class="number">0x200u</span>);</span><br><span class="line">  j_memset(v7, <span class="number">0</span>, <span class="number">0x200u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;please give me your flag:\n&quot;</span>, v3);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%24s&quot;</span>, (<span class="type">char</span>)Str);</span><br><span class="line">  v6 = j_strlen(Str);</span><br><span class="line">  v0 = j_strlen(v9);</span><br><span class="line">  RC4_1((<span class="type">int</span>)v11, (<span class="type">int</span>)v9, v0);</span><br><span class="line">  RC4_2((<span class="type">int</span>)v11, (<span class="type">int</span>)v7, v6);</span><br><span class="line">  j_xor((<span class="type">int</span>)Str, (<span class="type">int</span>)v7, v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">24</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[i] != v10[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;you are wrong\n&quot;</span>, v4);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;right\n&quot;</span>, v4);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  v2 = sub_41125D();</span><br><span class="line">  sub_4111F9(&amp;savedregs, &amp;dword_41202C);</span><br><span class="line">  <span class="keyword">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现有一个base64表，一个RC4和一个异或，密文为<font color=lime><strong>[0x41, 0xf1, 0xcb, 0x7d, 0x08, 0x08, 0x5c, 0x69, 0xe9, 0xf9, 0x35, 0x58, 0x59, 0x68, 0xc2, 0x12, 0xc1, 0xd9, 0xbb, 0x2f, 0x6d, 0x11, 0x84, 0x00]</strong></font>，由于全是对称加密，动态调试直接patch带入密文，得到flag：<font color=deepskyblue><strong>NSSCTF{This_1S_rc4_3ASY}</strong></font>.</p>
<h2 id="EzCpp："><a href="#EzCpp：" class="headerlink" title="EzCpp："></a>EzCpp：</h2><p>查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// rax</span></span><br><span class="line">  __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  __int64 v11; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">44</span>]; <span class="comment">// [rsp+28h] [rbp+8h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// [rsp+54h] [rbp+34h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v13;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">30</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_14002B0F2, argv, envp);</span><br><span class="line">  v5 = <span class="built_in">std</span>::<span class="built_in">cout</span>(<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)<span class="string">&quot;Do you Know CPP&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v5, sub_140011046);</span><br><span class="line">  v6 = <span class="built_in">std</span>::<span class="built_in">cout</span>(<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)<span class="string">&quot;Length Is 23&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v6, sub_140011046);</span><br><span class="line">  v7 = <span class="built_in">std</span>::<span class="built_in">cout</span>(<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)<span class="string">&quot;Place Input Flag&quot;</span>);</span><br><span class="line">  v8 = <span class="built_in">std</span>::<span class="built_in">cout</span>(v7, (__int64)<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v8, sub_140011046);</span><br><span class="line">  <span class="built_in">std</span>::istream::getline(<span class="built_in">std</span>::<span class="built_in">cin</span>, Str, <span class="number">24</span>i64);</span><br><span class="line">  v15 = j_strlen(Str);</span><br><span class="line">  <span class="keyword">if</span> ( v15 != <span class="number">23</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = <span class="built_in">std</span>::<span class="built_in">cout</span>(<span class="built_in">std</span>::<span class="built_in">cerr</span>, (__int64)<span class="string">&quot;Length Is Error&quot;</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v9, sub_140011046);</span><br><span class="line">    v10 = <span class="built_in">std</span>::ostream::operator&lt;&lt;(<span class="built_in">std</span>::<span class="built_in">cout</span>, v15);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v10, sub_140011046);</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)sub_14001159B((__int64)Str) )</span><br><span class="line">    v11 = <span class="built_in">std</span>::<span class="built_in">cout</span>(<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)<span class="string">&quot;WOW! You konw cpp , verry good! , flag is right&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v11 = <span class="built_in">std</span>::<span class="built_in">cout</span>(<span class="built_in">std</span>::<span class="built_in">cout</span>, (__int64)<span class="string">&quot;Oh no! , You should study cpp , flag is wrong&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::operator&lt;&lt;(v11, sub_140011046);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得知flag长度为23，查看关键函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_140016980</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rdi</span></span><br><span class="line">  __int64 i; <span class="comment">// rcx</span></span><br><span class="line">  <span class="type">unsigned</span> __int128 v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [rsp+20h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">60</span>]; <span class="comment">// [rsp+28h] [rbp+8h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  __int64 v11; <span class="comment">// [rsp+88h] [rbp+68h]</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">32</span>]; <span class="comment">// [rsp+A4h] [rbp+84h] BYREF</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+C4h] [rbp+A4h]</span></span><br><span class="line">  <span class="type">char</span> v14[<span class="number">60</span>]; <span class="comment">// [rsp+E8h] [rbp+C8h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v15; <span class="comment">// [rsp+124h] [rbp+104h]</span></span><br><span class="line">  __int64 v16; <span class="comment">// [rsp+208h] [rbp+1E8h]</span></span><br><span class="line">  <span class="type">void</span> *v17; <span class="comment">// [rsp+228h] [rbp+208h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v18; <span class="comment">// [rsp+244h] [rbp+224h]</span></span><br><span class="line">  <span class="type">int</span> v19; <span class="comment">// [rsp+254h] [rbp+234h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v20; <span class="comment">// [rsp+258h] [rbp+238h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v21; <span class="comment">// [rsp+260h] [rbp+240h]</span></span><br><span class="line"></span><br><span class="line">  v3 = &amp;v8;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">102</span>i64; i; --i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_DWORD *)v3 = <span class="number">0xCCCCCCCC</span>;</span><br><span class="line">    v3 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  j___CheckForDebuggerJustMyCode(&amp;unk_14002B0F2, a2, a3);</span><br><span class="line">  sub_140011609(v9);</span><br><span class="line">  v10 = j_strlen(a1); <span class="comment">//23</span></span><br><span class="line">  v20 = v10;</span><br><span class="line">  v5 = (<span class="type">unsigned</span> __int64)v10 * (<span class="type">unsigned</span> __int128)<span class="number">4u</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( !is_mul_ok(v10, <span class="number">4u</span>i64) )</span><br><span class="line">    *(_QWORD *)&amp;v5 = <span class="number">-1</span>i64;</span><br><span class="line">  v16 = sub_1400112A3(v5, *((_QWORD *)&amp;v5 + <span class="number">1</span>));</span><br><span class="line">  v11 = v16;</span><br><span class="line">  qmemcpy(v12, <span class="string">&quot;harker&quot;</span>, <span class="number">6</span>); <span class="comment">//密钥？</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v10; ++j ) <span class="comment">//循环23次</span></span><br><span class="line">  &#123;</span><br><span class="line">    v19 = a1[j]; <span class="comment">//输入值中第j个索引的字符</span></span><br><span class="line">    v20 = j; <span class="comment">//索引</span></span><br><span class="line">    v21 = sub_1400110AF(v12); <span class="comment">//length(6)</span></span><br><span class="line">    *(_DWORD *)(v11 + <span class="number">4</span>i64 * j) = v12[v20 % v21] ^ v19; <span class="comment">//密文=harker与输入值循环异或</span></span><br><span class="line">    sub_140011221(v9, *(<span class="type">unsigned</span> __int8 *)(v11 + <span class="number">4</span>i64 * j));</span><br><span class="line">  &#125;</span><br><span class="line">  sub_140011591(v14, v9);</span><br><span class="line">  v6 = sub_14001109B(v14); <span class="comment">//结果base64编码</span></span><br><span class="line">  v15 = sub_140011212(v6); <span class="comment">//这个函数中藏了密文“Dg0TDB4xGBEtWlAtPlIAGRwtW1VHEhg=”</span></span><br><span class="line">  v17 = (<span class="type">void</span> *)v11;</span><br><span class="line">  operator delete[]((<span class="type">void</span> *)v11);</span><br><span class="line">  <span class="keyword">if</span> ( v17 )</span><br><span class="line">  &#123;</span><br><span class="line">    v11 = <span class="number">33059</span>i64;</span><br><span class="line">    v20 = <span class="number">33059</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v20 = <span class="number">0</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v18 = v15;</span><br><span class="line">  sub_14001113B(v14);</span><br><span class="line">  sub_14001113B(v9);</span><br><span class="line">  <span class="keyword">return</span> v18;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是先和<code>harker</code>循环异或然后base64编码并和密文比较，解密得到<font color=deepskyblue><strong>flag{Cpp_15_V3rry_345y}</strong></font>，把flag换成NSSCTF就能提交了.</p>
<h2 id="EzProcessStruct："><a href="#EzProcessStruct：" class="headerlink" title="EzProcessStruct："></a>EzProcessStruct：</h2><p>查看关键函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __stdcall <span class="title function_">sub_401000</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v2; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">wchar_t</span> *v6; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">wchar_t</span> *v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// esi</span></span><br><span class="line">  PEPROCESS v9; <span class="comment">// edi</span></span><br><span class="line">  <span class="type">char</span> v10; <span class="comment">// dl</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *v12; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">wchar_t</span> *v14; <span class="comment">// [esp-Ch] [ebp-27Ch]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">wchar_t</span> *v15; <span class="comment">// [esp-8h] [ebp-278h]</span></span><br><span class="line">  <span class="type">size_t</span> v16; <span class="comment">// [esp-4h] [ebp-274h]</span></span><br><span class="line">  PEPROCESS Process; <span class="comment">// [esp+10h] [ebp-260h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18; <span class="comment">// [esp+17h] [ebp-259h]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">KAPC_STATE</span> <span class="title">ApcState</span>;</span> <span class="comment">// [esp+18h] [ebp-258h] BYREF</span></span><br><span class="line">  <span class="type">wchar_t</span> Dest[<span class="number">256</span>]; <span class="comment">// [esp+30h] [ebp-240h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v21[<span class="number">9</span>]; <span class="comment">// [esp+230h] [ebp-40h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v22[<span class="number">16</span>]; <span class="comment">// [esp+254h] [ebp-1Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v23[<span class="number">8</span>]; <span class="comment">// [esp+264h] [ebp-Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  v2 = <span class="number">0</span>;</span><br><span class="line">  Process = <span class="number">0</span>;</span><br><span class="line">  PsLookupProcessByProcessId((HANDLE)<span class="number">0xE6C</span>, &amp;Process);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;ApcState, <span class="number">0</span>, <span class="keyword">sizeof</span>(ApcState));</span><br><span class="line">  KeStackAttachProcess(Process, &amp;ApcState);</span><br><span class="line">  qmemcpy(v21, <span class="string">&quot;SkISV6U@b5Q1_6cwejUqc4Iaf5Q~ejQtNTA&gt;&quot;</span>, <span class="keyword">sizeof</span>(v21));</span><br><span class="line">  v3 = *((_DWORD *)Process + <span class="number">106</span>);</span><br><span class="line">  v4 = *(_DWORD *)(v3 + <span class="number">16</span>);</span><br><span class="line">  DbgPrint(<span class="string">&quot;%d.%d.%d&quot;</span>, *(_DWORD *)(v3 + <span class="number">164</span>), *(_DWORD *)(v3 + <span class="number">168</span>), *(<span class="type">unsigned</span> __int16 *)(v3 + <span class="number">172</span>));</span><br><span class="line">  v5 = v4 + <span class="number">64</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v5 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(Dest, <span class="number">0</span>, <span class="keyword">sizeof</span>(Dest));</span><br><span class="line">    v6 = wcsrchr(*(<span class="type">const</span> <span class="type">wchar_t</span> **)(v5 + <span class="number">4</span>), <span class="number">0x5Cu</span>);</span><br><span class="line">    v7 = wcsrchr(*(<span class="type">const</span> <span class="type">wchar_t</span> **)(v5 + <span class="number">4</span>), <span class="number">0x2Eu</span>);</span><br><span class="line">    v18 = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(v22, <span class="string">&quot;you found flag!&quot;</span>);</span><br><span class="line">    v8 = v7 - v6 - <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(v23, <span class="string">&quot;wrong&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( v6 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v7 &amp;&amp; v6 &lt; v7 )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = v7 - v6 - <span class="number">1</span>;</span><br><span class="line">        v15 = v6 + <span class="number">1</span>;</span><br><span class="line">        v14 = Dest;</span><br><span class="line">        _mm_lfence();</span><br><span class="line">        wcsncpy(v14, v15, v16);</span><br><span class="line">        <span class="keyword">if</span> ( <span class="number">2</span> * v8 &gt;= <span class="number">0x200</span> )</span><br><span class="line">          sub_401268();</span><br><span class="line">        Dest[v8] = <span class="number">0</span>;</span><br><span class="line">        DbgPrint(<span class="string">&quot;%ws\n&quot;</span>, Dest);</span><br><span class="line">        <span class="keyword">if</span> ( !v8 )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_12;</span><br><span class="line">        v9 = Process;</span><br><span class="line">        v10 = v18;</span><br><span class="line">        <span class="keyword">do</span></span><br><span class="line">        &#123;</span><br><span class="line">          v11 = (<span class="type">unsigned</span> __int16)(Dest[v2] ^ *(_WORD *)(*((_DWORD *)v9 + <span class="number">106</span>) + <span class="number">164</span>) ^ *(_WORD *)(*((_DWORD *)v9 + <span class="number">106</span>) + <span class="number">168</span>));</span><br><span class="line">          Dest[v2] = v11;</span><br><span class="line">          <span class="keyword">if</span> ( v10 )</span><br><span class="line">            v10 = v11 != *((<span class="type">char</span> *)v21 + v2) ? <span class="number">0</span> : v10;</span><br><span class="line">          ++v2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> ( v2 &lt; v8 );</span><br><span class="line">        v12 = v23;</span><br><span class="line">        <span class="keyword">if</span> ( v10 )</span><br><span class="line">LABEL_12:</span><br><span class="line">          v12 = v22;</span><br><span class="line">        DbgPrint(<span class="string">&quot;%s\n&quot;</span>, v12);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  KeUnstackDetachProcess(&amp;ApcState);</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">52</span>) = sub_401230;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现了密文<code>SkISV6U@b5Q1_6cwejUqc4Iaf5Q~ejQtNTA&gt;</code>和可能的加密方式（两个异或？），其中上方的<code>DbgPrint</code>输出的是某个系统内容的版本号，结合题目描述中提到的操作系统是<code>win7</code>，异或<code>0x7</code>后得到<code>TlNTQ1RGe2V6X1dpbmRvd3Nfa2VybmVsISF9</code>，base64解码得到flag：<font color=deepskyblue><strong>NSSCTF{ez_Windows_kernel!!}</strong></font>.</p>
<h2 id="ezminiprograme："><a href="#ezminiprograme：" class="headerlink" title="ezminiprograme："></a>ezminiprograme：</h2><p>发现是一个微信小程序，先查看wxml文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.wxml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">navigation-bar</span> <span class="attr">title</span>=<span class="string">&quot;Weixin&quot;</span> <span class="attr">back</span>=<span class="string">&quot;&#123;&#123;false&#125;&#125;&quot;</span> <span class="attr">color</span>=<span class="string">&quot;black&quot;</span> <span class="attr">background</span>=<span class="string">&quot;#FFF&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">navigation-bar</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scroll-view</span> <span class="attr">class</span>=<span class="string">&quot;scrollarea&quot;</span> <span class="attr">scroll-y</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scroll-with-animation</span>=<span class="string">&quot;true&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height: 100vh;&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">view</span> <span class="attr">animation</span>=<span class="string">&quot;&#123;&#123;animationData&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input-container&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">input</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;cool-input&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">placeholder</span>=<span class="string">&quot;请输入内容...&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">bindinput</span>=<span class="string">&quot;onInputChange&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">value</span>=<span class="string">&quot;&#123;&#123;inputValue&#125;&#125;&quot;</span></span></span><br><span class="line"><span class="tag">      /&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">icon</span> <span class="attr">type</span>=<span class="string">&quot;search&quot;</span> <span class="attr">class</span>=<span class="string">&quot;input-icon&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">icon</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">animation</span>=<span class="string">&quot;&#123;&#123;animationData&#125;&#125;&quot;</span> <span class="attr">class</span>=<span class="string">&quot;check-button&quot;</span> <span class="attr">bindtap</span>=<span class="string">&quot;onCheck&quot;</span> <span class="attr">style</span>=<span class="string">&quot;position: relative; left: -1rpx; top: -981rpx&quot;</span>&gt;</span>Check<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scroll-view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>得到关键函数<code>onCheck</code>，用<code>wxappUnpacker</code>解包<code>__APP__.wxapkg</code>，在其中的<code>app-service.js</code>找到关键函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&quot;use strict&quot;</span>;<span class="title class_">Page</span>(&#123;<span class="attr">data</span>:&#123;<span class="attr">inputValue</span>:<span class="string">&quot;&quot;</span>,<span class="attr">animationData</span>:&#123;&#125;&#125;,<span class="attr">onLoad</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> t=wx.<span class="title function_">createAnimation</span>(&#123;<span class="attr">duration</span>:<span class="number">1e3</span>,<span class="attr">timingFunction</span>:<span class="string">&quot;ease&quot;</span>&#125;);t.<span class="title function_">opacity</span>(<span class="number">1</span>).<span class="title function_">translateY</span>(<span class="number">0</span>).<span class="title function_">step</span>(),<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;<span class="attr">animationData</span>:t.<span class="title function_">export</span>()&#125;)&#125;,<span class="attr">onInputChange</span>:<span class="keyword">function</span>(<span class="params">t</span>)&#123;<span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;<span class="attr">inputValue</span>:t.<span class="property">detail</span>.<span class="property">value</span>&#125;)&#125;,<span class="attr">generateSbox</span>:<span class="keyword">function</span>(<span class="params">t</span>)&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=[],n=t.<span class="property">length</span>,e=[],o=<span class="number">0</span>;o&lt;<span class="number">256</span>;o++)a.<span class="title function_">push</span>(o),e.<span class="title function_">push</span>(t.<span class="title function_">charCodeAt</span>(o%n));<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>,r=<span class="number">0</span>;r&lt;<span class="number">256</span>;r++)&#123;<span class="keyword">var</span> s,u;s=[a[i=(i+a[r]+e[r])%<span class="number">256</span>],a[r]],a[r]=s[<span class="number">0</span>],a[i]=s[<span class="number">1</span>],u=[a[(i+<span class="number">1</span>)%<span class="number">256</span>],a[(r+<span class="number">1</span>)%<span class="number">256</span>]],a[(r+<span class="number">1</span>)%<span class="number">256</span>]=u[<span class="number">0</span>],a[(i+<span class="number">1</span>)%<span class="number">256</span>]=u[<span class="number">1</span>]&#125;<span class="keyword">return</span> a&#125;,<span class="attr">onCheck</span>:<span class="keyword">function</span>(<span class="params"></span>)&#123;<span class="keyword">var</span> t=<span class="variable language_">this</span>.<span class="property">data</span>.<span class="property">inputValue</span>;<span class="keyword">if</span>(<span class="string">&quot;&quot;</span>!==t.<span class="title function_">trim</span>())&#123;<span class="keyword">for</span>(<span class="keyword">var</span> a=t.<span class="title function_">split</span>(<span class="string">&quot;&quot;</span>),n=<span class="variable language_">this</span>.<span class="title function_">generateSbox</span>(<span class="string">&quot;NSSCTF2025&quot;</span>),e=<span class="number">0</span>,o=<span class="number">0</span>,i=<span class="number">0</span>;i&lt;a.<span class="property">length</span>;i++)&#123;<span class="keyword">var</span> r=[n[e=(e+n[o=(o+n[i%<span class="number">256</span>])%<span class="number">256</span>])%<span class="number">256</span>],n[o]];n[o]=r[<span class="number">0</span>],n[e]=r[<span class="number">1</span>];<span class="keyword">var</span> s=n[(n[o]+n[e])%<span class="number">256</span>];a[i]=<span class="title class_">String</span>.<span class="title function_">fromCharCode</span>(a[i].<span class="title function_">charCodeAt</span>(<span class="number">0</span>)^s)&#125;<span class="keyword">var</span> u=a.<span class="title function_">map</span>((<span class="keyword">function</span>(<span class="params">t</span>)&#123;<span class="keyword">return</span> t.<span class="title function_">charCodeAt</span>(<span class="number">0</span>)&#125;));<span class="variable language_">console</span>.<span class="title function_">log</span>(u);<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(u)===<span class="title class_">JSON</span>.<span class="title function_">stringify</span>([<span class="number">216</span>,<span class="number">156</span>,<span class="number">159</span>,<span class="number">86</span>,<span class="number">8</span>,<span class="number">143</span>,<span class="number">254</span>,<span class="number">92</span>,<span class="number">113</span>,<span class="number">3</span>,<span class="number">228</span>,<span class="number">74</span>,<span class="number">37</span>,<span class="number">80</span>,<span class="number">146</span>,<span class="number">68</span>,<span class="number">71</span>,<span class="number">42</span>,<span class="number">137</span>,<span class="number">132</span>,<span class="number">170</span>,<span class="number">85</span>,<span class="number">13</span>,<span class="number">196</span>,<span class="number">226</span>,<span class="number">152</span>,<span class="number">120</span>,<span class="number">176</span>,<span class="number">184</span>,<span class="number">36</span>,<span class="number">195</span>,<span class="number">233</span>,<span class="number">123</span>,<span class="number">230</span>,<span class="number">89</span>,<span class="number">10</span>,<span class="number">121</span>,<span class="number">180</span>,<span class="number">5</span>,<span class="number">219</span>])?wx.<span class="title function_">showToast</span>(&#123;<span class="attr">title</span>:<span class="string">&quot;太强了！&quot;</span>,<span class="attr">icon</span>:<span class="string">&quot;success&quot;</span>,<span class="attr">duration</span>:<span class="number">2e3</span>&#125;):wx.<span class="title function_">showToast</span>(&#123;<span class="attr">title</span>:<span class="string">&quot;再试试喔&quot;</span>,<span class="attr">icon</span>:<span class="string">&quot;error&quot;</span>,<span class="attr">duration</span>:<span class="number">2e3</span>&#125;)&#125;<span class="keyword">else</span> wx.<span class="title function_">showToast</span>(&#123;<span class="attr">title</span>:<span class="string">&quot;请输入内容&quot;</span>,<span class="attr">icon</span>:<span class="string">&quot;none&quot;</span>,<span class="attr">duration</span>:<span class="number">2e3</span>&#125;)&#125;&#125;);</span><br></pre></td></tr></table></figure>
<p><del>（没错，反编译出来就是这样一坨，真的很难受）</del><br><br>发现了密钥<font color=red><strong>NSSCTF2025</strong></font>和密文，还原加密逻辑：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">generate_sbox</span>(<span class="params">key</span>):</span><br><span class="line">    key = [<span class="built_in">ord</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> key]</span><br><span class="line">    key_len = <span class="built_in">len</span>(key)</span><br><span class="line">    sbox = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    e = [key[i % key_len] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        i = (i + sbox[r] + e[r]) % <span class="number">256</span></span><br><span class="line">        sbox[r], sbox[i] = sbox[i], sbox[r]</span><br><span class="line">        next_r = (r + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        next_i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        sbox[next_r], sbox[next_i] = sbox[next_i], sbox[next_r]</span><br><span class="line">    <span class="keyword">return</span> sbox</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">RC4</span>(<span class="params">ciphertext, sbox</span>):</span><br><span class="line">    n = sbox.copy()</span><br><span class="line">    e = <span class="number">0</span></span><br><span class="line">    o = <span class="number">0</span></span><br><span class="line">    plaintext = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ciphertext)):</span><br><span class="line">        o = (o + n[i % <span class="number">256</span>]) % <span class="number">256</span></span><br><span class="line">        e = (e + n[o]) % <span class="number">256</span></span><br><span class="line">        n[o], n[e] = n[e], n[o]</span><br><span class="line">        s = n[(n[o] + n[e]) % <span class="number">256</span>]</span><br><span class="line">        plain_byte = ciphertext[i] ^ s</span><br><span class="line">        plaintext.append(plain_byte)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(plaintext)</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="built_in">bytes</span>.fromhex(<span class="string">&quot;d89c9f56088ffe5c7103e44a25509244472a8984aa550dc4e29878b0b824c3e97be6590a79b405db&quot;</span>)</span><br><span class="line">sbox = generate_sbox(<span class="string">&quot;NSSCTF2025&quot;</span>)</span><br><span class="line">flag = RC4(ciphertext, sbox)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>NSSCTF{c6e67111c1aadd1bdc4dad6d99c254e7}</strong></font>.</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/03/25/nctf_24/"
      title="NCTF 2024 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        NCTF 2024 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/03/11/npcctf_25/"
      title="NPC²CTF 2025 WriteUp"
     >

    <p class="title-text">
      
        NPC²CTF 2025 WriteUp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
