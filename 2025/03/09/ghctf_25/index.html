<!DOCTYPE html>


<html theme="dark" showBanner="true" hasBanner="true" > 
<link href="/fontawesome/css/fontawesome.css" rel="stylesheet">
<link href="/fontawesome/css/brands.css" rel="stylesheet">
<link href="/fontawesome/css/solid.css" rel="stylesheet">
<script src="/js/color.global.min.js" ></script>
<script src="/js/load-settings.js" ></script>
<head>
  <meta charset="utf-8">
  
  
  

  
  <title>GHCTF 2025 WriteUp | 棱晶の小窝</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="preload" href="/css/fonts/Roboto-Regular.ttf" as="font" type="font/ttf" crossorigin="anonymous">
  <link rel="preload" href="/css/fonts/Roboto-Bold.ttf" as="font" type="font/ttf" crossorigin="anonymous">

  <meta name="description" content="这比赛3.2就开始了，我们当时没有听说，3.6才知道的，不过最后还是取得了不错的成绩.在这里仅给出我个人解出的题目的WriteUp. Reverse方向：ASM?Signin!：编写解密脚本： 123456789101112131415161718192021222324252627282930313233343536373839404142data1 &#x3D; [    0x26, 0x27, 0x2">
<meta property="og:type" content="article">
<meta property="og:title" content="GHCTF 2025 WriteUp">
<meta property="og:url" content="https://astralprisma.github.io/2025/03/09/ghctf_25/index.html">
<meta property="og:site_name" content="棱晶の小窝">
<meta property="og:description" content="这比赛3.2就开始了，我们当时没有听说，3.6才知道的，不过最后还是取得了不错的成绩.在这里仅给出我个人解出的题目的WriteUp. Reverse方向：ASM?Signin!：编写解密脚本： 123456789101112131415161718192021222324252627282930313233343536373839404142data1 &#x3D; [    0x26, 0x27, 0x2">
<meta property="og:locale">
<meta property="article:published_time" content="2025-03-08T16:00:00.000Z">
<meta property="article:modified_time" content="2025-04-20T19:14:47.171Z">
<meta property="article:author" content="Astral Prisma">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/XH.png">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  
  
    
<div id="banner" class="">
  <img src="/OTSA.png" itemprop="image">
  <div id="banner-dim"></div>
</div>
 
   
  <div id="main-grid" class="shadow   ">
    <div id="nav" class=""  >
      <navbar id="navbar">
  <nav id="title-nav">
    <a href="/">
      <div id="vivia-logo">
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
        <div class="dot"></div>
      </div>
      <div>棱晶の小窝 </div>
    </a>
  </nav>
  <nav id="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
  </nav>
  <nav id="sub-nav">
    <a id="theme-btn" class="nav-icon">
      <span class="light-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M438.5-829.913v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-829.913Zm0 747.826v-48q0-17.452 11.963-29.476 11.964-12.024 29.326-12.024 17.363 0 29.537 12.024t12.174 29.476v48q0 17.452-11.963 29.476-11.964 12.024-29.326 12.024-17.363 0-29.537-12.024T438.5-82.087ZM877.913-438.5h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537t29.476-12.174h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T877.913-438.5Zm-747.826 0h-48q-17.452 0-29.476-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T82.087-521.5h48q17.452 0 29.476 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T130.087-438.5Zm660.174-290.87-34.239 32q-12.913 12.674-29.565 12.174-16.653-.5-29.327-13.174-12.674-12.673-12.554-28.826.12-16.152 12.794-28.826l33-35q12.913-12.674 30.454-12.674t30.163 12.847q12.709 12.846 12.328 30.826-.38 17.98-13.054 30.653ZM262.63-203.978l-32 34q-12.913 12.674-30.454 12.674t-30.163-12.847q-12.709-12.846-12.328-30.826.38-17.98 13.054-30.653l33.239-31q12.913-12.674 29.565-12.174 16.653.5 29.327 13.174 12.674 12.673 12.554 28.826-.12 16.152-12.794 28.826Zm466.74 33.239-32-33.239q-12.674-12.913-12.174-29.565.5-16.653 13.174-29.327 12.673-12.674 28.826-13.054 16.152-.38 28.826 12.294l35 33q12.674 12.913 12.674 30.454t-12.847 30.163q-12.846 12.709-30.826 12.328-17.98-.38-30.653-13.054ZM203.978-697.37l-34-33q-12.674-12.913-13.174-29.945-.5-17.033 12.174-29.707t31.326-13.293q18.653-.62 31.326 13.054l32 34.239q11.674 12.913 11.174 29.565-.5 16.653-13.174 29.327-12.673 12.674-28.826 12.554-16.152-.12-28.826-12.794ZM480-240q-100 0-170-70t-70-170q0-100 70-170t170-70q100 0 170 70t70 170q0 100-70 170t-170 70Zm-.247-82q65.703 0 111.475-46.272Q637-414.544 637-480.247t-45.525-111.228Q545.95-637 480.247-637t-111.475 45.525Q323-545.95 323-480.247t45.525 111.975Q414.05-322 479.753-322ZM481-481Z"/></svg></span>
      <span class="dark-mode-icon"><svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M480.239-116.413q-152.63 0-258.228-105.478Q116.413-327.37 116.413-480q0-130.935 77.739-227.435t206.304-125.043q43.022-9.631 63.87 10.869t3.478 62.805q-8.891 22.043-14.315 44.463-5.424 22.42-5.424 46.689 0 91.694 64.326 155.879 64.325 64.186 156.218 64.186 24.369 0 46.978-4.946 22.609-4.945 44.413-14.076 42.826-17.369 62.967 1.142 20.142 18.511 10.511 61.054Q807.174-280 712.63-198.206q-94.543 81.793-232.391 81.793Zm0-95q79.783 0 143.337-40.217 63.554-40.218 95.793-108.283-15.608 4.044-31.097 5.326-15.49 1.283-31.859.805-123.706-4.066-210.777-90.539-87.071-86.473-91.614-212.092-.24-16.369.923-31.978 1.164-15.609 5.446-30.978-67.826 32.478-108.282 96.152Q211.652-559.543 211.652-480q0 111.929 78.329 190.258 78.329 78.329 190.258 78.329ZM466.13-465.891Z"/></svg></span>
    </a>
    
    <div id="nav-menu-btn" class="nav-icon">
      <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" width="20"><path d="M177.37-252.282q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Zm0-186.218q-17.453 0-29.477-11.963-12.024-11.964-12.024-29.326 0-17.363 12.024-29.537T177.37-521.5h605.26q17.453 0 29.477 11.963 12.024 11.964 12.024 29.326 0 17.363-12.024 29.537T782.63-438.5H177.37Zm0-186.217q-17.453 0-29.477-11.964-12.024-11.963-12.024-29.326t12.024-29.537q12.024-12.174 29.477-12.174h605.26q17.453 0 29.477 11.964 12.024 11.963 12.024 29.326t-12.024 29.537q-12.024 12.174-29.477 12.174H177.37Z"/></svg>
    </div>
  </nav>
</navbar>
<div id="nav-dropdown" class="hidden">
  <div id="dropdown-link-list">
    
      <a class="nav-dropdown-link" href="/">Home</a>
    
      <a class="nav-dropdown-link" href="/archives">Archives</a>
    
      <a class="nav-dropdown-link" href="/about">About</a>
    
     
    </div>
</div>
<script>
  let dropdownBtn = document.getElementById("nav-menu-btn");
  let dropdownEle = document.getElementById("nav-dropdown");
  dropdownBtn.onclick = function() {
    dropdownEle.classList.toggle("hidden");
  }
</script>
    </div>
    <div id="sidebar-wrapper">
      <sidebar id="sidebar">
  
    <div class="widget-wrap">
  <div class="info-card">
    <div class="avatar">
      
        <image src=/AP.png></image>
      
      <div class="img-dim"></div>
    </div>
    <div class="info">
      <div class="username">Astral Prisma </div>
      <div class="dot"></div>
      <div class="subtitle">星界棱晶 </div>
      <div class="link-list">
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://space.bilibili.com/454936579" title="Bilibili"><image src=https://www.bilibili.com/favicon.ico></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://www.primegrid.com/show_user.php?userid=1243718" title="PrimeGrid"><image src=https://www.primegrid.com/images/favicon_32.png></image></a>
        
          <a class="link-btn" target="_blank" rel="noopener" href="https://github.com/AstralPrisma" title="GitHub"><image src=https://github.githubassets.com/favicons/favicon.png></image></a>
         
      </div>  
    </div>
  </div>
</div>

  
  <div class="sticky">
    
      


  <div class="widget-wrap">
    <div class="widget">
      <h3 class="widget-title">Categories</h3>
      <div class="category-box">
            <a class="category-link" href="/categories/WriteUp/">
                WriteUp
                <div class="category-count">14</div>
            </a>
        </div>
    </div>
  </div>


    
      

    
  </div>
</sidebar>
    </div>
    <div id="content-body">
       

<article id="post-ghctf_25" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
    
   
  <div class="article-inner">
    <div class="article-main">
      <header class="article-header">
        
<div class="main-title-bar">
  <div class="main-title-dot"></div>
  
    
      <h1 class="p-name article-title" itemprop="headline name">
        GHCTF 2025 WriteUp
      </h1>
    
  
</div>

        <div class='meta-info-bar'>
          <div class="meta-info">
  <time class="dt-published" datetime="2025-03-08T16:00:00.000Z" itemprop="datePublished">2025-03-09</time>
</div>
          <div class="need-seperator meta-info">
            <div class="meta-cate-flex">
  
  <a class="meta-cate-link" href="/categories/WriteUp/">WriteUp</a>
   
</div>
  
          </div>
          <div class="wordcount need-seperator meta-info">
            9.2k words 
          </div>
        </div>
        
      </header>
      <div class="e-content article-entry" itemprop="articleBody">
        
          <p><em>这比赛3.2就开始了，我们当时没有听说，3.6才知道的，不过最后还是取得了不错的成绩.</em><br><br><em>在这里仅给出我个人解出的题目的WriteUp.</em></p>
<h1 id="Reverse方向："><a href="#Reverse方向：" class="headerlink" title="Reverse方向："></a>Reverse方向：</h1><h2 id="ASM-Signin-："><a href="#ASM-Signin-：" class="headerlink" title="ASM?Signin!："></a>ASM?Signin!：</h2><p>编写解密脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">data1 = [</span><br><span class="line">    <span class="number">0x26</span>, <span class="number">0x27</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x2A</span>, <span class="number">0x2B</span>, <span class="number">0x28</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x2E</span>, <span class="number">0x2F</span>, <span class="number">0x2C</span>, <span class="number">0x2D</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x30</span>, <span class="number">0x00</span>,</span><br><span class="line">    <span class="number">0x36</span>, <span class="number">0x37</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x3A</span>, <span class="number">0x3B</span>, <span class="number">0x38</span>, <span class="number">0x39</span>,</span><br><span class="line">    <span class="number">0x3E</span>, <span class="number">0x3F</span>, <span class="number">0x3C</span>, <span class="number">0x3D</span>, <span class="number">0x3F</span>, <span class="number">0x27</span>, <span class="number">0x34</span>, <span class="number">0x11</span></span><br><span class="line">]</span><br><span class="line">blocks = [data1[i*<span class="number">4</span>:(i+<span class="number">1</span>)*<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    si = i * <span class="number">4</span></span><br><span class="line">    di = si + <span class="number">4</span></span><br><span class="line">    <span class="keyword">if</span> di &gt;= <span class="number">28</span>:</span><br><span class="line">        di -= <span class="number">28</span></span><br><span class="line">    block_si = si // <span class="number">4</span></span><br><span class="line">    block_di = di // <span class="number">4</span></span><br><span class="line">    blocks[block_si], blocks[block_di] = blocks[block_di], blocks[block_si]</span><br><span class="line">processed_data1 = []</span><br><span class="line"><span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">    processed_data1.extend(block)</span><br><span class="line">data2 = [</span><br><span class="line">    <span class="number">0x69</span>, <span class="number">0x77</span>, <span class="number">0x77</span>, <span class="number">0x66</span>, <span class="number">0x73</span>, <span class="number">0x72</span>, <span class="number">0x4F</span>, <span class="number">0x46</span>,</span><br><span class="line">    <span class="number">0x03</span>, <span class="number">0x47</span>, <span class="number">0x6F</span>, <span class="number">0x79</span>, <span class="number">0x07</span>, <span class="number">0x41</span>, <span class="number">0x13</span>, <span class="number">0x47</span>,</span><br><span class="line">    <span class="number">0x5E</span>, <span class="number">0x67</span>, <span class="number">0x5F</span>, <span class="number">0x09</span>, <span class="number">0x0F</span>, <span class="number">0x58</span>, <span class="number">0x63</span>, <span class="number">0x7D</span>,</span><br><span class="line">    <span class="number">0x5F</span>, <span class="number">0x77</span>, <span class="number">0x68</span>, <span class="number">0x35</span>, <span class="number">0x62</span>, <span class="number">0x0D</span>, <span class="number">0x0D</span>, <span class="number">0x50</span></span><br><span class="line">]</span><br><span class="line">data2_blocks = [data2[i*<span class="number">4</span>:(i+<span class="number">1</span>)*<span class="number">4</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">flag = <span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">    block = processed_data1[i*<span class="number">4</span>: i*<span class="number">4</span>+<span class="number">4</span>]</span><br><span class="line">    b1, b2 = block[<span class="number">1</span>], block[<span class="number">2</span>]</span><br><span class="line">    word1 = (b2 &lt;&lt; <span class="number">8</span>) | b1 </span><br><span class="line">    word2 = (block[<span class="number">3</span>] &lt;&lt; <span class="number">8</span>) | b2</span><br><span class="line">    enc_block = data2_blocks[i]</span><br><span class="line">    enc_word1 = enc_block[<span class="number">0</span>] | (enc_block[<span class="number">1</span>] &lt;&lt; <span class="number">8</span>)</span><br><span class="line">    enc_word2 = enc_block[<span class="number">2</span>] | (enc_block[<span class="number">3</span>] &lt;&lt; <span class="number">8</span>)</span><br><span class="line">    dec_word1 = enc_word1 ^ word1</span><br><span class="line">    dec_word2 = enc_word2 ^ word2</span><br><span class="line">    flag.append(dec_word1 &amp; <span class="number">0xFF</span>)</span><br><span class="line">    flag.append((dec_word1 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">    flag.append(dec_word2 &amp; <span class="number">0xFF</span>)</span><br><span class="line">    flag.append((dec_word2 &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>)</span><br><span class="line">flag_str = flag.decode(<span class="string">&#x27;latin-1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag:&quot;</span>, flag_str)</span><br></pre></td></tr></table></figure>
<p>运行脚本得到flag：<font color=deepskyblue><strong>NSSCTF{W0w_y0u’re_g00d_@t_@5M!!}</strong></font>.</p>
<h2 id="FishingKit："><a href="#FishingKit：" class="headerlink" title="FishingKit："></a>FishingKit：</h2><p>查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">memset</span>(v4, <span class="number">0</span>, <span class="number">0x14u</span>i64);</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="number">0x32u</span>i64);</span><br><span class="line">  <span class="built_in">memset</span>(Str1, <span class="number">0</span>, <span class="number">0x32u</span>i64);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Give me the bait:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v4);</span><br><span class="line">  <span class="keyword">if</span> ( check((<span class="type">unsigned</span> __int8 *)v4) ) <span class="comment">//第一个检验</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Yes!This bait is a good one.\n\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Give me the second thing:&quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, v5);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\nFishing...\n\n&quot;</span>);</span><br><span class="line">    Sleep(<span class="number">0x3E8u</span>);</span><br><span class="line">    RC4(v5, (__int64)Str1, v4); <span class="comment">//输入密文并加密</span></span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Str1, &amp;Str2) ) <span class="comment">//比较</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Did the fish take the bait?\n&quot;</span>);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Didn&#x27;t the fish take the bait?\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Oops...This bait is terrible.\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现首先要输入一个满足第一个校验函数的字符串bait，然后才能输入flag并用bait作为密钥将flag加密并和密文str2进行比较输出结果，先查看第一个校验函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">check</span><span class="params">(<span class="type">unsigned</span> __int8 *x)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">202</span> * x[<span class="number">8</span>] + <span class="number">216</span> * x[<span class="number">5</span>] - <span class="number">4</span> * x[<span class="number">4</span>] - <span class="number">330</span> * x[<span class="number">9</span>] - <span class="number">13</span> * x[<span class="number">4</span>] - <span class="number">268</span> * x[<span class="number">6</span>] == <span class="number">-14982</span></span><br><span class="line">      &amp;&amp; <span class="number">325</span> * x[<span class="number">8</span>] + <span class="number">195</span> * *x + <span class="number">229</span> * x[<span class="number">1</span>] - <span class="number">121</span> * x[<span class="number">6</span>] - <span class="number">409</span> * x[<span class="number">6</span>] - (x[<span class="number">1</span>] &lt;&lt; <span class="number">7</span>) == <span class="number">22606</span></span><br><span class="line">      &amp;&amp; <span class="number">489</span> * x[<span class="number">1</span>] + <span class="number">480</span> * x[<span class="number">6</span>] + <span class="number">105</span> * x[<span class="number">2</span>] + <span class="number">367</span> * x[<span class="number">3</span>] - <span class="number">135</span> * x[<span class="number">4</span>] - <span class="number">482</span> * x[<span class="number">9</span>] == <span class="number">63236</span></span><br><span class="line">      &amp;&amp; <span class="number">493</span> * x[<span class="number">1</span>] - <span class="number">80</span> * x[<span class="number">4</span>] - <span class="number">253</span> * x[<span class="number">8</span>] - <span class="number">121</span> * x[<span class="number">2</span>] - <span class="number">177</span> * *x - <span class="number">243</span> * x[<span class="number">9</span>] == <span class="number">-39664</span></span><br><span class="line">      &amp;&amp; <span class="number">275</span> * x[<span class="number">4</span>] + <span class="number">271</span> * x[<span class="number">6</span>] + <span class="number">473</span> * x[<span class="number">7</span>] - <span class="number">72</span> * x[<span class="number">5</span>] - <span class="number">260</span> * x[<span class="number">4</span>] - <span class="number">367</span> * x[<span class="number">4</span>] == <span class="number">14255</span></span><br><span class="line">      &amp;&amp; <span class="number">286</span> * *x + <span class="number">196</span> * x[<span class="number">7</span>] + <span class="number">483</span> * x[<span class="number">2</span>] + <span class="number">442</span> * x[<span class="number">1</span>] - <span class="number">495</span> * x[<span class="number">8</span>] - <span class="number">351</span> * x[<span class="number">4</span>] == <span class="number">41171</span></span><br><span class="line">      &amp;&amp; <span class="number">212</span> * x[<span class="number">2</span>] + <span class="number">283</span> * x[<span class="number">7</span>] - <span class="number">329</span> * x[<span class="number">8</span>] - <span class="number">429</span> * x[<span class="number">9</span>] - <span class="number">362</span> * x[<span class="number">2</span>] - <span class="number">261</span> * x[<span class="number">6</span>] == <span class="number">-90284</span></span><br><span class="line">      &amp;&amp; <span class="number">456</span> * x[<span class="number">5</span>] + <span class="number">244</span> * x[<span class="number">7</span>] + <span class="number">92</span> * x[<span class="number">4</span>] + <span class="number">348</span> * x[<span class="number">7</span>] - <span class="number">225</span> * x[<span class="number">1</span>] - <span class="number">31</span> * x[<span class="number">2</span>] == <span class="number">88447</span></span><br><span class="line">      &amp;&amp; <span class="number">238</span> * x[<span class="number">9</span>] + <span class="number">278</span> * x[<span class="number">7</span>] + <span class="number">216</span> * x[<span class="number">6</span>] + <span class="number">237</span> * *x + <span class="number">8</span> * x[<span class="number">2</span>] - <span class="number">17</span> * x[<span class="number">9</span>] == <span class="number">83838</span></span><br><span class="line">      &amp;&amp; <span class="number">323</span> * x[<span class="number">9</span>] + <span class="number">121</span> * x[<span class="number">1</span>] + <span class="number">370</span> * x[<span class="number">7</span>] - (x[<span class="number">4</span>] &lt;&lt; <span class="number">6</span>) - <span class="number">196</span> * x[<span class="number">9</span>] - <span class="number">422</span> * *x == <span class="number">26467</span></span><br><span class="line">      &amp;&amp; <span class="number">166</span> * x[<span class="number">9</span>] + <span class="number">90</span> * x[<span class="number">1</span>] + <span class="number">499</span> * x[<span class="number">2</span>] + <span class="number">301</span> * x[<span class="number">8</span>] - <span class="number">31</span> * x[<span class="number">2</span>] - <span class="number">206</span> * x[<span class="number">2</span>] == <span class="number">88247</span></span><br><span class="line">      &amp;&amp; <span class="number">355</span> * *x + <span class="number">282</span> * x[<span class="number">4</span>] + <span class="number">44</span> * x[<span class="number">9</span>] + <span class="number">359</span> * x[<span class="number">8</span>] - <span class="number">167</span> * x[<span class="number">5</span>] - <span class="number">62</span> * x[<span class="number">3</span>] == <span class="number">76658</span></span><br><span class="line">      &amp;&amp; <span class="number">488</span> * x[<span class="number">6</span>] + <span class="number">379</span> * x[<span class="number">9</span>] + <span class="number">318</span> * x[<span class="number">2</span>] - <span class="number">85</span> * x[<span class="number">1</span>] - <span class="number">357</span> * x[<span class="number">2</span>] - <span class="number">277</span> * x[<span class="number">5</span>] == <span class="number">35398</span></span><br><span class="line">      &amp;&amp; <span class="number">40</span> * *x + <span class="number">281</span> * x[<span class="number">4</span>] + <span class="number">217</span> * x[<span class="number">5</span>] - <span class="number">241</span> * x[<span class="number">1</span>] - <span class="number">407</span> * x[<span class="number">7</span>] - <span class="number">309</span> * x[<span class="number">7</span>] == <span class="number">-35436</span></span><br><span class="line">      &amp;&amp; <span class="number">429</span> * x[<span class="number">3</span>] + <span class="number">441</span> * x[<span class="number">3</span>] + <span class="number">115</span> * x[<span class="number">1</span>] + <span class="number">96</span> * x[<span class="number">8</span>] + <span class="number">464</span> * x[<span class="number">1</span>] - <span class="number">133</span> * x[<span class="number">7</span>] == <span class="number">157448</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现是一个矩阵，编写脚本解矩阵：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.optimize <span class="keyword">import</span> fsolve</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">equations</span>(<span class="params"><span class="built_in">vars</span></span>):</span><br><span class="line">    x = np.array(<span class="built_in">vars</span>)</span><br><span class="line">    eq1 = <span class="number">202</span> * x[<span class="number">8</span>] + <span class="number">216</span> * x[<span class="number">5</span>] - <span class="number">4</span> * x[<span class="number">4</span>] - <span class="number">330</span> * x[<span class="number">9</span>] - <span class="number">13</span> * x[<span class="number">4</span>] - <span class="number">268</span> * x[<span class="number">6</span>] + <span class="number">14982</span></span><br><span class="line">    eq2 = <span class="number">325</span> * x[<span class="number">8</span>] + <span class="number">195</span> * x[<span class="number">0</span>] + <span class="number">229</span> * x[<span class="number">1</span>] - <span class="number">121</span> * x[<span class="number">6</span>] - <span class="number">409</span> * x[<span class="number">6</span>] - <span class="number">128</span> * x[<span class="number">1</span>] - <span class="number">22606</span></span><br><span class="line">    eq3 = <span class="number">489</span> * x[<span class="number">1</span>] + <span class="number">480</span> * x[<span class="number">6</span>] + <span class="number">105</span> * x[<span class="number">2</span>] + <span class="number">367</span> * x[<span class="number">3</span>] - <span class="number">135</span> * x[<span class="number">4</span>] - <span class="number">482</span> * x[<span class="number">9</span>] - <span class="number">63236</span></span><br><span class="line">    eq4 = <span class="number">493</span> * x[<span class="number">1</span>] - <span class="number">80</span> * x[<span class="number">4</span>] - <span class="number">253</span> * x[<span class="number">8</span>] - <span class="number">121</span> * x[<span class="number">2</span>] - <span class="number">177</span> * x[<span class="number">0</span>] - <span class="number">243</span> * x[<span class="number">9</span>] + <span class="number">39664</span></span><br><span class="line">    eq5 = <span class="number">275</span> * x[<span class="number">4</span>] + <span class="number">271</span> * x[<span class="number">6</span>] + <span class="number">473</span> * x[<span class="number">7</span>] - <span class="number">72</span> * x[<span class="number">5</span>] - <span class="number">260</span> * x[<span class="number">4</span>] - <span class="number">367</span> * x[<span class="number">4</span>] - <span class="number">14255</span></span><br><span class="line">    eq6 = <span class="number">286</span> * x[<span class="number">0</span>] + <span class="number">196</span> * x[<span class="number">7</span>] + <span class="number">483</span> * x[<span class="number">2</span>] + <span class="number">442</span> * x[<span class="number">1</span>] - <span class="number">495</span> * x[<span class="number">8</span>] - <span class="number">351</span> * x[<span class="number">4</span>] - <span class="number">41171</span></span><br><span class="line">    eq7 = <span class="number">212</span> * x[<span class="number">2</span>] + <span class="number">283</span> * x[<span class="number">7</span>] - <span class="number">329</span> * x[<span class="number">8</span>] - <span class="number">429</span> * x[<span class="number">9</span>] - <span class="number">362</span> * x[<span class="number">2</span>] - <span class="number">261</span> * x[<span class="number">6</span>] + <span class="number">90284</span></span><br><span class="line">    eq8 = <span class="number">456</span> * x[<span class="number">5</span>] + <span class="number">244</span> * x[<span class="number">7</span>] + <span class="number">92</span> * x[<span class="number">4</span>] + <span class="number">348</span> * x[<span class="number">7</span>] - <span class="number">225</span> * x[<span class="number">1</span>] - <span class="number">31</span> * x[<span class="number">2</span>] - <span class="number">88447</span></span><br><span class="line">    eq9 = <span class="number">238</span> * x[<span class="number">9</span>] + <span class="number">278</span> * x[<span class="number">7</span>] + <span class="number">216</span> * x[<span class="number">6</span>] + <span class="number">237</span> * x[<span class="number">0</span>] + <span class="number">8</span> * x[<span class="number">2</span>] - <span class="number">17</span> * x[<span class="number">9</span>] - <span class="number">83838</span></span><br><span class="line">    eq10 = <span class="number">323</span> * x[<span class="number">9</span>] + <span class="number">121</span> * x[<span class="number">1</span>] + <span class="number">370</span> * x[<span class="number">7</span>] - <span class="number">64</span> * x[<span class="number">4</span>] - <span class="number">196</span> * x[<span class="number">9</span>] - <span class="number">422</span> * x[<span class="number">0</span>] - <span class="number">26467</span></span><br><span class="line">    eq11 = <span class="number">166</span> * x[<span class="number">9</span>] + <span class="number">90</span> * x[<span class="number">1</span>] + <span class="number">499</span> * x[<span class="number">2</span>] + <span class="number">301</span> * x[<span class="number">8</span>] - <span class="number">31</span> * x[<span class="number">2</span>] - <span class="number">206</span> * x[<span class="number">2</span>] - <span class="number">88247</span></span><br><span class="line">    eq12 = <span class="number">355</span> * x[<span class="number">0</span>] + <span class="number">282</span> * x[<span class="number">4</span>] + <span class="number">44</span> * x[<span class="number">9</span>] + <span class="number">359</span> * x[<span class="number">8</span>] - <span class="number">167</span> * x[<span class="number">5</span>] - <span class="number">62</span> * x[<span class="number">3</span>] - <span class="number">76658</span></span><br><span class="line">    eq13 = <span class="number">488</span> * x[<span class="number">6</span>] + <span class="number">379</span> * x[<span class="number">9</span>] + <span class="number">318</span> * x[<span class="number">2</span>] - <span class="number">85</span> * x[<span class="number">1</span>] - <span class="number">357</span> * x[<span class="number">2</span>] - <span class="number">277</span> * x[<span class="number">5</span>] - <span class="number">35398</span></span><br><span class="line">    eq14 = <span class="number">40</span> * x[<span class="number">0</span>] + <span class="number">281</span> * x[<span class="number">4</span>] + <span class="number">217</span> * x[<span class="number">5</span>] - <span class="number">241</span> * x[<span class="number">1</span>] - <span class="number">407</span> * x[<span class="number">7</span>] - <span class="number">309</span> * x[<span class="number">7</span>] + <span class="number">35436</span></span><br><span class="line">    eq15 = <span class="number">429</span> * x[<span class="number">3</span>] + <span class="number">441</span> * x[<span class="number">3</span>] + <span class="number">115</span> * x[<span class="number">1</span>] + <span class="number">96</span> * x[<span class="number">8</span>] + <span class="number">464</span> * x[<span class="number">1</span>] - <span class="number">133</span> * x[<span class="number">7</span>] - <span class="number">157448</span></span><br><span class="line">    <span class="keyword">return</span> [eq1, eq2, eq3, eq4, eq5, eq6, eq7, eq8, eq9, eq10, eq11, eq12, eq13, eq14, eq15]</span><br><span class="line"></span><br><span class="line">initial_guess = np.zeros(<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">solution = fsolve(equations, initial_guess)</span><br><span class="line"><span class="built_in">print</span>(solution)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">round</span>(solution[i]),end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">round</span>(solution[i])), end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<p>运行脚本得到bait为DeluxeBait，接着看后面的RC4，发现多异或了<code>0x14</code>，提取密文：<font color=lime><strong>[0xE9, 0x37, 0xF8, 0xE2, 0x0C, 0x0F, 0x3D, 0xB9, 0x5C, 0xA3, 0xDE, 0x2D, 0x55, 0x96, 0xDF, 0xA2, 0x35, 0xFE, 0xB3, 0xDD, 0x7F, 0x91, 0x3C]</strong></font>，RC4解密，发现得到的是一个fakeflag，检查发现藏了很多个版本的RC4，有异或0x33、0x66和0x14的，并且还藏了一个生成24字节密文的函数，提取这个密文：<font color=red><strong>[0x21, 0x56, 0x97, 0xa6, 0x1a, 0xd5, 0xc4, 0xde, 0xa4, 0x9c, 0x82, 0x4d, 0xd1, 0x45, 0xc8, 0x56, 0xa7, 0xb4, 0x96, 0x5c, 0x4d, 0x49, 0x87, 0x20]</strong></font>，动态调试发现在比较时跳转到了一个有多重XTEA加密的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">dup_XTEA</span><span class="params">(_BYTE *a1, <span class="type">unsigned</span> __int8 *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  v34 = a1;</span><br><span class="line">  <span class="built_in">memset</span>(v32, <span class="number">0</span>, <span class="number">0x14u</span>i64);</span><br><span class="line">  <span class="built_in">memset</span>(v33, <span class="number">0</span>, <span class="number">0x32u</span>i64);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">20</span>; ++i )</span><br><span class="line">    *((_BYTE *)v32 + i) = a1[i - <span class="number">80</span>];</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">50</span>; ++j )</span><br><span class="line">    *((_BYTE *)v33 + j) = a1[j - <span class="number">56</span>];</span><br><span class="line">  v3 = <span class="number">0</span>;</span><br><span class="line">  v6 = v33[<span class="number">0</span>];</span><br><span class="line">  v9 = v33[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">24</span>; ++k )</span><br><span class="line">  &#123;</span><br><span class="line">    v6 += (v32[v3 &amp; <span class="number">3</span>] + v3) ^ (v9 + ((v9 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v9)));</span><br><span class="line">    v3 += <span class="number">0x66778899</span>;</span><br><span class="line">    v9 += (v32[(v3 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + v3) ^ (v6 + ((v6 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v6)));</span><br><span class="line">  &#125;</span><br><span class="line">  v33[<span class="number">0</span>] = v6;</span><br><span class="line">  v33[<span class="number">1</span>] = v9;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  v7 = v33[<span class="number">2</span>];</span><br><span class="line">  v10 = v33[<span class="number">3</span>];</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">24</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 += (v32[v4 &amp; <span class="number">3</span>] + v4) ^ (v10 + ((v10 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v10)));</span><br><span class="line">    v4 += <span class="number">0x66778899</span>;</span><br><span class="line">    v10 += (v32[(v4 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + v4) ^ (v7 + ((v7 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v7)));</span><br><span class="line">  &#125;</span><br><span class="line">  v33[<span class="number">2</span>] = v7;</span><br><span class="line">  v33[<span class="number">3</span>] = v10;</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  v8 = v33[<span class="number">4</span>];</span><br><span class="line">  v11 = v33[<span class="number">5</span>];</span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt; <span class="number">24</span>; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 += (v32[v5 &amp; <span class="number">3</span>] + v5) ^ (v11 + ((v11 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v11)));</span><br><span class="line">    v5 += <span class="number">0x66778899</span>;</span><br><span class="line">    v11 += (v32[(v5 &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>] + v5) ^ (v8 + ((v8 &gt;&gt; <span class="number">5</span>) ^ (<span class="number">16</span> * v8)));</span><br><span class="line">  &#125;</span><br><span class="line">  v33[<span class="number">4</span>] = v8;</span><br><span class="line">  v33[<span class="number">5</span>] = v11;</span><br><span class="line">  v12 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt; <span class="number">24</span>; ++ii )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( cipher[ii] != *((<span class="type">unsigned</span> __int8 *)v33 + ii) )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v12 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(LibFileName, <span class="string">&quot;dbtc\&quot;#?u&#125;&#125;&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt; <span class="number">10</span>; ++jj )</span><br><span class="line">      LibFileName[jj] ^= <span class="number">0x11u</span>;</span><br><span class="line">    hModule = LoadLibraryA(LibFileName);</span><br><span class="line">    <span class="built_in">strcpy</span>(ProcName, <span class="string">&quot;\\tbbpvtS~iP&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> ( kk = <span class="number">0</span>; kk &lt; <span class="number">11</span>; ++kk )</span><br><span class="line">      ProcName[kk] ^= <span class="number">0x11u</span>;</span><br><span class="line">    ProcAddress = GetProcAddress(hModule, ProcName);</span><br><span class="line">    <span class="built_in">strcpy</span>(v31, <span class="string">&quot;H~d6gt1rpdvye1p1sxv1wxby0&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> ( mm = <span class="number">0</span>; mm &lt; <span class="number">25</span>; ++mm )</span><br><span class="line">      v31[mm] ^= <span class="number">0x11u</span>;</span><br><span class="line">    qmemcpy(v28, <span class="string">&quot;R~&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    v28[<span class="number">2</span>] = <span class="number">127</span>;</span><br><span class="line">    qmemcpy(v29, <span class="string">&quot;vcped&#125;pex~&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    v29[<span class="number">10</span>] = <span class="number">127</span>;</span><br><span class="line">    <span class="built_in">strcpy</span>(v30, <span class="string">&quot;000&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> ( nn = <span class="number">0</span>; nn &lt; <span class="number">17</span>; ++nn )</span><br><span class="line">      v28[nn] ^= <span class="number">0x11u</span>;</span><br><span class="line">    ((<span class="type">void</span> (__fastcall *)(_QWORD, <span class="type">char</span> *, <span class="type">char</span> *, _QWORD))ProcAddress)(<span class="number">0</span>i64, v31, v28, <span class="number">0</span>i64);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v20 = (<span class="type">unsigned</span> __int8)*v34 - *a2;</span><br><span class="line">    <span class="keyword">if</span> ( v20 || !*v34 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    ++v34;</span><br><span class="line">    ++a2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v20 &gt; <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>i64;</span><br><span class="line">  <span class="keyword">if</span> ( v20 &gt;= <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现在这个函数中用<code>DeluxeBait</code>作为密钥，输入的字符串作为密文进行了delta为<code>0x66778899</code>的XTEA加密并和密文进行了比较，而这里的密文正是之前所见的第二个密文，编写解密脚本进行解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_dwords_little_endian</span>(<span class="params">byte_array</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(byte_array[i:i+<span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(byte_array), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dwords_to_bytes_little_endian</span>(<span class="params">dword_array</span>):</span><br><span class="line">    byte_list = []</span><br><span class="line">    <span class="keyword">for</span> dword <span class="keyword">in</span> dword_array:</span><br><span class="line">        byte_list.extend(dword.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> byte_list</span><br><span class="line"></span><br><span class="line">delta = <span class="number">0x66778899</span></span><br><span class="line">key = [<span class="number">0x756C6544</span>, <span class="number">0x61426578</span>, <span class="number">0x00007469</span>, <span class="number">0x00000000</span>]</span><br><span class="line">ttl = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">encflag = [<span class="number">0x21</span>, <span class="number">0x56</span>, <span class="number">0x97</span>, <span class="number">0xa6</span>, <span class="number">0x1a</span>, <span class="number">0xd5</span>,</span><br><span class="line">           <span class="number">0xc4</span>, <span class="number">0xde</span>, <span class="number">0xa4</span>, <span class="number">0x9c</span>, <span class="number">0x82</span>, <span class="number">0x4d</span>,</span><br><span class="line">           <span class="number">0xd1</span>, <span class="number">0x45</span>, <span class="number">0xc8</span>, <span class="number">0x56</span>, <span class="number">0xa7</span>, <span class="number">0xb4</span>,</span><br><span class="line">           <span class="number">0x96</span>, <span class="number">0x5c</span>, <span class="number">0x4d</span>, <span class="number">0x49</span>, <span class="number">0x87</span>, <span class="number">0x20</span>]</span><br><span class="line">dwordenc = bytes_to_dwords_little_endian(encflag)</span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(dwordenc)//<span class="number">2</span>):</span><br><span class="line">    m1 = dwordenc[<span class="number">2</span>*j]</span><br><span class="line">    m2 = dwordenc[<span class="number">2</span>*j+<span class="number">1</span>]</span><br><span class="line">    ttl = (<span class="number">0</span> + <span class="number">24</span> * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">        m2 = (m2 - ((((m1 &gt;&gt; <span class="number">5</span>) ^ (m1 &lt;&lt; <span class="number">4</span>)) + m1) ^ (ttl + key[(ttl &gt;&gt; <span class="number">11</span>) &amp; <span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        m1 = (m1 - ((((m2 &gt;&gt; <span class="number">5</span>) ^ (m2 &lt;&lt; <span class="number">4</span>)) + m2) ^ (ttl + key[ttl &amp; <span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    result.append(m1)</span><br><span class="line">    result.append(m2)</span><br><span class="line">flag = dwords_to_bytes_little_endian(result)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(flag[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>运行得到flag：<font color=deepskyblue><strong>NSSCTF{Wh@t_@_b1g_F1sh}</strong></font>.</p>
<h2 id="LockedSecret："><a href="#LockedSecret：" class="headerlink" title="LockedSecret："></a>LockedSecret：</h2><p>查壳发现UPX012和UPX!标识符被换成了LIVV，改回去之后脱壳，查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+0h] [ebp-108h]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">256</span>]; <span class="comment">// [esp+4h] [ebp-104h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(Str, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%32s&quot;</span>, (<span class="type">char</span>)Str);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(Str) != <span class="number">32</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Wrong length!\n&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  XorKeyGen();</span><br><span class="line">  MyTEA((<span class="type">int</span>)Str);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( cipher[i] != Str[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Wrong!\n&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Right!\n&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>显然flag长度为32，查看XorKeyGen，发现用固定的rand种子生成了一个密钥，动态调试得到值<font color=lime><strong>[0x64, 0x96, 0x50, 0x16, 0x69, 0xff, 0xbe, 0x60]</strong></font>，查看加密，发现是一个8轮的TEA加密，密钥为<code>IamTheKeyYouKnow</code>循环异或刚才的8字节的值，delta为<code>0x5E2377FF</code>，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dwords_to_bytes_little_endian</span>(<span class="params">dword_array</span>):</span><br><span class="line">    byte_list = []</span><br><span class="line">    <span class="keyword">for</span> dword <span class="keyword">in</span> dword_array:</span><br><span class="line">        byte_list.extend(dword.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> byte_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes_to_dwords_little_endian</span>(<span class="params">byte_array</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(byte_array[i:i+<span class="number">4</span>], byteorder=<span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>)<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(byte_array), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">test = [<span class="number">0x61</span>, <span class="number">0x62</span>, <span class="number">0x63</span>, <span class="number">0x64</span>, <span class="number">0x65</span>, <span class="number">0x66</span>, <span class="number">0x67</span>, <span class="number">0x68</span>, </span><br><span class="line">        <span class="number">0x69</span>, <span class="number">0x6a</span>, <span class="number">0x6b</span>, <span class="number">0x6c</span>, <span class="number">0x6d</span>, <span class="number">0x6e</span>, <span class="number">0x6f</span>, <span class="number">0x70</span>, </span><br><span class="line">        <span class="number">0x71</span>, <span class="number">0x72</span>, <span class="number">0x73</span>, <span class="number">0x74</span>, <span class="number">0x75</span>, <span class="number">0x76</span>, <span class="number">0x77</span>, <span class="number">0x78</span>, </span><br><span class="line">        <span class="number">0x79</span>, <span class="number">0x7a</span>, <span class="number">0x31</span>, <span class="number">0x32</span>, <span class="number">0x33</span>, <span class="number">0x34</span>, <span class="number">0x35</span>, <span class="number">0x36</span>]</span><br><span class="line">key = [<span class="number">0x49</span>, <span class="number">0x61</span>, <span class="number">0x6d</span>, <span class="number">0x54</span>, <span class="number">0x68</span>, <span class="number">0x65</span>, <span class="number">0x4b</span>, <span class="number">0x65</span>, </span><br><span class="line">       <span class="number">0x79</span>, <span class="number">0x59</span>, <span class="number">0x6f</span>, <span class="number">0x75</span>, <span class="number">0x4b</span>, <span class="number">0x6e</span>, <span class="number">0x6f</span>, <span class="number">0x77</span>]</span><br><span class="line">xor = [<span class="number">0x64</span>, <span class="number">0x96</span>, <span class="number">0x50</span>, <span class="number">0x16</span>, <span class="number">0x69</span>, <span class="number">0xff</span>, <span class="number">0xbe</span>, <span class="number">0x60</span>]</span><br><span class="line">delta = <span class="number">0x5E2377FF</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)-<span class="number">1</span>):</span><br><span class="line">    key[i] ^= xor[i % <span class="number">8</span>]</span><br><span class="line">k = bytes_to_dwords_little_endian(key)</span><br><span class="line">dwordenc = bytes_to_dwords_little_endian(test)</span><br><span class="line">dwordresult = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordenc)//<span class="number">2</span>):</span><br><span class="line">    v0 = dwordenc[<span class="number">2</span> * i]</span><br><span class="line">    v1 = dwordenc[<span class="number">2</span> * i + <span class="number">1</span>]</span><br><span class="line">    ttl = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        ttl = (ttl + delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 = (v0 + (((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + ttl) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v1 = (v1 + (((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + ttl) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    dwordresult.append(v0 ^ <span class="number">0xF</span>)</span><br><span class="line">    dwordresult.append(v1 ^ <span class="number">0xF</span>)</span><br><span class="line">result = dwords_to_bytes_little_endian(dwordresult)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordresult)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(dwordresult[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(result)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(result[i]),end=<span class="string">&quot;, &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line">encflag = [<span class="number">0xDC</span>, <span class="number">0x45</span>, <span class="number">0x1E</span>, <span class="number">0x03</span>, <span class="number">0x89</span>, <span class="number">0xE9</span>, <span class="number">0x76</span>, <span class="number">0x27</span>, </span><br><span class="line">           <span class="number">0x47</span>, <span class="number">0x48</span>, <span class="number">0x23</span>, <span class="number">0x01</span>, <span class="number">0x70</span>, <span class="number">0xD2</span>, <span class="number">0xCE</span>, <span class="number">0x64</span>, </span><br><span class="line">           <span class="number">0xDA</span>, <span class="number">0x7F</span>, <span class="number">0x46</span>, <span class="number">0x33</span>, <span class="number">0xB1</span>, <span class="number">0x03</span>, <span class="number">0x49</span>, <span class="number">0xA3</span>, </span><br><span class="line">           <span class="number">0x27</span>, <span class="number">0x00</span>, <span class="number">0xD1</span>, <span class="number">0x2C</span>, <span class="number">0x37</span>, <span class="number">0xB3</span>, <span class="number">0xBD</span>, <span class="number">0x75</span>]</span><br><span class="line">dwordencflag = bytes_to_dwords_little_endian(encflag)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordencflag)):</span><br><span class="line">    dwordencflag[i] ^= <span class="number">0xF</span></span><br><span class="line">dwordrev = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(dwordencflag)//<span class="number">2</span>):</span><br><span class="line">    v0 = dwordencflag[<span class="number">2</span> * i]</span><br><span class="line">    v1 = dwordencflag[<span class="number">2</span> * i + <span class="number">1</span>]</span><br><span class="line">    ttl = (<span class="number">8</span> * delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        v1 = (v1 - (((v0 &lt;&lt; <span class="number">4</span>) + k[<span class="number">2</span>]) ^ (v0 + ttl) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k[<span class="number">3</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 = (v0 - (((v1 &lt;&lt; <span class="number">4</span>) + k[<span class="number">0</span>]) ^ (v1 + ttl) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k[<span class="number">1</span>]))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        ttl = (ttl - delta) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    dwordrev.append(v0)</span><br><span class="line">    dwordrev.append(v1)</span><br><span class="line">rev = dwords_to_bytes_little_endian(dwordrev)</span><br><span class="line">bflag = <span class="built_in">bytearray</span>()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(rev)):</span><br><span class="line">    bflag.append(rev[i])</span><br><span class="line"><span class="built_in">print</span>(bflag)</span><br><span class="line">mapflag = bflag.decode()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;OutpFlag:&quot;</span>, mapflag)</span><br></pre></td></tr></table></figure>
<p>运行脚本得到flag：<font color=deepskyblue><strong>NSSCTF{!!!Y0u_g3t_th3_s3cr3t!!!}</strong></font>.</p>
<h2 id="Mio？Ryo？Soyo？："><a href="#Mio？Ryo？Soyo？：" class="headerlink" title="Mio？Ryo？Soyo？："></a>Mio？Ryo？Soyo？：</h2><p>发现是python打包，解包后反编译program.pyc，发现程序结构很简单：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Secret <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入:&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    aaaaaaaaaaaaa = <span class="built_in">input</span>()</span><br><span class="line">    wwwwwwwwwww = l(aaaaaaaaaaaaa)</span><br><span class="line">    <span class="keyword">if</span> sssssssssssss == wwwwwwwwwww.encode():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;哦，对的。&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;哎，并非。&quot;</span>)</span><br><span class="line"><span class="built_in">input</span>()</span><br></pre></td></tr></table></figure>
<p>所以需要关注的是l函数和s密文，找到Secret库进行反编译：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> SecretEncrypt <span class="keyword">import</span> *</span><br><span class="line">sssssssssssss = <span class="built_in">bytes</span>([<span class="number">57</span>, <span class="number">118</span>, <span class="number">33</span>, <span class="number">114</span>, <span class="number">68</span>, <span class="number">56</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">34</span>, <span class="number">52</span>, <span class="number">52</span>, <span class="number">95</span>, <span class="number">78</span>, <span class="number">40</span>, <span class="number">49</span>, <span class="number">59</span>,</span><br><span class="line"> <span class="number">95</span>, <span class="number">85</span>, <span class="number">63</span>, <span class="number">122</span>, <span class="number">54</span>, <span class="number">33</span>, <span class="number">77</span>, <span class="number">110</span>, <span class="number">49</span>, <span class="number">54</span>, <span class="number">34</span>, <span class="number">109</span>, <span class="number">106</span>, <span class="number">122</span>, <span class="number">60</span>,</span><br><span class="line"> <span class="number">92</span>, <span class="number">108</span>, <span class="number">91</span>, <span class="number">61</span>, <span class="number">51</span>, <span class="number">42</span>, <span class="number">62</span>, <span class="number">35</span>, <span class="number">38</span>, <span class="number">52</span>, <span class="number">67</span>, <span class="number">62</span>, <span class="number">122</span>, <span class="number">116</span>, <span class="number">48</span>,</span><br><span class="line"> <span class="number">76</span>, <span class="number">50</span>, <span class="number">67</span>, <span class="number">51</span>, <span class="number">59</span>, <span class="number">41</span>, <span class="number">122</span>, <span class="number">45</span>, <span class="number">45</span>, <span class="number">51</span>, <span class="number">90</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">l</span>(<span class="params">_: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> SSSooooyyooo(MMMMiiiiiio.MMMMiiooooooo(SSSooooyyooo(RRRRyyooo.RRRRRRRyyyyooooo(_.encode()), <span class="number">7</span>).encode()), <span class="number">9</span>)</span><br></pre></td></tr></table></figure>
<p>反编译SecretEncrypt：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MMMMiiiiiio</span>:</span><br><span class="line">    MMiiiiiiooo = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(Miiooooooooo) <span class="keyword">for</span> Miiooooooooo <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">118</span>)])</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">MMMMiiooooooo</span>(<span class="params">MMMMMMMMMiiiooo: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        MMMMiiiiioooooooooo = <span class="string">&quot;&quot;</span></span><br><span class="line">        MMMMMMMiiiiioo = (<span class="number">4</span> - <span class="built_in">len</span>(MMMMMMMMMiiiooo) % <span class="number">4</span>) % <span class="number">4</span></span><br><span class="line">        MMMMMMMMMiiiooo += <span class="string">b&#x27;\x00&#x27;</span> * MMMMMMMiiiiioo</span><br><span class="line">        <span class="keyword">for</span> MMMMMMiiiiiio <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(MMMMMMMMMiiiooo), <span class="number">4</span>):</span><br><span class="line">            MMMMiiiiiiooooo = MMMMMMMMMiiiooo[MMMMMMiiiiiio[:MMMMMMiiiiiio + <span class="number">4</span>]]</span><br><span class="line">            MMMMMMiiioooooo = <span class="built_in">int</span>.from_bytes(MMMMiiiiiiooooo, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">            MMMMMMMiiooooooooo = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                MMMMMMMiiooooooooo = MMMMiiiiiio.MMiiiiiiooo[MMMMMMiiioooooo % <span class="number">85</span>] + MMMMMMMiiooooooooo</span><br><span class="line">                MMMMMMiiioooooo //= <span class="number">85</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                MMMMiiiiioooooooooo += MMMMMMMiiooooooooo</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> MMMMMMMiiiiioo:</span><br><span class="line">                MMMMiiiiioooooooooo = MMMMiiiiioooooooooo[<span class="literal">None</span>[:-MMMMMMMiiiiioo]]</span><br><span class="line">            <span class="keyword">return</span> MMMMiiiiioooooooooo</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RRRRyyooo</span>:</span><br><span class="line">    RRRRyooooooo = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(RRRRRRRyyyyyoooo) <span class="keyword">for</span> RRRRRRRyyyyyoooo <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">93</span>)])</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">RRRRRRRyyyyooooo</span>(<span class="params">RRRRRRyyyoooooo: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        RRRRyyyyyooo = []</span><br><span class="line">        RRyyyyyyyyyoooooo = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> RRyyyyyyyyyoooooo &lt; <span class="built_in">len</span>(RRRRRRyyyoooooo):</span><br><span class="line">            <span class="keyword">if</span> RRyyyyyyyyyoooooo + <span class="number">1</span> &lt; <span class="built_in">len</span>(RRRRRRyyyoooooo):</span><br><span class="line">                RRRRRRRRRyyo = RRRRRRyyyoooooo[RRyyyyyyyyyoooooo] &lt;&lt; <span class="number">8</span> | RRRRRRyyyoooooo[RRyyyyyyyyyoooooo + <span class="number">1</span>]</span><br><span class="line">                RRRRyyyyyooo.append(RRRRyyooo.RRRRyooooooo[RRRRRRRRRyyo % <span class="number">45</span>])</span><br><span class="line">                RRRRRRRRRyyo //= <span class="number">45</span></span><br><span class="line">                RRRRyyyyyooo.append(RRRRyyooo.RRRRyooooooo[RRRRRRRRRyyo % <span class="number">45</span>])</span><br><span class="line">                RRRRRRRRRyyo //= <span class="number">45</span></span><br><span class="line">                RRRRyyyyyooo.append(RRRRyyooo.RRRRyooooooo[RRRRRRRRRyyo])</span><br><span class="line">                RRyyyyyyyyyoooooo += <span class="number">2</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                RRRRRRRRRyyo = RRRRRRyyyoooooo[RRyyyyyyyyyoooooo]</span><br><span class="line">                RRRRyyyyyooo.append(RRRRyyooo.RRRRyooooooo[RRRRRRRRRyyo % <span class="number">45</span>])</span><br><span class="line">                RRRRRRRRRyyo //= <span class="number">45</span></span><br><span class="line">                RRRRyyyyyooo.append(RRRRyyooo.RRRRyooooooo[RRRRRRRRRyyo])</span><br><span class="line">                RRyyyyyyyyyoooooo += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(RRRRyyyyyooo)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SSSooooyyooo</span>(<span class="params">SSSSooyoooooo, SSSSSoyyooooo</span>):</span><br><span class="line">    SSoooooyyyyyyoo = []</span><br><span class="line">    <span class="keyword">for</span> SSSSSSSSSoyooo <span class="keyword">in</span> SSSSooyoooooo:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;a&quot;</span> &lt;= SSSSSSSSSoyooo &lt;= <span class="string">&quot;z&quot;</span>:</span><br><span class="line">            SSSSoooyooooooo = (<span class="built_in">ord</span>(SSSSSSSSSoyooo) - <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) + SSSSSoyyooooo) % <span class="number">26</span></span><br><span class="line">            SSoooooyyyyyyoo.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) + SSSSoooyooooooo))</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;0&quot;</span> &lt;= SSSSSSSSSoyooo &lt;= <span class="string">&quot;9&quot;</span>:</span><br><span class="line">            SSSSoooyooooooo = (<span class="built_in">ord</span>(SSSSSSSSSoyooo) - <span class="built_in">ord</span>(<span class="string">&quot;0&quot;</span>) - SSSSSoyyooooo) % <span class="number">10</span></span><br><span class="line">            SSoooooyyyyyyoo.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&quot;0&quot;</span>) + SSSSoooyooooooo))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            SSoooooyyyyyyoo.append(SSSSSSSSSoyooo)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(SSoooooyyyyyyoo)</span><br></pre></td></tr></table></figure>
<p>去除混淆：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">M</span>:</span><br><span class="line">    M1 = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(idxM) <span class="keyword">for</span> idxM <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">118</span>)])</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">funM</span>(<span class="params">inputM: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        outputM = <span class="string">&quot;&quot;</span></span><br><span class="line">        infM = (<span class="number">4</span> - <span class="built_in">len</span>(inputM) % <span class="number">4</span>) % <span class="number">4</span></span><br><span class="line">        inputM += <span class="string">b&#x27;\x00&#x27;</span> * infM</span><br><span class="line">        <span class="keyword">for</span> iM <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(inputM), <span class="number">4</span>):</span><br><span class="line">            tempM = inputM[iM[:iM + <span class="number">4</span>]]</span><br><span class="line">            intM = <span class="built_in">int</span>.from_bytes(tempM, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">            strM = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">                strM = M.M1[intM % <span class="number">85</span>] + strM</span><br><span class="line">                intM //= <span class="number">85</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                outputM += strM</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> infM:</span><br><span class="line">                outputM = outputM[<span class="literal">None</span>[:-infM]]</span><br><span class="line">            <span class="keyword">return</span> outputM</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">R</span>:</span><br><span class="line">    R1 = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(idxR) <span class="keyword">for</span> idxR <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">93</span>)])</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">funR</span>(<span class="params">inputR: <span class="built_in">bytes</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        listR = []</span><br><span class="line">        iR = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> iR &lt; <span class="built_in">len</span>(inputR):</span><br><span class="line">            <span class="keyword">if</span> iR + <span class="number">1</span> &lt; <span class="built_in">len</span>(inputR):</span><br><span class="line">                tempR = inputR[iR] &lt;&lt; <span class="number">8</span> | inputR[iR + <span class="number">1</span>]</span><br><span class="line">                listR.append(R.R1[tempR % <span class="number">45</span>])</span><br><span class="line">                tempR //= <span class="number">45</span></span><br><span class="line">                listR.append(R.R1[tempR % <span class="number">45</span>])</span><br><span class="line">                tempR //= <span class="number">45</span></span><br><span class="line">                listR.append(R.R1[tempR])</span><br><span class="line">                iR += <span class="number">2</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                tempR = inputR[iR]</span><br><span class="line">                listR.append(R.R1[tempR % <span class="number">45</span>])</span><br><span class="line">                tempR //= <span class="number">45</span></span><br><span class="line">                listR.append(R.R1[tempR])</span><br><span class="line">                iR += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(listR)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">S1, S2</span>):</span><br><span class="line">    listS = []</span><br><span class="line">    <span class="keyword">for</span> iS <span class="keyword">in</span> S1:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;a&quot;</span> &lt;= iS &lt;= <span class="string">&quot;z&quot;</span>:</span><br><span class="line">            tempS = (<span class="built_in">ord</span>(iS) - <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) + S2) % <span class="number">26</span></span><br><span class="line">            listS.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) + tempS))</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;0&quot;</span> &lt;= iS &lt;= <span class="string">&quot;9&quot;</span>:</span><br><span class="line">            tempS = (<span class="built_in">ord</span>(iS) - <span class="built_in">ord</span>(<span class="string">&quot;0&quot;</span>) - S2) % <span class="number">10</span></span><br><span class="line">            listS.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&quot;0&quot;</span>) + tempS))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            listS.append(iS)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(listS)</span><br><span class="line"></span><br><span class="line">cipher = <span class="built_in">bytes</span>([<span class="number">57</span>, <span class="number">118</span>, <span class="number">33</span>, <span class="number">114</span>, <span class="number">68</span>, <span class="number">56</span>, <span class="number">117</span>, <span class="number">115</span>, <span class="number">34</span>, <span class="number">52</span>, <span class="number">52</span>, <span class="number">95</span>, <span class="number">78</span>, <span class="number">40</span>, <span class="number">49</span>, <span class="number">59</span>,</span><br><span class="line">                <span class="number">95</span>, <span class="number">85</span>, <span class="number">63</span>, <span class="number">122</span>, <span class="number">54</span>, <span class="number">33</span>, <span class="number">77</span>, <span class="number">110</span>, <span class="number">49</span>, <span class="number">54</span>, <span class="number">34</span>, <span class="number">109</span>, <span class="number">106</span>, <span class="number">122</span>, <span class="number">60</span>,</span><br><span class="line">                <span class="number">92</span>, <span class="number">108</span>, <span class="number">91</span>, <span class="number">61</span>, <span class="number">51</span>, <span class="number">42</span>, <span class="number">62</span>, <span class="number">35</span>, <span class="number">38</span>, <span class="number">52</span>, <span class="number">67</span>, <span class="number">62</span>, <span class="number">122</span>, <span class="number">116</span>, <span class="number">48</span>,</span><br><span class="line">                <span class="number">76</span>, <span class="number">50</span>, <span class="number">67</span>, <span class="number">51</span>, <span class="number">59</span>, <span class="number">41</span>, <span class="number">122</span>, <span class="number">45</span>, <span class="number">45</span>, <span class="number">51</span>, <span class="number">90</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">l</span>(<span class="params">_: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> S(M.funM(S(R.funR(_.encode()), <span class="number">7</span>).encode()), <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;输入:&quot;</span>, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    message = <span class="built_in">input</span>()</span><br><span class="line">    enc = l(message)</span><br><span class="line">    <span class="keyword">if</span> cipher == enc.encode():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;哦，对的。&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;哎，并非。&quot;</span>)</span><br><span class="line">    <span class="built_in">input</span>()</span><br></pre></td></tr></table></figure>
<p>发现S函数是一个凯撒加密，R函数是一个base45编码，M函数是一个base85编码，则加密方式为：</p>
<p>base45→偏移7→base85→偏移9</p>
<p>编写S函数的逆向脚本：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">S_inverse</span>(<span class="params">S1: <span class="built_in">str</span>, S2: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    listS = []</span><br><span class="line">    <span class="keyword">for</span> iS <span class="keyword">in</span> S1:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;a&quot;</span> &lt;= iS &lt;= <span class="string">&quot;z&quot;</span>:</span><br><span class="line">            tempS = (<span class="built_in">ord</span>(iS) - <span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) - S2) % <span class="number">26</span></span><br><span class="line">            listS.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&quot;a&quot;</span>) + tempS))</span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;0&quot;</span> &lt;= iS &lt;= <span class="string">&quot;9&quot;</span>:</span><br><span class="line">            tempS = (<span class="built_in">ord</span>(iS) - <span class="built_in">ord</span>(<span class="string">&quot;0&quot;</span>) + S2) % <span class="number">10</span></span><br><span class="line">            listS.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&quot;0&quot;</span>) + tempS))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            listS.append(iS)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(listS)</span><br><span class="line"></span><br><span class="line">enc = <span class="built_in">bytearray</span>([<span class="number">0x39</span>, <span class="number">0x76</span>, <span class="number">0x21</span>, <span class="number">0x72</span>, <span class="number">0x44</span>, <span class="number">0x38</span>, <span class="number">0x75</span>, <span class="number">0x73</span>, <span class="number">0x22</span>, <span class="number">0x34</span>, <span class="number">0x34</span>, <span class="number">0x5f</span>, <span class="number">0x4e</span>, <span class="number">0x28</span>, <span class="number">0x31</span>, <span class="number">0x3b</span>, <span class="number">0x5f</span>, <span class="number">0x55</span>, <span class="number">0x3f</span>, </span><br><span class="line">                 <span class="number">0x7a</span>, <span class="number">0x36</span>, <span class="number">0x21</span>, <span class="number">0x4d</span>, <span class="number">0x6e</span>, <span class="number">0x31</span>, <span class="number">0x36</span>, <span class="number">0x22</span>, <span class="number">0x6d</span>, <span class="number">0x6a</span>, <span class="number">0x7a</span>, <span class="number">0x3c</span>, <span class="number">0x5c</span>, <span class="number">0x6c</span>, <span class="number">0x5b</span>, <span class="number">0x3d</span>, <span class="number">0x33</span>, <span class="number">0x2a</span>, <span class="number">0x3e</span>, </span><br><span class="line">                 <span class="number">0x23</span>, <span class="number">0x26</span>, <span class="number">0x34</span>, <span class="number">0x43</span>, <span class="number">0x3e</span>, <span class="number">0x7a</span>, <span class="number">0x74</span>, <span class="number">0x30</span>, <span class="number">0x4c</span>, <span class="number">0x32</span>, <span class="number">0x43</span>, <span class="number">0x33</span>, <span class="number">0x3b</span>, <span class="number">0x29</span>, <span class="number">0x7a</span>, <span class="number">0x2d</span>, <span class="number">0x2d</span>, <span class="number">0x33</span>, <span class="number">0x5a</span>])</span><br><span class="line"></span><br><span class="line">encrypted_message = enc.decode()</span><br><span class="line">shift_value = <span class="number">9</span></span><br><span class="line">decrypted_message = S_inverse(encrypted_message, shift_value)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;decrypted_message&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>输出<code>8m!iD7lj&quot;33_N(0;_U?q5!Me05&quot;daq&lt;\c[=2*&gt;#&amp;3C&gt;qk9L1C2;)q--2Z</code>，base85解码得到：<code>JX2NG:CM:KJ?S0=:&gt;?NC&gt;K5&lt;V29Z5&lt;Y:9C=;LA1RQ9G:7</code>，再次偏移7得到：<code>JX9NG:CM:KJ?S7=:&gt;?NC&gt;K2&lt;V96Z2&lt;Y:6C=;LA8RQ6G:4</code>，base45解码：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">R</span>:</span><br><span class="line">    R1 = <span class="string">&quot;&quot;</span>.join(<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">93</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decode_R</span>(<span class="params">s</span>):</span><br><span class="line">    result = <span class="built_in">bytearray</span>()</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(s):</span><br><span class="line">        <span class="keyword">if</span> i + <span class="number">2</span> &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            c0, c1, c2 = [R.R1.index(s[i+j]) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">            tempR = c0 + c1 * <span class="number">45</span> + c2 * <span class="number">45</span>**<span class="number">2</span></span><br><span class="line">            result.extend([(tempR &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>, tempR &amp; <span class="number">0xFF</span>])</span><br><span class="line">            i += <span class="number">3</span></span><br><span class="line">        <span class="keyword">elif</span> i + <span class="number">1</span> &lt; <span class="built_in">len</span>(s):</span><br><span class="line">            c0, c1 = [R.R1.index(s[i+j]) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">            tempR = c0 + c1 * <span class="number">45</span></span><br><span class="line">            result.append(tempR)</span><br><span class="line">            i += <span class="number">2</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid length&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(result)</span><br><span class="line"></span><br><span class="line">step4 = <span class="string">&quot;JX9NG:CM:KJ?S7=:&gt;?NC&gt;K2&lt;V96Z2&lt;Y:6C=;LA8RQ6G:4&quot;</span></span><br><span class="line">step5 = decode_R(step4)</span><br><span class="line">flag = step5.decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>
<p>得到flag：<font color=deepskyblue><strong>NSSCTF{Th3y’r3_a11_p1aY_Ba5e!}</strong></font>.</p>
<h2 id="TimeSpaceRescue："><a href="#TimeSpaceRescue：" class="headerlink" title="TimeSpaceRescue："></a>TimeSpaceRescue：</h2><p>查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+0h] [ebp-11Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+4h] [ebp-118h]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">256</span>]; <span class="comment">// [esp+8h] [ebp-114h] BYREF</span></span><br><span class="line">  <span class="type">int</span> Src[<span class="number">4</span>]; <span class="comment">// [esp+108h] [ebp-14h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Before input the key, make sure you&#x27;re on the same spacetime as Liv.\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Try your key:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(Str, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str));</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, Str);</span><br><span class="line">  <span class="built_in">memset</span>(Src, <span class="number">0</span>, <span class="keyword">sizeof</span>(Src));</span><br><span class="line">  sub_401DD0((<span class="type">int</span>)Src);</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">  sub_401210(Src, <span class="number">0x10u</span>, (<span class="type">int</span>)Str, v4);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v4; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[i] != cipher[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Spacetime turbulence is detected, and rescue fails!\n&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Congratulations on rescuing Liv and successfully protecting the world!\n&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看src的初始化函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">sub_151DD0</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">__time64_t</span> v1; <span class="comment">// rax</span></span><br><span class="line">  HANDLE CurrentProcess; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+8h] [ebp-20h]</span></span><br><span class="line">  <span class="type">__time64_t</span> Time; <span class="comment">// [esp+Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  BOOL pbDebuggerPresent; <span class="comment">// [esp+14h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">int</span> Src[<span class="number">3</span>]; <span class="comment">// [esp+18h] [ebp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  LODWORD(v1) = sub_402180(<span class="number">0</span>);</span><br><span class="line">  Time = v1;</span><br><span class="line">  v4 = getlocaltime(&amp;Time);</span><br><span class="line">  <span class="built_in">memset</span>(Src, <span class="number">0</span>, <span class="keyword">sizeof</span>(Src));</span><br><span class="line">  pbDebuggerPresent = <span class="number">0</span>;</span><br><span class="line">  CheckRemoteDebuggerPresent(CurrentProcess, &amp;pbDebuggerPresent);</span><br><span class="line">  <span class="keyword">if</span> ( !pbDebuggerPresent )</span><br><span class="line">    <span class="built_in">memcpy</span>(Src, (<span class="type">const</span> <span class="type">void</span> *)(v4 + <span class="number">12</span>), <span class="keyword">sizeof</span>(Src));</span><br><span class="line">  sub_1521A0(Src, <span class="number">0xCu</span>, a1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + a1) ^= <span class="number">0x14u</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">39</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现有一个反调试，结尾还有一个诡异的return 39，查看汇编后发现藏了典型的call $+5花指令，抹掉后得到正确的函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> __cdecl <span class="title function_">sub_401DD0</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">__time64_t</span> v1; <span class="comment">// rax</span></span><br><span class="line">  HANDLE CurrentProcess; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">tm</span> *<span class="title">v4</span>;</span> <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+4h] [ebp-24h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+8h] [ebp-20h]</span></span><br><span class="line">  <span class="type">__time64_t</span> Time; <span class="comment">// [esp+Ch] [ebp-1Ch] BYREF</span></span><br><span class="line">  BOOL pbDebuggerPresent; <span class="comment">// [esp+14h] [ebp-14h] BYREF</span></span><br><span class="line">  <span class="type">int</span> Src[<span class="number">3</span>]; <span class="comment">// [esp+18h] [ebp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  Time = time64_(<span class="number">0</span>);</span><br><span class="line">  v3 = localtime64_(&amp;Time);</span><br><span class="line">  <span class="built_in">memset</span>(Src, <span class="number">0</span>, <span class="keyword">sizeof</span>(Src));</span><br><span class="line">  pbDebuggerPresent = <span class="number">0</span>;</span><br><span class="line">  CurrentProcess = GetCurrentProcess();</span><br><span class="line">  CheckRemoteDebuggerPresent(CurrentProcess, &amp;pbDebuggerPresent);</span><br><span class="line">  <span class="keyword">if</span> ( !pbDebuggerPresent )</span><br><span class="line">    <span class="built_in">memcpy</span>(Src, &amp;v4-&gt;tm_mday, <span class="keyword">sizeof</span>(Src)); <span class="comment">//时间函数，这里只有12字节（日月年），其中年份为2024，其他需要爆破</span></span><br><span class="line">  result = sub_4021A0(Src, <span class="number">0xCu</span>, a1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">16</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = (*(<span class="type">unsigned</span> __int8 *)(i + a1) ^ <span class="number">0x114</span>) &amp; <span class="number">0x800000FF</span>;</span><br><span class="line">    *(_BYTE *)(i + a1) ^= <span class="number">0x14u</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">16</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    result = j + a1;</span><br><span class="line">    *(_BYTE *)(j + a1) ^= <span class="number">0x11u</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>查看其中的sub函数，发现是16字节md5哈希，则这里的用意是选取2024年某月某日的系统时间表达中的日、月、年三个dword，对其求16字节md5哈希，并异或0x14和0x11之后返回（生成密钥），接着看加密函数，发现加密函数也有花指令，去掉之后发现是一个魔改的AES-ECB并在结尾多判定是否要额外异或一个0x11，这个值由之前对于Ntdll的是否处于调试模式的判断生成，非调试模式下为0，不会额外异或0x11，至于魔改，则是在加密前对密钥和明文进行了预处理，将密钥相邻字节交换并异或0x5（将刚才的异或0x14和0x11抵消），明文则逆序交换字节并异或0xF，加密完成后又对密文进行了相邻字节交换和异或0x5，编写同构加密脚本验证发现结果相符，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_operations</span>(<span class="params">cipher_text</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher_text)//<span class="number">2</span>):</span><br><span class="line">        temp = cipher_text[<span class="number">2</span>*i] ^ <span class="number">0x5</span></span><br><span class="line">        cipher_text[<span class="number">2</span>*i] = cipher_text[<span class="number">2</span>*i+<span class="number">1</span>] ^ <span class="number">0x5</span></span><br><span class="line">        cipher_text[<span class="number">2</span>*i+<span class="number">1</span>] = temp</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt_and_reverse_aes_ecb</span>(<span class="params">cipher_text, key</span>):</span><br><span class="line">    cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">    plain_text = <span class="built_in">bytearray</span>(cipher.decrypt(cipher_text))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        temp1 = plain_text[i] ^ <span class="number">0xF</span></span><br><span class="line">        temp2 = plain_text[<span class="number">16</span>+i] ^ <span class="number">0xF</span></span><br><span class="line">        plain_text[i] = plain_text[<span class="number">15</span>-i] ^ <span class="number">0xF</span></span><br><span class="line">        plain_text[<span class="number">16</span>+i] = plain_text[<span class="number">31</span>-i] ^ <span class="number">0xF</span></span><br><span class="line">        plain_text[<span class="number">15</span>-i] = temp1</span><br><span class="line">        plain_text[<span class="number">31</span>-i] = temp2</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> plain_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_key_and_decrypt</span>(<span class="params">cipher_text, tm_year</span>):</span><br><span class="line">    <span class="keyword">for</span> day <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">32</span>):  <span class="comment"># 日范围为1到31</span></span><br><span class="line">        <span class="keyword">for</span> tm_mon <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">13</span>):  <span class="comment"># 月范围为1到12</span></span><br><span class="line">            src = (day.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>) + tm_mon.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>) + tm_year.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">            key = <span class="built_in">bytearray</span>(hashlib.md5(src).digest())</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(key)//<span class="number">2</span>):</span><br><span class="line">                temp = key[<span class="number">2</span>*i+<span class="number">1</span>]</span><br><span class="line">                key[<span class="number">2</span>*i+<span class="number">1</span>] = key[<span class="number">2</span>*i]</span><br><span class="line">                key[<span class="number">2</span>*i] = temp</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                reversed_cipher_text = reverse_operations(<span class="built_in">bytearray</span>(cipher_text))</span><br><span class="line">                decrypted = decrypt_and_reverse_aes_ecb(reversed_cipher_text, key)</span><br><span class="line">                <span class="keyword">if</span> decrypted.decode()[:<span class="number">6</span>] == <span class="string">&quot;NSSCTF&quot;</span>:</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">f&quot;Match time found: Day=<span class="subst">&#123;day&#125;</span>, Month=<span class="subst">&#123;tm_mon&#125;</span>&quot;</span>)</span><br><span class="line">                    <span class="built_in">print</span>(<span class="string">&quot;Decrypted text:&quot;</span>, decrypted.decode())</span><br><span class="line">                    exit(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">cipher_text = <span class="built_in">bytearray</span>(<span class="string">b&#x27;\xcd\x16\xdb\xb5\xd1\x02\xa4\x82\x8e\x59\x73\x9e\x96\x26\x56\xf2\x16\x8e\x46\xf2\x55\x7b\x92\x31\x30\xdc\xaa\x8a\xf3\x1c\xa0\xaa&#x27;</span>) </span><br><span class="line">tm_year = <span class="number">124</span></span><br><span class="line"></span><br><span class="line">find_key_and_decrypt(cipher_text, tm_year)</span><br></pre></td></tr></table></figure>
<p>运行输出flag：<font color=deepskyblue><strong>NSSCTF{W0w_Y0u’re_@n_AE5_M@5t3r}</strong></font>.</p>
<h2 id="Room-0："><a href="#Room-0：" class="headerlink" title="Room 0："></a>Room 0：</h2><p>题目提示了除以零的异常和SMC，发现程序字节码最上端有一个.enc字段，猜测是SMC，再往下还有一个无法反编译的区域，发现有花指令，抹除后发现是SMC的解密函数，先查看main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+2Ch] [ebp-220h]</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">256</span>]; <span class="comment">// [esp+30h] [ebp-21Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">256</span>]; <span class="comment">// [esp+130h] [ebp-11Ch] BYREF</span></span><br><span class="line">  CPPEH_RECORD ms_exc; <span class="comment">// [esp+234h] [ebp-18h]</span></span><br><span class="line"></span><br><span class="line">  ms_exc.registration.TryLevel = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome to the hostel!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Please input your informatioin to enter your room.\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your flag:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(Str, <span class="number">0</span>, <span class="keyword">sizeof</span>(Str));</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>)Str);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Input your Key:&quot;</span>);</span><br><span class="line">  <span class="built_in">memset</span>(v5, <span class="number">0</span>, <span class="keyword">sizeof</span>(v5));</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>, (<span class="type">char</span>)v5);</span><br><span class="line">  <span class="keyword">if</span> ( KeyGen (v5) != <span class="number">0x11451419</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Not the key.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  RC4encrypt (Str, <span class="number">0x11451419</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( Str[i] != (<span class="type">unsigned</span> __int8)cipher[i] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Your flag is incorrect.\n&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Welcome into your room\n&quot;</span>);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现要输入key和flag，查看key是如何被加密的：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">KeyGen</span><span class="params">(<span class="type">char</span> *Str)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// [esp+0h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+4h] [ebp-18h]</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+8h] [ebp-14h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+Ch] [ebp-10h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+10h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+10h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v8; <span class="comment">// [esp+14h] [ebp-8h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+18h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  v2 = toInt(Str); <span class="comment">//这里是把输入的内容转换成一个32位int</span></span><br><span class="line">  <span class="keyword">if</span> ( !v2 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  v9 = v2; <span class="comment">//整个int（比如0x12345678）</span></span><br><span class="line">  v8 = HIBYTE(v2); <span class="comment">//最高字节（0x12）</span></span><br><span class="line">  v5 = BYTE2(v2); <span class="comment">//第二字节（0x34）</span></span><br><span class="line">  v4 = BYTE1(v2); <span class="comment">//第三字节（0x56）</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">32</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = v6 * (v8 + <span class="number">0x5464A178</span>) * (v9 - <span class="number">0x57780FDF</span>) * ((v8 - v9) ^ (v8 &gt;&gt; <span class="number">4</span>));</span><br><span class="line">    v5 = (v9 + v5) ^ (<span class="number">8</span> * v4);</span><br><span class="line">    v4 = (v9 + v8) ^ (<span class="number">8</span> * v5);</span><br><span class="line">    v8 = (v9 + v4) ^ (<span class="number">8</span> * v5);</span><br><span class="line">    v9 -= v4 + v5 + v8;</span><br><span class="line">    v6 = v7 + (v8 + <span class="number">0x57780FDF</span>) * (((v8 - v9) ^ (<span class="type">unsigned</span> __int64)(v8 &gt;&gt; <span class="number">4</span>)) / (<span class="type">unsigned</span> <span class="type">int</span>)(v9 - <span class="number">0x5464A178</span>)); <span class="comment">//这里有可能触发除零异常</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v9 ^ v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这貌似是一个单向函数，而且后文加密的时候并不需要用到key的值，所以直接在判定处进行patch，抹掉判定继续执行，发现下方的加密函数是对密文进行了密钥为0x11451419（32位int按小端序转4字节为[0x19, 0x14, 0x45, 0x11]），但对密文直接解密发现是fakeflag，说明刚才的SMC和异常处理应该也派上了用场，仔细查看main，发现有一个except分支，但是没有见到能触发的地方，调试过程中偶然发现特殊情况下跳转到了这个分支，仔细查看发现在KeyGen里面有一个div ecx，猜测若密钥正常，这一步应该是除以0 (对应上文v9 - 0x5464A178 &#x3D; 0)，动态调试到这一步直接修改ecx的值，触发除零异常，进入except分支，首先又调用了toint，然后进入了SMC函数，将SMC后的enc区段进行修改，观察发现enc区段末尾有大量重复的0xD3 0x75 0x5F 0xF0（真正的key是这四个字节的其中一种小端序顺序组合：755ff0d3），推测这里要循环异或这四个字节（也对应之前的32位int），编写idapython脚本让地址00401017开始的1513字节循环异或：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ida_bytes</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cyclic_xor</span>(<span class="params">start_addr, data_len, xor_key</span>):</span><br><span class="line">    data = ida_bytes.get_bytes(start_addr, data_len)</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;错误：无法读取地址 0x<span class="subst">&#123;start_addr:X&#125;</span> 处的 <span class="subst">&#123;data_len&#125;</span> 字节&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    data_list = <span class="built_in">bytearray</span>(data)</span><br><span class="line">    key_length = <span class="built_in">len</span>(xor_key)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(data_len):</span><br><span class="line">        key_index = i % key_length</span><br><span class="line">        data_list[i] ^= xor_key[key_index]</span><br><span class="line">    success = ida_bytes.patch_bytes(start_addr, <span class="built_in">bytes</span>(data_list))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> success:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：写入数据失败&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    idc.analyze_area(start_addr, start_addr + data_len)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;异或操作完成&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">start_addr = <span class="number">0x00401017</span></span><br><span class="line">data_len = <span class="number">1513</span></span><br><span class="line">xor_key = [<span class="number">0xD3</span>, <span class="number">0x75</span>, <span class="number">0x5F</span>, <span class="number">0xF0</span>]</span><br><span class="line">cyclic_xor(start_addr, data_len, xor_key)</span><br></pre></td></tr></table></figure>
<p>动态调试&#x2F;汇编异或后的结果，发现有很多花指令，去除后反编译：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl __noreturn <span class="title function_">sub_401000</span><span class="params">(<span class="type">char</span> *Str, <span class="type">unsigned</span> <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// [esp+0h] [ebp-240h]</span></span><br><span class="line">  <span class="type">size_t</span> v3; <span class="comment">// [esp+Ch] [ebp-234h]</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+10h] [ebp-230h]</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+14h] [ebp-22Ch]</span></span><br><span class="line">  <span class="type">int</span> ii; <span class="comment">// [esp+18h] [ebp-228h]</span></span><br><span class="line">  <span class="type">size_t</span> n; <span class="comment">// [esp+1Ch] [ebp-224h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [esp+20h] [ebp-220h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [esp+24h] [ebp-21Ch]</span></span><br><span class="line">  <span class="type">int</span> m; <span class="comment">// [esp+28h] [ebp-218h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+2Ch] [ebp-214h]</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// [esp+30h] [ebp-210h]</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// [esp+31h] [ebp-20Fh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v14; <span class="comment">// [esp+32h] [ebp-20Eh]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v15; <span class="comment">// [esp+33h] [ebp-20Dh]</span></span><br><span class="line">  <span class="type">char</span> v16[<span class="number">256</span>]; <span class="comment">// [esp+34h] [ebp-20Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> v17[<span class="number">256</span>]; <span class="comment">// [esp+134h] [ebp-10Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> v18[<span class="number">2</span>]; <span class="comment">// [esp+234h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v18[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">  v18[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(v17, <span class="number">0</span>, <span class="keyword">sizeof</span>(v17));</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= <span class="number">4</span> )</span><br><span class="line">      v4 = <span class="number">7</span> - i;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v4 = i;</span><br><span class="line">    *((_BYTE *)v18 + i) = a2 &gt;&gt; (<span class="number">8</span> * v4);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">256</span>; ++j )</span><br><span class="line">    v17[j] = j;</span><br><span class="line">  <span class="built_in">memset</span>(v16, <span class="number">0</span>, <span class="keyword">sizeof</span>(v16));</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; <span class="number">256</span>; ++k )</span><br><span class="line">    v16[k] = *((_BYTE *)v18 + k % <span class="number">8</span>);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( m = <span class="number">0</span>; m &lt; <span class="number">256</span>; ++m )</span><br><span class="line">  &#123;</span><br><span class="line">    v5 = ((<span class="type">unsigned</span> __int8)v16[m] + v5 + (<span class="type">unsigned</span> __int8)v17[m]) % <span class="number">256</span>;</span><br><span class="line">    v13 = v17[m];</span><br><span class="line">    v17[m] = v17[v5];</span><br><span class="line">    v17[v5] = v13;</span><br><span class="line">  &#125;</span><br><span class="line">  v15 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(Str);</span><br><span class="line">  <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt; v3; ++n )</span><br><span class="line">  &#123;</span><br><span class="line">    v14 += v17[++v15];</span><br><span class="line">    v12 = v17[v15];</span><br><span class="line">    v17[v15] = v17[v14];</span><br><span class="line">    v17[v14] = v12;</span><br><span class="line">    Str[n] ^= *((_BYTE *)v18 + (v15 &amp; <span class="number">7</span>)) ^ v17[((<span class="type">unsigned</span> __int8)v17[v14] + (<span class="type">unsigned</span> __int8)v17[v15]) % <span class="number">256</span>];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt; <span class="number">32</span>; ++ii )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( byte_405020[ii] != Str[ii] )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_4028C0(<span class="string">&quot;You shouldn&#x27;t come here, get out of that room!\n&quot;</span>, v2);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  sub_4028C0(<span class="string">&quot;Welcome to Room-0.\n&quot;</span>, v2);</span><br><span class="line">  system(<span class="string">&quot;pause&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现是一个魔改RC4，在PRGA阶段不仅使用了S盒生成的密钥流，还额外使用了 v18 中的一个字节（通过 (v15 &amp; 7) 来索引），密钥是刚才的4字节的正反（8字节），动态调试得到密钥<font color=lime><strong>[0xD4, 0x35, 0x6D, 0xF8, 0xF8, 0x6D, 0x35, 0xD4]</strong></font>，密文也变了，编写脚本解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_modified_encrypt</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    K = key * (<span class="number">256</span> // <span class="built_in">len</span>(key))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + K[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    output = <span class="built_in">bytearray</span>()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> plaintext:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        t = (S[i] + S[j]) % <span class="number">256</span></span><br><span class="line">        prga_output = S[t]</span><br><span class="line">        modified_byte = byte ^ prga_output ^ key[i % <span class="built_in">len</span>(key)]</span><br><span class="line">        output.append(modified_byte)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(output)</span><br><span class="line">key = [<span class="number">0xD4</span>, <span class="number">0x35</span>, <span class="number">0x6D</span>, <span class="number">0xF8</span>, <span class="number">0xF8</span>, <span class="number">0x6D</span>, <span class="number">0x35</span>, <span class="number">0xD4</span>]</span><br><span class="line">plaintext = <span class="string">b&quot;\x22\xc4\xa0\x5a\xde\xed\x62\x5e\x25\xe2\x6d\xa6\x05\xa7\x20\x8d\x7d\x99\x52\x3e\x8c\xa7\x7f\xfa\x09\xd8\x62\xdb\x00\x80\xc2\xa9&quot;</span></span><br><span class="line"></span><br><span class="line">ciphertext = rc4_modified_encrypt(plaintext, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Ciphertext: <span class="subst">&#123;ciphertext&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>运行得到flag：<font color=deepskyblue><strong>NSSCTF{Int3r3st1ng_5MC_Pr0gr@m?}</strong></font>.</p>
<h2 id="Canon："><a href="#Canon：" class="headerlink" title="Canon："></a>Canon：</h2><p>观察main：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+20h] [rbp-1F8h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+24h] [rbp-1F4h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [rsp+28h] [rbp-1F0h]</span></span><br><span class="line">  <span class="type">int</span> v7[<span class="number">4</span>]; <span class="comment">// [rsp+30h] [rbp-1E8h]</span></span><br><span class="line">  __int64 v8; <span class="comment">// [rsp+40h] [rbp-1D8h]</span></span><br><span class="line">  __int64 v9; <span class="comment">// [rsp+48h] [rbp-1D0h]</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+50h] [rbp-1C8h]</span></span><br><span class="line">  <span class="type">int</span> v11[<span class="number">8</span>]; <span class="comment">// [rsp+58h] [rbp-1C0h]</span></span><br><span class="line">  <span class="type">int</span> v12[<span class="number">4</span>]; <span class="comment">// [rsp+78h] [rbp-1A0h]</span></span><br><span class="line">  <span class="type">char</span> Str[<span class="number">12</span>]; <span class="comment">// [rsp+88h] [rbp-190h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Source[<span class="number">12</span>]; <span class="comment">// [rsp+94h] [rbp-184h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v15[<span class="number">16</span>]; <span class="comment">// [rsp+A0h] [rbp-178h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Destination[<span class="number">112</span>]; <span class="comment">// [rsp+B0h] [rbp-168h] BYREF</span></span><br><span class="line">  <span class="type">char</span> Str1[<span class="number">112</span>]; <span class="comment">// [rsp+120h] [rbp-F8h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v18[<span class="number">112</span>]; <span class="comment">// [rsp+190h] [rbp-88h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the flag: &quot;</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%36s&quot;</span>, Str);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(Str) == <span class="number">36</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">strncpy</span>(Part1, Str, <span class="number">0xCu</span>i64);</span><br><span class="line">    v8 = <span class="number">12</span>i64;</span><br><span class="line">    Part1[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">strncpy</span>(Part2, Source, <span class="number">0xCu</span>i64);</span><br><span class="line">    v9 = <span class="number">12</span>i64;</span><br><span class="line">    Part2[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">strncpy</span>(Part3, v15, <span class="number">0xCu</span>i64);</span><br><span class="line">    v10 = <span class="number">12</span>i64;</span><br><span class="line">    v18[<span class="number">12</span>] = <span class="number">0</span>;</span><br><span class="line">    v11[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    v11[<span class="number">1</span>] = <span class="number">5</span>;</span><br><span class="line">    v11[<span class="number">2</span>] = <span class="number">6</span>;</span><br><span class="line">    v11[<span class="number">3</span>] = <span class="number">3</span>;</span><br><span class="line">    v11[<span class="number">4</span>] = <span class="number">4</span>;</span><br><span class="line">    v11[<span class="number">5</span>] = <span class="number">1</span>;</span><br><span class="line">    v11[<span class="number">6</span>] = <span class="number">4</span>;</span><br><span class="line">    v11[<span class="number">7</span>] = <span class="number">5</span>;</span><br><span class="line">    v12[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    v12[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">    v12[<span class="number">2</span>] = <span class="number">2</span>;</span><br><span class="line">    v7[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    v7[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    v7[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">3</span>; ++j )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( i &gt;= v12[j] )</span><br><span class="line">        &#123;</span><br><span class="line">          v6 = v7[j];</span><br><span class="line">          <span class="keyword">if</span> ( v6 &lt; <span class="number">8</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( j )</span><br><span class="line">            &#123;</span><br><span class="line">              <span class="keyword">if</span> ( j == <span class="number">1</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                sub_1400015D0(Str1, v18, v11[v6]);</span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">else</span> <span class="keyword">if</span> ( j == <span class="number">2</span> )</span><br><span class="line">              &#123;</span><br><span class="line">                sub_1400015D0(v18, Destination, v11[v6]);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">              sub_1400015D0(Destination, Str1, v11[v6]);</span><br><span class="line">            &#125;</span><br><span class="line">            ++v7[j];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(Destination, <span class="string">&quot;WgvDmssEvcY326bHo3nNro3vXvvfmgrz&quot;</span>)</span><br><span class="line">      &amp;&amp; !<span class="built_in">strcmp</span>(Str1, <span class="string">&quot;gX+Ri9PG=bt5=00B6hscPQOL&quot;</span>)</span><br><span class="line">      &amp;&amp; !<span class="built_in">strcmp</span>(v18, <span class="string">&quot;T6bHgUPL2gXUd=xT=FNHtPzV&quot;</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Congratulations! You have found the flag!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;Invalid flag!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Invalid flag!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这里把输入拆成了三部分，且有一个嵌套循环，把循环改成print编写C++脚本跑一遍得到加密顺序：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Part1, Part2, 1</span><br><span class="line">Part1, Part2, 5</span><br><span class="line">Part2, Part3, 1</span><br><span class="line">Part1, Part2, 6</span><br><span class="line">Part2, Part3, 5</span><br><span class="line">Part3, Part1, 1</span><br><span class="line">Part1, Part2, 3</span><br><span class="line">Part2, Part3, 6</span><br><span class="line">Part3, Part1, 5</span><br><span class="line">Part1, Part2, 4</span><br><span class="line">Part2, Part3, 3</span><br><span class="line">Part3, Part1, 6</span><br><span class="line">Part1, Part2, 1</span><br><span class="line">Part2, Part3, 4</span><br><span class="line">Part3, Part1, 3</span><br><span class="line">Part1, Part2, 4</span><br><span class="line">Part2, Part3, 1</span><br><span class="line">Part3, Part1, 4</span><br><span class="line">Part1, Part2, 5</span><br><span class="line">Part2, Part3, 4</span><br><span class="line">Part3, Part1, 1</span><br></pre></td></tr></table></figure>
<p>查看这个加密函数：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_1400015D0</span><span class="params">(<span class="type">char</span> *a1, <span class="type">const</span> <span class="type">char</span> *a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  v9 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">  v21 = <span class="built_in">strlen</span>(a2);</span><br><span class="line">  <span class="keyword">switch</span> ( a3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: <span class="comment">//字母数字变换</span></span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v9; ++i )</span><br><span class="line">      &#123;</span><br><span class="line">        v22 = a2[i % v21];</span><br><span class="line">        <span class="keyword">if</span> ( a1[i] &lt; <span class="number">65</span> || a1[i] &gt; <span class="number">90</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( a1[i] &lt; <span class="number">97</span> || a1[i] &gt; <span class="number">122</span> )</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="keyword">if</span> ( a1[i] &gt;= <span class="number">48</span> &amp;&amp; a1[i] &lt;= <span class="number">57</span> )</span><br><span class="line">              a1[i] = (a1[i] + v22 - <span class="number">48</span>) % <span class="number">10</span> + <span class="number">48</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">else</span></span><br><span class="line">          &#123;</span><br><span class="line">            a1[i] = (a1[i] + v22 - <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          a1[i] = (a1[i] + v22 - <span class="number">65</span>) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      v32[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">      v32[<span class="number">1</span>] = <span class="number">3</span>;</span><br><span class="line">      v32[<span class="number">2</span>] = <span class="number">5</span>;</span><br><span class="line">      v32[<span class="number">3</span>] = <span class="number">7</span>;</span><br><span class="line">      v32[<span class="number">4</span>] = <span class="number">9</span>;</span><br><span class="line">      v32[<span class="number">5</span>] = <span class="number">11</span>;</span><br><span class="line">      v32[<span class="number">6</span>] = <span class="number">15</span>;</span><br><span class="line">      v32[<span class="number">7</span>] = <span class="number">17</span>;</span><br><span class="line">      v32[<span class="number">8</span>] = <span class="number">19</span>;</span><br><span class="line">      v32[<span class="number">9</span>] = <span class="number">21</span>;</span><br><span class="line">      v32[<span class="number">10</span>] = <span class="number">23</span>;</span><br><span class="line">      v32[<span class="number">11</span>] = <span class="number">25</span>;</span><br><span class="line">      <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; v9; ++j )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( a1[j] &lt; <span class="number">65</span> || a1[j] &gt; <span class="number">90</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( a1[j] &gt;= <span class="number">97</span> &amp;&amp; a1[j] &lt;= <span class="number">122</span> )</span><br><span class="line">            a1[j] = (a2[j % v21] + v32[j % <span class="number">12</span>] * (a1[j] - <span class="number">97</span>)) % <span class="number">26</span> + <span class="number">97</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">          a1[j] = (a2[j % v21] + v32[j % <span class="number">12</span>] * (a1[j] - <span class="number">65</span>)) % <span class="number">26</span> + <span class="number">65</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: <span class="comment">//换序</span></span><br><span class="line">      v10 = *a2 % <span class="number">10</span> + <span class="number">2</span>;</span><br><span class="line">      v33 = v10;</span><br><span class="line">      Block = <span class="built_in">malloc</span>(saturated_mul(v10, <span class="number">8u</span>i64));</span><br><span class="line">      <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt; v10; ++k )</span><br><span class="line">      &#123;</span><br><span class="line">        Block[k] = <span class="built_in">malloc</span>(v9 + <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">memset</span>((<span class="type">void</span> *)Block[k], <span class="number">0</span>, v9 + <span class="number">1</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">for</span> ( m = <span class="number">0</span>; v10 * m &lt; v9; ++m )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">for</span> ( n = <span class="number">0</span>; n &lt; v10 &amp;&amp; n + v10 * m &lt; v9; ++n )</span><br><span class="line">          *(_BYTE *)(Block[n] + m) = a1[n + v10 * m];</span><br><span class="line">      &#125;</span><br><span class="line">      v18 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> ( ii = <span class="number">0</span>; ii &lt; v10; ++ii )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">for</span> ( jj = <span class="number">0</span>; jj &lt; m; ++jj )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">if</span> ( *(_BYTE *)(Block[ii] + jj) &amp;&amp; v18 &lt; v9 )</span><br><span class="line">            a1[v18++] = *(_BYTE *)(Block[ii] + jj);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      a1[v18] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">for</span> ( kk = <span class="number">0</span>; kk &lt; v10; ++kk )</span><br><span class="line">        <span class="built_in">free</span>((<span class="type">void</span> *)Block[kk]);</span><br><span class="line">      <span class="built_in">free</span>(Block);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: <span class="comment">//也是换序</span></span><br><span class="line">      v25 = *a2 % <span class="number">10</span> + <span class="number">2</span>;</span><br><span class="line">      <span class="keyword">for</span> ( mm = <span class="number">0</span>; mm &lt; v25; ++mm )</span><br><span class="line">      &#123;</span><br><span class="line">        v11 = a1[v9 - <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> ( nn = v9 - <span class="number">1</span>; nn &gt; <span class="number">0</span>; --nn )</span><br><span class="line">          a1[nn] = a1[nn - <span class="number">1</span>];</span><br><span class="line">        *a1 = v11;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: <span class="comment">//异或和换了表的base64（stuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqr）</span></span><br><span class="line">      v34 = v9;</span><br><span class="line">      v26 = <span class="built_in">malloc</span>(saturated_mul(v9, <span class="number">4u</span>i64));</span><br><span class="line">      <span class="keyword">for</span> ( i1 = <span class="number">0</span>; i1 &lt; v9; ++i1 )</span><br><span class="line">        v26[i1] = (a2[i1 % v21] + <span class="number">57</span>) ^ a1[i1];</span><br><span class="line">      Source = (<span class="type">char</span> *)sub_140001470(v26, (<span class="type">unsigned</span> <span class="type">int</span>)v9);</span><br><span class="line">      <span class="built_in">strcpy</span>(a1, Source);</span><br><span class="line">      <span class="built_in">free</span>(v26);</span><br><span class="line">      <span class="built_in">free</span>(Source);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: <span class="comment">//魔改RC4（额外加57）和换表base64</span></span><br><span class="line">      v3 = saturated_mul(<span class="built_in">strlen</span>(a1), <span class="number">4u</span>i64);</span><br><span class="line">      v27 = <span class="built_in">malloc</span>(v3);</span><br><span class="line">      RC4((__int64)a1, a2, (__int64)v27);</span><br><span class="line">      v4 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">      v30 = (<span class="type">char</span> *)sub_140001470(v27, v4);</span><br><span class="line">      <span class="built_in">strcpy</span>(a1, v30);</span><br><span class="line">      <span class="built_in">free</span>(v27);</span><br><span class="line">      <span class="built_in">free</span>(v30);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">      v5 = saturated_mul(<span class="built_in">strlen</span>(a1), <span class="number">4u</span>i64);</span><br><span class="line">      v28 = <span class="built_in">malloc</span>(v5);</span><br><span class="line">      RC4_xor39(a1, a2, v28);</span><br><span class="line">      v6 = <span class="built_in">strlen</span>(a1);</span><br><span class="line">      v31 = (<span class="type">char</span> *)sub_140001470(v28, v6);</span><br><span class="line">      <span class="built_in">strcpy</span>(a1, v31);</span><br><span class="line">      <span class="built_in">free</span>(v28);</span><br><span class="line">      <span class="built_in">free</span>(v31);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现里面一共有7种加密逻辑，但是不是每种都用上了，编写同构加密脚本，运行发现结果相同，进行解密：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="comment"># case1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case1_enc</span>(<span class="params">a1: <span class="built_in">str</span>, a2: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    encrypted = <span class="built_in">list</span>(a1)</span><br><span class="line">    len_a1 = <span class="built_in">len</span>(a1)</span><br><span class="line">    len_a2 = <span class="built_in">len</span>(a2)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(len_a1):</span><br><span class="line">        key_char = <span class="built_in">ord</span>(a2[i % len_a2])</span><br><span class="line">        current_char = <span class="built_in">ord</span>(encrypted[i])</span><br><span class="line">        <span class="keyword">if</span> <span class="number">65</span> &lt;= current_char &lt;= <span class="number">90</span>:</span><br><span class="line">            encrypted[i] = <span class="built_in">chr</span>( (current_char + key_char - <span class="number">65</span>) % <span class="number">26</span> + <span class="number">65</span> )</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">97</span> &lt;= current_char &lt;= <span class="number">122</span>:</span><br><span class="line">            encrypted[i] = <span class="built_in">chr</span>( (current_char + key_char - <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span> )</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">48</span> &lt;= current_char &lt;= <span class="number">57</span>:</span><br><span class="line">            encrypted[i] = <span class="built_in">chr</span>( (current_char + key_char - <span class="number">48</span>) % <span class="number">10</span> + <span class="number">48</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(encrypted)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case1_dec</span>(<span class="params">encrypted_str: <span class="built_in">str</span>, a2: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    decrypted = <span class="built_in">list</span>(encrypted_str)</span><br><span class="line">    len_str = <span class="built_in">len</span>(encrypted_str)</span><br><span class="line">    len_a2 = <span class="built_in">len</span>(a2)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(len_str):</span><br><span class="line">        key_char = <span class="built_in">ord</span>(a2[i % len_a2])</span><br><span class="line">        current_char = <span class="built_in">ord</span>(decrypted[i])</span><br><span class="line">        <span class="keyword">if</span> <span class="number">65</span> &lt;= current_char &lt;= <span class="number">90</span>:</span><br><span class="line">            decrypted[i] = <span class="built_in">chr</span>( (current_char - key_char - <span class="number">65</span>) % <span class="number">26</span> + <span class="number">65</span> )</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">97</span> &lt;= current_char &lt;= <span class="number">122</span>:</span><br><span class="line">            decrypted[i] = <span class="built_in">chr</span>( (current_char - key_char - <span class="number">97</span>) % <span class="number">26</span> + <span class="number">97</span> )</span><br><span class="line">        <span class="keyword">elif</span> <span class="number">48</span> &lt;= current_char &lt;= <span class="number">57</span>:</span><br><span class="line">            decrypted[i] = <span class="built_in">chr</span>( (current_char - key_char - <span class="number">48</span>) % <span class="number">10</span> + <span class="number">48</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(decrypted)</span><br><span class="line"></span><br><span class="line"><span class="comment"># case3</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case3_enc</span>(<span class="params">plaintext: <span class="built_in">str</span>, key: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    cols = (<span class="built_in">ord</span>(key[<span class="number">0</span>]) % <span class="number">10</span>) + <span class="number">2</span></span><br><span class="line">    length = <span class="built_in">len</span>(plaintext)</span><br><span class="line">    columns = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(cols)]</span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>((length + cols - <span class="number">1</span>) // cols): </span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(cols):</span><br><span class="line">            idx = n + cols * m</span><br><span class="line">            <span class="keyword">if</span> idx &lt; length:</span><br><span class="line">                columns[n].append(plaintext[idx])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;&#x27;</span>.join(col) <span class="keyword">for</span> col <span class="keyword">in</span> columns)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case3_dec</span>(<span class="params">ciphertext: <span class="built_in">str</span>, key: <span class="built_in">str</span></span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">    cols = (<span class="built_in">ord</span>(key[<span class="number">0</span>]) % <span class="number">10</span>) + <span class="number">2</span></span><br><span class="line">    length = <span class="built_in">len</span>(ciphertext)</span><br><span class="line">    rows_per_col = [(length - n + cols - <span class="number">1</span>) // cols <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(cols)]</span><br><span class="line">    columns = []</span><br><span class="line">    start = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(cols):</span><br><span class="line">        end = start + rows_per_col[n]</span><br><span class="line">        columns.append(<span class="built_in">list</span>(ciphertext[start:end]))</span><br><span class="line">        start = end</span><br><span class="line">    original = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(length):</span><br><span class="line">        col_idx = i % cols</span><br><span class="line">        row_idx = i // cols</span><br><span class="line">        original.append(columns[col_idx][row_idx])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(original)</span><br><span class="line"></span><br><span class="line"><span class="comment"># case4</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case4_enc</span>(<span class="params">input_str, a2</span>):</span><br><span class="line">    v25 = (<span class="built_in">ord</span>(a2[<span class="number">0</span>]) % <span class="number">10</span>) + <span class="number">2</span></span><br><span class="line">    v9 = <span class="built_in">len</span>(input_str)</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(v25):</span><br><span class="line">        last_char = input_list[v9 - <span class="number">1</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(v9 - <span class="number">1</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">            input_list[i] = input_list[i - <span class="number">1</span>]</span><br><span class="line">        input_list[<span class="number">0</span>] = last_char</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case4_dec</span>(<span class="params">input_str, a2</span>):</span><br><span class="line">    v25 = (<span class="built_in">ord</span>(a2[<span class="number">0</span>]) % <span class="number">10</span>) + <span class="number">2</span></span><br><span class="line">    v9 = <span class="built_in">len</span>(input_str)</span><br><span class="line">    input_list = <span class="built_in">list</span>(input_str)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(v25):</span><br><span class="line">        last_char = input_list[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(v9 - <span class="number">1</span>):</span><br><span class="line">            input_list[i] = input_list[i + <span class="number">1</span>]</span><br><span class="line">        input_list[v9 - <span class="number">1</span>] = last_char</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(input_list)</span><br><span class="line"></span><br><span class="line"><span class="comment"># case5</span></span><br><span class="line">CUSTOM_BASE64_TABLE = <span class="string">&quot;stuvwxyz0123456789+/ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqr&quot;</span></span><br><span class="line">STANDARD_BASE64_TABLE = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">TRANSLATION_ENCODE = <span class="built_in">str</span>.maketrans(STANDARD_BASE64_TABLE, CUSTOM_BASE64_TABLE)</span><br><span class="line">TRANSLATION_DECODE = <span class="built_in">str</span>.maketrans(CUSTOM_BASE64_TABLE, STANDARD_BASE64_TABLE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_base64_encode</span>(<span class="params">data</span>):</span><br><span class="line">    encoded = base64.b64encode(data).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> encoded.translate(TRANSLATION_ENCODE)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_base64_decode</span>(<span class="params">encoded_str</span>):</span><br><span class="line">    standard_encoded = encoded_str.translate(TRANSLATION_DECODE)</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(standard_encoded)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case5_enc</span>(<span class="params">input_str, key_str</span>):</span><br><span class="line">    v9 = <span class="built_in">len</span>(input_str)</span><br><span class="line">    v21 = <span class="built_in">len</span>(key_str)</span><br><span class="line">    xor_result = <span class="built_in">bytearray</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(v9):</span><br><span class="line">        xor_char = ((<span class="built_in">ord</span>(key_str[i % v21]) + <span class="number">57</span>) ^ <span class="built_in">ord</span>(input_str[i]))</span><br><span class="line">        xor_result.append(xor_char)</span><br><span class="line">    encoded_result = custom_base64_encode(<span class="built_in">bytes</span>(xor_result))</span><br><span class="line">    <span class="keyword">return</span> encoded_result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case5_dec</span>(<span class="params">encoded_str, key_str</span>):</span><br><span class="line">    decoded_bytes = custom_base64_decode(encoded_str)</span><br><span class="line">    v9 = <span class="built_in">len</span>(decoded_bytes)</span><br><span class="line">    v21 = <span class="built_in">len</span>(key_str)</span><br><span class="line">    original_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(v9):</span><br><span class="line">        original_char = <span class="built_in">chr</span>(((<span class="built_in">ord</span>(key_str[i % v21]) + <span class="number">57</span>) ^ decoded_bytes[i]))</span><br><span class="line">        original_str += original_char</span><br><span class="line">    <span class="keyword">return</span> original_str</span><br><span class="line"></span><br><span class="line"><span class="comment"># case6</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rc4_modified</span>(<span class="params">data, key, output_buffer, decrypt=<span class="literal">False</span></span>):</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> idx, char <span class="keyword">in</span> <span class="built_in">enumerate</span>(data):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        k = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        <span class="keyword">if</span> decrypt:</span><br><span class="line">            output_buffer[idx] = ((char - <span class="number">57</span>) % <span class="number">256</span>) ^ k</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            output_buffer[idx] = ((k ^ char) + <span class="number">57</span>) % <span class="number">256</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case6_enc</span>(<span class="params">input_str, key_str</span>):</span><br><span class="line">    input_bytes = input_str.encode()</span><br><span class="line">    output_buffer = <span class="built_in">bytearray</span>(<span class="built_in">len</span>(input_bytes))</span><br><span class="line">    rc4_modified(input_bytes, key_str, output_buffer)</span><br><span class="line">    encoded_result = custom_base64_encode(output_buffer)</span><br><span class="line">    <span class="keyword">return</span> encoded_result</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">case6_dec</span>(<span class="params">encoded_str, key_str</span>):</span><br><span class="line">    decoded_bytes = custom_base64_decode(encoded_str)</span><br><span class="line">    output_buffer = <span class="built_in">bytearray</span>(<span class="built_in">len</span>(decoded_bytes))</span><br><span class="line">    rc4_modified(decoded_bytes, key_str, output_buffer, decrypt=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">return</span> output_buffer.decode()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试加密</span></span><br><span class="line">message = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz1234567890&quot;</span></span><br><span class="line">part1 = message[:<span class="number">12</span>]</span><br><span class="line">part2 = message[<span class="number">12</span>:<span class="number">24</span>]</span><br><span class="line">part3 = message[<span class="number">24</span>:]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case1_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case5_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part2 = case1_enc(part2, part3)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case6_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part2 = case5_enc(part2, part3)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part3 = case1_enc(part3, part1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case3_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part2 = case6_enc(part2, part3)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part3 = case5_enc(part3, part1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case4_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part2 = case3_enc(part2, part3)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part3 = case6_enc(part3, part1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case1_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part2 = case4_enc(part2, part3)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part3 = case3_enc(part3, part1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case4_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part2 = case1_enc(part2, part3)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part3 = case4_enc(part3, part1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part1 = case5_enc(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part2 = case4_enc(part2, part3)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line">part3 = case1_enc(part3, part1)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;part1: <span class="subst">&#123;part1&#125;</span>, part2: <span class="subst">&#123;part2&#125;</span>, part3: <span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">part1 = <span class="string">&quot;WgvDmssEvcY326bHo3nNro3vXvvfmgrz&quot;</span></span><br><span class="line">part2 = <span class="string">&quot;gX+Ri9PG=bt5=00B6hscPQOL&quot;</span></span><br><span class="line">part3 = <span class="string">&quot;T6bHgUPL2gXUd=xT=FNHtPzV&quot;</span></span><br><span class="line">part3 = case1_dec(part3, part1)</span><br><span class="line">part2 = case4_dec(part2, part3)</span><br><span class="line">part1 = case5_dec(part1, part2)</span><br><span class="line">part3 = case4_dec(part3, part1)</span><br><span class="line">part2 = case1_dec(part2, part3)</span><br><span class="line">part1 = case4_dec(part1, part2)</span><br><span class="line">part3 = case3_dec(part3, part1)</span><br><span class="line">part2 = case4_dec(part2, part3)</span><br><span class="line">part1 = case1_dec(part1, part2)</span><br><span class="line">part3 = case6_dec(part3, part1)</span><br><span class="line">part2 = case3_dec(part2, part3)</span><br><span class="line">part1 = case4_dec(part1, part2)</span><br><span class="line">part3 = case5_dec(part3, part1)</span><br><span class="line">part2 = case6_dec(part2, part3)</span><br><span class="line">part1 = case3_dec(part1, part2)</span><br><span class="line">part3 = case1_dec(part3, part1)</span><br><span class="line">part2 = case5_dec(part2, part3)</span><br><span class="line">part1 = case6_dec(part1, part2)</span><br><span class="line">part2 = case1_dec(part2, part3)</span><br><span class="line">part1 = case5_dec(part1, part2)</span><br><span class="line">part1 = case1_dec(part1, part2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;part1&#125;</span><span class="subst">&#123;part2&#125;</span><span class="subst">&#123;part3&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>运行脚本得到flag：<font color=deepskyblue><strong>NSSCTF{P4ch3Lbel’s_C@n0n_1n_D_mAjOr}</strong></font>.</p>
<h1 id="Crypto方向："><a href="#Crypto方向：" class="headerlink" title="Crypto方向："></a>Crypto方向：</h1><h2 id="MIMT-RSA："><a href="#MIMT-RSA：" class="headerlink" title="MIMT_RSA："></a>MIMT_RSA：</h2><p>编写脚本爆破key：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gmp.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(push)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(disable: 4146 4244)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;gmpxx.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> <span class="keyword">warning</span>(pop)</span></span><br><span class="line"></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">bool</span>&gt; <span class="title">found</span><span class="params">(<span class="literal">false</span>)</span></span>;</span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">uint64_t</span>&gt; <span class="title">total_processed</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">std::mutex cout_mutex;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">uint64_t</span> START_KEY = <span class="number">0b100000000000000000000000000000000000</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">uint64_t</span> END_KEY = <span class="number">0xFFFFFFFFF</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">uint64_t</span> TOTAL_KEYS = END_KEY - START_KEY + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">mpz_class <span class="title">n</span><span class="params">(<span class="string">&quot;26563847822899403123579768059987758748518109506340688366937229057385768563897579939399589878779201509595131302887212371556759550226965583832707699167542469352676806103999861576255689028708092007726895892953065618536676788020023461249303717579266840903337614272894749021562443472322941868357046500507962652585875038973455411548683247853955371839865042918531636085668780924020410159272977805762814306445393524647460775620243065858710021030314398928537847762167177417552351157872682037902372485985979513934517709478252552309280270916202653365726591219198063597536812483568301622917160509027075508471349507817295226801011&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">mpz_class <span class="title">target</span><span class="params">(<span class="string">&quot;8371316287078036479056771367631991220353236851470185127168826270131149168993253524332451231708758763231051593801540258044681874144589595532078353953294719353350061853623495168005196486200144643168051115479293775329183635187974365652867387949378467702492757863040766745765841802577850659614528558282832995416523310220159445712674390202765601817050315773584214422244200409445854102170875265289152628311393710624256106528871400593480435083264403949059237446948467480548680533474642869718029551240453665446328781616706968352290100705279838871524562305806920722372815812982124238074246044446213460443693473663239594932076&quot;</span>)</span></span>;</span><br><span class="line"><span class="type">const</span> <span class="type">uint32_t</span> e = <span class="number">0x10001</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProgressTracker</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::chrono::steady_clock::time_point start_time;</span><br><span class="line">    <span class="type">uint64_t</span> last_count = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> avg_speed = <span class="number">0.0</span>;</span><br><span class="line">    <span class="type">const</span> <span class="type">double</span> alpha = <span class="number">0.2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ProgressTracker</span>() : <span class="built_in">start_time</span>(std::chrono::steady_clock::<span class="built_in">now</span>()) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">uint64_t</span> current)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> now = std::chrono::steady_clock::<span class="built_in">now</span>();</span><br><span class="line">        <span class="type">double</span> elapsed = std::chrono::<span class="built_in">duration</span>&lt;<span class="type">double</span>&gt;(now - start_time).<span class="built_in">count</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (elapsed &gt; <span class="number">0.1</span>) &#123;</span><br><span class="line">            <span class="type">uint64_t</span> delta = current - last_count;</span><br><span class="line">            <span class="type">double</span> instant_speed = delta / elapsed;</span><br><span class="line">            avg_speed = alpha * instant_speed + (<span class="number">1</span> - alpha) * avg_speed;</span><br><span class="line">            </span><br><span class="line">            last_count = current;</span><br><span class="line">            start_time = now;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::pair&lt;<span class="type">double</span>, std::string&gt; <span class="title">get_progress</span><span class="params">(<span class="type">uint64_t</span> done)</span> </span>&#123;</span><br><span class="line">        <span class="type">double</span> progress = std::<span class="built_in">min</span>(<span class="number">100.0</span>, done * <span class="number">100.0</span> / TOTAL_KEYS);</span><br><span class="line">        <span class="type">double</span> remaining = (avg_speed &gt; <span class="number">0</span>) ? (TOTAL_KEYS - done) / avg_speed : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;progress, format_duration(remaining)&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">format_duration</span><span class="params">(<span class="type">double</span> seconds)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (seconds &lt; <span class="number">60</span>) </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">fmt_duration</span>(seconds, <span class="string">&quot;s&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (seconds &lt; <span class="number">3600</span>) </span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">fmt_duration</span>(seconds/<span class="number">60</span>, <span class="string">&quot;m&quot;</span>) + <span class="string">&quot; &quot;</span> + <span class="built_in">fmt_duration</span>(<span class="built_in">fmod</span>(seconds,<span class="number">60</span>), <span class="string">&quot;s&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">fmt_duration</span>(seconds/<span class="number">3600</span>, <span class="string">&quot;h&quot;</span>) + <span class="string">&quot; &quot;</span> </span><br><span class="line">             + <span class="built_in">fmt_duration</span>(<span class="built_in">fmod</span>(seconds,<span class="number">3600</span>)/<span class="number">60</span>, <span class="string">&quot;m&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::string <span class="title">fmt_duration</span><span class="params">(<span class="type">double</span> value, <span class="type">const</span> <span class="type">char</span>* unit)</span> </span>&#123;</span><br><span class="line">        std::stringstream ss;</span><br><span class="line">        ss &lt;&lt; std::fixed &lt;&lt; std::<span class="built_in">setprecision</span>(<span class="number">1</span>) &lt;&lt; value &lt;&lt; unit;</span><br><span class="line">        <span class="keyword">return</span> ss.<span class="built_in">str</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">check_range</span><span class="params">(<span class="type">uint64_t</span> start, <span class="type">uint64_t</span> end)</span> </span>&#123;</span><br><span class="line">    mpz_class result, key;</span><br><span class="line">    <span class="type">const</span> <span class="type">uint64_t</span> batch_size = <span class="number">0x1000</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint64_t</span> k = start; k &lt;= end &amp;&amp; !found; ) &#123;</span><br><span class="line">        <span class="type">uint64_t</span> batch_end = std::<span class="built_in">min</span>(k + batch_size, end);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (; k &lt;= batch_end &amp;&amp; !found; ++k) &#123;</span><br><span class="line">            key = k;</span><br><span class="line">            <span class="built_in">mpz_powm_ui</span>(result.<span class="built_in">get_mpz_t</span>(), key.<span class="built_in">get_mpz_t</span>(), e, n.<span class="built_in">get_mpz_t</span>());</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (result == target) &#123;</span><br><span class="line">                found = <span class="literal">true</span>;</span><br><span class="line">                <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(cout_mutex)</span></span>;</span><br><span class="line">                std::cout &lt;&lt; <span class="string">&quot;\n\nFound key: &quot;</span> &lt;&lt; k &lt;&lt; std::endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        total_processed.<span class="built_in">fetch_add</span>(k - start, std::memory_order_relaxed);</span><br><span class="line">        start = k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">progress_monitor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ProgressTracker tracker;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> bar_width = <span class="number">40</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!found &amp;&amp; total_processed &lt; TOTAL_KEYS) &#123;</span><br><span class="line">        <span class="type">uint64_t</span> done = total_processed.<span class="built_in">load</span>();</span><br><span class="line">        <span class="keyword">auto</span> [progress, eta] = tracker.<span class="built_in">get_progress</span>(done);</span><br><span class="line">        </span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(cout_mutex)</span></span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\r\033[K&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="type">int</span> pos = bar_width * progress / <span class="number">100.0</span>;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;[&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; bar_width; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span>      (i &lt; pos)  std::cout &lt;&lt; <span class="string">&quot;=&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == pos) std::cout &lt;&lt; <span class="string">&quot;&gt;&quot;</span>;</span><br><span class="line">            <span class="keyword">else</span>               std::cout &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;] &quot;</span>;</span><br><span class="line">        </span><br><span class="line">        std::cout &lt;&lt; std::fixed &lt;&lt; std::<span class="built_in">setprecision</span>(<span class="number">2</span>) </span><br><span class="line">                &lt;&lt; std::<span class="built_in">setw</span>(<span class="number">6</span>) &lt;&lt; progress &lt;&lt; <span class="string">&quot;% &quot;</span></span><br><span class="line">                &lt;&lt; <span class="string">&quot;ETA:&quot;</span> &lt;&lt; std::<span class="built_in">setw</span>(<span class="number">8</span>) &lt;&lt; eta</span><br><span class="line">                &lt;&lt; <span class="string">&quot; Keys:&quot;</span> &lt;&lt; std::<span class="built_in">setw</span>(<span class="number">10</span>) &lt;&lt; done &lt;&lt; <span class="string">&quot;/&quot;</span> &lt;&lt; TOTAL_KEYS</span><br><span class="line">                &lt;&lt; std::flush;</span><br><span class="line">        </span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">200</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\r\033[K&quot;</span> &lt;&lt; std::flush;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">unsigned</span> num_threads = std::thread::<span class="built_in">hardware_concurrency</span>();</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line">    <span class="type">uint64_t</span> range = (END_KEY - START_KEY) / num_threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">unsigned</span> i = <span class="number">0</span>; i &lt; num_threads; ++i) &#123;</span><br><span class="line">        <span class="type">uint64_t</span> start = START_KEY + i * range;</span><br><span class="line">        <span class="type">uint64_t</span> end = (i == num_threads - <span class="number">1</span>) ? END_KEY : start + range - <span class="number">1</span>;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(check_range, start, end);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">std::thread <span class="title">monitor</span><span class="params">(progress_monitor)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t : threads) &#123;</span><br><span class="line">        t.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    monitor.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;\nKey not found in the specified range!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>得到key &#x3D; 62495925932，flag为<font color=deepskyblue><strong>NSSCTF{14369380f677abec84ed8b6d0e3a0ba9}</strong></font>.</p>
<h1 id="Misc方向："><a href="#Misc方向：" class="headerlink" title="Misc方向："></a>Misc方向：</h1><h2 id="mybrave："><a href="#mybrave：" class="headerlink" title="mybrave："></a>mybrave：</h2><p>发现压缩包没密码，但里面只有一个png文件，由于png文件头是<code>89504e470d0a1a0a0000000d494844520000</code>，并且加密算法是<code>zipcrypto store</code>，则可以利用明文攻击，用bkcrack破解得到密钥<code>97d30dcc 173b15a8 6e0e7455</code>，解密得到一张png，发现文件尾有东西：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">54 00 6C 00 4E 00 54 00 51 00 31 00 52 00 47 00</span><br><span class="line">65 00 30 00 6B 00 6E 00 62 00 56 00 39 00 58 00</span><br><span class="line">61 00 44 00 46 00 7A 00 63 00 44 00 4E 00 79 00</span><br><span class="line">61 00 55 00 35 00 6E 00 58 00 30 00 39 00 31 00</span><br><span class="line">55 00 6C 00 39 00 4D 00 64 00 54 00 45 00 78 00</span><br><span class="line">59 00 57 00 4A 00 5A 00 58 00 32 00 59 00 77 00</span><br><span class="line">63 00 6C 00 39 00 5A 00 4D 00 48 00 56 00 66 00</span><br><span class="line">64 00 47 00 39 00 66 00 51 00 32 00 39 00 4E 00</span><br><span class="line">5A 00 56 00 39 00 43 00 4E 00 47 00 4E 00 72 00</span><br><span class="line">58 00 30 00 68 00 76 00 62 00 57 00 56 00 39 00</span><br></pre></td></tr></table></figure>
<p>去除其中的00，base64解密得到flag：<font color=deepskyblue><strong>NSSCTF{I’m_Wh1sp3riNg_OuR_Lu11abY_f0r_Y0u_to_CoMe_B4ck_Home}</strong></font>.</p>
<h2 id="mywav："><a href="#mywav：" class="headerlink" title="mywav："></a>mywav：</h2><p>发现该音频全是正弦波，0.1毫秒为一个小节，共有2种音高，一个300多Hz，一个700多Hz，当做二进制的0和1提取音频内容：</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> wavfile</span><br><span class="line"></span><br><span class="line">samplerate, data = wavfile.read(<span class="string">&#x27;E:/CTF/attachment.wav&#x27;</span>)</span><br><span class="line">samples_per_bit = <span class="built_in">int</span>(samplerate * <span class="number">0.010</span>)</span><br><span class="line">fft_size = samples_per_bit</span><br><span class="line">bit_sequence = []</span><br><span class="line">freq_resolution = samplerate / fft_size</span><br><span class="line">threshold_index = <span class="built_in">int</span>(<span class="number">450</span> / freq_resolution)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), samples_per_bit):</span><br><span class="line">    segment = data[i:i+samples_per_bit]</span><br><span class="line">    windowed_segment = segment * np.hanning(<span class="built_in">len</span>(segment))</span><br><span class="line">    freqs = np.fft.rfft(windowed_segment)</span><br><span class="line">    power_spectrum = np.<span class="built_in">abs</span>(freqs)**<span class="number">2</span></span><br><span class="line">    dominant_freq_index = np.argmax(power_spectrum[<span class="number">1</span>:]) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> dominant_freq_index &gt; threshold_index:</span><br><span class="line">        bit_sequence.append(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        bit_sequence.append(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(bit_sequence)):</span><br><span class="line">    <span class="built_in">print</span>(bit_sequence[i],end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<p>输出的内容转换为文本为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">YbAgLvWkQbFp qk k 2021 Gfgbyue gxriobzqgx hpyau utnkxmgz Jpwx Dfcmocn ngj Bn Flvytmc. Gh cu bnlkh hg apw Mlglsmg nbokp Lxjzwdw gl hbg Lnmzmvx. Apw cipgsm ciexj sg Fhvyy XT dfio Ahzawm 10 nubav Eseimv 26, 2021.</span><br><span class="line"></span><br><span class="line">Tux yikbla zkw qsfjcsfxj e vntcdkxgts pkejxxwabw wx 1.3 lmjjwip apkuwl ohzayyq nzuvfbksw, bgjtmnmle Aupgb MB&#x27;w whtmkdma ydjniptzmhg, FwmDyzc, ohf Tutoptgk BjeiGB.</span><br><span class="line"></span><br><span class="line">Gspoclow</span><br><span class="line"></span><br><span class="line">Mal awbmcq hynlf mni lmvzq yj y qijgrvhx egw bvjepw aogruf fgpx zvl Rrss Qwswe (Pakr Salgmkr) ylr u jenwyxkhuo, kdyzzclp, aaw rsoxsg Usrbcfynln zove, Wpvy Hmyl (Lo Oeazpmx). Yywe liglu gwthtrpr xekdewgts ncbyxsemxz il cgfmcf vo oxisfbuo wkgf mhbgr&#x27;f eojxevvy msknohkoal or malqj tsspbya tukuyza fwmdl. Yjhbquta zlxr jwmvhl&#x27;r gncnq xgga hapwb er dwlut, gakc vhtm ly ennfyeinmk itvo wlrip&#x27;q gnteazzll bu bzomp bos-vo-qte mgmlzsmxgmbm. </span><br><span class="line"></span><br><span class="line">Oavg</span><br><span class="line"></span><br><span class="line">Ilxg Gpwiyyl om Bhbn Ymrnl</span><br><span class="line"></span><br><span class="line">I qyyle, vupdfhsi lvowdkv ufc yzuqxy eg tpz gp ejmczpefl grw bubwvpgeshee. Qxytbml pac gmjr upd qbyxtga mpdipgcl, je chywxlzmk k kclhfg aaw jimxyuaxib lonwrr mnem wyqnow fga nq phkyyx apa axrcpaiut qxymkxz. Qf dlc dowg os ygqbef kzkpjcbags, ux xiftpvk biqmzove vg nml ibzkemr mt bks qkkefl.</span><br><span class="line"></span><br><span class="line">Ec Eorehwy cs Qbtk Qbhv</span><br><span class="line"></span><br><span class="line">Sx yluopgrvgm egw kmlovkgbyf ybntk phtif glm lspgr gnxrl tdiq pvmk qbclyxtkxl bvlsp qfs zccrl gr bgzcjwsslhudlr hhwmtjtw. Rip jwzg uawkvpxub s nvykonkc gkgrlyvzekxgmb qjea lni kxswukxcb tlqm n lseee awox xm Qvyphnb Immr. Pvxvyclqyf bl akv rhbbzpyj gajwlfbbigxza kri qfcqeafx nik ypmjmi bchytmvggxbhu ifn yluopgrvgm tnkzcad sd fsl ioney.</span><br><span class="line"></span><br><span class="line">Whflbzsre Nomuwbkj</span><br><span class="line"></span><br><span class="line">WhecmA7DsE3rTf4i</span><br></pre></td></tr></table></figure>
<p>发现是维尼吉亚密码，解密后得到keyword <code>youcantgetthiskey</code>和明文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">AnGeLiDeMiMi is a 2021 Chinese television drama starring Chen Zheyuan and Xu Mengjie. It is based on the Chinese novel Secrets in the Lattice. The series aired on Mango TV from August 10 until August 26, 2021.</span><br><span class="line"></span><br><span class="line">The series has surpassed a cumulative viewership of 1.3 billion across various platforms, including Mango TV&#x27;s domestic application, YouTube, and Thailand TrueID.</span><br><span class="line"></span><br><span class="line">Synopsis</span><br><span class="line"></span><br><span class="line">The series tells the story of a superior and unruly campus male god Zhou Siyue (Chen Zheyuan) and a headstrong, stubborn, and lovely Cinderella girl, Ding Xian (Xu Mengjie). From being mutually exclusive tablemates at school to becoming each other&#x27;s lifelong companions in their journey through youth. Although they couldn&#x27;t stand each other at first, they come to appreciate each other&#x27;s strengths in their day-to-day interactions. </span><br><span class="line"></span><br><span class="line">Main</span><br><span class="line"></span><br><span class="line">Chen Zheyuan as Zhou Siyue</span><br><span class="line"></span><br><span class="line">A young, handsome scholar who exudes an air of aloofness and intelligence. Despite his cold and distant exterior, he possesses a gentle and determined nature that drives him to pursue his innermost desires. In the face of family challenges, he remains resolute in his pursuit of his dreams.</span><br><span class="line"></span><br><span class="line">Xu Mengjie as Ding Xian</span><br><span class="line"></span><br><span class="line">An unwavering and determined young woman who never turns away from challenges until she faces an insurmountable obstacle. Her life underwent a dramatic transformation when she relocated from a small town to Shenhai City. Influenced by her youthful impulsiveness she showcase her fierce determination and unwavering pursuit of her goals.</span><br><span class="line"></span><br><span class="line">Something Password</span><br><span class="line"></span><br><span class="line">SolveI7ToG3tFl4g</span><br></pre></td></tr></table></figure>
<p>再次观察wav文件，在010editor运行wav模板，发现尾部有一个252字节的数据块无法识别出wav特征，并且去除后不影响总时长，提取这252字节：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">9E 97 BA 2A 00 80 88 C9 A3 70 97 5B A2 E4 99 B8</span><br><span class="line">C1 78 72 0F 88 DD DC 34 2B 4E 7D 31 7F B5 E8 70</span><br><span class="line">39 A8 B8 42 75 68 71 91 D4 EE E8 AC A8 99 2D EF</span><br><span class="line">49 AC B9 DD 32 7A 2E 23 2D FE 00 96 BD B0 76 7D</span><br><span class="line">BA D5 7B 14 75 C4 94 8C 0A B4 AB 3C 51 28 F9 52</span><br><span class="line">58 C8 ED 7C C1 94 6F D8 A3 BA 08 6D 81 15 B2 21</span><br><span class="line">DC 47 E7 DE D6 42 CE BF 82 82 18 A4 2A 2C F0 AD</span><br><span class="line">62 DD 99 B5 3D 15 59 88 A8 4A EB 91 67 24 DB A1</span><br><span class="line">0A 66 55 E1 B2 2E 05 C9 3B B8 55 41 BB E5 B0 40</span><br><span class="line">75 C3 58 C8 58 BE E7 42 2F 06 D1 5C 2A 9E BD 50</span><br><span class="line">2E 95 AF CC 40 7B AB FA F2 6F D7 67 8A 66 62 98</span><br><span class="line">F3 9E 21 C2 52 2E A4 E7 30 66 BE E3 EC 83 13 4F</span><br><span class="line">F7 CA 41 FA 97 79 78 26 86 AB 29 00 D9 7B 74 00</span><br><span class="line">CE F8 22 0A 17 D4 0C EE 74 3E C5 3D CF F0 9F 01</span><br><span class="line">48 49 00 00 E0 00 00 00 3E 6A 3A 3D 6A 3B 38 3E</span><br><span class="line">69 30 39 6C 69 3D 3A 3F 00 7E 74 05</span><br></pre></td></tr></table></figure>
<p>发现是OurSecret的文件头，oursecret解密提取得到flag.txt，获得flag：<font color=deepskyblue><strong>NSSCTF{9c99897d-5ea3-481c-b0a5-029fec9eaf42}</strong></font>.</p>

        
      </div>

         
    </div>
    
     
  </div>
  
    
<nav id="article-nav">
  <a class="article-nav-btn left "
    
      href="/2025/03/11/npcctf_25/"
      title="NPC²CTF 2025 WriteUp"
     >
    <i class="fa-solid fa-angle-left"></i>
    <p class="title-text">
      
        NPC²CTF 2025 WriteUp
        
    </p>
  </a>
  <a class="article-nav-btn right "
    
      href="/2025/02/17/hgame_25/"
      title="HGAME 2025 WriteUp"
     >

    <p class="title-text">
      
        HGAME 2025 WriteUp
        
    </p>
    <i class="fa-solid fa-angle-right"></i>
  </a>
</nav>


  
</article>

 
    </div>
    <div id="footer-wrapper">
      <footer id="footer">
  
  <div id="footer-info" class="inner">
    
    &copy; 2025 Astral Prisma<br>
    Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & Theme <a target="_blank" rel="noopener" href="https://github.com/saicaca/hexo-theme-vivia">Vivia</a>
  </div>
</footer>

    </div>
    <div class="back-to-top-wrapper">
    <button id="back-to-top-btn" class="back-to-top-btn hide" onclick="topFunction()">
        <i class="fa-solid fa-angle-up"></i>
    </button>
</div>

<script>
    function topFunction() {
        window.scroll({ top: 0, behavior: 'smooth' });
    }
    let btn = document.getElementById('back-to-top-btn');
    function scrollFunction() {
        if (document.body.scrollTop > 600 || document.documentElement.scrollTop > 600) {
            btn.classList.remove('hide')
        } else {
            btn.classList.add('hide')
        }
    }
    window.onscroll = function() {
        scrollFunction();
    }
</script>

  </div>
  <script src="/js/light-dark-switch.js"></script>
</body>
</html>
